<?xml version="1.0" encoding="UTF-8"?>
<view autoCancelInterval="90" isVisible="true" objectMode="SimpleDashboard" onunloadCancelJobs="true" refresh="-1" template="dashboard.html" stylesheet="vms.css">
    <label>Virtual Machines</label>
    <module name="AccountBar" layoutPanel="appHeader"/>
    <module name="AppBar" layoutPanel="navigationHeader"/>
    <module name="Message" layoutPanel="messaging">
        <param name="filter">*</param>
        <param name="clearOnJobDispatch">False</param>
        <param name="maxSize">1</param>
    </module>
    <module name="DashboardTitleBar" layoutPanel="viewHeader"/>
    <module name="Message" layoutPanel="navigationHeader">
        <param name="filter">splunk.search.job</param>
        <param name="clearOnJobDispatch">True</param>
        <param name="maxSize">1</param>
        <param name="level">warn</param>
    </module>
    
    <module name="GenericHeader" layoutPanel="panel_row1_col1">
        <param name="label">Virtual Machines</param>
    </module>
    <module name="TimeRangePicker" layoutPanel="panel_row1_col1" autoRun="true">
        <param name="searchWhenChanged">true</param>
        <param name="default">Last 4 Hours</param>
        
        <module name="SearchSelectLister" layoutPanel="panel_row1_col1">
            <param name="search">
              | inputlookup hv_type_lookup
            </param>
            <param name="label">Hypervisor type: </param>
            <param name="settingToCreate">hvtype_setting</param>
            <param name="staticFieldsToDisplay">
              <list>
                <param name="value">*</param>
                <param name="label">All</param>
              </list>
            </param>
            <param name="searchFieldsToDisplay">
              <list>
                <param name="value">product_value</param>
                <param name="label">product</param>
              </list>
            </param>
            <param name="selected">*</param>
            <param name="searchWhenChanged">True</param>
    
            <module name="ConvertToIntention">
                <param name="settingToConvert">hvtype_setting</param>
                <param name="intention">
                  <param name="name">stringreplace</param>
                  <param name="arg">
                    <param name="hvtype">
                      <param name="fillOnEmpty">True</param>
                      <param name="value">$target$</param>
                    </param>
                  </param>
                </param>
       
        <module name="HiddenSearch" layoutPanel="panel_row1_col1">
            <param name="search">
                eventtype=servervirt:host:$hvtype$ OR eventtype=servervirt:vm:$hvtype$ |
                fields hyp_hostname vm_id |
                stats dc(hyp_hostname) as num_hosts dc(vm_id) as num_vms
            </param>
            
            <module name="SingleValue" layoutPanel="panel_row1_col1">
                <param name="additionalClass">numHosts</param>
                <param name="beforeLabel">Host Count: </param>
                <param name="field">num_hosts</param>
                <param name="afterLabel">&amp;rarr;</param>
            </module>
            
            <module name="SingleValue" layoutPanel="panel_row1_col1">
                <param name="beforeLabel">Virtual Machine Count: </param>
                <param name="field">num_vms</param>
            </module>
        </module>
        
        <module name="HiddenSearch" layoutPanel="panel_row1_col1">
            <param name="search">
                eventtype=servervirt:vm:$hvtype$ vm_power_state="Running" |
                fields vm_id vm_host |
                stats dc(vm_id) as num_running_vms dc(vm_host) as num_hosts |
                eval avgVMperHost=round(num_running_vms/num_hosts, 2)
            </param>
            
            <module name="SingleValue" layoutPanel="panel_row1_col1">
                <param name="beforeLabel">Running Virtual Machine Count: </param>
                <param name="field">num_running_vms</param>
            </module>
            <module name="SingleValue" layoutPanel="panel_row1_col1">
                <param name="beforeLabel">Average VMs per Host: </param>
                <param name="field">avgVMperHost</param>
            </module>
        </module>   
  
        <module name="HiddenSearch" layoutPanel="panel_row2_col1" autoRun="True">
            <param name="search">
                eventtype=servervirt:performance:$hvtype$:vm:network OR
                eventtype=servervirt:performance:$hvtype$:vm:processor OR
                eventtype=servervirt:performance:$hvtype$:vm:disk |
                stats count by _time counter vm_name Value object
            </param>
            
            <module name="HiddenPostProcess" layoutPanel="panel_row2_col1" group="Top 5 Virtual Machines - CPU (combined)" autoRun="True">
                <param name="search">
                    | search counter="% Total Run Time" |
                    timechart max(Value) by vm_name useother=false limit=5 |
                    sort -max(Value)
                </param>
                <module name="JobProgressIndicator" />
                <module name="HiddenChartFormatter">
                    <param name="charting.chart">line</param>
                    <param name="charting.chart.nullValueMode">connect</param>
                    <param name="charting.legend.placement">bottom</param>
                    <param name="charting.axisTitleY.text">%</param>
                    <param name="charting.axisTitleX.text"> </param>
                    <param name="charting.axisY.minimumNumber">0</param>
                    <param name="charting.axisY.maximumNumber">100</param>
                    <module name="JSChart">
                        <param name="width">100%</param>
                    </module>
                    <module name="ViewRedirectorLink">
                        <param name="viewTarget">flashtimeline</param>
                    </module>
                </module>
            </module>
        
            <module name="HiddenPostProcess" layoutPanel="panel_row2_col2" group="Top 5 Virtual Machines - Network (combined)" autoRun="True">
                <param name="search">
                    | search counter="Bytes/sec" |
                    timechart max(Value) by vm_name useother=false limit=5 |
                    sort -max(Value)
                </param>
                <module name="JobProgressIndicator" />
                <module name="HiddenChartFormatter">
                    <param name="charting.chart">line</param>
                    <param name="charting.chart.nullValueMode">connect</param>
                    <param name="charting.legend.placement">bottom</param>
                    <param name="charting.axisTitleX.text"> </param>
                    <param name="charting.axisTitleY.text">Bps</param>
                    <param name="charting.axisY.minimumNumber">0</param>
                    <module name="JSChart">
                        <param name="width">100%</param>
                    </module>
                    <module name="ViewRedirectorLink">
                        <param name="viewTarget">flashtimeline</param>
                    </module>
                </module>
            </module>
            
            <module name="HiddenPostProcess" group="Top 5 Virtual Machines - Disk (combined)" layoutPanel="panel_row2_col3" autoRun="True">
                <param name="search">
                    | search object="*Virtual Storage Device" |
                    timechart max(Value) by vm_name useother=false limit=5 |
                    sort -max(Value)
                </param>
                
                <module name="JobProgressIndicator" />
                <module name="HiddenChartFormatter">
                    <param name="charting.chart">line</param>
                    <param name="charting.chart.nullValueMode">connect</param>
                    <param name="charting.legend.placement">bottom</param>
                    <param name="charting.axisTitleY.text">Bytes/Sec</param>
                    <param name="charting.axisTitleX.text"> </param>
                    <module name="JSChart">
                        <param name="width">100%</param>
                    </module>
                </module>
            </module>
            
        </module>
        
        <module name="HiddenSearch" layoutPanel="panel_row3_col1" group="All Hosts" autoRun="True">
            <param name="search">
                eventtype=servervirt:host:$hvtype$ | dedup hyp_hostname |
                fields hyp_hostname |
                table hyp_hostname |
                rename hyp_hostname as Hostname
            </param>
            <module name="StaticContentSample" layoutPanel="panel_row3_col1">
                <param name="text"><![CDATA[<img src="/static/app/SplunkAppForServerVirt/info.gif" class="info_icon" />]]> Click on a row below to view more details about the host.</param>
                <![CDATA[<span id="runningVMs" style="display:none"></span>]]>
            </module>
            <module name="JobProgressIndicator"/>
            <module name="Paginator">
                <param name="count">10</param>
                <param name="entityName">results</param>
                    <module name="SimpleResultsTable">
                        <param name="drilldown">row</param>
                        <module name="NullModule" />
                    </module>
                    <module name="ViewRedirectorLink">
                        <param name="viewTarget">flashtimeline</param>
                    </module>
            </module>
        </module>
        
        <module name="HiddenSearch" layoutPanel="panel_row3_col2" group="Running VMs" autoRun="True">
        <param name="search">
            eventtype=servervirt:vm:$hvtype$ vm_power_state="Running" |
            dedup vm_id |
            table vm_name, sourcetype, vm_host, guestOS, vm_toolstack_version |
            rename vm_name as "VM Name", vm_host as "Hostname", guestOS as "OS", vm_toolstack_version AS "Toolstack Version" |
            sort "VM Name" by Hostname
        </param>
        <module name="StaticContentSample" layoutPanel="panel_row3_col2">
            <param name="text">
                <![CDATA[<img src="/static/app/SplunkAppForServerVirt/info.gif" class="info_icon" />]]> Click on a row below to view more details about the virtual machine.
            </param>
        </module>
        <module name="JobProgressIndicator"/>
        <module name="Paginator" layoutPanel="panel_row3_col2">
            <param name="count">10</param>
            <param name="entityName">results</param>
            
            <module name="SimpleResultsTable">
                <param name="displayMenu">true</param>
                <param name="drilldown">row</param>
                <param name="displayRowNumbers">False</param>
                <module name="NullModule" />
            </module>
            <module name="ViewRedirectorLink">
                <param name="viewTarget">flashtimeline</param>
            </module>
        
        </module>
        
    </module>
        </module> <!-- ConvertToIntention (hvtype) -->
        </module> <!-- SearchSelectLister (hvtype) -->
    </module> <!-- TimeRangePicker -->
    
</view>
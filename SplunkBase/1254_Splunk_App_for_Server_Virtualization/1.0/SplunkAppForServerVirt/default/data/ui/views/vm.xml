<?xml version="1.0" encoding="UTF-8"?>
<view autoCancelInterval="90" isVisible="true" objectMode="SimpleDashboard" onunloadCancelJobs="true" refresh="-1" template="dashboard.html" stylesheet="vm.css">
    <label>Virtual Machine</label>
    <module name="AccountBar" layoutPanel="appHeader"/>
    <module name="AppBar" layoutPanel="navigationHeader"/>
    <module name="Message" layoutPanel="messaging">
        <param name="filter">*</param>
        <param name="clearOnJobDispatch">False</param>
        <param name="maxSize">1</param>
    </module>
    <module name="DashboardTitleBar" layoutPanel="viewHeader"/>
    <module name="Message" layoutPanel="navigationHeader">
        <param name="filter">splunk.search.job</param>
        <param name="clearOnJobDispatch">True</param>
        <param name="maxSize">1</param>
        <param name="level">warn</param>
    </module>
    
    <module name="ExtendedFieldSearch" layoutPanel="panel_row1_col1_grp1">
        <param name="intention">
            <param name="name">stringreplace</param>
            <param name="arg">
                <param name="vmname">
                    <param name="default"></param>
                </param>
            </param>
        </param>

        <param name="replacementMap">
            <param name="arg">
                <param name="vmname">
                    <param name="value"></param>
                </param>
            </param>
        </param>

        <param name="field">hostname</param>
        <param name="label">VM: </param>
        
        <module name="HiddenSearch" autoRun="false" layoutPanel="panel_row1_col1_grp2">
            <param name="search">
                `servervirt_index` sourcetype=hypervisor:*:vm vm_name="$vmname$" |
                head 1 |
                fields vm_host vm_cpu_count
            </param>

            <module name="SingleValue" layoutPanel="panel_row1_col1_grp1">
                <param name="additionalClass">residentOn</param>
                <param name="beforeLabel">Resident on: </param>
                <param name="field">vm_host</param>
                <param name="afterLabel">&amp;rarr;</param>
            </module>
            
            <module name="SingleValue" layoutPanel="panel_row1_col1_grp1">
                <param name="beforeLabel">CPU Count: </param>
                <param name="field">vm_cpu_count</param>
            </module>
                
        </module>
            
            <module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp3">
            <param name="default">Last 4 Hours</param>
            <param name="searchWhenChanged">True</param>

            <module name="HiddenSearch" layoutPanel="panel_row2_col1" autoRun="false">
                <param name="search">
                    (eventtype=servervirt:performance:*:vm:processor instance!="_Total") OR
                    (eventtype=servervirt:performance:*:vm:network counter!="Bytes Total/sec") OR
                    (eventtype=servervirt:performance:*:vm:disk)
                    vm_name=*$vmname$* |
                    fields counter instance Value object |
                    fillnull |
                    stats count by _time counter instance Value object
                </param>
                
                <module name="HiddenPostProcess" group="Processor Utilization" layoutPanel="panel_row2_col1" autoRun="false">
                    <param name="search">
                        | search counter="% Total Run Time" |
                        eval instance_name="CPU ".instance |
                        timechart max(Value) by instance_name useother=false limit=0
                    </param>
                    
                    <module name="JobProgressIndicator" />
                    <module name="HiddenChartFormatter">
                        <param name="charting.chart">line</param>
                        <param name="charting.chart.nullValueMode">connect</param>
                        <param name="charting.legend.placement">right</param>
                        <param name="charting.axisTitleY.text">%</param>
                        <param name="charting.axisY.minimumNumber">0</param>
                        <param name="charting.axisY.maximumNumber">100</param>
                        <param name="charting.axisTitleX.text"> </param>
                        <module name="JSChart">
                            <param name="width">100%</param>
                        </module>
                    </module>

                </module>
                
                <module name="HiddenPostProcess" group="Network Utilization" layoutPanel="panel_row2_col2" autoRun="false">
                    <param name="search">
                        | search counter="Bytes */sec" |
                        timechart max(Value) by instance useother=false limit=0
                    </param>
                    
                    <module name="JobProgressIndicator" />
                    <module name="HiddenChartFormatter">
                        <param name="charting.chart">line</param>
                        <param name="charting.chart.nullValueMode">connect</param>
                        <param name="charting.legend.placement">right</param>
                        <param name="charting.axisTitleY.text"> </param>
                        <param name="charting.axisTitleX.text"> </param>
                        <module name="JSChart">
                            <param name="width">100%</param>
                        </module>
                    </module>
                </module> <!-- HiddenPostProcess Network -->
                
                <module name="HiddenPostProcess" group="Virtual Disk Performance" layoutPanel="panel_row2_col3" autoRun="false">
                    <param name="search">
                        | search object="*Virtual Storage Device" |
                        eval obj = counter." ".instance |
                        timechart max(Value) by obj useother=false limit=0
                    </param>
                    
                    <module name="JobProgressIndicator" />
                    <module name="HiddenChartFormatter">
                        <param name="charting.chart">line</param>
                        <param name="charting.chart.nullValueMode">connect</param>
                        <param name="charting.legend.placement">right</param>
                        <param name="charting.axisTitleY.text">Bytes/Sec</param>
                        <param name="charting.axisTitleX.text"> </param>
                        <module name="JSChart">
                            <param name="width">100%</param>
                        </module>
                    </module>
                </module> <!-- HiddenPostProcess Disk -->
                
            </module> <!-- HiddenSearch -->
            
            
            <module name="TimeRangePicker" layoutPanel="panel_row3_col1">
                <param name="default">Last 7 Days</param>
                <param name="searchWhenChanged">True</param>
                <module name="HiddenSearch" autoRun="false" layoutPanel="panel_row3_col1" group="Host Residence History">
                    <param name="search">
                        `servervirt_index` sourcetype=hypervisor:*:vm vm_name="$vmname$"  |
                        dedup vm_host |
                        fields vm_host  |
                        eval Time=strftime(_time, "%Y-%m-%d %H:%M:%S") |
                        rename vm_host as "Hostname" |
                        table Hostname Time
                    </param>
                    <module name="StaticContentSample" layoutPanel="panel_row3_col1">
                        <param name="text">
                            <![CDATA[<img src="/static/app/SplunkAppForServerVirt/info.gif" class="info_icon" />]]> Click on a row below to view more details about the virtual machine.
                        </param>
                    </module>
                    <module name="JobProgressIndicator"  />
                        
                    <module name="Paginator">
                        <param name="count">10</param>
                        <param name="entityName">results</param>
                        
                        <module name="SimpleResultsTable">
                            <param name="displayMenu">true</param>
                            <param name="drilldown">row</param>
                            <param name="displayRowNumbers">False</param>
                            <module name="NullModule" />
                        </module>
                    </module> <!-- End Paginator -->
                </module> <!-- End Hidden Search -->
            </module>
        
            <module name="TimeRangePicker" layoutPanel="panel_row3_col2">
                <param name="default">Last 7 Days</param>
                <param name="searchWhenChanged">True</param>
                <module name="HiddenSearch" autoRun="false" layoutPanel="panel_row3_col2" group="Events">
                    <param name="search">
                        eventtype=servervirt:message:* $vmname$ |
                        dedup msg_id |
                        eval Time=strftime(_time, "%Y-%m-%d %H:%M:%S") |
                        table Time msg_body |
                        rename msg_body as Message
                    </param>
                        
                    <module name="JobProgressIndicator"  />
                    <module name="Paginator">
                        <param name="count">10</param>
                        <param name="entityName">results</param>
                        
                        <module name="SimpleResultsTable">
                            <param name="displayMenu">true</param>
                            <param name="drilldown">row</param>
                            <param name="displayRowNumbers">False</param>
                            <module name="NullModule" />
                        </module>
                    </module>
                </module>
            </module>
            
            <module name="TimeRangePicker" layoutPanel="panel_row3_col3">
                <param name="default">Last 24 Hours</param>
                <param name="searchWhenChanged">True</param>
                <module name="HiddenSearch" autoRun="false" layoutPanel="panel_row3_col3" group="Alerts">
                    <param name="search">
                        index=servervirt_alerts obj_name=$vmname$ |
                        eval Time=strftime(_time, "%Y-%m-%d %H:%M:%S") |
                        table Time alert_name value severity |
                        rename alert_name AS "Alert Name" value AS Value severity AS Severity
                    </param>
                        
                    <module name="JobProgressIndicator"  />
                    <module name="Paginator">
                        <param name="count">10</param>
                        <param name="entityName">results</param>
                        
                        <module name="SimpleResultsTable">
                            <param name="displayMenu">true</param>
                            <param name="drilldown">row</param>
                            <param name="displayRowNumbers">False</param>
                            <module name="NullModule" />
                        </module>
                    </module>
                </module>
            </module>
    
    </module> <!-- End ExtendedFieldSearch -->
    </module> <!-- End TimeRangePicker -->
    
</view>
<?xml version="1.0" encoding="UTF-8"?>
<view autoCancelInterval="90" isVisible="true" objectMode="SimpleDashboard" onunloadCancelJobs="true" refresh="-1" template="dashboard.html" stylesheet="environment.css">
  <label>Enterprise Environment</label>
  <module name="AccountBar" layoutPanel="appHeader"/>
  <module name="AppBar" layoutPanel="navigationHeader"/>
  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="clearOnJobDispatch">False</param>
    <param name="maxSize">1</param>
  </module>
  <module name="DashboardTitleBar" layoutPanel="viewHeader"/>
  <module name="Message" layoutPanel="navigationHeader">
    <param name="filter">splunk.search.job</param>
    <param name="clearOnJobDispatch">True</param>
    <param name="maxSize">1</param>
    <param name="level">warn</param>
  </module>
  
  <module name="SearchSelectLister" layoutPanel="panel_row1_col1">
    <param name="search">
      | inputlookup hv_type_lookup
    </param>
    <param name="label">Hypervisor type: </param>
    <param name="settingToCreate">hvtype_setting</param>
    <param name="staticFieldsToDisplay">
      <list>
        <param name="value">*</param>
        <param name="label">All</param>
      </list>
    </param>
    <param name="searchFieldsToDisplay">
      <list>
        <param name="value">product_value</param>
        <param name="label">product</param>
      </list>
    </param>
    <param name="selected">*</param>
    <param name="searchWhenChanged">True</param>
    
    <module name="ConvertToIntention">
    <param name="settingToConvert">hvtype_setting</param>
    <param name="intention">
      <param name="name">stringreplace</param>
      <param name="arg">
        <param name="hvtype">
          <param name="fillOnEmpty">False</param>
          <param name="value">$target$</param>
        </param>
      </param>
    </param>
            
  
    <module name="TimeRangePicker" layoutPanel="panel_row1_col1" autoRun="false">
      <param name="searchWhenChanged">true</param>
      <param name="default">Last 4 Hours</param>
      
      <!-- Start Environment Counts -->
      <module name="HiddenSearch" layoutPanel="panel_row2_col1">
        <param name="search">
          eventtype=servervirt:$hvtype$:cluster |
          dedup hyp_clust_id |
          stats count as num_clusters
        </param>
      
        <module name="SingleValue" layoutPanel="panel_row2_col1_grp1">
          <param name="additionalClass">clusterIcon</param>
          <param name="beforeLabel">Clusters: </param>
          <param name="field">num_clusters</param>
        </module>
      </module>
      
      <module name="HiddenSearch" layoutPanel="panel_row2_col1">
        <param name="search">
          index=servervirt_summary search_name="Summary - Hosts" orig_sourcetype=hypervisor:$hvtype$:host |
          dedup hyp_hostname |
          stats count as num_hosts
        </param>
      
        <module name="SingleValue" layoutPanel="panel_row2_col1_grp2">
          <param name="additionalClass">hostIcon</param>
          <param name="beforeLabel">Hosts: </param>
          <param name="field">num_hosts</param>
        </module>
      </module>
      
      <module name="HiddenSearch" layoutPanel="panel_row2_col1">
        <param name="search">
          index=servervirt_summary search_name="Summary - VMs" orig_sourcetype=hypervisor:$hvtype$:vm |
          dedup vm_id |
          stats count as num_vms
        </param>
      
        <module name="SingleValue" layoutPanel="panel_row2_col1_grp3">
          <param name="additionalClass">vmIcon</param>
          <param name="beforeLabel">VMs: </param>
          <param name="field">num_vms</param>
        </module>
      </module>
      
      <module name="HiddenSearch" layoutPanel="panel_row2_col1">
        <param name="search">
          eventtype=servervirt:$hvtype$:sr | dedup sr_id | fields sr_id | stats count as num_srs
        </param>
      
        <module name="SingleValue" layoutPanel="panel_row2_col1_grp4">
          <param name="additionalClass">vmStoreIcon</param>
          <param name="beforeLabel">Storage Pools: </param>
          <param name="field">num_srs</param>
        </module>
      </module>
      <!-- End Environment Counts -->
      
      <!-- Start Performance -->
      <module name="HiddenSearch" layoutPanel="panel_row3_col1" group="Top 5 Hosts - CPU (combined)">
        <param name="search">
          index=servervirt_summary search_name="Summary - Host Performance Processor"
            [ | inputlookup host_sourcetypes.csv | search sourcetype=hypervisor:$hvtype$:host | fields hyp_hostname ] |
          timechart max(Value) by hyp_hostname useother=false limit=5 |
          sort -max(Value)
        </param>
        <module name="JobProgressIndicator" />
        <module name="HiddenChartFormatter">
          <param name="charting.chart">line</param>
          <param name="charting.chart.nullValueMode">connect</param>
          <param name="charting.legend.placement">bottom</param>
          <param name="charting.axisTitleY.text">%</param>
          <param name="charting.axisY.minimumNumber">0</param>
          <param name="charting.axisY.maximumNumber">100</param>
          <param name="charting.axisTitleX.text"> </param>
          <module name="JSChart">
              <param name="width">100%</param>
              <module name="NullModule" />
          </module>
          <module name="ViewRedirectorLink">
              <param name="viewTarget">flashtimeline</param>
          </module>
        </module>
      </module>
         
      <module name="HiddenSearch" layoutPanel="panel_row3_col2" group="Top 5 Hosts - Available Memory">
        <param name="search">
          index=servervirt_summary search_name="Summary - Host Performance Memory" 
            [ | inputlookup host_sourcetypes.csv | search sourcetype=hypervisor:$hvtype$:host | fields hyp_hostname ] |
          eval MB=`toMB(Value)` |
          timechart min(MB) by hyp_hostname useother=false limit=5 |
          sort -min(MB)
        </param>
        <module name="JobProgressIndicator" />
          <module name="HiddenChartFormatter">
            <param name="charting.chart">line</param>
            <param name="charting.chart.nullValueMode">connect</param>
            <param name="charting.legend.placement">bottom</param>
            <param name="charting.axisTitleX.text"> </param>
            <param name="charting.axisTitleY.text">MB</param>
            <param name="charting.axisY.minimumNumber">0</param>
            <module name="JSChart">
              <param name="width">100%</param>
              <module name="NullModule" group="blah">
              </module>
            </module>
            <module name="ViewRedirectorLink">
              <param name="viewTarget">flashtimeline</param>
            </module>
          </module>
      </module>
      <!-- End Performance -->
      
      <!-- Start Running VMs -->
      <module name="HiddenSearch" layoutPanel="panel_row4_col1" group="Running VMs">
          <param name="search">
              eventtype=servervirt:vm:$hvtype$ vm_power_state="Running" |
              fields vm_id vm_name sourcetype vm_host guestOS vm_toolstack_version |
              dedup vm_id |
              table vm_name, sourcetype, vm_host, guestOS, vm_toolstack_version |
              rename vm_name as "VM Name", vm_host as "Hostname", guestOS as "OS", vm_toolstack_version AS "Toolstack Version" |
              sort "VM Name" by Hostname
          </param>
          <module name="StaticContentSample" layoutPanel="panel_row4_col1">
              <param name="text">
                <![CDATA[<img src="/static/app/SplunkAppForServerVirt/info.gif" class="info_icon" />]]> Click on a row below to view more details about the virtual machine.
                <![CDATA[<span id="runningVMs" style="display:none"></span>]]>
              </param>
          </module>
          <module name="JobProgressIndicator"/>
          <module name="Paginator" layoutPanel="panel_row4_col1">
              <param name="count">10</param>
              <param name="entityName">results</param>
              
              <module name="SimpleResultsTable" altTitle="test">
                  <param name="displayMenu">true</param>
                  <param name="drilldown">row</param>
                  <param name="displayRowNumbers">False</param>
                  <module name="NullModule" />
              </module>
              <module name="ViewRedirectorLink">
                  <param name="viewTarget">flashtimeline</param>
              </module>
          
          </module>
      </module>
      <!-- End Running VMs -->
      
    </module> <!-- TimeRangePicker -->
          
    <module name="TimeRangePicker" layoutPanel="panel_row4_col2" autoRun="false">
        <param name="searchWhenChanged">true</param>
        <param name="default">Last 24 Hours</param>
        <module name="HiddenSearch" layoutPanel="panel_row4_col2" group="Latest System Messages">
            <param name="search">
                eventtype=servervirt:message:$hvtype$ (msg_type="Error" OR msg_type="Warning") |
                dedup msg_id |
                fields msg_source, msg_subject, msg_body |
                eval Time=strftime(_time, "%Y-%m-%d %H:%M:%S") |
                table msg_body, Time, msg_source, msg_subject |
                rename msg_source as "Applies To" msg_subject as "Message" msg_body as "System Message Details"
            </param>
       
            <module name="StaticContentSample" layoutPanel="panel_row4_col2">
              <param name="text">
                <![CDATA[<img src="/static/app/SplunkAppForServerVirt/info.gif" class="info_icon" />]]> Click on a row below to view more details about the system message.
                <![CDATA[<span id="systemMessages" style="display:none"></span>]]>
              </param>
            </module>
            <module name="JobProgressIndicator" />
            <module name="Paginator">
                <param name="count">10</param>
                <param name="entityName">results</param>
                
                    <module name="SimpleResultsTable">
                        <param name="drilldown">row</param>
                        <param name="displayRowNumbers">False</param>
                        <module name="NullModule" />
                    </module>
                    <module name="ViewRedirectorLink">
                        <param name="viewTarget">flashtimeline</param>
                    </module>
            </module>
        </module>
      </module>
    
      <module name="TimeRangePicker" layoutPanel="panel_row4_col3">
        <param name="default">Last 24 Hours</param>
        <param name="searchWhenChanged">True</param>
        <module name="HiddenSearch" autoRun="false" layoutPanel="panel_row4_col3" group="Latest Alerts">
            <param name="search">
                index=servervirt_alerts orig_eventtype=*$hvtype$* |
                eval Time=strftime(_time, "%Y-%m-%d %H:%M:%S") |
                table Time alert_name value severity |
                rename alert_name AS "Alert Name" value AS Value severity AS Severity
            </param>
                
            <module name="JobProgressIndicator"  />
            <module name="Paginator">
                <param name="count">10</param>
                <param name="entityName">results</param>
                
                <module name="SimpleResultsTable">
                    <param name="displayMenu">true</param>
                    <param name="drilldown">row</param>
                    <param name="displayRowNumbers">False</param>
                    <module name="NullModule" />
                </module>
            </module>
        </module>
      </module>
    

    </module> <!-- End ConvertToIntention (hvtype) -->
  </module> <!-- End SearchSelectLister -->
  
  <module name="StaticContentSample" layoutPanel="panel_row5_col1">
      <param name="text"><![CDATA[<div id="dialog" title="System Event Details" style="white-space: pre;"></div>]]></param>
  </module>
  
</view>
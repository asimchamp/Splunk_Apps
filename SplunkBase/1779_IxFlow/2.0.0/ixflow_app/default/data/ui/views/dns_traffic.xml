<form>
  <label>DNS Traffic</label>
  <fieldset submitButton="true" autoRun="true">
    <input type="time">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="top">
      <label>Top</label>
      <choice value="10">10</choice>
      <choice value="25">25</choice>
      <choice value="50">50</choice>
      <default>10</default>
      <initialValue>10</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>DNS Classes Distribution</title>
      <viz type="ixflow_app.c3donut">
        <search>
          <query>| tstats `svalue` count from datamodel=Ixia where Ixia_Flow.dns_classes!="" by Ixia_Flow.dns_classes | sort 0 - count | head $top$</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="ixflow_app.c3donut.expand">0</option>
        <option name="ixflow_app.c3donut.label_format">%</option>
        <option name="ixflow_app.c3donut.label_show">0</option>
        <option name="ixflow_app.c3donut.label_threshold">0.15</option>
        <option name="ixflow_app.c3donut.label_value">ratio</option>
        <option name="ixflow_app.c3donut.legend_position">bottom</option>
        <option name="ixflow_app.c3donut.legend_show">1</option>
        <option name="ixflow_app.c3donut.tooltip_format">%</option>
        <option name="ixflow_app.c3donut.tooltip_show">1</option>
        <option name="ixflow_app.c3donut.tooltip_value">default</option>
      </viz>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top DNS TXTs</title>
      <table>
        <search>
          <query>| tstats `svalue` count as Counts, latest(Ixia_Flow.flow_end_time_milli) as time  from datamodel=Ixia where Ixia_Flow.dns_record_txt!="" by Ixia_Flow.dns_record_txt | rename Ixia_Flow.dns_record_txt as "DNS TXTs" | eval time = time/1000 | eval "Last Reported" = strftime(time, "%Y-%M-%d %H:%M:%S %Z") | sort 0 - Counts | table "DNS TXTs", Counts, "Last Reported" | head $top$</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">search?q=sourcetype="stream:netflow" dns_record_txt="$row.DNS TXTs$"&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top DNS Hostnames</title>
      <table>
        <search>
          <query>| tstats `svalue` count as Counts, latest(Ixia_Flow.flow_end_time_milli) as time, values(Ixia_Flow.query_response) as "Type(Query/Response)" from datamodel=Ixia where  Ixia_Flow.host_name!="" by Ixia_Flow.host_name | rename Ixia_Flow.host_name as Hostname | eval time = time/1000 | eval "Last Reported" = strftime(time, "%Y-%M-%d %H:%M:%S %Z") | sort 0 - Counts | table  Hostname, Counts, "Type(Query/Response)", "Last Reported" | head $top$</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">search?q=sourcetype="stream:netflow" host_name="$row.Hostname$"&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top Service Provider</title>
      <input type="dropdown" token="service_provider" searchWhenChanged="true">
        <label>From</label>
        <choice value="source">Source</choice>
        <choice value="destination">Destination</choice>
        <default>source</default>
        <initialValue>source</initialValue>
      </input>
      <table>
        <search>
          <query>| tstats `svalue` count(Ixia_Flow.packets) as Counts, latest(Ixia_Flow.flow_end_time_milli) as time, from datamodel=Ixia where Ixia_Flow.$service_provider$_as_name!="" by Ixia_Flow.$service_provider$_as_name | rename Ixia_Flow.$service_provider$_as_name as "AS Name" | eval time = time/1000  | eval "Last Reported" = strftime(time, "%Y-%M-%d %H:%M:%S %Z") | sort 0 - Counts | table "AS Name", Counts, "Last Reported" | head $top$</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">search?q=sourcetype="stream:netflow" $service_provider$_as_name="$row.AS Name$" packets!=""&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
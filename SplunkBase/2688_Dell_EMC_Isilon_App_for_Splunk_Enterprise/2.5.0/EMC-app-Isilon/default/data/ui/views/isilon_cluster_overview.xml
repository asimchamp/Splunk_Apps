<form stylesheet="clusterdetails.css" script="clusterdetails.js">
  <label>Cluster Overview</label>
  <search id="baseSearch">
    <query>|`cluster_overview($cluster$)` | table _time stats.key lnn stats.value</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time</label>
      <default>
        <earliest>-2h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="cluster" searchWhenChanged="true">
      <label>Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>|`cluster_list`</query>
        <earliest>$time.earliest$</earliest>
        <latest>$time.latest$</latest>
      </search>
      <fieldForLabel>Cluster_Name</fieldForLabel>
      <fieldForValue>Cluster_Name</fieldForValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <div class="detail_view_title">Summary</div>
        <div id="summary"/> 
      </html>
    </panel>
    <panel>
      <html>
        <div class="detail_view_title">Version Details</div>
        <div id="versiondetails"/> 
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Disk Usage</title>
        <search base="baseSearch">
          <query>| search (stats.key="ifs.bytes.avail" OR stats.key="ifs.bytes.used" OR stats.key="ifs.ssd.bytes.free" OR stats.key="ifs.ssd.bytes.used") | eval Usage = case('stats.key'="ifs.bytes.avail","HDD Available",'stats.key'="ifs.bytes.used","HDD Used",'stats.key'="ifs.ssd.bytes.free","SSD Available",'stats.key'="ifs.ssd.bytes.used","SSD Used")  | `bytes_to_gb_tb_pb('stats.value')` |  eval Usage = Usage . " (in GB)" | stats latest(bytes_gb) AS Space by Usage</query>
        </search>
        <option name="charting.axisTitleY.text">Disk Usage (%)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Cluster Disk Usage over Time</title>
        <search base="baseSearch">
          <query>| search stats.key = "ifs.percent.used"  | eval Space = case('stats.key'="ifs.percent.used", "Used (in %)") | eval stats.value = round('stats.value',2) | timechart avg(stats.value) by Space | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Disk Usage (%)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>FileSystem  Throughput over Time</title>
        <search base="baseSearch">
          <query>| search (stats.key="node.ifs.bytes.in.rate" OR stats.key="node.ifs.bytes.out.rate") | eval traffic_type = case('stats.key'="node.ifs.bytes.in.rate", "Inbound", 'stats.key'="node.ifs.bytes.out.rate", "Outbound") | eval stats.value = ifnull(round(('stats.value'*8)/(1000*1000),2),0) | timechart span=2min sum(stats.value) by traffic_type | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Data Transfer (Mbps)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>External Network Throughput Rate over Time</title>
        <search base="baseSearch">
          <query>| search (stats.key="node.net.ext.bytes.out.rate" OR stats.key="node.net.ext.bytes.in.rate" ) |`bytes_to_kb_mb_gb('stats.value'*8)` | timechart span=2m sum(bytes_mb) as "Throughput Rate (Mbps)" | fields - NULL</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisTitleY.text">Throughput (Mbps)</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>CPU Usage over Time</title>
        <search base="baseSearch">
          <query>| search (stats.key="cluster.cpu.user.max" OR stats.key="cluster.cpu.sys.max") | eval usage_by = case('stats.key'="cluster.cpu.user.max", "User", 'stats.key'="cluster.cpu.sys.max", "System") | eval stats.value = round(('stats.value'/10),1) | timechart span=2m avg(stats.value) by usage_by | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">CPU Usage (%)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Client Connections over Time</title>
        <search base="baseSearch">
          <query>| search stats.key="node.clientstats.connected.*"|  eval Node_ID="Node".'lnn' | timechart max(stats.value) as Connections by Node_ID | fields - NULL</query>
        </search>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Connections</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Events Severity Summary</title>
        <search>
          <query>|`events_list($cluster$)` | dedup events.id  | table events.id,"Start Time","End Time",events.severity,events.message,Scope | rename events.message AS Message events.id AS Event_Id events.severity AS Severity | stats count by Severity | sort count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Severity</option>
        <option name="charting.axisTitleY.text">Event Count</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>Major Problems (Critical Events)</title>
        <search>
          <query>|`events_list($cluster$)` | search events.severity = "critical" | dedup events.id | table _time events.id "Start Time"  events.message Scope | rename events.message as "Message", events.id as "Event_Id" "Start Time" as "Time"  | sort _time | fields - _time | fillnull value="N/A" Scope</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>
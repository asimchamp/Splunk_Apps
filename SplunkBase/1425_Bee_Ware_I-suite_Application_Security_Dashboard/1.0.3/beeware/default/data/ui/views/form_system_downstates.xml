<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>Down states</label>
  	<searchTemplate>sourcetype=beeware bw_eventlogs_class="MONITORING" bw_ibox_name="$bw_ibox_name$" monitoring_metric="$monitoring_metric$" | fields bw_ibox_name monitoring_metric monitoring_state monitoring_object</searchTemplate>    
    <fieldset autoRun="true">
        <input type="dropdown" token="bw_ibox_name">
   <label> filter by ibox </label>
   <populatingSearch fieldForValue="bw_ibox_name" fieldForLabel="bw_ibox_name"><![CDATA[sourcetype=beeware bw_eventlogs_class="MONITORING" | table bw_ibox_name | dedup bw_ibox_name]]></populatingSearch>
    <choice value="*">All</choice>
</input>

        <input type="dropdown" token="monitoring_metric">
   <label> filter by event </label>
   <populatingSearch fieldForValue="monitoring_metric" fieldForLabel="monitoring_metric"><![CDATA[sourcetype=beeware bw_eventlogs_class="MONITORING" | table monitoring_metric | dedup monitoring_metric]]></populatingSearch>
    <choice value="*">All</choice>
</input>
        
        <input type="time">
      <default>Last 4 hours</default>
    </input>
  </fieldset>

  <row>
	<single>
    <searchPostProcess> search monitoring_metric="rp.running.value" monitoring_state="*trigger*" | stats count as result | rangemap field=result low=0-15 elevated=20-50 default=severe</searchPostProcess>
		<title>Reverses Proxies down states</title>
    </single>
      <single>
      <searchPostProcess> search monitoring_metric = "tunnels.listen.value" monitoring_state="*trigger*" | stats count as result | rangemap field=result low=0-15 elevated=20-50 default=severe </searchPostProcess>
      <title>Tunnels down states</title>
    </single>
    <single>
      <searchPostProcess> search monitoring_metric = "tunnels.backend.value" monitoring_state="*trigger*" | stats count as result | rangemap field=result low=0-15 elevated=20-50 default=severe </searchPostProcess>
      <title>Backends down states</title>
    </single>
  </row>
    
   <row>
    <chart>
      <searchPostProcess> search monitoring_metric = "tunnels.backend.value" monitoring_state="*trigger*" | stats count(monitoring_object) as "down states" by monitoring_object </searchPostProcess> 
      <title>Backends down states by tunnel</title>
      <option name="charting.chart">bar</option>
    </chart>
   </row>

  <row>
    <table>
      <searchPostProcess> eval status=if(monitoring_state=="normal value","normal","warning") | table _time bw_ibox_name monitoring_object monitoring_metric status | rename monitoring_metric as event monitoring_object as object  </searchPostProcess> 
        <option name="count">10</option>
      <title>10 last messages</title>
    </table>
  </row>

</form>
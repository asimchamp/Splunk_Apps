<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>Security</label>
  	<searchTemplate>sourcetype=beeware AND bw_log_source != "Event Logs" bw_tunnel_name="$bw_tunnel_name$" | fields bw_tunnel_name bw_log_class bw_eventlogs_class iam_result icx_src_ip icx_trap icx_target_url icx_target_www icx_target_page</searchTemplate>    
    <fieldset autoRun="true">
        <input type="dropdown" token="bw_tunnel_name">
   <label> filter by tunnel </label>
   <populatingSearch fieldForValue="bw_tunnel_name" fieldForLabel="bw_tunnel_name"><![CDATA[sourcetype=beeware AND bw_log_source != "Event Logs" | table bw_tunnel_name | dedup bw_tunnel_name]]></populatingSearch>
    <choice value="*">All</choice>
</input>

        <input type="time">
      <default>Last 4 hours</default>
    </input>
  </fieldset>

  <row>
    <single>
      <searchPostProcess> search (bw_log_class=BLOCKED OR (bw_log_class="BLOCKED INTERNAL" AND bw_eventlogs_class!="HEADER*") ) | stats count(bw_log_class) as result | rangemap field=result low=0-15 elevated=20-50 default=severe </searchPostProcess>
      <title>Attacks blocked</title>
    </single>
    <single>
      <searchPostProcess> search bw_log_class=ALERT | stats count(bw_log_class) as result | rangemap field=result low=0-15 elevated=20-50 default=severe </searchPostProcess>
      <title>Alerts</title>
    </single>
  </row>

  <row>
    <table>
      <searchPostProcess> search  bw_log_class=BLOCKED OR (bw_log_class="BLOCKED INTERNAL" AND bw_eventlogs_class!="HEADER*") | table _time icx_src_ip icx_trap icx_target_url | rename  icx_src_ip as "source ip" icx_trap as "attack" icx_target_url as "target url"</searchPostProcess> 
        <option name="count">10</option>
      <title>10 last attacks</title>
    </table>
  </row>

  <row>
    <chart>
      <searchPostProcess> search bw_log_class=BLOCKED OR bw_log_class=ALERT | stats count(bw_log_class) as attacks by bw_tunnel_name | sort -attacks</searchPostProcess> 
      <title>Attacks and alerts by tunnel</title>
      <option name="charting.chart">bar</option>
    </chart>
   </row>

   <row>
    <table>
      <searchPostProcess> search bw_log_class=BLOCKED OR bw_log_class=ALERT | stats count(icx_src_ip) as Hits by icx_src_ip | rename icx_src_ip as ip | sort -Hits </searchPostProcess> 
        <option name="count">10</option>      
        <option name="dataOverlayMode">heatmap</option>
      <title>Top attackers source</title>
    </table>

    <chart>
      <searchPostProcess> search bw_log_class=BLOCKED | lookup geoip clientip as icx_src_ip | stats count(client_country) as Hits by client_country </searchPostProcess> 
      <title>Attackers countries</title>
      <option name="charting.chart">pie</option>
    </chart>
       
  </row>
  <row>
    <table>
      <searchPostProcess> search bw_log_class=BLOCKED | stats count(bw_tunnel_name) as Hits by bw_tunnel_name,icx_target_page | rename bw_tunnel_name as "tunnel" icx_target_page as "target page" | sort -Hits</searchPostProcess> 
        <option name="count">10</option>
        <option name="dataOverlayMode">heatmap</option>
      <title>top target pages</title>
    </table>
      
  </row>
  <row>
    <table>
      <searchPostProcess> search (bw_log_class=BLOCKED OR (bw_log_class="BLOCKED INTERNAL" AND bw_eventlogs_class!="HEADER*") ) | top icx_trap limit=50 | rename icx_trap as "Attack type"</searchPostProcess> 
        <option name="count">10</option>
        <option name="dataOverlayMode">heatmap</option>
      <title>top attack types</title>
    </table>
      
  </row>
    
</form>

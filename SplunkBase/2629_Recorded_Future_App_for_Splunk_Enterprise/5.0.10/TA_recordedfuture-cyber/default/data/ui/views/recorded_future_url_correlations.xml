<dashboard script="js/evidence.js" stylesheet="css/recorded_future_correlation.css">
  <label>Recorded Future URL Log Correlation</label>
  <!-- Original search using real data
  <search id="core">
    <query>
      sourcetype="squid:access" earliest=-24h 
      | eval Name=url
      | join Name [|inputlookup rf_url_risklist.csv | table *]
      | search EvidenceDetails != ""
    </query>
  </search>
  -->
  <search id="core">
    <query>
      | rest splunk_server=local /services/TA_recordedfuture-cyber/sample_data type=url
      | sort -Risk
    </query>
  </search>
  <row>
    <html>
      <div class="help-link" style="float: right; text-align: right;">
        <img src="/static/app/TA_recordedfuture-cyber/img/logo.svg" alt="Recorded Future, Inc logotype" style="height: 30px;"/><br/>
        <a href="/app/TA_recordedfuture-cyber/recorded_future_help_correlation_dashboards" target="_blank">Help</a>
      </div>
      <div>
        <h1>
          This dashboard displays correlated URLs with Recorded Future's URL Risk List.
        </h1>
      </div>
    </html>
  </row>
  <row>
    <panel>
      <single>
        <title>Summary</title>
        <search base="core">
          <query>
            | stats dc(Name) as count
            | fields count
            | rangemap field=count low=0-0 evelated=1-1 default=severe
          </query>
        </search>
        <option name="underLabel">High Risk URLs</option>
        <option name="refresh.time.visible">false</option>
        <option name="drilldown">none</option>
      </single>
    </panel>
    <panel>
      <table>
        <title>Top URL Rule Hits</title>
        <search base="core">
          <query>
            | eval Rule=spath(EvidenceDetails,"EvidenceDetails{}.Rule")
	          | eval EvidenceString=spath(EvidenceDetails,"EvidenceDetails{}.EvidenceString")
            | sort -Risk
            | top Rule limit=20 showperc=false
          </query>
        </search>
        <option name="totalsRow">true</option>
        <option name="wrap">false</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel id="topcount">
      <table>
        <title>Top URL Counts</title>
        <search base="core">
          <query>
            | eval Rule=spath(EvidenceDetails,"EvidenceDetails{}.Rule")
            | eval EvidenceString=spath(EvidenceDetails,"EvidenceDetails{}.EvidenceString")
            | sort -Risk
      	    | rename Name TO URL
	        | top URL limit=20 showperc=false
          </query>
        </search>
        <option name="refresh.display">progressbar</option>
        <option name="totalsRow">true</option>
        <option name="drilldown">row</option>
        <drilldown>
          <condition field="URL">
            <link target="_blank">/app/TA_recordedfuture-cyber/search?q=search%20index%3D*%20$row.URL$</link>
          </condition>
          <condition>
            <link target="_blank">/app/TA_recordedfuture-cyber/recorded_future_url_enrichment?form.name=$row.URL$</link>
          </condition>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="etable">
        <title>High Risk URLs</title>
        <search base="core">
          <query>
            | eventstats Count BY Name
            | dedup Name
            | `format_evidence`
            | sort - Risk, Name
            | eval Risk=round(Risk,0)
            | rename RiskString AS Rules
            | rename Name AS URL
            | table Risk, URL, Count, Rules, Evidence</query>
        </search>
        <option name="count">10</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <format type="color" field="Risk">
          <colorPalette type="list">[#777777,#FFCE00,#CF0A2C]</colorPalette>
          <scale type="threshold">30,71,100</scale>
        </format>
        <drilldown>
          <condition field="URL">
            <link target="_blank">/app/TA_recordedfuture-cyber/search?q=search%20index%3D*%20$row.URL$</link>
          </condition>
          <condition>
            <link target="_blank">/app/TA_recordedfuture-cyber/recorded_future_url_enrichment?form.name=$row.URL$</link>
          </condition>
        </drilldown>
      </table>
    </panel>
  </row>
</dashboard>

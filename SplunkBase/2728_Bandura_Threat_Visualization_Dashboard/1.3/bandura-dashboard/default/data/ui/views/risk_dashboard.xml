<form>
  <label>Risk Dashboard</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="risk_time_field" searchWhenChanged="true">
      <label>Select Time</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="resource_group" searchWhenChanged="true">
      <label>Resource Group</label>
      <choice value="*">All Resource Groups</choice>
      <search>
        <query>index=poliwall_riskinfo | stats count by group, group_uid | strcat group " (" count ")" group_count</query>
        <earliest>$risk_time_field.earliest$</earliest>
        <latest>$risk_time_field.latest$</latest>
      </search>
      <fieldForLabel>group_count</fieldForLabel>
      <fieldForValue>group_uid</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Count of Threats by Risk Category</title>
      <chart>
        <search>
          <query>index=poliwall_riskinfo riskinfo group_uid=$resource_group$ risk_score&gt;0 risk_score&lt;=100 category_name!="NA" | eval risk_action=if((risk_threshold &gt; 0) AND (risk_score &gt;= risk_threshold), "dropped", "allowed")| chart count over category_name by risk_action</query>
          <earliest>$risk_time_field.earliest$</earliest>
          <latest>$risk_time_field.latest$</latest>
        </search>
        <option name="height">450</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.text">Category Name</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Count</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Distribution of Risk Scores</title>
      <input type="dropdown" token="category" searchWhenChanged="true">
        <label>Category</label>
        <choice value="*">All Categories</choice>
        <search>
          <query>index=poliwall_riskinfo category_name!="NA" | stats count by category_name category_id | strcat category_name " (" count ")" name_count</query>
          <earliest>$risk_time_field.earliest$</earliest>
          <latest>$risk_time_field.latest$</latest>
        </search>
        <fieldForLabel>name_count</fieldForLabel>
        <fieldForValue>category_id</fieldForValue>
        <default>*</default>
      </input>
      <input type="dropdown" token="bucket_size" searchWhenChanged="true">
        <label>Bucket Size</label>
        <choice value="1">1</choice>
        <choice value="5">5</choice>
        <choice value="10">10</choice>
        <choice value="20">20</choice>
        <default>5</default>
      </input>
      <chart>
        <search>
          <query>index=poliwall_riskinfo group_uid=$resource_group$ category_id=$category$ risk_score&gt;0 risk_score&lt;=100 |              eval risk_action=if((risk_threshold &gt; 0) AND (risk_score &gt;= risk_threshold), "dropped", "allowed")| chart span=$bucket_size$ start=1 end=100 usenull=true count over risk_score by risk_action</query>
          <earliest>$risk_time_field.earliest$</earliest>
          <latest>$risk_time_field.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-90</option>
        <option name="charting.axisLabelsX.integerUnits">true</option>
        <option name="charting.axisLabelsX.minorTickSize">10</option>
        <option name="charting.axisLabelsX.majorTickSize">20</option>
        <option name="charting.axisLabelsX.majorLabelAlignment">afterTick</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisX">numeric</option>
        <option name="charting.axisX.minimumNumber">1</option>
        <option name="charting.axisX.maximumNumber">100</option>
        <option name="charting.axisX.includeZero">true</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Risk Score</option>
        <option name="charting.axisTitleY.text">Count</option>
      </chart>
    </panel>
  </row>
</form>
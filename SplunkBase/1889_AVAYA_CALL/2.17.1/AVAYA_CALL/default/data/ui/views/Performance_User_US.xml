<form>
  <label>User Performance</label>
  <description></description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="field1" searchWhenChanged="true">
      <label>Period of analysis</label>
      <default>
        <earliest>@w0</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="TimeWindow">
      <label>Time Window</label>
      <choice value="&quot;&quot;">All Time</choice>
      <choice value="`TimeWindow_WorkingDays`">Working Days</choice>
      <choice value="`TimeWindow_DayClosed`">Closed Days</choice>
      <choice value="`TimeWindow_Weekend`">Weekend</choice>
      <choice value="`TimeWindow_NightTime`">Night Time</choice>
      <choice value="`TimeWindow_Lunch`">Lunch</choice>
      <default>""</default>
      <initialValue>""</initialValue>
    </input>
    <input type="text" token="Token_Party1Name" searchWhenChanged="true">
      <label>User Name</label>
      <default>*</default>
    </input>
    <input type="text" token="Token_Caller" searchWhenChanged="true">
      <label>Caller Number</label>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <chart>
        <title>TOP 10 - External Incoming Calls / User</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=I
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| TOP 10 AVAYA_Party1Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>TOP 10 - External Outgoing Calls / User</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=O
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| TOP 10 AVAYA_Party1Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>TOP 10 - International Outgoing Calls / User</title>
        <search>
          <query>`sourcelog`
`UserFilter`
(AVAYA_Dialled_Number="00*" OR
AVAYA_External_Targeted_Number="00*")
AVAYA_Is_Internal=0
AVAYA_Direction=O
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| lookup AVAYA_International_Prefix_US.csv AVAYA_Called_Number OUTPUTNEW Country
| rename AVAYA_Party1Name AS "User"
| TOP 10  "User"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>TOP 10 - External Calls Ring Time</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Direction="I"
AVAYA_Is_Internal=0
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
`US_DetailCall_RENAME`
|sort -"Ring Duration"
| table Date "Call Start"  "User"  "Ring Duration" "Caller Number"  "SIP Caller"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <format type="color" field="User">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <table>
        <title>TOP 10 -  External Calls Hold Time</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Direction="I"
AVAYA_Is_Internal=0
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
`US_DetailCall_RENAME`
| sort - "Hold Time"
| table Date "Call Start" "User" "Hold Time" "Park Time" "Caller Number" "SIP Caller"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <format type="color" field="User">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <chart>
        <title>External Missed Calls  / User</title>
        <search>
          <query>`sourcelog`
AVAYA_Party1Device="E*"
AVAYA_Call_Duration="00:00:00"
AVAYA_Direction="I"  AVAYA_Is_Internal=0
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| TOP 10 AVAYA_Party1Name</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>External Calls Received and Outgoing Calls for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  (AVAYA_Direction=I OR AVAYA_Direction=O)
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| timechart count
| rename count AS "Number of Calls"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>TOP 50 - External Calls Received and Outgoing Calls for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  (AVAYA_Direction=I OR AVAYA_Direction=O)
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
|  rename AVAYA_Party1Name AS "User Name" 
| Top 50 "User Name" countfield="Number of Calls" percentfield="%"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Number of Calls">
          <colorPalette type="minMidMax" maxColor="#1E93C6" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="Number of Calls">
          <option name="precision">0</option>
          <option name="useThousandSeparators">false</option>
        </format>
        <format type="number" field="%">
          <option name="precision">0</option>
        </format>
      </table>
    </panel>
    <panel>
      <table>
        <title>Total Duration of External Calls Received and Issued for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  (AVAYA_Direction=I OR AVAYA_Direction=O)
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| convert dur2sec(AVAYA_Call_Duration)  AS AVAYA_Duration
| stats count, avg(AVAYA_Duration) AS AVG_Duration, sum(AVAYA_Duration) AS Sum_Duration by  AVAYA_Party1Name
| eval Total_AVG_Duration=tostring(AVG_Duration, "duration")
| eval Total_Duration=tostring(Sum_Duration, "duration")
| eval avg_split=split(Total_AVG_Duration,".")
| eval "AVG_Call"=mvindex(avg_split,0)
| eval "AVG_Call_ms"=mvindex(avg_split,-1)
| sort -AVAYA_Duration_Hour
| rename AVAYA_Party1Name AS "User Name"  Total_Duration AS "Total Duration" AVG_Call AS "Average Call Time" count AS "Total Call" AVG_RingDuration AS "Average response time"
| Table "User Name"  "Total Duration" "Average Call Time" "Total Call"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="User Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>External Calls Received for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  (AVAYA_Direction=I)
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| timechart count
| rename count AS "Number of Calls"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>TOP 50 - External Calls Received for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=I
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
|  rename AVAYA_Party1Name AS "User Name" 
| Top 50 "User Name" countfield="Number of Calls" percentfield="%"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="number" field="%">
          <option name="precision">0</option>
        </format>
        <format type="color" field="Number of Calls">
          <colorPalette type="minMidMax" maxColor="#1E93C6" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
      </table>
    </panel>
    <panel>
      <table>
        <title>Total Duration of External Calls Received for the selected period</title>
        <search>
          <query>`sourcelog`
AVAYA_Is_Internal=0  AVAYA_Direction=I
AVAYA_Party1Name!=" *"
AVAYA_Party1Name!="VM Channel*"
AVAYA_Party1Name!="U1 *"
AVAYA_Party1Name!="Line *"
AVAYA_Party1Name!="CO Channel *"
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| convert dur2sec(AVAYA_Call_Duration)  AS AVAYA_Duration
| stats count, count(eval(AVAYA_Call_Duration="00:00:00")) AS Call_Lost, avg(AVAYA_Duration) AS AVG_Duration, avg(AVAYA_Ring_Duration) AS AVG_Ring, sum(AVAYA_Duration) AS Sum_Duration by  AVAYA_Party1Name
| eval RingDuration=tostring(AVG_Ring, "Duration")
| eval avgring_split=split(RingDuration,".")
| eval "AVG_RingDuration"=mvindex(avgring_split,0)
| eval "AVG_Ring_ms"=mvindex(avgring_split,-1)
| eval Total_AVG_Duration=tostring(AVG_Duration, "duration")
| eval Total_Duration=tostring(Sum_Duration, "duration")
| eval avg_split=split(Total_AVG_Duration,".")
| eval "AVG_Call"=mvindex(avg_split,0)
| eval "AVG_Call_ms"=mvindex(avg_split,-1)
| sort -AVAYA_Duration_Hour
| rename AVAYA_Party1Name AS "User Name"  Total_Duration AS "Total Call Duration" AVG_Call AS "Average Call Time" count AS "Total Call" AVG_RingDuration AS "Average Response Time" Call_Lost AS "Total Call Lost"
| Table "User Name"  "Total Call Duration" "Average Call Time" "Average Response Time" "Total Call Lost" "Total Call"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="User Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Outgoing Calls for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=O
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| timechart count
| rename count AS "Number of Calls"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisTitleX.text">Date</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <table>
        <title>TOP 50 - Outgoing Calls for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=O
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
|  rename AVAYA_Party1Name AS "User Name" 
| Top 50 "User Name" countfield="Number of Calls" percentfield="%"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Number of Calls">
          <colorPalette type="minMidMax" maxColor="#1E93C6" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="%"></format>
      </table>
    </panel>
    <panel>
      <table>
        <title>Total Duration of External Calls Issued for the selected period</title>
        <search>
          <query>`sourcelog`
`UserFilter`
AVAYA_Is_Internal=0  AVAYA_Direction=O
AVAYA_Party1Name=$Token_Party1Name$
AVAYA_Caller=$Token_Caller$
$TimeWindow$
| convert dur2sec(AVAYA_Call_Duration)  AS AVAYA_Duration
| stats count, avg(AVAYA_Duration) AS AVG_Duration, sum(AVAYA_Duration) AS Sum_Duration by  AVAYA_Party1Name
| eval Total_AVG_Duration=tostring(AVG_Duration, "duration")
| eval Total_Duration=tostring(Sum_Duration, "duration")
| eval avg_split=split(Total_AVG_Duration,".")
| eval "AVG_Call"=mvindex(avg_split,0)
| eval "AVG_Call_ms"=mvindex(avg_split,-1)
| sort -AVAYA_Duration_Hour
| rename AVAYA_Party1Name AS "User Name"  Total_Duration AS "Total Call Duration" AVG_Call AS "Average Call Time" count AS "Total Call"
| Table "User Name"  "Total Call Duration" "Average Call Time" "Total Call"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="User Name">
          <colorPalette type="sharedList"></colorPalette>
          <scale type="sharedCategory"></scale>
        </format>
      </table>
    </panel>
  </row>
</form>
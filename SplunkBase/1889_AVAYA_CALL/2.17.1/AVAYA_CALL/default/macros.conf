[UserFilter]
definition = AVAYA_Call_Duration!="00:00:00"\
AVAYA_Party1Name!=" *"\
AVAYA_Party1Name!="VM Channel*"\
AVAYA_Party1Name!="U1 *"\
AVAYA_Party1Name!="Line *"\
AVAYA_Party1Name!="CO Channel *"
iseval = 0

[sourcelog]
definition = ""
iseval = 0

[US_DetailCall_Table]
definition = | table\
 Date\
 Day\
 "Call Start"\
 "Call ID"\
 "Global Call Duration"\
 "Call Duration"\
 "Calling Direction" \
 "Continuation"\
 "Caller Number"\
 "SIP Caller"  \
 "Called Number"\
 "SIP Called" \
 "Dialled Number"\
 "Device"\
 "User"\
 "Device2"\
 "User2"\
 "External Targeting Cause"\
 "External Targeting Code"\
 "External Targeter Id"\
 "External Targeted Number"\
 "Ring Duration"\
 "Hold Time"\
 "Park Time"\
 "Authorization Code"\
 "Authorization Validation"\
 "Account"\
 "User Charged"\
 "Call Charged"\
 "Call Units"\
 "Cost Per Unit"\
 "Mark Up"\
 "Currency"\
 "Amount Last User Change"\
 "Units Last User Change"
iseval = 0

[FR_DetailCall_Table]
definition = | table\
Jour\
Date\
Heure\
"Identifiant d'Appel"\
"Temps Global d'Appel"\
"Durée d'Appel"\
"Sens de l'Appel"\
"Continuation"\
"Numéro Appelant"\
"Numéro Appelé"\
"Numéro Composé"\
"Terminal"\
"Utilisateur"\
"Terminal2"\
"Utilisateur2"\
"Cause Ciblage Externe"\
"Code Ciblage Externe"\
"ID Ciblage Externe"\
"Numéro Ciblage Externe"\
"Durée de Sonnerie"\
"Durée d'Attente"\
"Durée de Parcage"\
"Code d'Authorisation"\
"Validation Authorisation"\
"Code de Compte"\
"Utilisateur Facturé"\
"Coût de l'Appel"\
"Unités d'Appel"\
"Coût par unité"\
"Majoration"\
"Devise"\
"Total lors du dernier changement d'utilisateur"\
"Unités lors du dernier changement d'utilisateur"
iseval = 0

[FR_DetailCall_RENAME]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| lookup AVAYA_DateTranslate_FR.csv "Week_Day" OUTPUTNEW "Jour"\
| eval AVAYA_Start_FR_Date=AVAYA_Day."/".AVAYA_Month."/".AVAYA_Year\
| eval AVAYA_Start_Hour=AVAYA_Hour.":".AVAYA_Min.":".AVAYA_Sec\
| eval  SIP_Call=split(AVAYA_Called_Number,"@")\
| eval "Called_Number"=mvindex(SIP_Call,0)\
| eval SIP_Called=mvindex(SIP_Call,1)\
| eval  SIP_Call=split(AVAYA_Caller,"@")\
| eval "Caller_Number"=mvindex(SIP_Call,0)\
| eval SIP_Caller=mvindex(SIP_Call,1)\
| eval HoldTime_in_hhmmss=tostring(AVAYA_Hold_Time, "Duration")\
| eval RingDuration_in_hhmmss=tostring(AVAYA_Ring_Duration, "Duration")\
| eval Park_Time_in_hhmmss=tostring(AVAYA_Park_Time, "Duration")   \
| rename\
 Called_Number AS "Numéro Appelé"\
 Caller_Number AS "Numéro Appelant"\
 HoldTime_in_hhmmss AS "Durée d'Attente"\
 RingDuration_in_hhmmss AS "Durée de Sonnerie"\
 Park_Time_in_hhmmss AS "Durée de Parcage"\
 AVAYA_Start_FR_Date AS "Date"\
 AVAYA_Start_Hour AS "Heure"\
 AVAYA_Call_Duration AS  "Durée d'Appel"\
 AVAYA_Direction AS "Direction"\
 AVAYA_Dialled_Number AS "Numéro Composé"\
 AVAYA_Account AS "Code de Compte"\
 AVAYA_Is_Internal AS "Appel Interne"\
 AVAYA_Call_ID AS "Identifiant d'Appel"\
 AVAYA_Continuation AS "Continuation"\
 AVAYA_Party1Device AS "Terminal"\
 AVAYA_Party1Name AS "Utilisateur"\
 AVAYA_Party2Device AS "Terminal2"\
 AVAYA_Party2Name AS "Utilisateur2"\
 AVAYA_Auth_Valid AS "Validation Authorisation"\
 AVAYA_Auth_Code AS "Code d'Authorisation"\
 AVAYA_User_Charged AS "Utilisateur Facturé"\
 AVAYA_Call_Charge AS  "Coût de l'Appel"\
 AVAYA_Currency AS  "Devise"\
 AVAYA_Amount_Last_User_Change AS "Total lors du dernier changement d'utilisateur"\
 AVAYA_Call_Units AS  "Unités d'Appel"\
 AVAYA_Units_Last_User_Change AS "Unités lors du dernier changement d'utilisateur"\
 AVAYA_Cost_Per_Unit AS "Coût par unité"\
 AVAYA_Mark_Up AS  "Majoration"\
 AVAYA_External_Targeter_Id AS "ID Ciblage Externe"\
 AVAYA_External_Targeted_Number AS "Numéro Ciblage Externe"\
 AVAYA_External_Targeting_Cause AS "Code Ciblage Externe"\
 CallTime_in_hhmmss AS "Temps Global d'Appel"\
 "Calling Direction"  AS "Sens de l'Appel"\
 "External Targeting Cause" AS "Cause Ciblage Externe"\
 "SIP_Called" AS "SIP Appelé"  \
 "SIP_Caller" AS "SIP Appelant"\
| replace "Anonymous" with "Inconnu" in "Numéro Appelé"\
| replace Anonymous with Inconnu in "Numéro Appelant"\
| replace Restricted with Restreint in "Numéro Appelant" \
| replace unavailable with Indisponible in "Numéro Appelant"
iseval = 0

[US_DetailCall_RENAME]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| eval AVAYA_Start_US_Date=AVAYA_Year."/".AVAYA_Month."/".AVAYA_Day\
| eval AVAYA_Start_Hour=AVAYA_Hour.":".AVAYA_Min.":".AVAYA_Sec\
| eval  SIP_Call=split(AVAYA_Called_Number,"@")\
| eval "Called_Number"=mvindex(SIP_Call,0)\
| eval SIP_Called=mvindex(SIP_Call,1)\
| eval  SIP_Call=split(AVAYA_Caller,"@")\
| eval "Caller_Number"=mvindex(SIP_Call,0)\
| eval SIP_Caller=mvindex(SIP_Call,1)\
| eval HoldTime_in_hhmmss=tostring(AVAYA_Hold_Time, "Duration")\
| eval RingDuration_in_hhmmss=tostring(AVAYA_Ring_Duration, "Duration")\
| eval Park_Time_in_hhmmss=tostring(AVAYA_Park_Time, "Duration")  \
| rename\
 Week_Day AS "Day"\
 Called_Number AS "Called Number"\
 Caller_Number AS "Caller Number"\
 RingDuration_in_hhmmss AS "Ring Duration"\
 HoldTime_in_hhmmss AS "Hold Time"\
 Park_Time_in_hhmmss AS "Park Time"\
 AVAYA_Start_US_Date AS "Date"\
 AVAYA_Start_Hour AS "Call Start" \
 AVAYA_Call_Duration AS  "Call Duration"\
 AVAYA_Direction AS "Direction"\
 AVAYA_Dialled_Number AS "Dialled Number"\
 AVAYA_Account AS "Account"\
 AVAYA_Is_Internal AS "Is Internal"\
 AVAYA_Call_ID AS "Call ID"\
 AVAYA_Continuation AS "Continuation"\
 AVAYA_Party1Device AS "Device"\
 AVAYA_Party1Name AS "User"\
 AVAYA_Party2Device AS "Device2"\
 AVAYA_Party2Name AS "User2"\
 AVAYA_Auth_Valid AS "Authorization Validation"\
 AVAYA_Auth_Code AS "Authorization Code"\
 AVAYA_User_Charged AS "User Charged"\
 AVAYA_Call_Charge AS  "Call Charge"\
 AVAYA_Currency AS  "Currency"\
 AVAYA_Amount_Last_User_Change AS "Amount Last User Change"\
 AVAYA_Call_Units AS  "Call Units"\
 AVAYA_Units_Last_User_Change AS "Units Last User Change"\
 AVAYA_Cost_Per_Unit AS "Cost Per Unit"\
 AVAYA_Mark_Up AS  "Mark Up"\
 AVAYA_External_Targeter_Id AS "External Targeter Id"\
 AVAYA_External_Targeted_Number AS "External Targeted Number"\
 AVAYA_External_Targeting_Cause AS "External Targeting Code"\
 CallTime_in_hhmmss AS "Global Call Duration"\
 "Calling Direction"  AS "Calling Direction"\
 "External Targeting Cause" AS "External Targeting Cause"\
 "SIP_Called" AS "SIP Called"  \
 "SIP_Caller" AS "SIP Caller"
iseval = 0

[Global_Time]
definition = convert dur2sec(AVAYA_Call_Duration)  AS Call_Duration\
 | eval CallTime=Call_Duration+AVAYA_Ring_Duration+AVAYA_Hold_Time+AVAYA_Park_Time\
 | eval CallTime_in_hhmmss=tostring(CallTime, "Duration")
iseval = 0

[Call_Direction]
definition = eval "Direction"=AVAYA_Direction."".AVAYA_Is_Internal
iseval = 0

[Call_Global_Time]
definition = | convert dur2sec(AVAYA_Call_Duration)  AS Call_Duration\
 | eval CallTime=Call_Duration+AVAYA_Ring_Duration+AVAYA_Hold_Time+AVAYA_Park_Time\
 | eval CallTime_in_hhmmss=tostring(CallTime, "Duration")
iseval = 0

[Extract_SIP_IP]
definition = eval  accountname=split(AVAYA_Called_Number,"@")\
| eval "Called_Number"=mvindex(accountname,0)\
| eval SIP_Called=mvindex(accountname,-1)\
| eval  accountname=split(AVAYA_Caller,"@")\
| eval "Caller_Number"=mvindex(accountname,0)\
| eval SIP2_Caller=mvindex(accountname,-1)\
iseval = 0

[TimeWindow_Weekend]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| where ((Week_Day="Saturday") OR (Week_Day="Sunday"))
iseval = 0

[TimeWindow_Lunch]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| where ((AVAYA_Hour=12 AND AVAYA_Min>=00) OR (AVAYA_Hour=13 AND AVAYA_Min<=59))
iseval = 0

[TimeWindow_WorkingDays]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| where ((Week_Day!="Saturday") AND (Week_Day!="Sunday"))\
| where ((AVAYA_Hour>=8 AND AVAYA_Hour<12)  OR (AVAYA_Hour>=14 AND AVAYA_Hour<18))
iseval = 0

[TimeWindow_NightTime]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| where (AVAYA_Hour<=7 OR AVAYA_Hour>=18)
iseval = 0

[TimeWindow_DayClosed]
definition = | rex field=AVAYA_Call_Start "(?<AVAYA_Year>.*)\/(?<AVAYA_Month>.*)\/(?<AVAYA_Day>.*)\s(?<AVAYA_Hour>.*)\:(?<AVAYA_Min>.*)\:(?<AVAYA_Sec>.*)"\
| eval Week_Day = strftime(_time, "%A")\
| where\
(Week_Day="Monday"    AND (AVAYA_Hour<=7 OR AVAYA_Hour>=18)) OR \
(Week_Day="Tuesday"   AND (AVAYA_Hour<=7 OR AVAYA_Hour>=18)) OR \
(Week_Day="Wednesday" AND (AVAYA_Hour<=7 OR AVAYA_Hour>=18)) OR \
(Week_Day="Thursday"  AND (AVAYA_Hour<=7 OR AVAYA_Hour>=18)) OR \
(Week_Day="Friday"    AND (AVAYA_Hour<=7 OR AVAYA_Hour>=18)) OR \
(Week_Day="Saturday") OR\
(Week_Day="Sunday")
iseval = 0
<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js" stylesheet="main.css, single_citrixadc_inventory.css">

   <label>Single Citrix ADC Inventory</label>
   <description>This dashboard displays details for a Citrix ADC. Please note that inventory information is only collected once per 24 hour period by default. uberAgent collects inventory data from the primary as well as secondary Citrix ADC.</description>

  <fieldset autoRun="true">
    <input type="time" searchWhenChanged="true">
      <label>Time range:</label>
      <default>
        <earliest>-1d@d</earliest>
        <latest>now</latest>
      </default>
      <change>
         <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
         <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
         <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
      </change>
    </input>
    <input type="dropdown" token="CitrixADCFilterString" searchWhenChanged="true">
         <choice value="*">All</choice>
         <default>*</default>
         <label>Citrix ADC:</label>
         <fieldForLabel>HostName</fieldForLabel>
         <fieldForValue>HostName</fieldForValue>
         <allowCustomValues>false</allowCustomValues>
         <search>
            <query>
               | pivot `uA_DM_CitrixADC_ApplianceInventory` CitrixADC_ApplianceInventory
                  splitrow HostName
               | eval sortfield = lower (HostName)
               | sort sortfield
               | table
                  HostName
            </query>
         </search>
    </input>
  </fieldset>

   <search id="Search_Single">
      <query>
         | pivot `uA_DM_CitrixADC_ApplianceInventory` CitrixADC_ApplianceInventory
            latest(HostName) as "Host name"
            filter HostName is $CitrixADCFilterString|s$
         | eval Title = "Inventory data: " . 'Host name'
      </query>
   </search>
   
   <!-- Row 1 -->
   <row>
      <panel>
         <viz type="uberAgent.uberagent-singlevalue">
            <search base="Search_Single" />
            <option name="uberAgent.uberagent-singlevalue.1-field">Title</option>
            <option name="uberAgent.uberagent-singlevalue.1-title"></option>
         </viz>
         
         <table id="Table_Panel11">
           <title>Basic settings</title>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_ApplianceInventory` CitrixADC_ApplianceInventory
                     count(CitrixADC_ApplianceInventory) as EventCount
                     latest(HwDescription) as "Hardware model"
                     latest(SysId) as "System ID"
                     latest(ManufactureDay) as ManufactureDay
                     latest(ManufactureMonth) as ManufactureMonth
                     latest(ManufactureYear) as ManufactureYear
                     latest(CpuFrequncy) as "Max. CPU speed (GHz)"
                     latest(SerialNo) as "Serial number"
                     latest(EncodedSerialno) as "Encoded serial number"
                     latest(MACAddress) as "MAC address"
                     latest(HostId) as "Host ID"
                     latest(LastConfigSaveTime) as "Time when the configuration was last saved"
                     latest(Timezone) as Timezone
                     latest(WeakPassword) as "All weak passwords"
                     latest(SystemType) as "System type"
                     latest(LastConfigChangedTime) as "Time when the configuration was last modified"
                     latest(LastStartupTime) as "Last startup time"
                     latest(SSLCards) as "#SSL cards"
                     latest(SSLCardsUp) as "#SSL cards up"
                     filter HostName is $CitrixADCFilterString|s$
                     | join type=outer
                     [ 
                        | pivot `uA_DM_CitrixADC_AppliancePerformance` CitrixADC_AppliancePerformance
                            latest(Disk0Size) as Disk0Size
                            latest(Disk1Size) as Disk1Size
                            latest(MemSizeMB) as MemSizeMB
                            latest(MemUseInMB) as MemUseInMB
                            latest(MemUsagePcnt) as MemUsagePcnt
                            latest(NumCpus) as "#CPUs"
                            filter HostName is $CitrixADCFilterString|s$
                        | eval "RAM size (GB)" = round(if(MemSizeMB = 0,(MemUseInMB / MemUsagePcnt * 100)/1024,MemSizeMB/1024),1)
                        | eval "/flash size (GB)" = round(Disk0Size / 1024,1)
                        | eval "/var size (GB)" = round(Disk1Size / 1024,1)
                        | fields + HostName "RAM size (GB)" "/flash size (GB)" "/var size (GB)" "#CPUs"
                     ]
                  | eval "Manufacture date" = ManufactureYear + "-" + ManufactureMonth + "-" + ManufactureDay
                  | eval "Max. CPU speed (GHz)" = round('Max. CPU speed (GHz)' / 1000,1)
                  | fields
                     - EventCount _timediff column ManufactureYear ManufactureMonth ManufactureDay
                  | transpose
                  | sort column
                  | rename
                     column as Property
                     "row 1" as Data
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>
         
         <table id="Table_Panel12">
           <title>High-availability settings</title>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_ApplianceInventory` CitrixADC_ApplianceInventory
                     count(CitrixADC_ApplianceInventory) as EventCount
                     latest(CurrentHAStatus) as "Current HA status"
                     latest(LastHAStatusChange) as "Last HA status change"
                     filter HostName is $CitrixADCFilterString|s$
                  | fields
                     - EventCount _timediff column
                  | transpose
                  | sort column
                  | rename
                     column as Property
                     "row 1" as Data
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>
         
         <table id="Table_Panel13">
           <title>Licensing settings</title>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_ApplianceInventory` CitrixADC_ApplianceInventory
                     count(CitrixADC_ApplianceInventory) as EventCount
                     latest(Model) as "License model"
                     latest(License) as "License type"
                     latest(MACAddress) as "MAC address"
                     latest(LicensingMode) as "Licensing mode"
                     filter HostName is $CitrixADCFilterString|s$
                  | fields
                     - EventCount _timediff column 
                  | transpose
                  | sort column
                  | rename
                     column as Property
                     "row 1" as Data
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>
      </panel>
   </row>

   <!-- Row 2 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Gateways</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_Gateway` CitrixADC_Gateway
                    latest(PrimaryIpAddress) as "IP address"
                    latest(PrimaryPort) as Port
                    latest(Type) as Type
                    splitrow
                       vServerName as Gateway
                    filter HostName is $CitrixADCFilterString|s$
                  | table
                     Gateway
                     "IP address"
                     Port
                     Type
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">row</option>
            <drilldown>
              <link>
                <![CDATA[
                         citrixadc_gateway?earliest=$earliest$&latest=$latest$&form.CitrixADCFilterString=$click.value$
                      ]]>
              </link>
            </drilldown>
         </table>
      <html src="single_citrixadc_inventory_explanation.html">
      </html>
      </panel>
      
      
      <!-- Column 2 -->
      <panel>
         <title>Virtual servers</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_vServer` CitrixADC_vServer
                    latest(PrimaryIpAddress) as "IP address"
                    latest(PrimaryPort) as Port
                    latest(Type) as Type
                    splitrow
                       vServerName as "Virtual server"
                    filter HostName is $CitrixADCFilterString|s$
                  | table
                     "Virtual server"
                     "IP address"
                     Port
                     Type
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">row</option>
            <drilldown>
              <link>
                <![CDATA[
                         single_citrixadc_virtual_server_performance?earliest=$earliest$&latest=$latest$&form.CitrixADCFilterString=$click.value$
                      ]]>
              </link>
            </drilldown>
         </table>
      <html src="single_citrixadc_inventory_explanation_2.html">
      </html>
      </panel>
   </row>
   
   <!-- Row 3 -->
   <row>
      <!-- Column 1 -->
      <panel>
         <title>IP addresses</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_Ip` CitrixADC_Ip
                     latest(IpNetmask) as Netmask
                     latest(IpType) as Type
                     latest(IpvServer) as "Bound to vServer"
                     latest(IpMgmtAccess) as "Mgmt. access"
                     splitrow
                        IpAddress as "IP address"
                     filter HostName is $CitrixADCFilterString|s$
                  | eval "Mgmt. access" = if('Mgmt. access'=1,"Yes","No")
                  | table
                     "IP address"
                     Netmask
                     Type
                     "Bound to vServer"
                     "Mgmt. access"
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">none</option>
         </table>
      <html src="single_citrixadc_inventory_explanation_3.html">
      </html>
      </panel>
      
      <!-- Column 2 -->
      <panel>
         <title>Certificates</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_CitrixADC_Certificate` CitrixADC_Certificate
                     latest(CertFile) as "File name"
                     latest(CertType) as Type
                     latest(CertExpirationDate) as "Expiration date"
                     splitrow
                        CertName as "Certificate name"
                     filter HostName is $CitrixADCFilterString|s$
                     | eval Type = split(Type, ";")
                     | sort "Expiration date"
                  | table
                     "Certificate name"
                     "File name"
                     Type
                     "Expiration date"
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">none</option>
         </table>
      <html src="single_citrixadc_inventory_explanation_4.html">
      </html>
      </panel>
   </row>
</form>

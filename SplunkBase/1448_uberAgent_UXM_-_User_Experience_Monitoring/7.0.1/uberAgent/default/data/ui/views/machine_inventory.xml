<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js" stylesheet="main.css, machine_inventory.css">

   <label>Machine Inventory</label>
   <description>This dashboard displays inventory information about the endpoints monitored with uberAgent.</description>

   <fieldset autoRun="true">
      <input type="time" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-1d@d</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>System_MachineInventory</default>
      </input>
   </fieldset>

   <!-- Row 1 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Hardware models (top 10)</title>
         <chart id="Chart_Panel11">
            <search>
               <query>
                  | pivot `uA_DM_System_MachineInventory` System_MachineInventory
                     dc(host) as "HW count"
                     splitrow
                        HwManufacturerModel as "HW model"
                     $SearchFilter$
                  | sort limit=10 - "HW count"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Operating systems (top 10)</title>
         <chart id="Chart_Panel12">
            <search>
               <query>
                  | pivot `uA_DM_System_MachineInventory` System_MachineInventory
                     dc(host) as "OS count"
                     splitrow
                        OsName as "Operating system"
                     $SearchFilter$
                  | sort limit=10 - "OS count"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

   <!-- Row 2 -->
   <row>
      <panel>
         <title>Inventory data grouped</title>
         <input type="dropdown" token="Panel21GroupBy" searchWhenChanged="true">
            <choice value="AdDomainDns">AD domain DNS</choice>
            <choice value="AdOu">AD OU</choice>
            <choice value="AdSite">AD site</choice>
            <choice value="HwBiosVersion">BIOS version</choice>
            <choice value="CtxDeliveryGroupName">Citrix delivery group</choice>
            <choice value="CtxFarmName">Citrix site</choice>
            <choice value="CtxMachineCatalogName">Citrix machine catalog</choice>
            <choice value="CPUCoresLogical">CPU cores (logical)</choice>
            <choice value="CPUCoresPhysical">CPU cores (physical)</choice>
            <choice value="CPUName">CPU name</choice>
            <choice value="CPUSockets">CPU sockets</choice>
            <choice value="CPUMaxMhz">CPU speed (MHz)</choice>
            <choice value="HwIsVirtualMachine">Hardware: is VM?</choice>
            <choice value="HwHypervisorVendor">Hardware: hypervisor</choice>
            <choice value="IsBatteryPresent">Hardware: has battery?</choice>
            <choice value="HwManufacturer">Hardware manufacturer</choice>
            <choice value="HwModel">Hardware model</choice>
            <choice value="OsBuild">OS build number</choice>
            <choice value="OsName">OS name</choice>
            <choice value="OsType">OS type</choice>
            <choice value="OsVersion">OS version number</choice>
            <choice value="OsArchitecture">OS architecture</choice>
            <choice value="RAMSizeGB">RAM size (GB)</choice>
            <default>HwModel</default>
            <label>Group by:</label>
            <change>
               <condition value="*">
                  <set token="Panel21GroupByDisplay">$label$</set>
                  <unset token="DrilldownFilterBy21"></unset>
               </condition>
            </change>
         </input>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_System_MachineInventory` System_MachineInventory
                     dc(host) as "#Hosts"
                     dc(OsName) as "#OS names"
                     dc(OsVersion) as "#OS versions"
                     dc(OsBuildUbr) as "#OS builds"
                     dc(OsSpName) as "#OS SP names"
                     dc(OsSpVersion) as "#OS SP versions"
                     dc(OsType) as "#OS types"
                     dc(OsArchitecture) as "#OS architectures"
                     dc(HwManufacturer) as "#HW manufacturers"
                     dc(HwModel) as "#HW models"
                     dc(HwBiosVersion) as "#BIOS versions"
                     dc(CPUName) as "#CPU models"
                     dc(RAMSizeGB) as "#RAM sizes"
                     splitrow
                        $Panel21GroupBy$ as "$Panel21GroupByDisplay$"
                     $SearchFilter$
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">row</option>
            <drilldown>
                <set token="DrilldownFilterBy21">$click.value$</set>
            </drilldown>
         </table>

      <html src="machine_inventory_explanation.html">
      </html>
      </panel>
   </row>

   <!-- Row 3 -->
   <row depends="$DrilldownFilterBy21$">
      <panel>
         <title>Machines in selected group: $Panel21GroupByDisplay$ = $DrilldownFilterBy21$</title>
         <input type="multiselect" token="FieldFilter" id="Input_Panel21FieldFilter" searchWhenChanged="true">
            <choice value='"AD domain DNS"'>AD domain DNS</choice>
            <choice value='"AD domain NetBIOS"'>AD domain NetBIOS</choice>
            <choice value='"AD OU"'>AD OU</choice>
            <choice value='"AD site"'>AD site</choice>
            <choice value='"Baseboard serial number"'>Baseboard serial number</choice>
            <choice value='"Battery wear level (%)"'>Battery wear level (%)</choice>
            <choice value='"BIOS serial number"'>BIOS serial number</choice>
            <choice value='"BIOS version"'>BIOS version</choice>
            <choice value='"Computer name (canonical)"'>Computer name (canonical)</choice>
            <choice value='"Computer name (distinguished name)"'>Computer name (distinguished name)</choice>
            <choice value='"CPU cores (logical)"'>CPU cores (logical)</choice>
            <choice value='"CPU cores (physical)"'>CPU cores (physical)</choice>
            <choice value='"CPU speed (MHz)"'>CPU speed (MHz)</choice>
            <choice value='"CPU name"'>CPU name</choice>
            <choice value='"CPU sockets"'>CPU sockets</choice>
            <choice value='"Citrix delivery group"'>Citrix delivery group</choice>
            <choice value='"Citrix site"'>Citrix site</choice>
            <choice value='"Citrix machine catalog"'>Citrix machine catalog</choice>
            <choice value='"Hardware: is VM?"'>Hardware: is VM?</choice>
            <choice value='"Hardware: hypervisor"'>Hardware: hypervisor</choice>
            <choice value='"Hardware: has battery?"'>Hardware: has battery?</choice>
            <choice value='"Hardware: has UPS?"'>Hardware: has UPS?</choice>
            <choice value='"Hardware manufacturer"'>Hardware manufacturer</choice>
            <choice value='"Hardware model"'>Hardware model</choice>
            <choice value='"IPv4 address(es)"'>IPv4 address(es)</choice>
            <choice value='"Monitor count"'>Monitor count</choice>
            <choice value='"Network conn. desc."'>Network conn. desc.</choice>
            <choice value='"Network conn. name(s)"'>Network conn. name(s)</choice>
            <choice value='"OS name"'>OS name</choice>
            <choice value='"OS type"'>OS type</choice>
            <choice value='"OS version number"'>OS version number</choice>
            <choice value='"OS build"'>OS build</choice>
            <choice value='"OS build number"'>OS build number</choice>
            <choice value='"OS update build revision number"'>OS update build revision number</choice>
            <choice value='"OS service pack name"'>OS service pack name</choice>
            <choice value='"OS service pack version"'>OS service pack version</choice>
            <choice value='"OS install date"'>OS install date</choice>
            <choice value='"OS architecture"'>OS architecture</choice>
            <choice value='"Power: supports connected standby"'>Power: supports connected standby</choice>
            <choice value='"Power: supports S1"'>Power: supports S1</choice>
            <choice value='"Power: supports S2"'>Power: supports S2</choice>
            <choice value='"Power: supports S3"'>Power: supports S3</choice>
            <choice value='"Power: supports S4"'>Power: supports S4</choice>
            <choice value='"Power: supports S5"'>Power: supports S5</choice>
            <choice value='"RAM size (GB)"'>RAM size (GB)</choice>
            <choice value='"SIP enabled?"'>SIP enabled?</choice>
            <choice value='"TagsHost"'>Host tags</choice>
            <default>
               "OS name",
               "OS version number",
               "OS build",
               "OS type",
               "OS install date",
               "Hardware manufacturer",
               "Hardware model",
               "BIOS version",
               "CPU name",
               "RAM size (GB)",
               "IPv4 address(es)"
            </default>
            <label>Fields to display:</label>
            <prefix></prefix>
            <suffix></suffix>
            <valuePrefix></valuePrefix>
            <valueSuffix></valueSuffix>
            <delimiter> </delimiter>
         </input>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_System_MachineInventory` System_MachineInventory
                        latest(AdDomainDns) as "AD domain DNS"
                        latest(AdDomainNetBios) as "AD domain NetBIOS"
                        latest(AdOu) as "AD OU"
                        latest(AdSite) as "AD site"
                        latest(BatteryWearLevelPercent) as "Battery wear level (%)"
                        latest(ComputerNameCanonical) as "Computer name (canonical)"
                        latest(ComputerNameDn) as "Computer name (distinguished name)"
                        latest(CPUCoresLogical) as "CPU cores (logical)"
                        latest(CPUCoresPhysical) as "CPU cores (physical)"
                        latest(CPUMaxMhz) as "CPU speed (MHz)"
                        latest(CPUName) as "CPU name"
                        latest(CPUSockets) as "CPU sockets"
                        latest(CtxDeliveryGroupName) as "Citrix delivery group"
                        latest(CtxFarmName) as "Citrix site"
                        latest(CtxMachineCatalogName) as "Citrix machine catalog"
                        latest(BaseboardSerial) as "Baseboard serial number"
                        latest(HwBiosVersion) as "BIOS version"
                        latest(BIOSSerial) as "BIOS serial number"
                        latest(HwIsVirtualMachine) as "Hardware: is VM?"
                        latest(HwHypervisorVendor) as "Hardware: hypervisor"
                        latest(IsBatteryPresent) as "Hardware: has battery?"
                        latest(IsUpsPresent) as "Hardware: has UPS?"
                        latest(HwManufacturer) as "Hardware manufacturer"
                        latest(HwModel) as "Hardware model"
                        latest(OsName) as "OS name"
                        latest(OsType) as "OS type"
                        latest(OsVersion) as "OS version number"
                        latest(OsBuild) as "OS build number"
                        latest(OsUpdateBuildRevision) as "OS update build revision number"
                        latest(OsBuildUbr) as "OS build"
                        latest(OsSpName) as "OS service pack name"
                        latest(OsSpVersion) as "OS service pack version"
                        latest(OsInstallDate) as "OS install date"
                        latest(OsArchitecture) as "OS architecture"
                        latest(PowerSupportsConnectedStandby) as "Power: supports connected standby"
                        latest(PowerSupportsS1) as "Power: supports S1"
                        latest(PowerSupportsS2) as "Power: supports S2"
                        latest(PowerSupportsS3) as "Power: supports S3"
                        latest(PowerSupportsS4) as "Power: supports S4"
                        latest(PowerSupportsS5) as "Power: supports S5"
                        latest(RAMSizeGB) as "RAM size (GB)"
                        latest(IsSipEnabled) as "SIP enabled?"
                        values(TagsHost) as "TagsHost"
                     splitrow
                        host
                     filter $Panel21GroupBy$ is $DrilldownFilterBy21|s$
                     $SearchFilter$
                  | join type=left host
                     [
                        | pivot `uA_DM_System_MonitorInventory` System_MonitorInventory
                           count(System_MonitorInventory) as "Monitor count"
                           splitrow
                              _time
                           splitrow
                              host
                     ]
                  | join type=left host
                     [
                        | pivot `uA_DM_System_NetworkConfigInformation` System_NetworkConfigInformation
                           values(NetworkConfigIPv4) as "IPv4 address(es)"
                           values(NetworkConfigFriendlyName) as "Network conn. name(s)"
                           values(NetworkConfigDescription) as "Network conn. desc."
                           splitrow
                              host
                        | eval "IPv4 address(es)" = mvjoin ('IPv4 address(es)', "#@#")   
                        | eval "Network conn. name(s)" = mvjoin ('Network conn. name(s)', "#@#")   
                        | eval "Network conn. desc." = mvjoin ('Network conn. desc.', "#@#")   
                     ]
                  | eval "IPv4 address(es)" = split ('IPv4 address(es)', "#@#")   
                  | eval "Network conn. name(s)" = split ('Network conn. name(s)', "#@#")   
                  | eval "Network conn. desc." = split ('Network conn. desc.', "#@#")   
                  | rename host as Host
                  | fields
                      Host $FieldFilter$

               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">row</option>
            <drilldown>
               <link>
                  <![CDATA[
                     single_machine_inventory?earliest=$earliest$&latest=$latest$&form.FilterField=shost&form.FilterOperator=in&form.FilterExpression=$click.value$
                  ]]>
               </link>
            </drilldown>
         </table>

      </panel>
   </row>

</form>
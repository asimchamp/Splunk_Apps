<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js, machine_smbclient.js, tokenlinks.js" stylesheet="main.css, machine_smbclient.css">

   <label>SMB Client Performance</label>
   <description>This dashboard displays information about the performance of SMB connections to shares on the network.</description>

   <fieldset autoRun="true">
      <input type="time" id="TimeRange1" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-1h</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>System_SmbClient</default>
      </input>
   </fieldset>

   <search id="Search_Single">
      <query>
         | pivot `uA_DM_System_SmbClient` System_SmbClient
            sum(IOCountRead) AS SumIOCountRead
            sum(IOCountWrite) AS SumIOCountWrite
            sum(IODurationReadMs) AS SumIODurationReadMs
            sum(IODurationWriteMs) AS SumIODurationWriteMs
            sum(IOMBRead) AS SumIOMBRead
            sum(IOMBWrite) AS SumIOMBWrite
            avg(IOPSRead) AS AvgIOPSRead
            avg(IOPSWrite) AS AvgIOPSWrite
            avg(IOPSMetadata) AS AvgIOPSMetadata
            $SearchFilter$
         | eval "Avg. read latency (ms)" = round(SumIODurationReadMs/SumIOCountRead,1)
         | eval "Avg. write latency (ms)" = round(SumIODurationWriteMs/SumIOCountWrite,1)
         | eval "Avg. read IOPS" = round(AvgIOPSRead,1)
         | eval "Avg. write IOPS" = round(AvgIOPSWrite,1)
         | eval "Avg. metadata IOPS" = round(AvgIOPSMetadata,1)
         | eval "Read data volume (MB)" = round(SumIOMBRead,1)
         | eval "Write data volume (MB)" = round(SumIOMBWrite,1)
      </query>
   </search>
   
   <!-- Row 1 -->
   <row>
      <panel>
         <title>Averages for all machines</title>
         <viz type="uberAgent.uberagent-singlevalue">
            <search base="Search_Single" />
            <option name="uberAgent.uberagent-singlevalue.1-field">Avg. read latency (ms)</option>
            <option name="uberAgent.uberagent-singlevalue.1-title">Avg. read latency</option>
            <option name="uberAgent.uberagent-singlevalue.1-afterLabel">ms</option>
            <option name="uberAgent.uberagent-singlevalue.2-field">Avg. write latency (ms)</option>
            <option name="uberAgent.uberagent-singlevalue.2-title">Avg. write latency</option>
            <option name="uberAgent.uberagent-singlevalue.2-afterLabel">ms</option>
            <option name="uberAgent.uberagent-singlevalue.3-field">Avg. read IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.3-title">Avg. read IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.3-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.4-field">Avg. write IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.4-title">Avg. write IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.4-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.5-field">Avg. metadata IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.5-title">Avg. metadata IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.5-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.6-field">Read data volume (MB)</option>
            <option name="uberAgent.uberagent-singlevalue.6-title">Read data volume</option>
            <option name="uberAgent.uberagent-singlevalue.6-afterLabel">MB</option>
            <option name="uberAgent.uberagent-singlevalue.7-field">Write data volume (MB)</option>
            <option name="uberAgent.uberagent-singlevalue.7-title">Write data volume</option>
            <option name="uberAgent.uberagent-singlevalue.7-afterLabel">MB</option>
         </viz>
      </panel>
   </row>
   
   <!-- Row 2 -->
   <row>
      <panel>
         <title>IOPS over time per network share (top 5)</title>
         <input type="dropdown" token="Panel21Function1" id="Input_Panel21Function1" searchWhenChanged="true">
            <choice value="avg">average</choice>
            <choice value="count">count</choice>
            <choice value="max">maximum</choice>
            <choice value="median">median</choice>
            <choice value="min">minimum</choice>
            <choice value="stdev">standard deviation</choice>
            <choice value="sum">sum</choice>
            <default>avg</default>
            <label>Function:</label>
            <prefix></prefix>
            <suffix></suffix>
         </input>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     $Panel21Function1$(IOPSRW) as "IOPS (r+w)"
                     splitrow
                        _time
                        period $PivotPeriodAutoSolo$
                     splitcol
                        SharePath
                        numcols 5
                        showother 1
                     $SearchFilter$
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">column</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.includeZero">true</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

   <!-- Row 3 -->
   <row>
      <!-- Column 1 -->
      <panel>
         <title>Data volume (top 10)</title>
         <html>
            <div class="tokenlink-container" id="Tokenlink_Panel31">
               Group by:
               <!-- Set tokens when the link is clicked (requires tokenlinks.js) -->
               <a href="#" id="Share" class="btn-pill tokenlink-default" data-token-json='{"Panel31GroupBy": "SharePath", "Panel31GroupByDisplay": "Share"}'>
                  Share
               </a>
               <a href="#" id="Host" class="btn-pill" data-token-json='{"Panel31GroupBy": "host", "Panel31GroupByDisplay": "Host"}'>
                  Host
               </a>
            </div>
         </html>
         <chart id="Chart_Panel31">
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     sum(IOMBRead) AS "Read volume (MB)"
                     sum(IOMBWrite) AS "Write volume (MB)"
                     sum(IOMBRW) AS "Read+write volume (MB)"
                     splitrow
                        $Panel31GroupBy$ as $Panel31GroupByDisplay$
                     $SearchFilter$
                  | sort limit=10 - "Read+write volume (MB)"
                  | fields
                     "$Panel31GroupByDisplay$"
                     "Read volume (MB)"
                     "Write volume (MB)"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Average latency (top 10)</title>
         <html>
            <div class="tokenlink-container" id="Tokenlink_Panel32">
               Group by:
               <!-- Set tokens when the link is clicked (requires tokenlinks.js) -->
               <a href="#" id="Share" class="btn-pill tokenlink-default" data-token-json='{"Panel32GroupBy": "SharePath", "Panel32GroupByDisplay": "Share"}'>
                  Share
               </a>
               <a href="#" id="Host" class="btn-pill" data-token-json='{"Panel32GroupBy": "host", "Panel32GroupByDisplay": "Host"}'>
                  Host
               </a>
            </div>
         </html>
         <chart id="Chart_Panel32">
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     sum(IOCountRead) AS SumIOCountRead
                     sum(IOCountWrite) AS SumIOCountWrite
                     sum(IOCountRW) AS SumIOCountRW
                     sum(IODurationReadMs) AS SumIODurationReadMs
                     sum(IODurationWriteMs) AS SumIODurationWriteMs
                     sum(IODurationRWMs) AS SumIODurationRWMs
                     splitrow
                        $Panel32GroupBy$ as $Panel32GroupByDisplay$
                     $SearchFilter$
                  | eval "Avg. read latency (ms)" = round(SumIODurationReadMs/SumIOCountRead,1)
                  | eval "Avg. write latency (ms)" = round(SumIODurationWriteMs/SumIOCountWrite,1)
                  | eval "Avg. read+write latency (ms)" = round(SumIODurationRWMs/SumIOCountRW,1)
                  | sort limit=10 - "Avg. read+write latency (ms)"
                  | fields
                     "$Panel32GroupByDisplay$"
                     "Avg. read latency (ms)"
                     "Avg. write latency (ms)"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>
   </row>

   <!-- Row 4 -->
   <row>
      <!-- Column 1 -->
      <panel>
         <title>Data volume over time</title>
         <chart id="Chart_Panel41">
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     sum(IOMBRead) AS SumIOMBRead
                     sum(IOMBWrite) AS SumIOMBWrite
                     splitrow
                        _time
                        period $PivotPeriodAutoTimechart$
                     $SearchFilter$
                  | timechart
                     `uberAgent_dynamic_span`
                     sum(SumIOMBRead) as "Read volume (MB)"
                     sum(SumIOMBWrite) as "Write volume (MB)"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">line</option>
            <option name="charting.legend.placement">bottom</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
            <option name="charting.chart.nullValueMode">zero</option>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Average latency over time</title>
         <chart id="Chart_Panel42">
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     sum(IOCountRead) AS SumIOCountRead
                     sum(IOCountWrite) AS SumIOCountWrite
                     sum(IODurationReadMs) AS SumIODurationReadMs
                     sum(IODurationWriteMs) AS SumIODurationWriteMs
                     splitrow
                        _time
                        period $PivotPeriodAutoTimechart$
                     $SearchFilter$
                  | timechart
                     `uberAgent_dynamic_span`
                     eval(round(sum(SumIODurationReadMs)/sum(SumIOCountRead),1)) as "Avg. read latency (ms)"
                     eval(round(sum(SumIODurationWriteMs)/sum(SumIOCountWrite),1)) as "Avg. write latency (ms)"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">line</option>
            <option name="charting.legend.placement">bottom</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

   <!-- Row 5 -->
   <row>
      <panel id="Panel_51">
         <title>Data table</title>
         <input type="dropdown" token="Panel51Function1" id="Input_Panel51Function1" searchWhenChanged="true">
            <choice value="avg">average</choice>
            <choice value="max">maximum</choice>
            <choice value="min">minimum</choice>
            <default>avg</default>
            <label>IOPS function:</label>
            <prefix></prefix>
            <suffix></suffix>
            <change>
               <condition value="avg">
                  <set token="Panel51Function1Display">Avg.</set>
               </condition>
               <condition value="max">
                  <set token="Panel51Function1Display">Max.</set>
               </condition>
               <condition value="min">
                  <set token="Panel51Function1Display">Min.</set>
               </condition>
            </change>
         </input>
         <html id="Html_Panel51">
            <div class="tokenlink-container" id="Tokenlink_Panel51">
               Group by:
               <!-- Set tokens when the link is clicked (requires tokenlinks.js) -->
               <a href="#" id="Share" class="btn-pill tokenlink-default" data-token-json='{"Panel51GroupBy": "SharePath", "Panel51GroupByDisplay": "Share"}'>
                  Share
               </a>
               <a href="#" id="Host" class="btn-pill" data-token-json='{"Panel51GroupBy": "host", "Panel51GroupByDisplay": "Host"}'>
                  Host
               </a>
            </div>
         </html>
         <table id="Table_Panel51">
            <search>
               <query>
                  | pivot `uA_DM_System_SmbClient` System_SmbClient
                     sum(IOCountRead) AS SumIOCountRead
                     sum(IOCountWrite) AS SumIOCountWrite
                     sum(IOCountMetadata) AS SumIOCountMetadata
                     sum(IODurationReadMs) AS SumIODurationReadMs
                     sum(IODurationWriteMs) AS SumIODurationWriteMs
                     sum(IOMBRead) AS SumIOMBRead
                     sum(IOMBWrite) AS SumIOMBWrite
                     $Panel51Function1$(IOPSRead) AS $Panel51Function1$IOPSRead
                     $Panel51Function1$(IOPSWrite) AS $Panel51Function1$IOPSWrite
                     $Panel51Function1$(IOPSMetadata) AS $Panel51Function1$IOPSMetadata
                     dc(SharePath) as "Share count"
                     dc(host) as "Host count"
                     splitrow
                        $Panel51GroupBy$ as "$Panel51GroupByDisplay$"
                     $SearchFilter$
                  | eval "Read IO count" = SumIOCountRead
                  | eval "Write IO count" = SumIOCountWrite
                  | eval "Metadata IO count" = SumIOCountMetadata
                  | eval "Avg. read latency (ms)" = round(SumIODurationReadMs/SumIOCountRead,1)
                  | eval "Avg. write latency (ms)" = round(SumIODurationWriteMs/SumIOCountWrite,1)
                  | eval "$Panel51Function1Display$ read IOPS" = round($Panel51Function1$IOPSRead,1)
                  | eval "$Panel51Function1Display$ write IOPS" = round($Panel51Function1$IOPSWrite,1)
                  | eval "$Panel51Function1Display$ metadata IOPS" = round($Panel51Function1$IOPSMetadata,1)
                  | eval "Read data volume (MB)" = round(SumIOMBRead,1)
                  | eval "Write data volume (MB)" = round(SumIOMBWrite,1)
                  | eval sortfield = lower('$Panel51GroupByDisplay$')
                  | table
                     "$Panel51GroupByDisplay$"
                     "Read IO count"
                     "Write IO count"
                     "Metadata IO count"
                     "Avg. read latency (ms)"
                     "Avg. write latency (ms)"
                     "$Panel51Function1Display$ read IOPS"
                     "$Panel51Function1Display$ write IOPS"
                     "$Panel51Function1Display$ metadata IOPS"
                     "Read data volume (MB)"
                     "Write data volume (MB)"                     
                     "Share count"
                     "Host count"
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">row</option>
         </table>
         
         <html src="machine_smbclient_explanation.html">
         </html>
      </panel>
   </row>
</form>

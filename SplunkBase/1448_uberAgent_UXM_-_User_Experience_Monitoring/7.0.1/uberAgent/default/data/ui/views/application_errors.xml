<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js, application_errors.js" stylesheet="main.css">

   <label>Application Errors</label>
   <description>This dashboard displays information about application errors (crashes and hangs).</description>

   <fieldset autoRun="true">
      <input type="time" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-1h</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>Application_Errors</default>
      </input>
   </fieldset>

   <search id="Search_Single">
      <query>
         | pivot `uA_DM_Application_Errors` Application_Errors
            count(ErrorType) as ErrorCount
            dc(ProcName) as ProcessCount
            dc(User) as UserCount
            dc(host) as HostCount
            $SearchFilter$
         | appendcols
         [
         | pivot `uA_DM_Application_Errors` Application_Errors
            count(ErrorType) as ErrorCountCrash
            dc(ProcName) as ProcessCount
            dc(User) as UserCount
            dc(host) as HostCount
            filter ErrorTypeName is "Crash"
            $SearchFilter$
         ]
         | appendcols
         [
         | pivot `uA_DM_Application_Errors` Application_Errors
            count(ErrorType) as ErrorCountHang
            dc(ProcName) as ProcessCount
            dc(User) as UserCount
            dc(host) as HostCount
            filter ErrorTypeName is "Hang"
            $SearchFilter$
         ]
      </query>
   </search>
   
   <!-- Row 1 -->
   <row>
      <panel>
         <title>Application crashes and hangs</title>
         <viz type="uberAgent.uberagent-singlevalue">
            <search base="Search_Single" />
            <option name="uberAgent.uberagent-singlevalue.1-field">ErrorCount</option>
            <option name="uberAgent.uberagent-singlevalue.1-title">All errors:</option>
            <option name="uberAgent.uberagent-singlevalue.1-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.2-field">ErrorCountCrash</option>
            <option name="uberAgent.uberagent-singlevalue.2-title">#Crashes:</option>
            <option name="uberAgent.uberagent-singlevalue.2-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.3-field">ErrorCountHang</option>
            <option name="uberAgent.uberagent-singlevalue.3-title">#Hangs:</option>
            <option name="uberAgent.uberagent-singlevalue.3-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.4-field">ProcessCount</option>
            <option name="uberAgent.uberagent-singlevalue.4-title">Affected executables:</option>
            <option name="uberAgent.uberagent-singlevalue.4-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.5-field">UserCount</option>
            <option name="uberAgent.uberagent-singlevalue.5-title">Affected users:</option>
            <option name="uberAgent.uberagent-singlevalue.5-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.6-field">HostCount</option>
            <option name="uberAgent.uberagent-singlevalue.6-title">Affected hosts:</option>
            <option name="uberAgent.uberagent-singlevalue.6-afterLabel"></option>
         </viz>
      </panel>
   </row>

   <!-- Row 2 -->
   <row>
      <panel>
         <title>Application errors over time</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(ErrorType) as "Error count"
                     splitrow
                        _time
                        period $PivotPeriodAutoSolo$
                     splitcol
                        ErrorTypeName
                     $SearchFilter$
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">column</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.includeZero">true</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.text">#Errors</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

   <!-- Row 3 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Application errors per host (top 10)</title>
         <chart id="Chart_Panel21">
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(Application_Errors) as "Application errors per host"
                     splitrow
                        host
                     $SearchFilter$
                     | sort limit=10 - "Application errors per host"
                     | fields
                        host
                        "Application errors per host"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Application errors per user (top 10)</title>
         <chart id="Chart_Panel22">
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(Application_Errors) as "Application errors per user"
                     splitrow
                        User
                     $SearchFilter$
                     | sort limit=10 - "Application errors per user"
                     | fields
                        User
                        "Application errors per user"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
         </chart>
      </panel>
   </row>

   <!-- Row 4 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Application errors per application (top 10)</title>
         <chart id="Chart_Panel31">
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(Application_Errors) as "Application errors per application"
                     splitrow
                        AppName as Application
                     $SearchFilter$
                     | sort limit=10 - "Application errors per application"
                     | fields
                        Application
                        "Application errors per application"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Application errors per process (top 10)</title>
         <chart id="Chart_Panel32">
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(Application_Errors) as "Application errors per process"
                     splitrow
                        ProcName as Process
                     $SearchFilter$
                     | sort limit=10 - "Application errors per process"
                     | fields
                        Process
                        "Application errors per process"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
         </chart>
      </panel>
   </row>

   <!-- Row 5 -->
   <row>
      <panel>
         <title>Crashes</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(ErrorType) as "#Crashes"
                     values(AppName) as "App name(s)"
                     values(ProcVersion) as "Process version(s)"
                     dc(User) as "User count"
                     dc(host) as "Host count"
                     values(ExceptionCode) as "Exception code(s)"
                     values(ModuleName) as "Faulting module(s)"
                     avg(ProcLifetimeMs) as AvgProcLifetimeMs
                     splitrow
                        ProcName as "Process name"
                     filter ErrorTypeName is "Crash"
                     $SearchFilter$
                  | eval "Avg. process lifetime [s]" = round(AvgProcLifetimeMs/1000,1)
                  | eval sortfield=lower('App name')
                  | table
                     "Process name"
                     "Process version(s)"
                     "App name(s)"
                     "#Crashes"
                     "User count"
                     "Host count"
                     "Exception code(s)"
                     "Faulting module(s)"
                     "Avg. process lifetime [s]"
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">row</option>
            <drilldown>
               <set token="DrilldownFilterBy41">$click.value$</set>
            </drilldown>
         </table>

         <table depends="$DrilldownFilterBy41$">
            <title>Crashes with: process name = $DrilldownFilterBy41$</title>
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(ErrorType) as "#Crashes"
                     values(AppName) as "App name(s)"
                     values(User) as "User(s)"
                     values(host) as "Host(s)"
                     values(ProcTimestamp) as "Process build timestamp(s)"
                     values(ModuleTimestamp) as "Module build timestamp(s)"
                     values(ProcImageUUID) as "Process unique identifier(s)"
                     values(ModuleImageUUID) as "Module unique identifier(s)"
                     avg(ProcLifetimeMs) as AvgProcLifetimeMs
                     latest(OsPlatform) as OsPlatform
                     splitrow
                        ProcName as "Process name"
                     splitrow
                        ProcVersion as "Process version(s)"
                     splitrow
                        ExceptionCode as "Exception code(s)"
                     splitrow
                        ModuleName as "Faulting module(s)"
                     filter ProcName is $DrilldownFilterBy41|s$
                     filter ErrorTypeName is "Crash"
                     $SearchFilter$
                  | eval "Avg. process lifetime [s]" = round(AvgProcLifetimeMs/1000,1)
                  | eval "Process identifier(s)" = case(OsPlatform=="Windows",'Process build timestamp(s)',OsPlatform=="macOS",'Process unique identifier(s)')
                  | eval "Module identifier(s)" = case(OsPlatform=="Windows",'Module build timestamp(s)',OsPlatform=="macOS",'Module unique identifier(s)')
                  | eval sortfield=lower('App name')
                  | table
                     "Process name"
                     "Process version(s)"
                     "App name(s)"
                     "#Crashes"
                     "User(s)"
                     "Host(s)"
                     "Exception code(s)"
                     "Faulting module(s)"
                     "Avg. process lifetime [s]"
                     "Process identifier(s)"
                     "Module identifier(s)"
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>

         <html src="application_errors_explanation.html">
         </html>
      </panel>
   </row>

   <!-- Row 6 -->
   <row>
      <panel>
         <title>Hangs</title>
         <table>
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(ErrorType) as "#Hangs"
                     values(AppName) as "App name(s)"
                     values(ProcVersion) as "Process version(s)"
                     values(HangType) as "Hang type(s)"
                     dc(User) as "User count"
                     dc(host) as "Host count"
                     avg(ProcLifetimeMs) as AvgProcLifetimeMs
                     splitrow
                        ProcName as "Process name"
                     filter ErrorTypeName is "Hang"
                     $SearchFilter$
                  | eval "Avg. process lifetime [s]" = round(AvgProcLifetimeMs/1000,1)
                  | eval sortfield=lower('App name')
                  | table
                     "Process name"
                     "Process version(s)"
                     "App name(s)"
                     "Hang type(s)"
                     "#Hangs"
                     "User count"
                     "Host count"
                     "Avg. process lifetime [s]"
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">row</option>
            <drilldown>
               <set token="DrilldownFilterBy51">$click.value$</set>
            </drilldown>
         </table>

         <table depends="$DrilldownFilterBy51$">
            <title>Hangs with: process name = $DrilldownFilterBy51$</title>
            <search>
               <query>
                  | pivot `uA_DM_Application_Errors` Application_Errors
                     count(ErrorType) as "#Hangs"
                     values(AppName) as "App name(s)"
                     values(HangType) as "Hang type(s)"
                     values(User) as "User(s)"
                     values(host) as "Host(s)"
                     avg(ProcLifetimeMs) as AvgProcLifetimeMs
                     splitrow
                        ProcName as "Process name"
                     splitrow
                        ProcVersion as "Process version(s)"
                     filter ProcName is $DrilldownFilterBy51|s$
                     filter ErrorTypeName is "Hang"
                     $SearchFilter$
                  | eval "Avg. process lifetime [s]" = round(AvgProcLifetimeMs/1000,1)
                  | eval sortfield=lower('App name')
                  | table
                     "Process name"
                     "Process version(s)"
                     "App name(s)"
                     "Hang type(s)"
                     "#Hangs"
                     "User(s)"
                     "Host(s)"
                     "Avg. process lifetime [s]"
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>

         <html src="application_errors_explanation_2.html">
         </html>
      </panel>
   </row>

</form>

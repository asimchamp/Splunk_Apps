<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js" stylesheet="main.css">

   <label>SBC Sizing and Capacity Planning</label>
   <description>This dashboard displays relevant information for sizing server-based computing farms (RDS/XenApp).</description>

   <fieldset autoRun="true">
      <input type="time" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-1h</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>System_SystemPerformanceSummary</default>
      </input>
   </fieldset>

   <search id="Search_Single">
      <query>
         | pivot `uA_DM_System_SystemPerformanceSummary` System_SystemPerformanceSummary
            avg(CPUUsagePercent) as CPUUsagePercentByTimeHost
            avg(RAMUsageGB) as RAMUsageGBByTimeHost
            avg(IOPS) as IOPSReadWriteByTimeHost
            avg(IOPercentDiskTime) as IOPercentDiskTimeByTimeHost
            avg(NetUtilizationPercent) as NetUtilizationPercentByTimeHost
            avg(TotalRamGb) as TotalRamGb
            splitrow
               _time
               period minute
            splitrow
               host
            $SearchFilter$
         | stats
            avg(CPUUsagePercentByTimeHost) as CPUUsagePercentByTime
            sum(RAMUsageGBByTimeHost) as RAMUsageGBByTime
            sum(IOPSReadWriteByTimeHost) as IOPSReadWriteByTime
            avg(IOPercentDiskTimeByTimeHost) as IOPercentDiskTimeByTime
            avg(NetUtilizationPercentByTimeHost) as NetUtilizationPercentByTime
            sum(TotalRamGb) as TotalRamGb
            by _time
         | stats
            max(CPUUsagePercentByTime) as PeakCPUUsagePercent
            max(RAMUsageGBByTime) as PeakRAMUsageGB
            max(IOPSReadWriteByTime) as PeakIOPSReadWrite
            max(IOPercentDiskTimeByTime) as PeakIOPercentDiskTime
            max(NetUtilizationPercentByTime) as PeakNetUtilizationPercent
            max(TotalRamGb) as TotalRamGb
         | eval PeakCPUUsagePercentRounded=round(PeakCPUUsagePercent,0)
         | eval PeakRAMUsagePercentRounded=round(PeakRAMUsageGB/TotalRamGb*100,0)
         | eval PeakRAMUsageGBRounded=round(PeakRAMUsageGB,0)
         | eval PeakIOPSReadWriteRounded=round(PeakIOPSReadWrite,0)
         | eval PeakIOPercentDiskTimeRounded=round(PeakIOPercentDiskTime,0)
         | eval PeakNetUtilizationPercentRounded=round(PeakNetUtilizationPercent,0)
         | appendcols
         [
         | pivot `uA_DM_Session_SessionDetail_Users` Session_SessionDetail_Users
            dc(SessionGUID) as UniqueSessions
            splitrow
               _time
               period minute
            $SearchFilter$
         | stats
            max(UniqueSessions) as MaxConcurrentSessions
         ]
      </query>
   </search>
   
   <!-- Row 1 -->
   <row>
      <panel>
         <title>Peak average usage</title>
         <html src="sbc_sizing_1.html">
         </html>
         <viz type="uberAgent.uberagent-singlevalue">
            <search base="Search_Single" />
            <option name="uberAgent.uberagent-singlevalue.1-field">PeakCPUUsagePercentRounded</option>
            <option name="uberAgent.uberagent-singlevalue.1-title">CPU:</option>
            <option name="uberAgent.uberagent-singlevalue.1-afterLabel">%</option>
            <option name="uberAgent.uberagent-singlevalue.2-field">PeakRAMUsagePercentRounded</option>
            <option name="uberAgent.uberagent-singlevalue.2-title">RAM:</option>
            <option name="uberAgent.uberagent-singlevalue.2-afterLabel">%</option>
            <option name="uberAgent.uberagent-singlevalue.2-underLabel">##PeakRAMUsageGBRounded## GB</option>
            <option name="uberAgent.uberagent-singlevalue.3-field">PeakIOPercentDiskTimeRounded</option>
            <option name="uberAgent.uberagent-singlevalue.3-title">Disk:</option>
            <option name="uberAgent.uberagent-singlevalue.3-afterLabel">%</option>
            <option name="uberAgent.uberagent-singlevalue.3-underLabel">##PeakIOPSReadWriteRounded## IOPS</option>
            <option name="uberAgent.uberagent-singlevalue.4-field">PeakNetUtilizationPercentRounded</option>
            <option name="uberAgent.uberagent-singlevalue.4-title">Network:</option>
            <option name="uberAgent.uberagent-singlevalue.4-afterLabel">%</option>
            <option name="uberAgent.uberagent-singlevalue.5-field">MaxConcurrentSessions</option>
            <option name="uberAgent.uberagent-singlevalue.5-title">Concurrent sessions:</option>
            <option name="uberAgent.uberagent-singlevalue.5-afterLabel"></option>
         </viz>
      </panel>
   </row>
   
   <!-- Row 2 -->
   <row>
      <panel>
         <title>Average usage over time</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_System_SystemPerformanceSummary` System_SystemPerformanceSummary
                     avg(CPUUsagePercent) as CPUUsagePercentByTime
                     avg(RAMUsageGB) as RAMUsageGBByTime
                     avg(IOPercentDiskTime) as IOPercentDiskTimeByTime
                     avg(NetUtilizationPercent) as NetUtilizationPercentByTime
                     avg(TotalRamGb) as TotalRamGbByTime
                     splitrow
                        _time
                        period minute
                     $SearchFilter$
                  | timechart
                     `uberAgent_dynamic_span`
                     eval(round(avg(CPUUsagePercentByTime),1)) as "CPU usage (%)"
                     eval(round(sum(RAMUsageGBByTime)/sum(TotalRamGbByTime)*100,1)) as "RAM usage (%)"
                     eval(round(avg(IOPercentDiskTimeByTime),1)) as "Disk usage (%)"
                     eval(round(avg(NetUtilizationPercentByTime),1)) as "Network usage (%)"
               </query>
            </search>
            <option name="height">400</option>
            <option name="charting.chart">column</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">bottom</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

</form>

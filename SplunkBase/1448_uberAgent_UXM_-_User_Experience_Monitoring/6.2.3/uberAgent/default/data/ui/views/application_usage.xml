<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js" stylesheet="main.css">

   <label>Application Usage</label>
   <description>This dashboard displays information about actual application usage.</description>

   <fieldset autoRun="true">
      <input type="time" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-1d</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>CommonWithUser</default>
      </input>
   </fieldset>

   <search id="Search_Single">
      <query>
         | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
            dc(AppName) as AppNameCount
            dc(AppVersion) as VersionCount
            dc(ProcUser) as UserCount
            dc(host) as HostCount
            filter SessionID > 0
            filter AppName is *
            `uberAgent_filter_AppNameIsNotOS`
            $SearchFilter$
      </query>
   </search>
   
   <!-- Row 1 -->
   <row>
      <panel>
         <viz type="uberAgent.uberagent-singlevalue">
            <search base="Search_Single" />
            <option name="uberAgent.uberagent-singlevalue.1-field">AppNameCount</option>
            <option name="uberAgent.uberagent-singlevalue.1-title">#Applications:</option>
            <option name="uberAgent.uberagent-singlevalue.1-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.2-field">VersionCount</option>
            <option name="uberAgent.uberagent-singlevalue.2-title">#Versions:</option>
            <option name="uberAgent.uberagent-singlevalue.2-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.3-field">UserCount</option>
            <option name="uberAgent.uberagent-singlevalue.3-title">#Users:</option>
            <option name="uberAgent.uberagent-singlevalue.3-afterLabel"></option>
            <option name="uberAgent.uberagent-singlevalue.4-field">HostCount</option>
            <option name="uberAgent.uberagent-singlevalue.4-title">#Hosts:</option>
            <option name="uberAgent.uberagent-singlevalue.4-afterLabel"></option>
         </viz>
      </panel>
   </row>

   <row>

      <panel>
         <title>Foreground application over time (%)</title>
         <chart>
            <search>
               <query>
                  <![CDATA[
                     | pivot `uA_DM_Session_SessionDetail_Users` Session_SessionDetail_Users
                        count(Session_SessionDetail_Users)
                        splitrow
                           _time
                           period $PivotPeriodAutoSolo$
                        splitcol
                           SessionFgAppName
                        $SearchFilter$
                     | eval NULL = coalesce (NULL, 0)
                     | eval OTHER = coalesce (OTHER, 0)
                     | rename NULL as _NULL
                     | eval _RowTotal = 0
                     | foreach * [ eval _RowTotal = _RowTotal + '<<FIELD>>']
                     | eval _TotalEvents = _RowTotal + _NULL + OTHER
                     | foreach * [ eval <<MATCHSTR>> = round ('<<FIELD>>' / _TotalEvents * 100, 1)]
                  ]]>
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">column</option>
            <option name="charting.chart.stackMode">stacked100</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.includeZero">false</option>
            <option name="charting.axisY.maximumNumber">100</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
            <option name="charting.chart.nullValueMode">zero</option>
         </chart>
      </panel>

   </row>
   
   <!-- Row 2 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Foreground application (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_Session_SessionDetail_Users` Session_SessionDetail_Users
                     count(SessionFgAppName) as CountSessionFgAppName
                     splitrow
                        SessionFgAppName
                     $SearchFilter$
                  | eventstats sum(CountSessionFgAppName) as EventCount
                  | eval "App in foreground (%)"=round(CountSessionFgAppName/EventCount*100,1)
                  | fields SessionFgAppName "App in foreground (%)"
                  | sort -"App in foreground (%)"
                  | head 10
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <drilldown>
               <link>
                  <![CDATA[
                     single_application_detail?earliest=$earliest$&latest=$latest$&form.FilterField=sAppName&form.FilterOperator=in&form.FilterExpression=$click.value$
                  ]]>
               </link>
            </drilldown>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Foreground process (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_Session_SessionDetail_Users` Session_SessionDetail_Users
                     count(SessionFgProcessName) as CountSessionFgProcessName
                     splitrow
                        SessionFgProcessName
                     $SearchFilter$
                  | eventstats sum(CountSessionFgProcessName) as EventCount
                  | eval "Process in foreground (%)"=round(CountSessionFgProcessName/EventCount*100,1)
                  | fields SessionFgProcessName "Process in foreground (%)"
                  | sort -"Process in foreground (%)"
                  | head 10
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <drilldown>
               <link>
                  <![CDATA[
                     analyze_timechart?earliest=$earliest$&latest=$latest$&form.FilterDatamodel=Process_ProcessDetail&form.FilterField=sProcName&form.FilterOperator=in&form.FilterExpression=$click.value$
                  ]]>
               </link>
            </drilldown>
         </chart>
      </panel>
   </row>

   <!-- Row 3 -->
   <row>

      <!-- Column 1 -->
      <panel>
         <title>Number of users running an application (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(ProcUser) as "#Users"
                     splitrow
                        AppName as Name
                     filter SessionID > 0
                     filter AppName is *
                     `uberAgent_filter_AppNameIsNotOS`
                     $SearchFilter$
                  | sort limit=10 - "#Users"
                  | fields
                     Name
                     "#Users"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <drilldown>
               <link>
                  <![CDATA[
                     single_application_detail?earliest=$earliest$&latest=$latest$&form.FilterField=sAppName&form.FilterOperator=in&form.FilterExpression=$click.value$
                  ]]>
               </link>
            </drilldown>
         </chart>
      </panel>

      <!-- Column 2 -->
      <panel>
         <title>Number of computers running an application (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(host) as "#Hosts"
                     splitrow
                        AppName as Name
                     filter SessionID > 0
                     filter AppName is *
                     `uberAgent_filter_AppNameIsNotOS`
                     $SearchFilter$
                  | sort limit=10 - "#Hosts"
                  | fields
                     Name
                     "#Hosts"
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <drilldown>
               <link>
                  <![CDATA[
                     single_application_detail?earliest=$earliest$&latest=$latest$&form.FilterField=sAppName&form.FilterOperator=in&form.FilterExpression=$click.value$
                  ]]>
               </link>
            </drilldown>
         </chart>
      </panel>
   </row>

   <!-- Row 4 -->
   <row>
      <panel>
         <title>Application usage</title>
         <input type="dropdown" token="Panel41AppFilterTemp" searchWhenChanged="true">
            <choice value="">All</choice>
            <default></default>
            <label>App name:</label>
            <allowCustomValues>true</allowCustomValues>
            <change>
               <condition value="">
                  <set token="Panel41AppFilter"></set>
                  <unset token="DrilldownFilterBy41"></unset>
               </condition>
               <condition value="*">
                  <set token="Panel41AppFilter">filter AppName is $value|s$</set>
                  <unset token="DrilldownFilterBy41"></unset>
               </condition>
            </change>
         </input>
         <table>
            <title>All filtered applications</title>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(AppVersion) as "#Versions"
                     dc(ProcUser) as "#Users"
                     dc(host) as "#Hosts"
                     splitrow
                        AppName as Name
                        $Panel41AppFilter$
                     filter SessionID > 0
                     filter AppName is *
                     `uberAgent_filter_AppNameIsNotOS`
                     $SearchFilter$
                  | eval sortfield = lower ('Name')
                  | sort limit=0 sortfield
                  | table
                     Name
                     "#Versions"
                     "#Users"
                     "#Hosts"
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">row</option>
            <drilldown>
                <set token="DrilldownFilterBy41">$click.value$</set>
            </drilldown>
         </table>

         <html src="application_usage_explanation.html">
         </html>
      </panel>
   </row>

   <row depends="$DrilldownFilterBy41$">
      <panel>
         <chart>
            <title>$DrilldownFilterBy41$: usage over time</title>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(ProcUser) as "#Users"
                     dc(host) as "#Hosts"
                     splitrow
                        _time
                        period $PivotPeriodAutoSolo$
                     filter SessionID > 0
                     filter AppName is $DrilldownFilterBy41|s$
                     $SearchFilter$
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">line</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.includeZero">true</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>
   <row depends="$DrilldownFilterBy41$">
      <panel>
         <chart>
            <title>$DrilldownFilterBy41$: process count over time</title>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(ProcID) as "#Processes"
                     splitcol
                        ProcName
                     splitrow
                        _time
                        period $PivotPeriodAutoSolo$
                     filter SessionID > 0
                     filter AppName is $DrilldownFilterBy41|s$
                     $SearchFilter$
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">column</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisY.includeZero">true</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.chart.nullValueMode">zero</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>
      
   <!-- Row 7 -->
   <row depends="$DrilldownFilterBy41$">
      <panel>
         <table>
            <title>$DrilldownFilterBy41$: usage per application version</title>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     dc(ProcUser) as "#Users"
                     dc(host) as "#Hosts"
                     splitrow
                        AppVersion as Version
                     filter SessionID > 0
                     filter AppName is $DrilldownFilterBy41|s$
                     $SearchFilter$
                  | eval sortfield = lower ('Version')
                  | sort limit=0 sortfield
                  | table
                     Version
                     "#Users"
                     "#Hosts"
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">none</option>
         </table>
         
         <html src="application_usage_explanation_2.html" depends="$DrilldownFilterBy41$">
         </html>
      </panel>
         
      <panel>
         <table depends="$DrilldownFilterBy41$">
            <title>$DrilldownFilterBy41$: usage detail</title>
            <search>
               <query>
                  | pivot `uA_DM_Process_ProcessDetail` Process_ProcessDetail
                     splitrow
                        ProcUser as User
                     splitrow
                        AppVersion as Version
                     splitrow
                        host as Host
                     filter SessionID > 0
                     filter AppName is $DrilldownFilterBy41|s$
                     $SearchFilter$
                  | eval sortfield=lower('User')
                  | table
                     User
                     Version
                     Host
                     sortfield
                  | sort limit=0 sortfield
                  | fields - sortfield
               </query>
            </search>
            <option name="count">50</option>
            <option name="drilldown">none</option>
         </table>

         <html src="application_usage_explanation_3.html" depends="$DrilldownFilterBy41$">
         </html>
         
      </panel>
   </row>

   <!-- Row 8 -->
   <row depends="$DrilldownFilterBy41$">

      <panel>
         <table>
            <title>$DrilldownFilterBy41$: foreground window(s)</title>
            <search>
               <query>
                  | pivot `uA_DM_Session_SessionDetail_Users` Session_SessionDetail_Users
                     count(SessionFgAppName) as CountSessionFgAppName
                     values(SessionFgWindowTitle) as "Window title"
                     dc(SessionFgAppVersion) as "#Versions"
                     dc(SessionUser) as "#Users"
                     dc(host) as "#Hosts"
                     splitrow
                         SessionFgWindowTitle
                     filter AppName is $DrilldownFilterBy41|s$
                     $SearchFilter$
                  | eventstats sum(CountSessionFgAppName) as EventCount
                  | eval "Window in foreground (%)"=round(CountSessionFgAppName/EventCount*100,1)
                  | table
                     "Window title"
                     "Window in foreground (%)"
                     "#Versions"
                     "#Users"
                     "#Hosts"
               </query>
            </search>
            <option name="count">10</option>
            <option name="drilldown">none</option>
         </table>
      </panel>
   </row>

</form>

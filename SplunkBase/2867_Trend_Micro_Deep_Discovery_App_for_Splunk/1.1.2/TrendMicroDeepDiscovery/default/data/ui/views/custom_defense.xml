<form>
  <label>Custom Detections and Watchlists</label>
  <description/>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="intime" searchWhenChanged="true">
      <label>Period / Range:</label>
      <default>
        <earliestTime>-7d@h</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Deep Discovery Inspector Custom Detections</title>
        <searchString>cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource  cs11!="GLOBAL_INTELLIGENCE" | eval Object=if(len(cs12)&lt;72, cs12, substr(cs12,0,72)+"...") | eval Type=if(cs13=="IP_DOMAIN", "IP Address or domain", cs13) | stats count by Object,Type,cs11 | sort -count | 
rename cs11 as "Detection Type" | rename count as Occurrences</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource 
            cs11!="GLOBAL_INTELLIGENCE" earliest=$intime.earliest$ latest=$intime.latest$ 
|search cs12="$click.value$" | convert ctime(_time) as "Detected"
|table Detected,dvchost,src,shost,dst,dhost,app,cef_severity,ruleId,ruleName,cs11,cs12,cs13 
|rename dvchost as "Device" | rename src as "Source IP" | rename shost as "Source Host"
|rename dst as "Destination IP" | rename dhost as "Destination Host" | rename app as Protocol 
|rename ruleId as "Rule ID" | rename ruleName as "Rule Name" | rename cef_severity as Severity 
|rename cs11 as "Detection Type" | rename cs12 as "Object" | rename cs13 as "Object Type"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Deep Discovery Analyzer Custom Detections</title>
        <searchString>cef_product="Deep Discovery Analyzer" cef_signature=200120 | eval DetType="VIRTUAL_ANALYZER" | eval Object=case(cs1=="Deny List IP/Port", dst, cs1=="Deny List Domain", dhost, cs1=="Deny List URL", if(len(request)&lt;72, request, substr(request,0,72)+"..."), cs1=="Deny List File SHA1", fileHash) | eval Type=case(cs1=="Deny List IP/Port", "IP address", cs1=="Deny List Domain", "Domain", cs1=="Deny List URL", "URL", cs1=="Deny List File SHA1", "File SHA1") | stats count by  Object, Type,DetType | sort -count | rename DetType AS "Detection Type", count AS Occurrences</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=cef_product="Deep Discovery Analyzer" cef_signature=200120 earliest=$intime.earliest$ latest=$intime.latest$
| eval Object=case(cs1=="Deny List IP/Port", dst, cs1=="Deny List Domain", dhost, cs1=="Deny List URL", request, cs1=="Deny List File SHA1", fileHash)
| search Object="$click.value$" | convert ctime(_time) as "Detected" | eval RiskLevel=if(cs2!=Null, cs2, deviceExternalRiskType)
| table Detected, dvchost, cef_product,cs1, Object RiskLevel
| rename dvchost AS Device, cef_product AS "Detection Type", cs1 AS "Object Type", RiskLevel AS "Risk Level"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Virtual Analyzer - High Risk Files</title>
        <searchString>cef_signature=200119  cn2Label=ROZRating cn2=3 | eval Detection=if(cs2Label="MalwareName", cs2, if(malName!="", malName, "")) |stats count by fileHash fname fileType Detection |fields fileHash fname fileType count Detection | sort -count | rename fileHash as "File SHA-1" fname as "File Name" fileType as "File Type" | rename count as " Occurrences"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=(cef_signature=200119 cn2Label=ROZRating cn2=3 fileHash="$click.value$" earliest=$earliest$ latest=$latest$) OR (cef_signature=200128 fileHash="$click.value$" cn1=0 earliest=$earliest$ latest=$latest$)</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Virtual Analyzer - High Risk URLs</title>
        <searchString>cef_signature=200126  cn2Label=ROZRating cn2=3 | stats count by request |fields request count | sort -count | rename request as "URL" | rename count as " Occurrences"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=(cef_signature=200126 cn2Label=ROZRating cn2=3 request="$click.value$" earliest=$earliest$ latest=$latest$) OR (cef_signature=200128 request="$click.value$" cn1=1 earliest=$earliest$ latest=$latest$)</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Hosts with Custom Detections</title>
        <searchString>cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE"  |eval Hostname=(if(src=interestedIp, shost, dhost)) |stats count(eval(cs11="USER_DEFINED")) as "Denied Objects", count(eval(cs11="VIRTUAL_ANALYZER")) as "Suspicious Objects" by interestedIp,Hostname  | addtotals |sort - Total |rename interestedIp as "IP Address"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE" $in_objtype_filter$ earliest=$intime.earliest$ latest=$intime.latest$ 
|search interestedIp=$click.value$ | convert ctime(_time) as "Detected"
|table Detected,dvchost,src,shost,dst,dhost,app,cef_severity,ruleId,ruleName,cs11,cs12,cs13 
|rename dvchost as "Device" | rename src as "Source IP" |rename shost as "Source Host"
|rename dst as "Destination IP" | rename dhost as "Destination Host" |rename app as Protocol 
|rename ruleId as "Rule ID" | rename ruleName as "Rule Name" | rename cef_severity as Severity  
|rename cs11 as "Detection Type" | rename cs12 as "Object" | rename cs13 as "Object Type"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>IP Address Watchlist</title>
        <searchString>cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE" [inputlookup watch_list.csv | fields interestedIp]  |top interestedIp |lookup watch_list.csv interestedIp OUTPUT Description |fields interestedIp,Description,count |rename interestedIp as "IP Address" | rename count as "Occurrences"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE" earliest=$intime.earliest$ latest=$intime.latest$
|search interestedIp=$click.value$ | convert ctime(_time) as "Detected"
|table Detected,dvchost,src,shost,cs4,dst,dhost,cs9,app,cef_severity,ruleId,ruleName,pAttackPhase
|rename dvchost as "Device" | rename src as "Source IP" |rename shost as "Source Host" |rename cs4 as "Source Group"
|rename dst as "Destination IP" | rename dhost as "Destination Host" |rename cs9 as "Destination Group" |rename app as Protocol
|rename ruleId as "Rule ID" | rename ruleName as "Rule Name" | rename cef_severity as Severity
|rename pAttackPhase as "Attack Phase"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Hostname Watchlist</title>
        <searchString>cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE"  [inputlookup watch_list_src.csv | fields shost]  | stats count(eval(_raw)) as "count" by shost,src  |lookup watch_list_src.csv shost OUTPUT Description | sort - count  |table shost,src,Description,count |rename shost as "Source Host" |rename src as "Source IP" |rename count as "Occurrences"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=cs12Label=CCCA_Destination cs13Label=CCCA_DestinationFormat cs11Label=CCCA_DetectionSource cs11!="GLOBAL_INTELLIGENCE" earliest=$intime.earliest$ latest=$intime.latest$
|search shost="$click.value$" | convert ctime(_time) as "Detected"
|table Detected,dvchost,src,shost,cs4,dst,dhost,cs9,app,cef_severity,ruleId,ruleName,pAttackPhase
|rename dvchost as "Device" | rename src as "Source IP" |rename shost as "Source Host" |rename cs4 as "Source Group"
|rename dst as "Destination IP" | rename dhost as "Destination Host" |rename cs9 as "Destination Group" |rename app as Protocol
|rename ruleId as "Rule ID" | rename ruleName as "Rule Name" | rename cef_severity as Severity
|rename pAttackPhase as "Attack Phase"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Email Recipient Watchlist</title>
        <searchString>(appGroup=SMTP OR appGroup=IMAP4 OR appGroup=POP3 OR appGroup=WEBMAIL) duser [inputlookup watch_list.csv | fields duser]  |stats count(eval(_raw)) as "count" by duser | lookup watch_list.csv duser OUTPUT Description |sort - count  |table duser,Description,count  | rename duser as "Recipient" | rename count as "Occurrences"</searchString>
        <earliestTime>$intime.earliest$</earliestTime>
        <latestTime>$intime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">heatmap</option>
        <option name="drilldown">row</option>
        <drilldown target="_blank">
          <link>search?q=(appGroup=SMTP OR appGroup=IMAP4 OR appGroup=POP3 OR appGroup=WEBMAIL) duser earliest=$intime.earliest$ latest=$intime.latest$
|search duser="$click.value$" | convert ctime(_time) as "Detected"
|table Detected,dvchost,suser,duser,app,cef_severity,ruleId,ruleName,pAttackPhase,mailMsgSubject
|rename dvchost as "Device" | rename suser as "Sender" |rename mailMsgSubject as "Subject" 
|rename duser as "Recipient" | rename app as Protocol |rename ruleId as "Rule ID" | rename ruleName as "Rule Name"
|rename cef_severity as "Severity" | rename pAttackPhase as "Attack Phase"</link>
        </drilldown>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>
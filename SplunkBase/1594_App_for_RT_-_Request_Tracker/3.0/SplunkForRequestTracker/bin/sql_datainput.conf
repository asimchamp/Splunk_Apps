[rtdb]
engine = mysql
port = 3306
hostname = $DB_HOST$
username = $DB_USER$
password = $DB_PASSWORD$
instance = rtdb
query    = 
   SELECT
     trn.Created AS Date,
     trn.ObjectId AS TicketID,
     que.Name AS Queue,
     usr.EmailAddress AS Who,
     trn.Type AS Type,
     trn.Field AS Field,
	 trn.OldValue AS OldValue,
     trn.NewValue AS NewValue,
     tck.Subject AS Subject,
     cre.Mail AS Requestor,
     own.Name AS Owner,
     tck.Priority AS Priority,
     trn.id AS ID
  FROM
     ( SELECT * FROM Transactions WHERE id > %(last_id)s) AS trn,
     Tickets AS tck,
     Users AS usr,
     Queues AS que,
     (SELECT Tickets.id AS id, Users.Name AS Name FROM Tickets, Users  WHERE Tickets.Owner=Users.id) AS own,
     (SELECT Tickets.id AS id, Users.EmailAddress AS Mail FROM Tickets, Users WHERE Tickets.Creator=Users.id) AS cre
  WHERE
       trn.ObjectType="RT::Ticket" AND
       (trn.Field!="Owner" OR trn.Field IS NULL) AND
       own.id=trn.ObjectId AND
       cre.id=trn.ObjectId AND
       trn.Creator=usr.id AND
       trn.ObjectId=tck.Id AND
       que.id=tck.Queue
  UNION
  SELECT
     trn.Created AS Date,
     trn.ObjectId AS TicketID,
     que.Name AS Queue,
     usr.EmailAddress AS Who,
     trn.Type AS Type,
     trn.Field AS Field,
     own02.Name AS OldOwner,
     own03.Name AS NewOwner,
     tck.Subject AS Subject,
     cre.Mail AS Requestor,
     own01.Name AS Owner,
     tck.Priority AS Priority,
     trn.id AS ID
  FROM
     (SELECT * FROM Transactions WHERE id > %(last_id)s) AS trn,
     Tickets AS tck,
     Users AS usr,
     Queues AS que,
     (SELECT Tickets.id AS id, Users.Name AS Name FROM Tickets, Users WHERE Tickets.Owner=Users.id) AS own01,
     (SELECT id as id, Name as Name FROM Users) AS own02,
     (SELECT id as id, Name as Name FROM Users) AS own03,
     (SELECT Tickets.id AS id, Users.EmailAddress AS Mail FROM Tickets, Users WHERE Tickets.Creator=Users.id) AS cre
  WHERE
     trn.ObjectType="RT::Ticket" AND
     trn.Field="Owner" AND
     own01.id=trn.ObjectId AND
     own02.id=trn.OldValue AND
     own03.id=trn.NewValue AND
     cre.id=trn.ObjectId AND
     trn.Creator=usr.id AND
     trn.ObjectId=tck.Id AND
     que.id=tck.Queue
  
  

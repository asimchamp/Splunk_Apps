<div id="header">

<h1>Collector Configuration Options</h1>

</div>



<br>

<h2>Overview</h2>





<a href="#concurrency">Concurrency</a><br />

<a href="#filters">Filtering Flows</a><br />

<a href="#exporters">Exporters</a><br />

<a href="#custom_exporters">Implement Your Own Exporter as a Plugin</a><br />



<br>

<a name="concurrency"></a>

<h2>Concurrency</h2>

<p>By default when running on a host with multiple cores, the collector takes advantage of by creating a separate server process per core. This parallelizes IPFX processing. This configuration can be tuned using the "multiprocess" dictionary inside of the main collector config file.</p>



<p>

<b>To disable multiprocessing (force a single process):</b><br>

<pre><code>{

    "multiprocess": 

        {"enabled": false}

}

</code></pre>

</p>



<p>

<b>To force 2 server processes:</b><br>

<pre><code>{

    "multiprocess": 

        {

            "enabled": true,

            "numProcesses": 2

        }

}

</code></pre>

</p>



<br />

<a name="filters"></a>

<h2>Filtering Flows</h2>

<p>Collector supports three optional flow filtering modes- inclusion mode (whitelist), exclusion mode (blacklist), and hybrid. Filtering is defined in a separate JSON policy file. The policy file path could be specified when starting the collector. By default, the collector will look for policy stored in this file:</p>

<pre><code>/etc/acnvmfilters.conf</code></pre>



<p>If no policy exists, filtering is disabled and all flows will be processed and exported. The three filtering modes operates as follows:



<ul>

    <li>

        <b>Include Only (whitelist)</b> - By default, a flow is dropped unless it matches an include rule.

    </li>

    <li>

        <b>Exclude Only (blacklist)</b> - By default, a flow is collected unless it matches an exclude rule.

    </li>

    <li>

        <b>Include + Exclude (hybrid)</b> - By default, a flow is dropped unless it matches an include rule AND it does not match an exclude rule.

    </li>

</ul>

</p>



<p>

Each rule is specified as a JSON dictionary, with each key/value pair specifying a match criteria on a flow field (whose name matches the key). Suffix wildcards are supported for string field types and is denoted by a *.

</p>



<p>

<b>Sample: Exclude all DNS flows:</b><br>

<pre><code>{

  "rules": 

    {

        "exclude": 

        [

            {"dp": 53, "pr": 17}

        ]

    }

}

</code></pre>

</p>



<p>

<b>Sample: Exclude flows to certain DNS servers:</b><br>

<pre><code>{

  "rules": 

    {

        "exclude": 

        [

            {"dp": 53, "pr": 17, "da": "1.2.*"},

            {"dp": 53, "pr": 17, "da": "8.8.8.8"}

        ]

    }

}

</code></pre>

</p>



<p>

<b>Sample- Only collect flows from Angry Birds (Android app), but ignore DNS flows:</b><br>

<pre><code>{

  "rules": 

    {

        "include": 

        [

          {"pname": "com.rovio.angrybirds"}

        ],

        "exclude": 

        [

            {"dp": 53, "pr": 17, "da": "1.2.*"},

            {"dp": 53, "pr": 17, "da": "8.8.8.8"}

        ]

    }

}

</code></pre>

</p>



<br>

<a name="exporters"></a>

<h2>Additional Exporters</h2>

<p>The collector exporter currently supports Splunk (syslog). There is also limited support for Kafka. To request additional support, please contact: nvzflow@cisco.com</p>



<p>Export behavior can be configured in the main configuration file.</p>



<p>

<b>Sample Splunk (syslog) Export Configuration</b>

<pre><code>{

  "exporter": {

        "type": "syslog",

        "syslog_server": "localhost",

        "flow_port": 20519,

        "endpoint_port": 20520,

        "interface_port": 20521

    }

}

</code></pre>

</p>



<p>

<b>Sample Kafka Export Configuration</b>

<pre><code>{

  "exporter": {

        "type": "kafka",

        "bootstra_server": "localhost:9092",

        "flow_port": "flow",

        "endpoint_port": "endpoint",

        "interface_port": "interface"

    }

}

</code></pre>

</p>



<br>

<a name="custom_exporters"></a>

<h2>Implementing Your Own Exporter as a Plugin</h2>

<p>The collector's export capability can be extended using native C++ code by building a shared library against the plugin API. The SDK bundle (including headers and sample) is located in the Splunk app bundle in addon directory: CiscoNVM/appserver/addon. For questions, please contact: please contact: nvzflow@cisco.com</p>



<o>To use your custom plugin, a special configuration is required in the main collector config:

<pre><code>{    

    "exporter": {

        "type": "plugin"

    }

}

</code></pre>

</p>
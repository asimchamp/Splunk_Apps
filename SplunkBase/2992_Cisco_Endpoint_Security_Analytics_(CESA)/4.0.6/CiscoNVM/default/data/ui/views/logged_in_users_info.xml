<form version="1.1" script="custom_table_row_expansion.js" showsource="False" stylesheet="drilldownBkgd.css,css/common.css">
  <label>Logged In Users Info</label>
  <fieldset submitButton="true">
    <input type="time" token="time">
      <label></label>
      <default>
        <earliest>-7d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Historical Listing of all Logged In Users</title>
      <input type="text" token="User" searchWhenChanged="true">
        <label>Filter User here</label>
        <initialValue>*</initialValue>
      </input>
      <table id="expand_with_events">
        <title>Select row to drilldown and obtain more information on each Logged In User</title>
        <search>
          <query>`nvm_flowdata_index` pap!=Administrator AND pap!=LOCAL AND pap!=SYSTEM AND pap!=_netbios AND pap!=NETWORK AND pap!=linuxuid_0 AND pap!=_softwareupdate AND pap!=nobody AND pap!=_mdnsresponder AND pap!=_lp AND pap!=_locationd AND pap!=root AND pap!=UpdatusUser liuid!='AC-BUILD-XP\\Administrator' liuid!='Unknown' | stats count by liuid  | replace '' with "Unknown" | rename liuid AS "User"| fields - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <drilldown>
          <!-- Use set to specify the new token to be created.
                     Use any token from the page or from the click event to produce the value needed. -->
          <set token="User">$row.User$</set>
          <!-- If we also set the form.sourcetype the input will get updated too -->
          <set token="form.User">$row.User$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="OSDetails" depends="$User$">
        <title>Device Details for user : $User$</title>
        <search>
          <query>`nvm_sysdata_index` earliest=0 osn!='' [search `nvm_flowdata_index`
            		| eval UserID = if("*"=="*","%",replace("*","\\\\", "\\\\")) | WHERE like(liuid,UserID) | fields + udid] 
            		| stats count by osn, osv, vsn | rename vsn as "System Name", osn as "Operating System", osv as "Version"| fields - count</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">highlow</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="DNSSuffix" depends="$User$">
        <title>Location details for user : $User$</title>
        <search>
          <query>`nvm_flowdata_index` | eval UserID = if("*"=="*","%",replace("*","\\\\", "\\\\")) | WHERE like(liuid,UserID) | join udid [search earliest=0 `nvm_sysdata_index` | fields + udid  + vsn] | stats count, sum(ibc), sum(obc) by ds, vsn, liuid | rename vsn as "System Name", liuid AS "Logged In User", count as "Total Flows", ds as "Location", sum(obc) as "Total Out Bytes", sum(ibc) as "Total In Bytes"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="DestinationAddress" depends="$User$">
        <title>Destination Address Details for user : $User$</title>
        <search>
          <query>`nvm_flowdata_index` dh!=Unknown | eval UserID = if("$User$"=="*","%",replace("$User$","\\\\", "\\\\")) | WHERE like(liuid,UserID) | join udid [search earliest=0 `nvm_sysdata_index` | fields + udid  + vsn] | stats count, sum(ibc), sum(obc) by dh, vsn, liuid, ds | rename count AS "Total Flows", vsn AS "System Name", liuid AS "Logged In User", dh AS "Destination Domain", ds AS "Location", sum(obc) as "Total Out Bytes", sum(ibc) as "Total In Bytes"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">highlow</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">false</option>
      </table>
    </panel>
  </row>
</form>

<form version="1.1" showsource="False" script="autodiscover.js, default_token.js" stylesheet="drilldownBkgd.css, css/common.css">
  <label>Applications View</label>
  <search id="sankey_search">
    <query>
      <![CDATA[
                    `nvm_flowdata_index` pn=$Application$  | eval dest=if(dh=="unknown", da, dh)
                    | stats count by pn dest | sort count desc | head 15
                ]]>
    </query>
    <earliest>$earliest$</earliest>
    <latest>$latest$</latest>
  </search>
  <fieldset submitButton="true">
    <input type="time" token="time">
      <label></label>
      <default>
        <earliest>-7d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel id="drilldown">
      <title>Select an Application to drilldown and obtain information on Destination Domains reached by the Application</title>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top 15 Applications by Flow Count</title>
      <chart>
        <search>
          <query>`nvm_flowdata_index` NOT pap=* OR (pap!=Administrator AND pap!=LOCAL AND pap!=SYSTEM AND pap!=_netbios AND pap!=NETWORK AND pap!=linuxuid_0 AND pap!=_softwareupdate AND pap!=nobody AND pap!=_mdnsresponder AND pap!=_lp AND pap!=_locationd AND pap!=root AND pap!=UpdatusUser) | join udid [ | inputlookup unique_endpoints ] | eval dh = if(dh="Unknown", da, dh) | eval app=pn." (".osn.")" | top app limit=15 </query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <drilldown>
          <!-- Use set to specify the new token to be created.
                     Use any token from the page or from the click event to produce the value needed. -->
          <eval token="Application">mvindex(split( 'click.value', " (" ), 0)</eval>
          <set token="Drilldown_source">"total_flows"</set>
        </drilldown>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
    </panel>
    <panel>
      <title>Top 15 Applications by In-Bytes</title>
      <chart>
        <search>
          <query>`nvm_flowdata_index`  NOT pap=* OR (pap!=Administrator AND pap!=LOCAL AND pap!=SYSTEM AND pap!=_netbios AND pap!=NETWORK AND pap!=linuxuid_0 AND pap!=_softwareupdate AND pap!=nobody AND pap!=_mdnsresponder AND pap!=_lp AND pap!=_locationd AND pap!=root AND pap!=UpdatusUser) ibc &gt; 0 | join udid [search `nvm_sysdata_index`] | eval app=pn." (".osn.")" | stats sum(ibc) by app | rename sum(ibc) as in_bytes | sort in_bytes desc | head 15</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <drilldown>
          <!-- Use set to specify the new token to be created.
                     Use any token from the page or from the click event to produce the value needed. -->
          <eval token="Application">mvindex(split( 'click.value', " (" ), 0)</eval>
          <set token="Drilldown_source">"inbytes"</set>
        </drilldown>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <title>Top 15 Applications by Out-Bytes</title>
      <chart>
        <search>
          <query>`nvm_flowdata_index`NOT pap=* OR (pap!=Administrator AND pap!=LOCAL AND pap!=SYSTEM AND pap!=_netbios AND pap!=NETWORK AND pap!=linuxuid_0 AND pap!=_softwareupdate AND pap!=nobody AND pap!=_mdnsresponder AND pap!=_lp AND pap!=_locationd AND pap!=root AND pap!=UpdatusUser) obc &gt; 0 | join udid [search `nvm_sysdata_index`] | eval app=pn." (".osn.")" | stats sum(obc) by app | rename sum(obc) as in_bytes | sort in_bytes desc | head 15</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <drilldown>
          <!-- Use set to specify the new token to be created.
                     Use any token from the page or from the click event to produce the value needed. -->
          <eval token="Application">mvindex(split( 'click.value', " (" ), 0)</eval>
          <set token="Drilldown_source">"outbytes"</set>
        </drilldown>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Destination Domains reached by Application : $Application$</title>
      <chart id="AppDetails" depends="$Application$">
        <search>
          <query>`nvm_flowdata_index` pn=$Application$ |eval dest=if(dh=="unknown", da, dh)  | top 15 dest | rename dest AS "Destinations", count AS "Flows"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisY2.enabled">undefined</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel id="DestinationDomains_sankey" depends="$Application$">
      <html>
                <div id="sankey" class="splunk-view" data-require="app/CiscoNVM/components/sankey/sankey" data-options="{                             &quot;managerid&quot;: &quot;sankey_search&quot;,                             &quot;height&quot;: 700                          }">
                </div>
            </html>
    </panel>
  </row>
  <row>
    <panel depends="$Application$">&gt;<single>
        <title>Average Flow Duration</title>
        <search>
          <query>`nvm_flowdata_index` pn=$Application$ | eval flowTime = strptime(fet, "%a %b %d %H:%M:%S %Y") - strptime(fst, "%a %b %d %H:%M:%S %Y") | stats avg(flowTime) as flowTimeAvg</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="unit">s</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Average Flow Upload</title>
        <search>
          <query>`nvm_flowdata_index` pn=$Application$ | stats avg(obc) as obc_avg | eval obc_kb = obc_avg/1000</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="unit">kB</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Average Flow Download</title>
        <search>
          <query>`nvm_flowdata_index` pn=$Application$ | stats avg(ibc) as ibc_avg | eval ibc_kb = ibc_avg/1000</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
        <option name="unit">Kb</option>
      </single>
    </panel>
  </row>
</form>

<form stylesheet="custom.css">
  <label>Metascan IP/URL</label>
  <description>Enter an IP address or URL to obtain reputation data.  Limit 25 IP address or URL scans per hour.</description>
  <searchTemplate>| script reputation __EXECUTE__ metascan "$type$" "$search_hash_url$" | spath input=ms</searchTemplate>
  <!-- Add time range picker -->
  <fieldset autoRun="True" submitButton="true">
    <!-- Add Wildcard Filter -->
    <input type="text" token="search_hash_url" searchWhenChanged="false">
      <label>URL or IP</label>
      <default>$url:UrlHash$</default>
      <suffix></suffix>
    </input>
    <input type="dropdown" token="type" searchWhenChanged="false">
      <label>Type</label>
      <default>ip</default>
      <choice value="ip">IP</choice>
      <choice value="url">URL</choice>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title>Metascan Hits</title>
        <search base="global">
          <query>| rex field=ms "(?:.*\"scan_results\"+:\s+\[)(?P&lt;scan_result&gt;(.*))(?=\],)" | table detected_by</query>
        </search>
        <option name="linkView">search</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>IP address</title>
        <search base="global">
          <query>| rex field=ms "(?:.*\"scan_results\"+:\s+\[)(?P&lt;scan_result&gt;(.*))(?=\],)" | table geo_info.ip</query>
        </search>
        <option name="linkView">search</option>
        <option name="drilldown">none</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <table>
        <title>Geo Information</title>
        <search base="global">
          <query>| rex field=ms "(?:.*\"scan_results\"+:\s+\[)(?P&lt;scan_result&gt;(.*))(?=\],)" | table geo_info.city, geo_info.country_code, geo_info.region_name, geo_info.latitude, geo_info.longitude | rename geo_info.city AS City, geo_info.country_code AS Country, geo_info.region_name AS Region, geo_info.latitude AS Lat, geo_info.longitude AS Long | fillnull value="N/A"</query>
        </search>
        <option name="linkView">search</option>
        <option name="drilldown">cell</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <map>
        <title>Geo Map</title>
        <search base="global">
          <query>|  rex field=ms "(?:.*\"scan_results\"+:\s+\[)(?P&lt;scan_result&gt;(.*))(?=\],)" | iplocation geo_info.ip | geostats latfield=lat, longfield=lon count by geo_info.city</query>
        </search>
        <option name="mapping.type">marker</option>
        <option name="mapping.choroplethLayer.colorBins">5</option>
        <option name="mapping.choroplethLayer.colorMode">auto</option>
        <option name="mapping.choroplethLayer.maximumColor">0xDB5800</option>
        <option name="mapping.choroplethLayer.minimumColor">0x2F25BA</option>
        <option name="mapping.choroplethLayer.neutralPoint">0</option>
        <option name="mapping.choroplethLayer.shapeOpacity">0.75</option>
        <option name="mapping.choroplethLayer.showBorder">1</option>
        <option name="mapping.data.maxClusters">100</option>
        <option name="mapping.map.center">(0,0)</option>
        <option name="mapping.map.panning">true</option>
        <option name="mapping.map.scrollZoom">false</option>
        <option name="mapping.map.zoom">2</option>
        <option name="mapping.markerLayer.markerMaxSize">50</option>
        <option name="mapping.markerLayer.markerMinSize">10</option>
        <option name="mapping.markerLayer.markerOpacity">0.8</option>
        <option name="mapping.showTiles">1</option>
        <option name="mapping.tileLayer.maxZoom">7</option>
        <option name="mapping.tileLayer.minZoom">0</option>
        <option name="mapping.tileLayer.tileOpacity">1</option>
        <option name="drilldown">all</option>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Metascan Results</title>
        <search base="global">
          <query>|  rex field=ms "(?:.*\"scan_results\"+:\s+\[)(?P&lt;scan_result&gt;(.*))(?=\],)" | rex max_match=70 field=scan_result "(?P&lt;results_field&gt;\".*?\".*?{.*?})," | mvexpand results_field | spath input=results_field | rex max_match=70 field=results_field "(?:\"confident\":\s+)(?P&lt;Confidence&gt;\d+)" | rex max_match=70 field=results_field "(?:\"assessment\":\s+\")(?P&lt;Assessment&gt;\w+)" | rex max_match=70 field=results_field "(?:\"result\":\s+\")(?P&lt;Result&gt;\w+)" | rex max_match=70 field=results_field "(?:\"source\":\s+\")(?P&lt;Source&gt;[\w\s]+)" | rex max_match=70 field=results_field "(?:\"detecttime\":\s+\")(?P&lt;Detected&gt;[\d\s\w-:]+)" | rex max_match=70 field=results_field "(?:\"updatetime\":\s+\")(?P&lt;Updated&gt;[\d\s\w-:]+)" | sort -Confidence | eval Confidence=case((Confidence&gt;=95 AND Confidence&lt;=99),"Certain",(Confidence&gt;=85 AND Confidence&lt;=94),"Very Confident",(Confidence&gt;=75 AND Confidence&lt;=84),"Somewhat Confident",(Confidence&gt;=50 AND Confidence&lt;=74),"Not Confident",(Confidence&gt;=00 AND Confidence&lt;=49),"Unknown") | table Source, Detected, Updated, Result, Assessment, Confidence | fillnull value="N/A"</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">70</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Metascan Raw Response</title>
        <search base="global">
          <query>| table ms | rename ms AS "Response"</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">70</option>
      </table>
    </panel>
  </row>
</form>
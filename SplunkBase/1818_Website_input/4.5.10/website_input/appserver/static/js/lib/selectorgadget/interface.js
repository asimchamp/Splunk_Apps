function SelectorGadget(){this.border_width=5;this.border_padding=2;this.b_top=null;this.b_left=null;this.b_right=null;this.b_bottom=null;this.selected=[];this.rejected=[];this.special_mode=null;this.path_output_field=null;this.sg_div=null;this.unbound=false;this.prediction_helper=new DomPredictionHelper();this.restricted_elements=jQuery.map(["html","body","head","base"],function(a){return jQuery(a).get(0)})}SelectorGadget.prototype=new Object();SelectorGadget.prototype.makeBorders=function(i,e){this.removeBorders();this.setupBorders();if(i.parentNode){var g=i.parentNode.tagName.toLowerCase()+" "+i.tagName.toLowerCase()}else{var g=i.tagName.toLowerCase()}var d=jQuery(i);var a=d.offset();var f=a.top;var c=a.left;var b=d.outerWidth();var h=d.outerHeight();this.b_top.css("width",this.px(b+this.border_padding*2+this.border_width*2)).css("top",this.px(f-this.border_width-this.border_padding)).css("left",this.px(c-this.border_padding-this.border_width));this.b_bottom.css("width",this.px(b+this.border_padding*2+this.border_width*2-5)).css("top",this.px(f+h+this.border_padding)).css("left",this.px(c-this.border_padding-this.border_width)).text(g);this.b_left.css("height",this.px(h+this.border_padding*2)).css("top",this.px(f-this.border_padding)).css("left",this.px(c-this.border_padding-this.border_width));this.b_right.css("height",this.px(h+this.border_padding*2)).css("top",this.px(f-this.border_padding)).css("left",this.px(c+b+this.border_padding));this.b_right.get(0).target_elem=this.b_left.get(0).target_elem=this.b_top.get(0).target_elem=this.b_bottom.get(0).target_elem=i;if(e||d.hasClass("sg_suggested")||d.hasClass("sg_selected")){this.b_top.addClass("sg_border_red");this.b_bottom.addClass("sg_border_red");this.b_left.addClass("sg_border_red");this.b_right.addClass("sg_border_red")}else{if(this.b_top.hasClass("sg_border_red")){this.b_top.removeClass("sg_border_red");this.b_bottom.removeClass("sg_border_red");this.b_left.removeClass("sg_border_red");this.b_right.removeClass("sg_border_red")}}this.showBorders()};SelectorGadget.prototype.px=function(a){return a+"px"};SelectorGadget.prototype.showBorders=function(){this.b_top.show();this.b_bottom.show();this.b_left.show();this.b_right.show()};SelectorGadget.prototype.removeBorders=function(){if(this.b_top){this.b_top.hide();this.b_bottom.hide();this.b_left.hide();this.b_right.hide()}};SelectorGadget.prototype.setupBorders=function(){if(!this.b_top){var a=this.border_width+"px";this.b_top=jQuery("<div>").addClass("sg_border").css("height",a).hide().bind("mousedown.sg",{self:this},this.sgMousedown);this.b_bottom=jQuery("<div>").addClass("sg_border").addClass("sg_bottom_border").css("height",this.px(this.border_width+6)).hide().bind("mousedown.sg",{self:this},this.sgMousedown);this.b_left=jQuery("<div>").addClass("sg_border").css("width",a).hide().bind("mousedown.sg",{self:this},this.sgMousedown);this.b_right=jQuery("<div>").addClass("sg_border").css("width",a).hide().bind("mousedown.sg",{self:this},this.sgMousedown);this.addBorderToDom()}};SelectorGadget.prototype.addBorderToDom=function(){document.body.appendChild(this.b_top.get(0));document.body.appendChild(this.b_bottom.get(0));document.body.appendChild(this.b_left.get(0));document.body.appendChild(this.b_right.get(0))};SelectorGadget.prototype.removeBorderFromDom=function(){if(this.b_top){this.b_top.remove();this.b_bottom.remove();this.b_left.remove();this.b_right.remove()}};SelectorGadget.prototype.sgMouseover=function(d){var c=d.data.self;if(c.unbound){return true}if(this==document.body||this==document.body.parentNode){return false}var a=jQuery(this);if(c.special_mode!="d"){var b=c.firstSelectedOrSuggestedParent(this);if(b!=null&&b!=this){c.makeBorders(b,true)}else{c.makeBorders(this)}}else{if(!jQuery(".sg_selected",this).get(0)){c.makeBorders(this)}}return false};SelectorGadget.prototype.firstSelectedOrSuggestedParent=function(a){var b=a;if(jQuery(a).hasClass("sg_suggested")||jQuery(a).hasClass("sg_selected")){return a}while(a.parentNode&&(a=a.parentNode)){if(jQuery.inArray(a,this.restricted_elements)==-1){if(jQuery(a).hasClass("sg_suggested")||jQuery(a).hasClass("sg_selected")){return a}}}return null};SelectorGadget.prototype.sgMouseout=function(a){if(a.data.self.unbound){return true}if(this==document.body||this==document.body.parentNode){return false}a.data.self.removeBorders();return false};SelectorGadget.prototype.sgMousedown=function(g){var f=g.data.self;if(f.unbound){return true}var c=this;var d=jQuery(c);if(d.hasClass("sg_border")){c=c.target_elem||c;d=jQuery(c)}if(c==document.body||c==document.body.parentNode){return}if(f.special_mode!="d"){var a=f.firstSelectedOrSuggestedParent(c);if(a!=null&&a!=c){c=a;d=jQuery(c)}}else{if(jQuery(".sg_selected",this).get(0)){f.blockClicksOn(c)}}if(d.hasClass("sg_selected")){d.removeClass("sg_selected");f.selected.splice(jQuery.inArray(c,f.selected),1)}else{if(d.hasClass("sg_rejected")){d.removeClass("sg_rejected");f.rejected.splice(jQuery.inArray(c,f.rejected),1)}else{if(d.hasClass("sg_suggested")){d.addClass("sg_rejected");f.rejected.push(c)}else{d.addClass("sg_selected");f.selected.push(c)}}}f.clearSuggested();var b=f.prediction_helper.predictCss(f.selected,f.rejected.concat(f.restricted_elements));f.suggestPredicted(b);f.setPath(b);f.postSelectorMessage(b);f.removeBorders();f.blockClicksOn(c);d.trigger("mouseover.sg",{self:f});return false};SelectorGadget.prototype.setupEventHandlers=function(){jQuery("*:not(.sg_ignore)").bind("mouseover.sg",{self:this},this.sgMouseover);jQuery("*:not(.sg_ignore)").bind("mouseout.sg",{self:this},this.sgMouseout);jQuery("*:not(.sg_ignore)").bind("mousedown.sg",{self:this},this.sgMousedown);jQuery("html").bind("keydown.sg",{self:this},this.listenForActionKeys);jQuery("html").bind("keyup.sg",{self:this},this.clearActionKeys)};SelectorGadget.prototype.listenForActionKeys=function(b){var a=b.data.self;if(a.unbound){return true}if(b.keyCode==16||b.keyCode==68){a.special_mode="d";a.removeBorders()}};SelectorGadget.prototype.clearActionKeys=function(b){var a=b.data.self;if(a.unbound){return true}a.removeBorders();a.special_mode=null};SelectorGadget.prototype.blockClicksOn=function(a){var a=jQuery(a);var b=a.offset();var c=jQuery("<div>").css("position","absolute").css("z-index","9999999").css("width",this.px(a.outerWidth())).css("height",this.px(a.outerHeight())).css("top",this.px(b.top)).css("left",this.px(b.left)).css("background-color","");document.body.appendChild(c.get(0));setTimeout(function(){c.remove()},400);return false};SelectorGadget.prototype.setMode=function(a){if(a=="browse"){this.removeEventHandlers()}else{if(a=="interactive"){this.setupEventHandlers()}}this.clearSelected()};SelectorGadget.prototype.suggestPredicted=function(a){if(a&&a!=""){var b=0;jQuery(a).each(function(){b+=1;if(!jQuery(this).hasClass("sg_selected")&&!jQuery(this).hasClass("sg_ignore")&&!jQuery(this).hasClass("sg_rejected")){jQuery(this).addClass("sg_suggested")}});if(this.clear_button){if(b>0){this.clear_button.attr("value","Clear ("+b+")")}else{this.clear_button.attr("value","Clear")}}}};SelectorGadget.prototype.setPath=function(a){if(a&&a.length>0){this.path_output_field.value=a}else{this.path_output_field.value="No valid path found."}};SelectorGadget.prototype.postSelectorMessage=function(a){if(a&&a.length>0){window.parent.postMessage({message:"selector_updated",selector:a},"*")}else{window.parent.postMessage({message:"selector_updated",selector:null},"*")}};SelectorGadget.prototype.refreshFromPath=function(c){var a=(c&&c.data&&c.data.self)||this;var b=a.path_output_field.value;a.clearSelected();a.suggestPredicted(b);a.setPath(b)};SelectorGadget.prototype.showXPath=function(c){var a=(c&&c.data&&c.data.self)||this;var b=a.path_output_field.value;if(b=="No valid path found."){return}prompt("The CSS selector '"+b+"' as an XPath is shown below.  Please report any bugs that you find with this converter.",a.prediction_helper.cssToXPath(b))};SelectorGadget.prototype.clearSelected=function(b){var a=(b&&b.data&&b.data.self)||this;a.selected=[];a.rejected=[];jQuery(".sg_selected").removeClass("sg_selected");jQuery(".sg_rejected").removeClass("sg_rejected");a.removeBorders();a.clearSuggested()};SelectorGadget.prototype.clearEverything=function(b){var a=(b&&b.data&&b.data.self)||this;a.clearSelected();a.resetOutputs()};SelectorGadget.prototype.resetOutputs=function(){this.setPath()};SelectorGadget.prototype.clearSuggested=function(){jQuery(".sg_suggested").removeClass("sg_suggested");if(this.clear_button){this.clear_button.attr("value","Clear")}};SelectorGadget.prototype.showHelp=function(){alert("(Better help coming soon!  Please visit http://selectorgadget.com!  Please report bugs!)\n\nClick on a page element that you would like your selector to match (it will turn green). SelectorGadget will then generate a minimal CSS selector for that element, and will highlight (yellow) everything that is matched by the selector. Now click on a highlighted element to remove it from the selector (red), or click on an unhighlighted element to add it to the selector. Through this process of selection and rejection, SelectorGadget helps you to come up with the perfect CSS selector for your needs.\n\nHolding 'shift' while moving the mouse will let you select elements inside of other selected ones.")};SelectorGadget.prototype.makeInterface=function(){this.sg_div=jQuery("<div>").attr("id","_sg_div").addClass("sg_bottom").addClass("sg_ignore");var a=this;var b=jQuery("<input>").attr("id","_sg_path_field").addClass("sg_ignore").keydown(function(c){if(c.keyCode==13){return a.refreshFromPath(c)}}).focus(function(){jQuery(this).select()});this.sg_div.append(b);this.clear_button=jQuery('<input type="button" value="Clear"/>').bind("click",{self:this},this.clearEverything).addClass("sg_ignore");this.sg_div.append(this.clear_button);this.sg_div.append(jQuery('<input type="button" value="Toggle Position"/>').click(function(){if(a.sg_div.hasClass("sg_top")){a.sg_div.removeClass("sg_top").addClass("sg_bottom")}else{a.sg_div.removeClass("sg_bottom").addClass("sg_top")}}).addClass("sg_ignore"));this.sg_div.append(jQuery('<input type="button" value="XPath"/>').bind("click",{self:this},this.showXPath).addClass("sg_ignore"));this.sg_div.append(jQuery('<input type="button" value="Help"/>').bind("click",{self:this},this.showHelp).addClass("sg_ignore"));this.sg_div.append(jQuery('<input type="button" value="X"/>').bind("click",{self:this},this.unbind).addClass("sg_ignore"));jQuery("body").append(this.sg_div);this.path_output_field=b.get(0)};SelectorGadget.prototype.removeInterface=function(a){this.sg_div.remove();this.sg_div=null;this.removeBorderFromDom()};SelectorGadget.prototype.unbind=function(b){var a=(b&&b.data&&b.data.self)||this;a.unbound=true;a.removeInterface();a.clearSelected()};SelectorGadget.prototype.setOutputMode=function(c,b){var a=(c&&c.data&&c.data.self)||this;a.output_mode=(c&&c.data&&c.data.mode)||b};SelectorGadget.prototype.rebind=function(){this.unbound=false;this.makeInterface();this.clearEverything();this.setupBorders();this.addBorderToDom()};SelectorGadget.prototype.randBetween=function(d,c){return Math.floor(Math.random()*c)+d};SelectorGadget.prototype.analytics=function(){var e="UA-148948-9";var g=encodeURIComponent("www.selectorgadget.com");var j=this.randBetween(1000000000,9999999999);var c=this.randBetween(10000000,99999999);var d=this.randBetween(1000000000,2147483647);var h=Math.round(new Date().getTime()/1000);var f=encodeURIComponent(window.location.href);var b="-";var i="sg";var a="http://www.google-analytics.com/__utm.gif?utmwv=1&utmn="+j+"&utmsr=-&utmsc=-&utmul=-&utmje=0&utmfl=-&utmdt=-&utmhn="+g+"&utmr="+f+"&utmp="+i+"&utmac="+e+"&utmcc=__utma%3D"+c+"."+d+"."+h+"."+h+"."+h+".2%3B%2B__utmb%3D"+c+"%3B%2B__utmc%3D"+c+"%3B%2B__utmz%3D"+c+"."+h+".2.2.utmccn%3D(direct)%7Cutmcsr%3D(direct)%7Cutmcmd%3D(none)%3B%2B__utmv%3D"+c+"."+b+"%3B";document.body.appendChild(jQuery("<img />").attr("src",a).get(0))};SelectorGadget.prototype.listenForSelectorUpdates=function(){window.addEventListener("message",function(a){console.log("Got selector to the gadget:",a.data.selector);this.path_output_field.value=a.data.selector;this.refreshFromPath()}.bind(this));window.parent.postMessage({message:"selector_gadget_ready"},"*")};if(typeof(selector_gadget)=="undefined"||selector_gadget==null){(function(){selector_gadget=new SelectorGadget();selector_gadget.makeInterface();selector_gadget.clearEverything();selector_gadget.setMode("interactive");selector_gadget.listenForSelectorUpdates()})()}else{if(selector_gadget.unbound){selector_gadget.rebind()}else{selector_gadget.unbind()}}jQuery(".selector_gadget_loading").remove();
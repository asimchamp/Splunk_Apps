define(["underscore","backbone","splunkjs/mvc","jquery","splunkjs/mvc/simplesplunkview","text!../app/website_input/js/templates/PreviewWebsiteInputResultsView.html","css!../app/website_input/css/PreviewWebsiteInputResultsView.css"],function(b,f,e,d,a,c){return a.extend({className:"PreviewWebsiteInputResultsView",defaults:{},events:{"click .page":"clickChangePage","click .previous-page":"clickPreviousPage","click .next-page":"clickNextPage"},initialize:function(){this.options=b.extend({},this.defaults,this.options);this.input_config=this.options.input_config;this.results=null;this.dialog_rendered=false;this.page=0;this.error_message=null},clickChangePage:function(g){var h=d(g.target).data("page");this.page=parseInt(h,10);this.render()},clickPreviousPage:function(g){this.page=this.page-1;if(this.page<0){this.page=0}this.render()},clickNextPage:function(g){this.page=this.page+1;if(this.page>=this.results.length){this.page=this.results.length-1}this.render()},showDialog:function(){d("#preview-results-modal",this.$el).modal()},round:function(g){return Math.round(g*10)/10},getHumanReadableResponseTime:function(g){if(g>(60*1000)){return String(this.round(g/60*1000))+" minutes"}else{if(g>(1000)){return String(this.round(g/1000))+" seconds"}else{return String(this.round(g))+" ms"}}},getHumanReadableBytes:function(g){if(g>(1024*1024)){return String(this.round(g/(1024*1024)))+" MB"}else{if(g>1024){return String(this.round(g/1024))+" KB"}else{return String(g)+" bytes"}}},defaultIfBlank:function(h,g){if(h===undefined||h===null||h===""){return g}else{return h}},updatePreview:function(g){this.results=null;this.page=0;this.error_message=null;this.render();this.showDialog();if(parseInt(g.page_limit,10)>10){g.page_limit="10"}g.match_prefix="result_field_";d.ajax({url:Splunk.util.make_full_url("/splunkd/__raw/services/data/website_input_ops/scrape_page"),data:g,type:"POST",success:function(h){if(h.hasOwnProperty("success")&&!h.success){this.error_message=h.messages[0].message}else{this.results=h;this.error_message=null}this.render();console.info("Successfully retrieved the results preview")}.bind(this),error:function(){console.error("Unable to fetch the results");this.error_message="Unable to fetch the results";this.render()}.bind(this)});return},hasFields:function(h,i){if(!h||!h[i]){return false}for(var g in h[i]){if(g.indexOf("result_field_")===0){return true}}return false},render:function(){var g={results:this.results,round:this.round.bind(this),getHumanReadableResponseTime:this.getHumanReadableResponseTime.bind(this),getHumanReadableBytes:this.getHumanReadableBytes.bind(this),render_dialog_too:!this.dialog_rendered,page:this.page,error_message:this.error_message,has_fields:this.hasFields(this.results,this.page),defaultIfBlank:this.defaultIfBlank.bind(this)};if(this.dialog_rendered){d("#preview-results-modal > .modal-body-scrolling",this.$el).html(b.template(c,g))}else{this.$el.html(b.template(c,g));this.dialog_rendered=true}}})});
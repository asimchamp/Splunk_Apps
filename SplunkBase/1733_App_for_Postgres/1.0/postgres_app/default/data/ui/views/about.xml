<?xml version='1.0' encoding='utf-8'?>
<view template="dashboard.html">
  <label>About</label>
  <module name="AccountBar" layoutPanel="appHeader"/>
  <module name="AppBar" layoutPanel="navigationHeader"/>
  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="clearOnJobDispatch">False</param>
    <param name="maxSize">1</param>
  </module>
  <module name="StaticContentSample" layoutPanel="panel_row1_col1">
    <param name="text"><![CDATA[
      <h1>PostgreSQL App for Splunk</h1>
        <p><em>  
          The application is dedicated to visualize and monitor current as well as historical condition of PostgreSQL database infrastructure.
        </em></p>
    ]]></param>
  </module>
  <module name="StaticContentSample" layoutPanel="panel_row1_col2">
    <param name="text"><![CDATA[
      <h2>Important defaults</h2>
        <p>
          In order to properly manage a huge amount of logs generated by PostgreSQL, the application explicitly attempts to make use of dedicated index, named by default as 'pgsql'. By default this index is created by the application.
        </p>
        <p>
          When you are adding data from PostgreSQL log file, remember to use <b>postgresql</b> as sourcetype, as all the field definitions created by the application depends on it.
        </p>
    ]]></param>
  </module>
  <module name="StaticContentSample" layoutPanel="panel_row3_col1">
    <param name="text"><![CDATA[
      <h2>How to use Add-on for Postgres</h2>
        <p>
In order to collect data from the PostgreSQL servers, you need the Add-on for Postgres. This add-on should be installed onto the universal forwarder (or searchhead or indexer) from which you want to collect PostgreSQL data. The Add-on for PostgreSQL is available from Splunk Apps.
         </p>
         <p>
The Add-on for PostgreSQL provides data inputs for PostgreSQL server which facilitate  retrieving data from PostgreSQL standard statistic views (as <b>pg_stat</b> and <b>pg_statio</b> table) and from standard PostgreSQL server logs. The Add-on for PostgreSQL requires Python (at least version 2.6) and <b>psycopg2</b> python library installed on the system.
        </p>

<p>
   To start the PostgresSQL server monitoring you should follow theese steps:
<ul>
   <li>Create database user dedicated to read data from PostgreSQL statistic views.</li><br>
   <li>Enable extensive query logging in PostgreSQL. To do so you have to change the following entries in your postgresql.conf<br><br>
      <ul>
              <li><tt>log_file_mode = <b>640</b></tt> – change in order to access PostgreSQL logs if Splunk is running on non-root user account, apart of this Splunk user must be in an appropriate supplementary group (default: 600)</li>

              <li><tt>log_min_duration_statement = <b>0</b></tt> – change in order to log all SQL statements executed by the server; the value represents minimal query duration to be recorded by logger; by default logging of SQL statements is disabled at all (default: -1)</li>

              <li><tt>log_line_prefix = <b>'%m pid=%p database=%d user=%u rhost=%h tid=%v sessionid=%c '</b></tt> – change in order to provide some useful fields automatically extracted by Splunk (remember of trailing space in the defined string)</li>

      </ul>
      <p> After changes are applied, restart PostgreSQL server and verify the results in log files.</p>

   <li>Install the Add-on for Postgres onto the universal forwarder from which you want to collect PostgreSQL data</li><br>

   <li>Set database connection parameters. Copy <tt>$SPLUNK_HOME/etc/apps/ta-postgres/default/postgrestats.conf</tt> to <tt>$SPLUNK_HOME/etc/apps/ta-postgres/local/postgrestats.conf</tt> and customize the connection options.</li><br>
   <li>Turn on your PostgreSQL log files monitoring by adding "monitor" stanza in $SPLUNK_HOME/etc/apps/ta-postgres/local/inputs.conf. Let's say your log files are in: /var/lib/pgsql/9.3/data/pg_log directory and the name of each file log is similart to: postgres-Mon.log. In such case your monitor stanza can look like this:
       <p> 
                <tt>[monitor:///var/lib/pgsql/9.3/data/pg_log/postgresql-*.log]</tt><br>
                <tt>disabled = false</tt><br>
                <tt>sourcetype = postgresql</tt><br>
      </p>
      <p> After changes are applied, restart Splunk Universal Forwarder </p>

</ul>

</p>
    ]]></param>
  </module>
</view>

import{_ as e,a as t,g as a,h as s,d as n,i}from"./_rollupPluginBabelHelpers-deef47fd.js";import{P as r,r as o,R as u,e as l,f as c,g as _,h as d,F as m,j as f,b as v,m as h,$ as p,o as w,c as g,k as b,l as S}from"./vendor-024cf9ec.js";import{a as N,d as y}from"./SourceInput-ba1acdc5.js";import{g as k}from"./GlobalConfigUtil-2d540963.js";import{T as x}from"./Theme-731a73d2.js";var R=new(function(){function a(){t(this,a)}return e(a,[{key:"getServiceLocationMap",value:function(){return{aws_config:"aws.config",aws_config_rule:"aws.configrules",aws_cloudwatch:"aws.cloudwatch",aws_cloudwatch_logs:"aws.cloudwatchlogs",aws_s3:"aws.s3",splunk_ta_aws_logs:"aws.incrementals3",aws_sqs_based_s3:"aws.sqs_based_s3",aws_billing:"aws.billing",aws_billing_cur:"aws.billing.cur",aws_cloudtrail:"aws.cloudtrail",aws_kinesis:"aws.kinesis",aws_inspector:"aws.inspector",aws_inspector_v2:"aws.inspectorv2",splunk_ta_aws_sqs:"aws.sqs",aws_metadata:"aws.metadata"}}},{key:"getAllLinks",value:function(){return{SQS_BASED_S3:"aws.configure_aws.configure_sqs"}}},{key:"buildInputLink",value:function(e){var t=E()[e];return'<a data-test="link" target="_blank" class="imDUvl" href="/help?location='.concat(encodeURIComponent("[AddOns:released]")).concat(t,'">').concat("Learn more",'<svg focusable="false" height="8px" width="8px" viewBox="0 0 1500 1499" aria-hidden="false" class="help-link-icon"><path d="M1500 1125h-189.04v185.96H189.04V189.04H375V0H0v1500h1500v-375zm0-1125H723.288v190.068h469.52l-666.78 648.288 133.56 134.59 650.344-665.754v469.52l189.04 1.028L1500 0z"></path></svg></a>')}}]),a}()),q=R.buildInputLink;R.getAllLinks;var E=R.getServiceLocationMap,F=o.exports.createContext({regions:[],setRegions:function(){},queues:[],setQueues:function(){},effectiveState:{},setEffectiveState:function(){}}),j=function(e){var t=e.hookProps,s=e.children,n=t.initFormRows,i=t.setFormState,r=t.serviceName,l=t.initAccount,c=t.initAwsIamRole,_=o.exports.useState(l),d=a(_,2),m=d[0],f=d[1],v=o.exports.useState(c),h=a(v,2),p=h[0],w=h[1],g=o.exports.useState(n),b=a(g,2),S=b[0],N=b[1],y=o.exports.useState({}),k=a(y,2),x=k[0],R=k[1],q=o.exports.useState({}),E=a(q,2),j=E[0],M=E[1],O=o.exports.useState({}),C=a(O,2),L=C[0],T=C[1];return u.createElement(F.Provider,{value:{setFormState:i,serviceName:r,account:m,setAccount:f,awsIamRole:p,setAwsIamRole:w,effectiveFormRows:S,setEffectiveFormRows:N,regions:x,setRegions:R,queues:j,setQueues:M,rules:L,setRules:T},__self:undefined,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/hooks/useFormData.jsx",lineNumber:30,columnNumber:5}},s)};j.propTypes={children:r.oneOfType([r.arrayOf(r.node),r.node]).isRequired};var M=function(){return o.exports.useContext(F)},O="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/QueueInput.jsx",C={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},L=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function T(e){var t=this,n=e.initValue,i=e.effectiveRegion,r=e.index,d=e.handleFormStateUpdate,m=M(),f=m.queues,v=m.setQueues,h=m.account,p=m.setFormState,w=o.exports.useState(n),g=a(w,2),b=g[0],S=g[1],N=o.exports.useState([]),y=a(N,2),k=y[0],x=y[1],R=o.exports.useState(!1),q=a(R,2),E=q[0],F=q[1],j=o.exports.useState(i),T=a(j,2),V=T[0],A=T[1],I=function(e){e&&d(r,i,null),S(),x([]),F(!1)};return o.exports.useEffect((function(){var e;h||I(!1),void 0!==(null===(e=f[h])||void 0===e?void 0:e[i])&&(x(f[h][i].map((function(e){return u.createElement(l.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:O,lineNumber:46,columnNumber:29}})}))),i!==V&&(A(i),d(r,i,null),S()),F(!1))}),[h,i,f]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=f[h])||void 0===e?void 0:e[i])){F(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_sqs_queue_names"),location),a={aws_account:h,aws_region:i,output_mode:"json",count:"0"},n={"X-Splunk-Form-Key":_,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(a).toString(),fetch(t,{method:"GET",headers:n}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],a=s({},f);a[h]=void 0===a[h]?{}:a[h],a[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(a)})).catch((function(e){I(!0);var t="Failed to get SQS Queue for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(e){var a=e.match(L);a&&3===a.length?t+="[".concat(a[1],"] ").concat(a[2]):t+=e,p((function(e){var a=s({},e);return a.errorMsg=t,a}))})):(t+=e,p((function(e){var a=s({},e);return a.errorMsg=t,a})))}))}}),[h,i]),u.createElement(l,{value:b,onChange:function(e,t){var a=t.value;d(r,i,a),S(a)},disabled:E,placeholder:E?"Loading...":"Select an account and a region first",style:C,filter:!0,inline:!0,__self:this,__source:{fileName:O,lineNumber:140,columnNumber:5}},k)}var V=o.exports.memo(T),A="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RulesInput.jsx",I={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},D=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function U(e){var t=this,n=e.initValue,i=e.effectiveRegion,r=e.index,l=e.handleFormStateUpdate,m=M(),f=m.rules,v=m.setRules,h=m.account,p=m.awsIamRole,w=m.setFormState,g=o.exports.useState(n),b=a(g,2),S=b[0],N=b[1],y=o.exports.useState([]),k=a(y,2),x=k[0],R=k[1],q=o.exports.useState(!1),E=a(q,2),F=E[0],j=E[1],O=o.exports.useState(i),C=a(O,2),L=C[0],T=C[1],V=function(e){e&&l(r,i,[]),N([]),R([]),j(!1)};return o.exports.useEffect((function(){var e;h||V(!1),void 0!==(null===(e=f[h])||void 0===e?void 0:e[i])&&(R(f[h][i].map((function(e){return u.createElement(d.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:A,lineNumber:47,columnNumber:7}})}))),i!==L&&(T(i),l(r,i,[]),N([])),j(!1))}),[h,i,f]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=f[h])||void 0===e?void 0:e[i])){j(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_config_rules"),location),a={aws_account:h,aws_region:i,output_mode:"json",count:"0"};p&&(a.aws_iam_role=p);var n={"X-Splunk-Form-Key":_,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(a).toString(),fetch(t,{method:"GET",headers:n}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],a=s({},f);a[h]=void 0===a[h]?{}:a[h],a[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(a)})).catch((function(e){var t="Failed to get Config Rules for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(a){var n=a.match(D);n&&3===n.length?t+="[".concat(n[1],"] ").concat(n[2]):t+=a,w((function(a){var n=s({},a);return n.data.region.value.includes(i)&&(V(!0),l(r,i,null,e=t),n.errorMsg=t),n}))})):(t+=e,w((function(e){var a=s({},e);return a.errorMsg=t,a})))}))}}),[h,i]),u.createElement(d,{values:S,onChange:function(e,t){var a=t.values;l(r,i,a),N(a)},disabled:F,placeholder:F?"Loading...":"Leave blank to select all rules in this region",style:I,inline:!0,__self:this,__source:{fileName:A,lineNumber:149,columnNumber:5}},x)}var z=o.exports.memo(U),P="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/MultiQueueInput.jsx",Q={flex:"1 0 0",borderColor:"rgb(195, 203, 212)"},J=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function H(e){var t=this,n=e.initValue,i=e.effectiveRegion,r=e.index,l=e.handleFormStateUpdate,m=M(),f=m.queues,v=m.setQueues,h=m.account,p=m.awsIamRole,w=m.setFormState;m.effectiveFormRows;var g=o.exports.useState(n),b=a(g,2),S=b[0],N=b[1],y=o.exports.useState([]),k=a(y,2),x=k[0],R=k[1],q=o.exports.useState(!1),E=a(q,2),F=E[0],j=E[1],O=o.exports.useState(i),C=a(O,2),L=C[0],T=C[1],V=function(e){e&&l(r,i,[]),N([]),R([]),j(!1)};return o.exports.useEffect((function(){var e;h||V(!1),void 0!==(null===(e=f[h])||void 0===e?void 0:e[i])&&(R(f[h][i].map((function(e){return u.createElement(d.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:P,lineNumber:48,columnNumber:7}})}))),i!==L&&(T(i),l(r,i,[]),N([])),j(!1))}),[h,i,f]),o.exports.useEffect((function(){var e;if(h&&i&&void 0===(null===(e=f[h])||void 0===e?void 0:e[i])){j(!0);var t=new URL(c("splunk_ta_aws/splunk_ta_aws_sqs_queue_names"),location),a={aws_account:h,aws_iam_role:p,aws_region:i,output_mode:"json",count:"0"},n={"X-Splunk-Form-Key":_,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};t.search=new URLSearchParams(a).toString(),fetch(t,{method:"GET",headers:n}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],a=s({},f);a[h]=void 0===a[h]?{}:a[h],a[h][i]=t.map((function(e){return{label:e.name,value:e.name}})),v(a)})).catch((function(e){V(!0);var t="Failed to get SQS Queues for Region ".concat(i,". ");"function"==typeof e.text?e.text().then((function(e){var a=e.match(J);a&&3===a.length?t+="[".concat(a[1],"] ").concat(a[2]):t+=e,w((function(e){var a=s({},e);return a.errorMsg=t,a}))})):(t+=e,w((function(e){var a=s({},e);return a.errorMsg=t,a})))}))}}),[h,i]),u.createElement(d,{values:S,onChange:function(e,t){var a=t.values;l(r,i,a),N(a)},disabled:F,placeholder:F?"Loading...":"Select an account and a region first",style:Q,inline:!0,__self:this,__source:{fileName:P,lineNumber:144,columnNumber:5}},x)}var Y=o.exports.memo(H),X="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/RegionInput.jsx",W={flex:"0 0 150px",display:"flex",alignItems:"center"},G=/REST Error \[([0-9]+)\]: (.*)\\".  See/;function B(e){var t=this,n=e.initValue,i=e.handleChangeRegion,r=e.index,d=e.handleFormStateUpdate,m=e.handleFormStateDelete,f=M(),v=f.regions,h=f.setRegions,p=f.serviceName,w=f.account,g=f.setFormState,b=o.exports.useState([]),S=a(b,2),N=S[0],y=S[1],k=o.exports.useState(!1),x=a(k,2),R=x[0],q=x[1],E=o.exports.useState(n),F=a(E,2),j=F[0],O=F[1],C=function(){m(r),O(),y([]),q(!1)};return o.exports.useEffect((function(){w||C(),void 0!==v[w]&&(y(v[w].map((function(e){return u.createElement(l.Option,{label:e.label,value:e.value,__self:t,__source:{fileName:X,lineNumber:60,columnNumber:7}})}))),q(!1))}),[w,v]),o.exports.useEffect((function(){if(w&&void 0===v[w]){q(!0);var e=new URL(c("splunk_ta_aws/splunk_ta_aws_regions"),location),t={aws_service:p,aws_account:w,output_mode:"json",count:"0"},a={"X-Splunk-Form-Key":_,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"};e.search=new URLSearchParams(t).toString(),fetch(e,{method:"GET",headers:a}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(e){var t=(null==e?void 0:e.entry)||[],a=s({},v);a[w]=t.map((function(e){return{label:e.content.label,value:e.name}})),h(a)})).catch((function(e){C();var t="Failed to get Region for Account ".concat(w,". ");"function"==typeof e.text?e.text().then((function(e){var a=e.match(G);a&&3===a.length?t+="[".concat(a[1],"] ").concat(a[2]):t+=e,g((function(e){var a=s({},e);return a.errorMsg=t,a}))})):(t+=e,g((function(e){var a=s({},e);return a.errorMsg=t,a})))}))}}),[w]),u.createElement("div",{style:W,__self:this,__source:{fileName:X,lineNumber:144,columnNumber:5}},u.createElement(l,{value:j,onChange:function(e,t){var a=t.value;O(a),i(a),d(r,a,"aws_config_rule"===p||"splunk_ta_aws_sqs"===p?[]:null),g((function(e){var t=s({},e);return t.errorMsg="",t}))},disabled:R,placeholder:R?"Loading...":"Select...",style:{width:"150px",minWidth:"100%",borderColor:"rgb(195, 203, 212)"},filter:!0,inline:!0,__self:this,__source:{fileName:X,lineNumber:145,columnNumber:7}},N))}var K=o.exports.memo(B),Z="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/SingleInputWrapper.jsx",$={display:"inline-flex",lineHeight:"32px",flex:"0 0 30px",justifyContent:"center",alignItems:"center"};function ee(e){var t=e.initValue,s=e.index,n=e.handleFormStateUpdate,i=e.handleFormStateDelete,r=o.exports.useState(null==t?void 0:t.region),l=a(r,2),c=l[0],_=l[1],d=M().serviceName;o.exports.useEffect((function(){return function(){i(s)}}),[]);var m=u.createElement(z,{initValue:null==t?void 0:t.rules,effectiveRegion:c,index:s,handleFormStateUpdate:n,__self:this,__source:{fileName:Z,lineNumber:40,columnNumber:5}});return"splunk_ta_aws_sqs"===d?m=u.createElement(Y,{initValue:null==t?void 0:t.queues,effectiveRegion:c,index:s,handleFormStateUpdate:n,__self:this,__source:{fileName:Z,lineNumber:49,columnNumber:7}}):"aws_config"===d&&(m=u.createElement(V,{initValue:null==t?void 0:t.queues,effectiveRegion:c,index:s,handleFormStateUpdate:n,__self:this,__source:{fileName:Z,lineNumber:58,columnNumber:7}})),u.createElement("div",{style:{display:"flex"},__self:this,__source:{fileName:Z,lineNumber:68,columnNumber:5}},u.createElement(K,{initValue:null==t?void 0:t.region,handleChangeRegion:_,index:s,handleFormStateUpdate:n,handleFormStateDelete:i,__self:this,__source:{fileName:Z,lineNumber:69,columnNumber:7}}),u.createElement("span",{style:$,__self:this,__source:{fileName:Z,lineNumber:76,columnNumber:7}}),m)}var te=o.exports.memo(ee),ae="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/CustomFormRows.jsx";function se(){var e=this,t=o.exports.useState([]),n=a(t,2),i=n[0],r=n[1],l=M(),c=l.setAccount,_=l.setAwsIamRole,d=l.serviceName,v=l.setFormState,h=l.effectiveFormRows,p=l.setEffectiveFormRows;window.setAccount=function(e){c(e)},window.setAwsIamRole=function(e){_(e)},o.exports.useEffect((function(){var e=[],t=[],n=[],i=[];Object.entries(h).forEach((function(s){var r=a(s,2);r[0];var o=r[1];e.push(o.region),"aws_config_rule"===d?(n.push(o.rules&&o.rules.join(",")),i.push(o.error)):"splunk_ta_aws_sqs"===d?t.push(o.queues&&o.queues.join(",")):t.push(o.queues)})),v((function(a){var r=s({},a);return"aws_config_rule"===d?(r.data.region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),r.data.rule_names.value=0===n.length?JSON.stringify([""]):JSON.stringify(n),r.data.rule_names.custom_errors=0===i.length?JSON.stringify([""]):JSON.stringify(i)):"splunk_ta_aws_sqs"===d?(r.data.aws_region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),r.data.sqs_queues.value=0===t.length?JSON.stringify([""]):JSON.stringify(t)):(r.data.aws_region.value=0===e.length?JSON.stringify([""]):JSON.stringify(e),r.data.sqs_queue.value=0===t.length?JSON.stringify([""]):JSON.stringify(t)),r}))}),[h]);var w=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;p((function(i){var r=s({},i);return r[e]="aws_config_rule"===d?{region:t,rules:a,error:n}:{region:t,queues:a},r}))},g=function(e){p((function(t){var a=s({},t);return delete a[e],a}))},b=function(e,t){var a=t.index;r((function(e){return 1===e.length?e:m.removeRow(a,e)}))};o.exports.useEffect((function(){Object.entries(h).length>0?r(Object.entries(h).map((function(t,s){var n=a(t,2),i=n[0],r=n[1];return u.createElement(m.Row,{index:s,key:"uniqueRowUno",onRequestRemove:b,__self:e,__source:{fileName:ae,lineNumber:139,columnNumber:13}},u.createElement(te,{initValue:r,index:i,handleFormStateUpdate:w,handleFormStateDelete:g,__self:e,__source:{fileName:ae,lineNumber:144,columnNumber:15}}))}))):r([u.createElement(m.Row,{index:0,key:"uniqueRowUno",onRequestRemove:b,__self:e,__source:{fileName:ae,lineNumber:156,columnNumber:9}},u.createElement(te,{index:Date.now().toString(36)+Math.random().toString(36).substr(2),handleFormStateUpdate:w,handleFormStateDelete:g,__self:e,__source:{fileName:ae,lineNumber:161,columnNumber:11}}))])}),[]);var S="Config Rules";"splunk_ta_aws_sqs"===d?S="SQS Queues":"aws_config"===d&&(S="SQS Queue");var N=u.createElement("div",{__self:this,__source:{fileName:ae,lineNumber:179,columnNumber:5}},u.createElement("span",{style:{display:"inline-block",width:180},id:"header-key",__self:this,__source:{fileName:ae,lineNumber:180,columnNumber:7}},"Region"),u.createElement("span",{style:{display:"inline-block"},id:"header-value",__self:this,__source:{fileName:ae,lineNumber:189,columnNumber:7}},S));return u.createElement(m,{addLabel:"Add Another",header:N,onRequestAdd:function(){r((function(t){var a=Date.now().toString(36)+Math.random().toString(36).substr(2);return p((function(e){var t=s({},e);return t[a]={},t})),m.addRow(u.createElement(m.Row,{index:t.length,key:f(),onRequestRemove:b,__self:e,__source:{fileName:ae,lineNumber:118,columnNumber:9}},u.createElement(te,{index:a,handleFormStateUpdate:w,handleFormStateDelete:g,__self:e,__source:{fileName:ae,lineNumber:123,columnNumber:11}})),t)}))},style:{width:500},__self:this,__source:{fileName:ae,lineNumber:195,columnNumber:5}},i)}var ne=o.exports.memo(se),ie="/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/components/FormRowsWrapper.jsx";function re(e){var t=e.hookProps;return u.createElement(v.SplunkThemeProvider,n({},x,{__self:this,__source:{fileName:ie,lineNumber:17,columnNumber:5}}),u.createElement(j,{hookProps:t,__self:this,__source:{fileName:ie,lineNumber:18,columnNumber:7}},u.createElement(ne,{__self:this,__source:{fileName:ie,lineNumber:19,columnNumber:9}})))}var oe=h("2038-01-19T03:14:07Z"),ue=["aws_cloudwatch","aws_config","aws_config_rule","splunk_ta_aws_sqs"],le=["aws_config","aws_config_rule","splunk_ta_aws_sqs"],ce={CloudTrail:"aws:cloudtrail",Config:"aws:config",S3AccessLogs:"aws:s3:accesslogs",CloudFrontAccessLogs:"aws:cloudfront:accesslogs",ELBAccessLogs:"aws:elb:accesslogs",VPCFlowLogs:"aws:cloudwatchlogs:vpcflow",DelimitedFilesDecoder:"aws:s3:csv",CustomLogs:"aws:s3"},_e={cloudtrail:"aws:cloudtrail","s3:accesslogs":"aws:s3:accesslogs","cloudfront:accesslogs":"aws:cloudfront:accesslogs","elb:accesslogs":"aws:elb:accesslogs"},de=function(){function a(e,s,n,i,r){t(this,a),this.globalConfig=e,this.serviceName=s,this.state=n,this.mode=i,this.util=r,this._debouncedNameChange=this.debounce(this._nameChange.bind(this),200),this.context=k(e,s)}return e(a,[{key:"onCreate",value:function(){var e=this,t=p("button[label='Cancel']");t&&t.on("click",(function(t){return e._removeExtraParamsFromURL()}))}},{key:"debounce",value:function(e,t){var a;return function(){for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];clearTimeout(a),a=setTimeout((function(){e.apply(void 0,n)}),t)}}},{key:"onChange",value:function(e,t,a){if("s3_file_decoder"===e){var s=ce[t];this._setValue("sourcetype",s)}if("distribution_id"===e){var n=t+".%Y-%m-%d-";this._setValue("log_name_format",n)}"aws_config"===this.serviceName&&"aws_account"===e&&window.setAccount(a.data.aws_account.value),"splunk_ta_aws_sqs"===this.serviceName&&"aws_account"===e&&window.setAccount(a.data.aws_account.value),"splunk_ta_aws_sqs"===this.serviceName&&"aws_iam_role"===e&&window.setAwsIamRole(a.data.aws_iam_role.value),"aws_config_rule"===this.serviceName&&"account"===e&&window.setAccount(a.data.account.value),"aws_config_rule"===this.serviceName&&"aws_iam_role"===e&&window.setAwsIamRole(a.data.aws_iam_role.value),"aws_kinesis"===this.serviceName&&("account"===e&&this._setValue("region",this.state.data.region.value),"account"!==e&&"aws_iam_role"!==e&&"region"!==e&&"private_endpoint_enabled"!==e&&"sts_private_endpoint_url"!==e&&"kinesis_private_endpoint_url"!==e||this._setValue("stream_names",this.state.data.stream_names.value))}},{key:"onRender",value:function(){var e=this,t=this._getInputService(),a=t.input,n=t.service;if("edit"===this.mode||"clone"===this.mode){var i=window.location.toString().split("?"),r="".concat(i[0],"?service=").concat(n,"&input=").concat(a,"&action=").concat(this.mode);setTimeout((function(){return window.history.pushState({},"",r)}))}var o=p("form > div");if(o.length>0){var l=q(n);p(o[0]).append(l)}var c,_,d,m,f,v=N().find((function(e){return e.service===n&&e.input===a}));if(v){var b=w(v,["service","input"]);Object.keys(b).forEach((function(t){e._setValue(t,b[t])}))}if(le.includes(this.serviceName)){if(this.account=this.state.data["aws_config_rule"===this.serviceName?"account":"aws_account"].value,"aws_config_rule"!==this.serviceName&&"splunk_ta_aws_sqs"!==this.serviceName||(this.aws_iam_role=this.state.data.aws_iam_role.value),this.initFormRows={},"edit"===this.mode||"clone"===this.mode)if("aws_config_rule"===this.serviceName){var S=JSON.parse(this.state.data.region.value),y=JSON.parse(this.state.data.rule_names.value).map((function(e){return e.split(",")}));S.forEach((function(t,a){e.initFormRows[Date.now().toString(36)+Math.random().toString(36).substr(2)]={region:t,rules:y[a]}}))}else{var k=JSON.parse(this.state.data.aws_region.value),x=null;x="splunk_ta_aws_sqs"===this.serviceName?JSON.parse(this.state.data.sqs_queues.value).map((function(e){return e.split(",")})):JSON.parse(this.state.data.sqs_queue.value),k.forEach((function(t,a){e.initFormRows[Date.now().toString(36)+Math.random().toString(36).substr(2)]={region:t,queues:x[a]}}))}c="#group_selection",_=function(){g.render(u.createElement(re,{hookProps:{initFormRows:e.initFormRows,setFormState:e.util.setState,serviceName:e.serviceName,initAccount:e.account,initAwsIamRole:e.aws_iam_role},__self:e,__source:{fileName:"/home/runner/work/splunk-add-on-for-amazon-web-services/splunk-add-on-for-amazon-web-services/build-ui/js/Hook.js",lineNumber:210,columnNumber:13}}),document.getElementById("group_selection"))},d=500,m=9e3,f=Date.now(),function e(){null!=document.querySelector(c)?_():setTimeout((function(){m&&Date.now()-f>m||e()}),d)}()}if("aws_billing"===this.serviceName){if(null===this.state.data.initial_scan_datetime.value||""===this.state.data.initial_scan_datetime.value){var R=h().utc().subtract(3,"months").startOf("month").format("YYYY-MM-DDTHH:mm:ss")+"Z";this._setValue("initial_scan_datetime",R)}}else if("aws_billing_cur"===this.serviceName){if(null===this.state.data.start_date.value||""===this.state.data.start_date.value){var E=h().utc().subtract(3,"months").startOf("month").format("YYYY-MM");this._setValue("start_date",E)}}else if("aws_s3"===this.serviceName){if(null===this.state.data.parse_csv_with_delimiter.value||""===this.state.data.parse_csv_with_delimiter.value||void 0===this.state.data.parse_csv_with_delimiter.value){this._setValue("parse_csv_with_delimiter",",")}if(null===this.state.data.parse_csv_with_header.value||""===this.state.data.parse_csv_with_header.value||void 0===this.state.data.parse_csv_with_header.value){this._setValue("parse_csv_with_header",0)}if(null===this.state.data.initial_scan_datetime.value||""===this.state.data.initial_scan_datetime.value){var F=h().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z";this._setValue("initial_scan_datetime",F)}}else if("aws_sqs_based_s3"===this.serviceName){if(null===this.state.data.sourcetype.value||""===this.state.data.sourcetype.value){var j=ce[this.state.data.s3_file_decoder.value];this._setValue("sourcetype",j)}if(null===this.state.data.parse_csv_with_delimiter.value||""===this.state.data.parse_csv_with_delimiter.value||void 0===this.state.data.parse_csv_with_delimiter.value){this._setValue("parse_csv_with_delimiter",",")}if(null===this.state.data.parse_csv_with_header.value||""===this.state.data.parse_csv_with_header.value||void 0===this.state.data.parse_csv_with_header.value){this._setValue("parse_csv_with_header",0)}}if("aws_s3"===this.serviceName)"aws_cloudtrail"!==a&&this._hideField("ct_blacklist"),"others"!==a&&(this._hideField(["whitelist","blacklist"]),this._disabledField("sourcetype"));else if("splunk_ta_aws_logs"===this.serviceName){"cloudfront_access_logs"===a&&this._hideField("distribution_id",!0);var M=_e[this.state.data.log_type.value];this._setValue("sourcetype",M);var O=h().utc().subtract(7,"days").format("YYYY-MM-DD");if(this._setValue("log_start_date",O),this._disabledField(["log_type","sourcetype"]),"create"!==this.mode&&"cloudfront_access_logs"===a){var C=this.state.data.log_name_format.value;-1!==C.indexOf(".%Y-%m-%d-")&&(C=C.substring(0,C.length-".%Y-%m-%d-".length)),this._setValue("distribution_id",C),"edit"===this.mode&&this._disabledField("distribution_id")}}else"aws_sqs_based_s3"===this.serviceName?"others"!==a&&this._disabledField(["s3_file_decoder","sourcetype"]):"aws_kinesis"===this.serviceName&&"vpc_flow_logs"===a&&this._disabledField(["format","encoding","sourcetype"]);if("aws_s3"===this.serviceName){this.util.setState((function(e){return s(s({},e),{},{warningMsg:"Amazon S3 buckets with an excessive number of files or abundant size will result in significant performance degradation and ingestion delays. Configure an SQS-Based S3 input to achieve efficiency."})}))}}},{key:"onSave",value:function(e){if("splunk_ta_aws_logs"===this.serviceName&&"cloudfront:accesslogs"===e.log_type){if(null==e.log_name_format)return this.util.setErrorFieldMsg("distribution_id","Field Distribution ID is required."),!1;this._setValue("distribution_id",null)}else if("aws_cloudwatch"===this.serviceName){if("period"in e&&"polling_interval"in e){var t=e.polling_interval/e.period;if(Math.floor(t)!==t)return this.util.setErrorMsg('The number of "Polling Interval" field should be a multiple of "Granularity".'),!1}}else if("aws_s3"===this.serviceName){if("terminal_scan_datetime"in e){var a=e.terminal_scan_datetime;try{if((a=h(a))>oe)return this.util.setErrorFieldMsg("terminal_scan_datetime","The max supported timestamp is 2038-01-19T03:14:07Z due to Year 2038 problem"),!1;this.util.clearAllErrorMsg()}catch(e){return!1}}}else if("aws_sqs_based_s3"===this.serviceName){if(e.aws_account&&e.sqs_queue_region&&e.sqs_queue_url)return this._validateSQSqueue(e)}else if("aws_config_rule"===this.serviceName){var s,n=JSON.parse(this.state.data.rule_names.custom_errors),r=i(n.values());try{for(r.s();!(s=r.n()).done;){var o=s.value;if(null!==o&&""!==o)return this.util.setErrorMsg(o),!1}}catch(e){r.e(e)}finally{r.f()}}else if("aws_metadata"===this.serviceName&&"apis"in e)for(var u=/^[1-9]\d*?$/,l=e.apis.split(", "),c=0;c<l.length;c++){var _=l[c].split("/");if(null===_[1]||""===_[1])return this.util.setErrorMsg("Field Interval is Required");if(!u.test(_[1]))return this.util.setErrorMsg("Interval value should be a non-zero positive integer")}return!0}},{key:"onSaveSuccess",value:function(){this._removeExtraParamsFromURL()}},{key:"onSaveFail",value:function(){if("splunk_ta_aws_logs"===this.serviceName&&"cloudfront:accesslogs"===this.state.data.log_type.value){var e=this.state.data.log_name_format.value;if(null!==e){var t=e.split(".")[0];this._setValue("distribution_id",t)}}}},{key:"onEditLoad",value:function(){var e=this;ue.includes(this.serviceName)&&this._fetchConflictFields(this.serviceName).done((function(){if(Object.keys(e._conflict_fields||{}).length>0){var t=e.context.entity,a="The following fields have conflict. ";a+=Object.keys(e._conflict_fields||{}).map((function(a){"disabled"!==a&&e.util.setErrorFieldMsg(a,"");var s=t.find((function(e){return e.field===a})),n=s?s.label:a;return"".concat(n," = [").concat(e._conflict_fields[a].join(", "),"]")})).join(", "),a+=". Please resolve the conflict in conf file first.",e.util.setErrorMsg(a)}}))}},{key:"_validateSQSqueue",value:function(e){var t="splunk_ta_aws/splunk_ta_aws_sqs_queue_attributes?aws_account=".concat(e.aws_account,"&aws_region=").concat(e.sqs_queue_region,"&sqs_queue_url=").concat(e.sqs_queue_url,"&private_endpoint_enabled=").concat(e.private_endpoint_enabled,"&sts_private_endpoint_url=").concat(e.sts_private_endpoint_url,"&sqs_private_endpoint_url=").concat(e.sqs_private_endpoint_url,"&output_mode=json"),a=e.aws_iam_role;a&&(t+="&aws_iam_role=".concat(a));var s=c(t,{app:"Splunk_TA_aws",sharing:"app"}),n=e.using_dlq;try{var i=new XMLHttpRequest;if(i.open("GET",s,!1),i.setRequestHeader("X-Splunk-Form-Key",_),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/json"),i.send(),200!==i.status)return this.util.setErrorFieldMsg("sqs_queue_url","The SQS Queue entered may not be present in the given region. "),!1;var r=JSON.parse(i.responseText).entry[0].content,o=r.VisibilityTimeout,u=r.RedrivePolicy;if(0!==n&&!u)return this.util.setErrorFieldMsg("sqs_queue_url","Enabling dead letter queue is required for the SQS queue in this input. "),!1;if(0!==n&&o<300)return this.util.setErrorFieldMsg("sqs_queue_url","It is recommended to set VisibilityTimeout larger than 5 minutes for specified SQS queue. "),!1}catch(e){return this.util.setErrorFieldMsg("sqs_queue_url","validation of selected SQS queue failed. ERROR : ".concat(e)),!1}return!0}},{key:"_nameChange",value:function(e){}},{key:"_getInputService",value:function(){this.urlParams=this._extractQuery();var e=this.urlParams,t=e.input,a=e.service;if(!t||"edit"===this.mode||"clone"===this.mode){var s=this._getNormalizeData();t=y(s,this.serviceName)}return{input:t,service:a}}},{key:"_removeExtraParamsFromURL",value:function(){var e=window.location.toString().split("?");2===e.length&&setTimeout((function(){return window.history.pushState({},"",e[0])}))}},{key:"_extractQuery",value:function(){var e=document.location.search||document.location.hash;if(e&&0!==e.length){var t=e.indexOf("?")+1||0,a=e.substring(t).split("&"),s={};return a.forEach((function(e){var t=e.split("=");1===t.length?s[t[0]]=null:s[t[0]]=t[1]})),s}}},{key:"_setValue",value:function(e,t){this.util.setState((function(a){var n=s({},a.data);return n[e].value=t,{data:n}}))}},{key:"_hideField",value:function(e,t){var a=this;b(e)||(e=[e]);var n,r=i(e);try{var o=function(){var e=n.value;a.util.setState((function(a){var n=s({},a.data);return n[e].display=!!t,{data:n}}))};for(r.s();!(n=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}}},{key:"_disabledField",value:function(e){var t=this;b(e)||(e=[e]);var a,n=i(e);try{var r=function(){var e=a.value;t.util.setState((function(t){var a=s({},t.data);return a[e].disabled=!0,{data:a}}))};for(n.s();!(a=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}},{key:"_fetchConflictFields",value:function(e){var t=this,a=S.exports.Deferred(),s=c("splunk_ta_aws_"+e,{app:"Splunk_TA_aws",sharing:"app"});return fetch(s+"?output_mode=json").then((function(e){return e.json()})).then((function(e){if(e.entry!==[])for(var s=0;s<e.entry.length;s++)e.entry[s].name===t.state.data.name.value&&"_conflict_fields"in e.entry[s].content&&(t._conflict_fields=JSON.parse(e.entry[s].content._conflict_fields));a.resolve()})),a}},{key:"_getNormalizeData",value:function(){var e=this,t={};return Object.keys(this.state.data).forEach((function(a){t[a]=e.state.data[a].value})),t}}]),a}();export{de as default};
//# sourceMappingURL=Hook.js.map

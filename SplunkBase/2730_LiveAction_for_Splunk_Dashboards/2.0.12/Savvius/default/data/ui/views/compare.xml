<form stylesheet="compare.css">
  <label>Compare</label>
  <fieldset autorun="true" submitButton="false">
    <!-- Global timer. Not token is necessary -->
    <input type="dropdown" token="source" searchWhenChanged="true">
      <label>Source</label>
      <default>*</default>
      <choice value="*">All</choice>
      <search>
        <query>sourcetype=sv_summaries | stats count by host</query>
        <earliest>-1h</earliest>
        <latest>now</latest>
      </search>
      <fieldForValue>host</fieldForValue>
      <fieldForLabel>host</fieldForLabel>
    </input>
    <input type="time" searchWhenChanged="true" token="timea">
      <label>Date &amp; Time (Baseline Period)</label>
      <default>
        <earliest>-30m@m</earliest>
        <latest>-15m@m</latest>
      </default>
    </input>
    <input type="time" searchWhenChanged="true" token="timeb">
      <label>Date &amp; Time (Compare Period)</label>
      <default>
        <earliest>-15m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <searchString>| multisearch
            [search sourcetype=sv_nodes host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | fields Address | rename Address as AddressA]
            [search sourcetype=sv_nodes host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | fields Address | rename Address as AddressB]
            | dedup keepempty=true AddressA
            | dedup keepempty=true AddressB
            | eval Address=if(isnull(AddressA),AddressB,AddressA)
            | eval FromB=if(isnull(AddressA),1,0)
            | eventstats count by Address
            | where count = 1 AND FromB = 1 | stats count
            | fieldformat count=tostring(count, "commas")</searchString>
        <option name="drilldown">all</option>
        <option name="underLabel">New Nodes</option>
        <option name="field">count</option>
        <option name="linkFields">result, underlabel</option>
        <drilldown>
          <link>
            <![CDATA[
					statistics_nodes?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$
				]]>
          </link>
        </drilldown>
      </single>
      <single>
        <searchString>| multisearch
            [search sourcetype=sv_nodes host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | iplocation Address | fields Country | rename Country as CountryA]
            [search sourcetype=sv_nodes host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | iplocation Address | fields Country | rename Country as CountryB]
            | dedup keepempty=true CountryA
            | dedup keepempty=true CountryB
            | eval Country=if(isnull(CountryA),CountryB,CountryA)
            | eval FromB=if(isnull(CountryA),1,0)
            | eventstats count as countCountries by Country
            | where countCountries = 1 AND FromB = 1
            | eventstats count by Country | stats count
            | fieldformat count=tostring(count, "commas")</searchString>
        <option name="drilldown">all</option>
        <option name="underLabel">New Countries</option>
        <option name="field">count</option>
        <option name="linkFields">result, underlabel</option>
        <drilldown>
          <link>
            <![CDATA[
                    maps_utilization?earliest=$timeb.earliest$&latest=$timeb.latest$
                ]]>
          </link>
        </drilldown>
      </single>
      <single>
        <searchString>| multisearch
            [search sourcetype=sv_apps host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | fields Name | rename Name as NameA]
            [search sourcetype=sv_apps host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | fields Name | rename Name as NameB]
            | dedup keepempty=true NameA
            | dedup keepempty=true NameB
            | eval Application=if(isnull(NameA),NameB,NameA)
            | eval FromB=if(isnull(NameA),1,0)
            | eventstats count by Application
            | where count = 1 AND FromB = 1 | stats count
            | fieldformat count=tostring(count, "commas")</searchString>
        <option name="drilldown">all</option>
        <option name="underLabel">New Applications</option>
        <option name="field">count</option>
        <option name="linkFields">result, underlabel</option>
        <drilldown>
          <link>
            <![CDATA[
                  statistics_applications?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$
				]]>
          </link>
        </drilldown>
      </single>
      <single>
        <searchString>| multisearch
            [search sourcetype=sv_event_counts host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | fields Event | rename Event as EventA]
            [search sourcetype=sv_event_counts host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | fields Event | rename Event as EventB]
            | dedup keepempty=true EventA
            | dedup keepempty=true EventB
            | eval "Expert Event"=if(isnull(EventA),EventB,EventA)
            | eval FromB=if(isnull(EventA),1,0)
            | eventstats count by "Expert Event"
            | where count = 1 AND FromB = 1 | stats count
            | fieldformat count=tostring(count, "commas")</searchString>
        <option name="drilldown">all</option>
        <option name="underLabel">New Expert Event Trends</option>
        <option name="field">count</option>
        <option name="linkFields">result, underlabel</option>
        <drilldown>
          <link>
            <![CDATA[
					events_expert_events?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$
				]]>
          </link>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <map>
        <title>World Map of New Nodes In Compare Period</title>
        <search>
          <query>| multisearch
            [search sourcetype=sv_nodes host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | eval Bytes='Bytes Received' + 'Bytes Sent' | fields Address, Bytes | rename Address as AddressA | rename Bytes as BytesA]
            [search sourcetype=sv_nodes host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | eval Bytes='Bytes Received' + 'Bytes Sent' | fields Address, Bytes | rename Address as AddressB | rename Bytes as BytesB]
            | dedup keepempty=true AddressA
            | dedup keepempty=true AddressB
            | eval Address=if(isnull(AddressA),AddressB,AddressA)
            | eval FromB=if(isnull(AddressA),1,0)
            | eval Bytes=if(isnull(AddressA),BytesB,BytesA)
            | eventstats count by Address
            | where count = 1 AND FromB = 1
            | iplocation prefix=iploc_ allfields=true Address
            | geostats latfield=iploc_lat longfield=iploc_lon sum(Bytes) by Address globallimit=0</query>
        </search>
        <option name="mapping.data.maxClusters">500</option>
        <option name="mapping.markerLayer.markerMaxSize">20</option>
        <option name="mapping.map.center">(5,20)</option>
        <option name="mapping.map.zoom">2</option>
        <option name="height">300px</option>
        <fields>["host","source","sourcetype"]</fields>
        <option name="drilldown">all</option>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>New Nodes In Compare Period</title>
        <search>
          <query>| multisearch
            [search sourcetype=sv_nodes host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | fields Address | rename Address as AddressA]
            [search sourcetype=sv_nodes host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | fields Address | rename Address as AddressB]
            | dedup keepempty=true AddressA
            | dedup keepempty=true AddressB
            | eval Address=if(isnull(AddressA),AddressB,AddressA)
            | eval FromB=if(isnull(AddressA),1,0)
            | eventstats count by Address
            | where count = 1 AND FromB = 1
            | table Address
            | sort + Address
            | rename Address as Node</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <drilldown>
          <condition field="Node">
            <link>
              <![CDATA[
                  statistics_nodes?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$&form.address=$click.value2$
                      ]]>
            </link>
          </condition>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table>
        <title>New Countries In Compare Period</title>
        <search>
          <query>| multisearch
            [search sourcetype=sv_nodes host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | iplocation Address | fields Country | rename Country as CountryA]
            [search sourcetype=sv_nodes host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | eval Address=replace(Address, "IP-", "") | eval Address=replace(Address, "IPv6-", "") | eval Address=replace(Address, "IPX-", "") | eval Address=replace(Address, "AT-", "") | eval Address=replace(Address, "DEC-", "") | iplocation Address | fields Country | rename Country as CountryB]
            | dedup keepempty=true CountryA
            | dedup keepempty=true CountryB
            | eval Country=if(isnull(CountryA),CountryB,CountryA)
            | eval FromB=if(isnull(CountryA),1,0)
            | eventstats count by Country
            | where count = 1 AND FromB = 1
            | table Country
            | sort + Country</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <drilldown>
          <link>
            <![CDATA[
                    maps_utilization?earliest=$timeb.earliest$&latest=$timeb.latest$
                ]]>
          </link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table>
        <title>New Applications In Compare Period</title>
        <search>
          <query>| multisearch
            [search sourcetype=sv_apps host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | fields Name | rename Name as NameA]
            [search sourcetype=sv_apps host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | fields Name | rename Name as NameB]
            | dedup keepempty=true NameA
            | dedup keepempty=true NameB
            | eval Application=if(isnull(NameA),NameB,NameA)
            | eval FromB=if(isnull(NameA),1,0)
            | eventstats count by Application
            | where count = 1 AND FromB = 1
            | table Application
            | sort + Application</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <drilldown>
          <condition field="Application">
            <link>
              <![CDATA[
                  statistics_applications?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$&form.application=$click.value2$
                      ]]>
            </link>
          </condition>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table>
        <title>New Expert Event Trends In Compare Period</title>
        <search>
          <query>| multisearch
            [search sourcetype=sv_event_counts host="$source$" earliest=$timea.earliest$ latest=$timea.latest$ | fields Event | rename Event as EventA]
            [search sourcetype=sv_event_counts host="$source$" earliest=$timeb.earliest$ latest=$timeb.latest$ | fields Event | rename Event as EventB]
            | dedup keepempty=true EventA
            | dedup keepempty=true EventB
            | eval "Expert Event"=if(isnull(EventA),EventB,EventA)
            | eval FromB=if(isnull(EventA),1,0)
            | eventstats count by "Expert Event"
            | where count = 1 AND FromB = 1
            | table "Expert Event"
            | sort + "Expert Event"</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
        <drilldown>
          <condition field="Expert Event">
            <link>
              <![CDATA[
                  events_expert_events?earliest=$timeb.earliest$&latest=$timeb.latest$&form.source=$source$&form.filter=$click.value2$
                      ]]>
            </link>
          </condition>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
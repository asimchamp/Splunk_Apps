# simple call to spath and fields renaming (required for workflow-actions).
[parse_ioc_indicators_json]
# definition = spath input=ioc_indicators_json | rename {}.type AS indicator_type {}.value AS indicator_value {}.value_type AS indicator_value_type {}.creation_time AS ioc_ingestion_time {}.modification_time AS ioc_last_modification_time {}.revision AS ioc_revision_number {}.stanza_name AS ioc_source_stanza {}.indicator_id AS indicator_id {}.indicator_raw_id AS indicator_raw_id  {}.ioc_id AS ioc_id {}.raw_id AS ioc_raw_id 

definition = spath input=ioc_indicators_json  | rename {}.type AS indicator_type {}.value AS indicator_value {}.value_type AS indicator_value_type {}.creation_time AS ioc_ingestion_time {}.modification_time AS ioc_last_modification_time {}.revision AS ioc_revision_number {}.stanza_name AS ioc_source_stanza {}.indicator_id AS indicator_id {}.indicator_raw_id AS indicator_raw_id  {}.ioc_id AS ioc_id {}.raw_id AS ioc_raw_id  | eval z = mvzip(indicator_type, indicator_value) | eval z = mvzip(z, indicator_value_type) | eval z = mvzip(z, indicator_id) | eval z = mvzip(z, indicator_raw_id) | eval z = mvzip(z, ioc_id) | eval z = mvzip(z, ioc_raw_id) | eval z = mvzip(z, ioc_ingestion_time) | eval z = mvzip(z, ioc_last_modification_time) | eval z = mvzip(z, ioc_revision_number) | eval z = mvzip(z, ioc_source_stanza)  | fields - indicator_type, indicator_value, indicator_value_type, indicator_id, indicator_raw_id, ioc_id, ioc_raw_id, ioc_ingestion_time, ioc_last_modification_time, ioc_revision_number, ioc_source_stanza, {}.*, ioc_indicators_json | mvexpand z | eval z = split(z, ",") | eval indicator_type = mvindex(z, 0) | eval indicator_value = mvindex(z, 1) | eval indicator_value_type = mvindex(z, 2) | eval indicator_id = mvindex(z, 3) | eval indicator_raw_id = mvindex(z, 4) | eval ioc_id = mvindex(z, 5) | eval ioc_raw_id = mvindex(z, 6) | eval ioc_ingestion_time = mvindex(z, 7) | eval ioc_last_modification_time = mvindex(z, 8) | eval ioc_revision_number = mvindex(z, 9) | eval ioc_source_stanza = mvindex(z, 10) | eval ioc_source_stanza=replace(ioc_source_stanza, "^ioc://", "")  | eval ioc_source_stanza=replace(ioc_source_stanza, "^taxii://", "") 

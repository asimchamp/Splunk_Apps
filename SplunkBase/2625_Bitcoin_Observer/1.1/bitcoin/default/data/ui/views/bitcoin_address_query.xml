<form>
  <label>Bitcoin Address Query</label>
  <description>Enter a time range, transaction type and bitcoin address below to see transfer amounts and the possible transaction locations on the map below.</description>
  <fieldset autoRun="false" submitButton="true">
    <input type="time" searchWhenChanged="true">
      <label>Select Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
     <input type="dropdown" token="ecat" searchWhenChanged="true">
      <label>Select Transaction Type</label>
      <default>Received</default>
      <choice value="output_to">Received</choice>
      <choice value="input_from">Sent</choice>
       <change>
        <condition label="Received">
          <set token="dest1">out_address</set>
          <set token="val">out_value</set>
          <set token="clabel">total_received</set>
        </condition>
         <condition label="Sent">
          <set token="dest1">in_address</set>
          <set token="val">in_value</set>
           <set token="clabel">total_sent</set>
        </condition>
       </change>
    </input>
    <input type="text" token="address" searchWhenChanged="true">
      <label>Enter a Bitcoin Address:</label>
      <default>3MXxfNZoifLYdS8wJTpvfeDNPt9ZWuMAaN</default>
    </input>
  </fieldset>
  <row>
    <html>
      <p>Bitcoin uses peer-to-peer connections to share the transaction database called the “Blockchain.” This app uses the Blockchain.info 
        “Relayed by IP” address to determine location. Note that this is just the first IP address that blockchain.info saw broadcast the transaction, 
        not necessarily the IP address that originated the transaction. Some bitcoin clients connect to peers that 
        do not publish IP address information.</p>
      <p>See this <a href="http://cointext.com/bitcoin-and-ip-address-privacy/">link</a> for more information on how IP Addresses are handled on the Bitcoin network.</p>
    </html>
        </row>
  
  
 <row>
    <panel>
      <chart>
        <title>Transfer Amount Per Transaction for Selected Bitcoin Address - $address$</title>
        
        <search>
          <query>index=bitcoin eventcat=$ecat$ $dest1$=$address$ | chart sum($val$) AS $clabel$ by tx_index</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.text">Transfer Amount</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  
  <row>
    <panel>
      <map>
        <title>Possible Transaction Locations for Bitcoin Address - $address$</title>
        <search>
          <query>index=bitcoin eventcat=transaction [search index=bitcoin eventcat=$ecat$ startdaysago=7 $dest1$=$address$ | dedup tx_index | table tx_index] NOT tx_relayed_by=127.0.0.1 | iplocation tx_relayed_by allfields=true | geostats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="mapping.tileLayer.url">http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</option>
      <option name="mapping.tileLayer.subdomains">[a,b,c]</option>
      <option name="mapping.tileLayer.minZoom">0</option>
      <option name="mapping.tileLayer.maxZoom">18</option>
      <option name="mapping.tileLayer.attribution">Map data (c) 2012 OpenStreetMap contributors, CC-BY-SA.</option>
      </map>
    </panel>
  </row>
</form>
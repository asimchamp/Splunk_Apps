<?xml version='1.0' encoding='utf-8'?>
<form version="1.1" script="main.js" stylesheet="main.css">

   <label>uberAgent log file overview</label>
   <description>This dashboard shows an overview from the uberAgent log files.</description>

   <fieldset autoRun="true">
      <input type="time" id="TimeRange1" searchWhenChanged="true">
         <label>Time range:</label>
         <default>
            <earliest>-4h</earliest>
            <latest>now</latest>
         </default>
         <change>
            <eval token="TimeRangePickerSpan">relative_time(now(), latest) - relative_time(now(), earliest)</eval>
            <eval token="PivotPeriodAutoSolo">case('TimeRangePickerSpan' &lt; 350000, "auto", 'TimeRangePickerSpan' &lt; 610000, "hour", 1=1, "auto")</eval>
            <eval token="PivotPeriodAutoTimechart">case('TimeRangePickerSpan' &lt; 1200, "second", 'TimeRangePickerSpan' &lt; 300000, "minute", 'TimeRangePickerSpan' &lt; 700000, "hour", 1=1, "day")</eval>
         </change>
      </input>
      <input type="dropdown" token="FilterField" id="Input_FilterField">
         <label>Filter field:</label>
      </input>
      <input type="dropdown" token="FilterOperator" id="Input_FilterOperator">
         <label>Filter operator:</label>
      </input>
      <input type="text" token="FilterExpression" id="Input_FilterExpression">
         <label>Filter expression:</label>
         <default>*</default>
      </input>
      <input type="dropdown" token="FilterField2" id="Input_FilterField2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterOperator2" id="Input_FilterOperator2" depends="$FilterLevel2$">
      </input>
      <input type="text" token="FilterExpression2" id="Input_FilterExpression2" depends="$FilterLevel2$">
      </input>
      <input type="dropdown" token="FilterField3" id="Input_FilterField3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterOperator3" id="Input_FilterOperator3" depends="$FilterLevel3$">
      </input>
      <input type="text" token="FilterExpression3" id="Input_FilterExpression3" depends="$FilterLevel3$">
      </input>
      <input type="dropdown" token="FilterField4" id="Input_FilterField4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterOperator4" id="Input_FilterOperator4" depends="$FilterLevel4$">
      </input>
      <input type="text" token="FilterExpression4" id="Input_FilterExpression4" depends="$FilterLevel4$">
      </input>
      <input type="dropdown" token="FilterField5" id="Input_FilterField5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterOperator5" id="Input_FilterOperator5" depends="$FilterLevel5$">
      </input>
      <input type="text" token="FilterExpression5" id="Input_FilterExpression5" depends="$FilterLevel5$">
      </input>
      <input type="dropdown" token="FilterField6" id="Input_FilterField6" depends="$FilterLevel6$">
      </input>
      <input type="dropdown" token="FilterOperator6" id="Input_FilterOperator6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterExpression6" id="Input_FilterExpression6" depends="$FilterLevel6$">
      </input>
      <input type="text" token="FilterLevels" id="Input_FilterLevels" depends="$FilterLevels_Hidden$">
      </input>
      <input type="text" token="FilterDatamodel" id="Input_FilterDatamodel" depends="$FilterDatamodel_Hidden$">
         <default>Meta_uberAgentLog</default>
      </input>
   </fieldset>

   <!-- Row 1 -->
   <row>
      <panel>
         <title>Log file to display:</title>
         <input type="dropdown" token="Dataset" searchWhenChanged="true">
            <label></label>
            <default>Meta_uberAgentLog</default>
            <choice value="Meta_uberAgentLog">uberAgent.log</choice>
            <choice value="Meta_uAInSessionHelperLog">uAInSessionHelper.log</choice>
            <choice value="Meta_uAIEExtensionLog">uberAgentIEExtension.log</choice>
            <choice value="Meta_uASandboxLog">uberAgentSandbox.log</choice>
        </input>
      </panel>
   </row>
   
    <!-- Row 2 -->
   <row>
      <panel>
         <title>Overview</title>
         <single>
             <title>#Hosts</title>
             <search>
                 <query>
                     | pivot uberAgentMeta $Dataset$
                        dc(host) as HostCount
                       $SearchFilter$
                 </query>
             </search>
             <option name="numberPrecision">0</option>
             <option name="useThousandSeparators">1</option>
         </single>
         <single>
             <title>#Errors</title>
             <search>
                 <query>
                     | pivot uberAgentMeta $Dataset$
                        count(Message) as ErrorCount
                       filter Severity is ERROR
                       $SearchFilter$
                 </query>
             </search>
             <option name="numberPrecision">0</option>
             <option name="useThousandSeparators">1</option>
         </single>
         <single>
             <title>#Warnings</title>
             <search>
                 <query>
                     | pivot uberAgentMeta $Dataset$
                        count(Message) as WarningCount
                       filter Severity is WARN
                       $SearchFilter$
                 </query>
             </search>
             <option name="numberPrecision">0</option>
             <option name="useThousandSeparators">1</option>
         </single>   
      </panel>
   </row>

   <!-- Row 3 -->
   <row>
      <panel>
         <title>#Errors by host (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count($Dataset$) as Count
                     splitrow 
                        host
                     filter Severity is "ERROR"
                     $SearchFilter$
                  | stats sum(Count) as "#Errors" by host
                  | sort - "#Errors" limit=10
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>
            <option name="charting.drilldown">none</option>            
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>
      <panel>
         <title>#Warnings by host (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count($Dataset$) as Count
                     splitrow 
                        host
                     filter Severity is "WARN"
                     $SearchFilter$
                  | stats sum(Count) as "#Warnings" by host
                  | sort - "#Warnings" limit=10
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.legend.placement">none</option>   
            <option name="charting.drilldown">none</option>                        
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>
   </row>
   
   <!-- Row 4 -->
   <row>
      <panel>
         <title>Severities to display:</title>
         <input type="multiselect" token="FieldFilter" id="Input_Panel31FieldFilter" searchWhenChanged="true">
            <choice value='"ERROR"'>Error</choice>
            <choice value='"WARN"'>Warning</choice>
            <choice value='"INFO"'>Information</choice>
            <choice value='"DEBUG"'>Debug</choice>
            <default>
               Warning,
               Error
            </default>
            <label></label>
            <prefix>filter Severity in (</prefix>
            <suffix>)</suffix>
            <valuePrefix></valuePrefix>
            <valueSuffix></valueSuffix>
            <delimiter>,</delimiter>
         </input>
      </panel>
   </row>

   <!-- Row 5 -->
   <row>
      <panel>
         <title>Severity count by host (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count($Dataset$) as Count
                     splitrow 
                        host
                     splitcol
                        Severity
                     $FieldFilter$
                     $SearchFilter$
                  | stats sum(*) as * by host
                  | addtotals
                  | sort - Total limit=10
                  | fields - Total
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">bottom</option>  
            <option name="charting.drilldown">none</option>                        
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>
      <panel>
         <title>Severity count by category (top 10)</title>
         <chart>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count($Dataset$) as Count
                     splitrow 
                        Category
                     splitcol
                        Severity
                     $FieldFilter$
                     $SearchFilter$
                  | stats sum(*) as * by Category
                  | addtotals
                  | sort - Total limit=10
                  | fields - Total
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">bar</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">bottom</option>    
            <option name="charting.drilldown">none</option>                        
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>
      </panel>
   </row>
   
   <!-- Row 6 -->
   <row>
      <panel>
         <title>Log entry count over time by severity</title>
         <chart>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count($Dataset$) as Count
                     splitrow 
                        Severity
                     splitrow
                        _time
                        period minute
                     $FieldFilter$
                     $SearchFilter$
                  | timechart 
                     `uberAgent_dynamic_span`
                     sum(Count) by Severity
                  | fillnull
               </query>            
            </search>
            <option name="height">300</option>
            <option name="charting.chart">line</option>
            <option name="charting.legend.placement">right</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
         </chart>      
      </panel>
   </row>  

   <!-- Row 7 -->
   <row>
      <panel>
         <title>Messages (top 100)</title>
         <input type="dropdown" token="Panel51SortBy" searchWhenChanged="true">
            <choice value="#Messages">#Messages</choice>
            <choice value="#Hosts">#Hosts</choice>
            <default>#Messages</default>
            <label>Sort by:</label>
         </input>         
         <table>            
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count(Message) as "#Messages"
                     dc(host) as "#Hosts"
                     latest(Severity) as Severity
                     splitrow
                        Message
                     $FieldFilter$
                     $SearchFilter$
                  | sort - $Panel51SortBy$ limit=100
                  | fields
                      Severity Message "#Messages" "#Hosts"
               </query>
            </search>
            <option name="count">25</option>
            <option name="drilldown">row</option>
            <drilldown>
                <set token="DrilldownFilterBy61">$row.Message$</set>
            </drilldown>            
         </table>
      </panel>
   </row>   

   <!-- Row 8 -->
   <row depends="$DrilldownFilterBy61$">
      <panel>
         <title>Detail for log message: $DrilldownFilterBy61$</title>
         <chart>
            <title>Log message over time and host</title>
            <search>
               <query>
                  | pivot uberAgentMeta $Dataset$
                     count(Message) as "#Messages"
                     splitrow
                        _time
                        period $PivotPeriodAutoTimechart$
                     splitcol
                        host
                     filter Message is $DrilldownFilterBy61|s$
                     $FieldFilter$
                     $SearchFilter$
                  | timechart
                     `uberAgent_dynamic_span`
                     sum(*) as *
               </query>
            </search>
            <option name="height">250</option>
            <option name="charting.chart">Column</option>
            <option name="charting.chart.stackMode">stacked</option>
            <option name="charting.legend.placement">bottom</option>
            <option name="charting.axisTitleX.visibility">collapsed</option>
            <option name="charting.axisTitleY.visibility">collapsed</option>
            <option name="charting.drilldown">none</option>
         </chart>
      </panel>
   </row>

</form>   
<form script="metawoot_cell_highlighting.js" stylesheet="metawoot_cell_highlighting.css" version="1.1">
  <label>Meta Woot! Indexing Compliance</label>
  <description>Allows for compliance reporting on data sources that have stopped being indexed. In cases, it might be normal for some sources to stop indexing data, but in many cases, it would be expected that data is continually indexed. Here you can set thresholds for what you might consider delayed (i.e. have not been indexed for a short time) vs. late (i.e. have not been indexed for a long time).</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="index">
      <label>Index</label>
      <choice value="*">All</choice>
      <search>
        <query>| inputlookup meta_woot | dedup index | fields index | sort index</query>
      </search>
      <fieldForLabel>index</fieldForLabel>
      <fieldForValue>index</fieldForValue>
      <default>*</default>
    </input>
        <input type="multiselect" token="exclude_index" searchWhenChanged="true">
      <label>Exclude Index</label>
      <choice value="null">None</choice>
      <default>null</default>
      <fieldForLabel>index</fieldForLabel>
      <fieldForValue>index</fieldForValue>
      <search>
        <query>| inputlookup meta_woot | dedup index | fields index | sort index</query>
        <earliest>0</earliest>
        <latest></latest>
      </search>
      <delimiter> </delimiter>
      <valuePrefix>index!=</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
    </input>
    <input type="dropdown" token="sourcetype" searchWhenChanged="true">
      <label>Sourcetype</label>
      <choice value="*">All</choice>
      <search>
        <query>| inputlookup meta_woot where index=$index$ | dedup sourcetype | fields sourcetype | sort sourcetype</query>
      </search>
      <fieldForLabel>sourcetype</fieldForLabel>
      <fieldForValue>sourcetype</fieldForValue>
      <default>*</default>
    </input>
    <input type="text" token="host" searchWhenChanged="true">
      <label>Host</label>
      <default>*</default>
    </input>
    <input type="multiselect" token="index_level_filter" searchWhenChanged="true">
      <label>Indexing Level</label>
      <choice value="*">All</choice>
      <choice value="recent">Recent</choice>
      <choice value="delayed">Delayed</choice>
      <choice value="late">Late</choice>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>last_time_indexed="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
    </input>
    <input type="text" token="delayed_threshold" searchWhenChanged="true">
      <label>Delayed Threshold (mins)</label>
      <default>60</default>
    </input>
    <input type="text" token="late_threshold" searchWhenChanged="true">
      <label>Late Threshold (mins)</label>
      <default>1440</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <search>
          <query>| inputlookup meta_woot  where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$
| eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case((now()-recentTime)&lt;convert_delayed, "Recent", (now()-recentTime)&gt;convert_late, "Late", (now()-recentTime) &gt; convert_delayed, "Delayed")
 |  stats dc(host)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x6db7c6","0xf7bc38","0xf58f39","0xd93f3c"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="underLabel">Total Hosts</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <option name="unitPosition">after</option>
      </single>
    </panel>
    <panel>
      <single>
        <search>
          <query>| inputlookup meta_woot  where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$ | eval last_time=(now()-recentTime) | stats max(last_time) as last_time by host |  eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case(last_time&lt;convert_delayed, "Recent", last_time&gt;convert_late, "Late", last_time &gt; convert_delayed, "Delayed") |  where last_time_indexed="Recent" | stats dc(host) | appendpipe [| stats count | where count=0]</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x65a637","0x65a637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="underLabel">Recent Hosts</option>
      </single>
    </panel>
    <panel>
      <single>
        <search>
          <query>| inputlookup meta_woot  where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$ | eval last_time=(now()-recentTime) | stats max(last_time) as last_time by host |  eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case(last_time&lt;convert_delayed, "Recent", last_time&gt;convert_late, "Late", last_time &gt; convert_delayed, "Delayed") |  where last_time_indexed="Delayed" | stats dc(host) | appendpipe [| stats count | where count=0]</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="rangeColors">["0xf7bc38","0xf7bc38"]</option>
        <option name="rangeValues">[0]</option>
        <option name="underLabel">Delayed Hosts</option>
      </single>
    </panel>
    <panel>
      <single>
        <search>
          <query>| inputlookup meta_woot  where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$ | eval last_time=(now()-recentTime) | stats max(last_time) as last_time by host |  eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case(last_time&lt;convert_delayed, "Recent", last_time&gt;convert_late, "Late", last_time &gt; convert_delayed, "Delayed") |  where last_time_indexed="Late" | stats dc(host) | appendpipe [| stats count | where count=0]</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xC00000","0xC00000"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="underLabel">Late Hosts</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="unitPosition">after</option>
      </single>
    </panel>
    <panel>
      <single>
        <search>
          <query>| inputlookup meta_woot  where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$| eval last_time=(now()-recentTime) | stats max(last_time) as last_time by host |  eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case(last_time&lt;convert_delayed, "Recent", last_time&gt;convert_late, "Late", last_time &gt; convert_delayed, "Delayed") | eval compliant_host=if(last_time_indexed="Recent", "1","0") | stats dc(host) as total_host, sum(compliant_host) as compliant_host | eval compliance_rate=(compliant_host/total_host)*100 | fields compliance_rate</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xC00000","0xf7bc38","0x65a637"]</option>
        <option name="rangeValues">[33,67]</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="trendInterval">auto</option>
        <option name="underLabel">Indexing Compliance</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <option name="unitPosition">after</option>
        <option name="unit">%</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Detailed Indexing Compliance by Host</title>
            <html>Click to drill down to event counts over time. firstTime is the first time that Meta Woot first saw the record. lastTime is the last timestamp of the last event. recentTime is the time the last event was actually indexed.</html>
      <table id="shading">
        <search>
          <query>| inputlookup meta_woot where index=$index$ sourcetype=$sourcetype$ host=$host$ $exclude_index$ | eval convert_late=($late_threshold$*60) | eval convert_delayed=($delayed_threshold$*60) | eval last_time_indexed=case((now()-recentTime)&lt;convert_delayed, "Recent", (now()-recentTime)&gt;convert_late, "Late", (now()-recentTime) &gt; convert_delayed, "Delayed")  | eval minutesAgo=round((now() - recentTime)/60,2) | convert ctime(recentTime) ctime(firstTime) ctime(lastTime) ctime(lastUpdated) | table index, sourcetype, host, last_time_indexed, minutesAgo, firstTime, lastTime, recentTime | search $index_level_filter$ | rename last_time_indexed AS "Index Level" | sort - minutesAgo</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="count">50</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <drilldown target="NewWindow">
          <link>
            <![CDATA[
          meta_woot_trends?form.sourcetype=$row.sourcetype$&form.index=$row.index$&form.host=$row.host$
		]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>
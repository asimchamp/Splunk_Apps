<form script="autodiscover.js" refresh="60">
  <label>Kill zone map</label>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="killtime" searchWhenChanged="true">
      <label/>
      <default>
        <earliestTime>-60m@m</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <input type="dropdown" token="map_vis_type" searchWhenChanged="true">
        <label>Visualize by:</label>
        <choice value="victim_position | rename player_name AS victim_name player_position_x AS victim_position_x player_position_y AS victim_position_y player_position_z AS victim_position_z">attaker position</choice>
        <choice value="victim_position">victim position</choice>
        <choice value="| rename player_name AS victim_name player_position_x AS victim_position_x player_position_y AS victim_position_y player_position_z AS victim_position_z">common areas</choice>
        <default>victim_position</default>
      </input>
      <html>
    <h2>Kill heatmap</h2>
      <div id="killSearch" class="splunk-manager" data-require="splunkjs/mvc/searchmanager" data-options="{                                         &quot;search&quot;: {          &quot;type&quot;: &quot;token_safe&quot;,          &quot;value&quot;: &quot;tag=tf2 $$map_vis_type$$ | stats count, values(victim_name) AS victims by victim_position_x, victim_position_y, victim_position_z | sort - count | eval label=\&quot;Kills: \&quot;.count.\&quot;&lt;br/&gt;Victims: \&quot;.victims | eval x=1 | join x type=outer [search earliest=-24h@h tag=tf2 map started | head 1 | fields map_name | eval x=1] | fields - x&quot;        },                                              &quot;earliest_time&quot;: {                  &quot;type&quot;: &quot;token_safe&quot;,                  &quot;value&quot;: &quot;$$killtime.earliest$$&quot;              },              &quot;latest_time&quot;: {                  &quot;type&quot;: &quot;token_safe&quot;,                  &quot;value&quot;: &quot;$$killtime.latest$$&quot;              },        &quot;status_buckets&quot;: 0,                                 &quot;cancelOnUnload&quot;: true,                                 &quot;auto_cancel&quot;: 90,                                 &quot;preview&quot;: true                           }"/>
      <div id="killChart" class="splunk-view" data-require="app/tf2/components/imagemapheatmap/imagemapheatmap" data-options="{                             &quot;managerid&quot;: &quot;killSearch&quot;,     &quot;xField&quot;: &quot;victim_position_x&quot;,    &quot;yField&quot;: &quot;victim_position_y&quot;,    &quot;zField&quot;: &quot;victim_position_z&quot;,    &quot;countField&quot;: &quot;count&quot;,    &quot;labelField&quot;: &quot;label&quot;,                                  &quot;drilldown&quot;: &quot;http://localhost/&quot;       }"/>
    </html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Kill positions</title>
        <searchString>tag=tf2 victim_position | stats count, values(player_action) AS actions, values(player_name) AS players, values(victim_name) AS victims by victim_position_x, victim_position_y, victim_position_z | mvcombine actions | sort - count | eval x=1 | join x type=outer [search earliest=-24h@h tag=tf2 map started | head 1 | fields map_name | eval x=1] | fields - x</searchString>
        <earliestTime>$killtime.earliest$</earliestTime>
        <latestTime>$killtime.latest$</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>

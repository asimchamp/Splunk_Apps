[Domains without categories]
action.email.reportServerEnabled = 0
search = `webproxy-index` | eval category_domain = `webproxy-domain-field` | lookup domain_categories category_domain | search NOT category=* NOT tag::`webproxy-domain-field`=category_*

# [Collect custom domain categories]
# search = `webproxy-index` tag::`webproxy-domain-field`=category_* | dedup `webproxy-domain-field` tag::`webproxy-domain-field` | rex field=tag::`webproxy-domain-field` "category_(?<category>.*)" | rename `webproxy-domain-field` as category_domain | eval vendor="Custom" | table category category_domain vendor

# [Append custom domain categories]
# search = `webproxy-index` tag::`webproxy-domain-field`=category_* | dedup `webproxy-domain-field` tag::`webproxy-domain-field` | rex field=tag::`webproxy-domain-field` "category_(?<category>.*)" | rename `webproxy-domain-field` as category_domain | fields category category_domain | eval vendor="Custom" | inputlookup custom_domain_categories.csv append=t | dedup category category_domain vendor | table category category_domain vendor

# [Append custom domain categories and output]
# action.email.inline = 1
# alert.suppress = 0
# alert.track = 0
# cron_schedule = 03,33 * * * *
# enableSched = 1
# dispatch.earliest_time = -35m@m
# dispatch.latest_time = -5m@m
# search = `webproxy-index` tag::`webproxy-domain-field`=category_* | dedup `webproxy-domain-field` tag::`webproxy-domain-field` | rex field=tag::`webproxy-domain-field` "category_(?<category>.*)" | rename `webproxy-domain-field` as category_domain | fields category_domain category | inputlookup custom_domain_categories.csv append=t | dedup category_domain category | eval vendor="Custom" | table category category_domain vendor | outputlookup custom_domain_categories.csv

# [Getwatchlist for domain categories - malwaredomains]
# search = | getwatchlist malwaredomains | fields domain category | rename domain as category_domain | eval vendor="Malware Domains" | table category category_domain vendor



[Combine all domain categories]
action.email.inline = 1
alert.suppress = 0
alert.track = 0
cron_schedule = 5 * * * *
enableSched = 1
dispatch.earliest_time = -15m@m
dispatch.latest_time = -10m@m
search = | inputlookup domaincategories.csv | append [| getwatchlist malwaredomains vendor="Malware Domains"| fields domain category | rename domain as category_domain | table category category_domain vendor] | append [| inputlookup custom_domain_categories.csv] | join category type=outer [| inputlookup category_actions.csv] | join vendor type=outer [|inputlookup vendor_actions.csv] | outputlookup all_domain_categories.csv

# search = | inputlookup domaincategories.csv | append [| getwatchlist malwaredomains | fields domain category | rename domain as category_domain | eval vendor="Malware Domains" | table category category_domain vendor] | append [| inputlookup custom_domain_categories.csv] | outputlookup all_domain_categories.csv

# [Add domain category lookup]
# search = `webproxy-index` | eval category_domain = `webproxy-domain-field` | lookup domain_categories category_domain

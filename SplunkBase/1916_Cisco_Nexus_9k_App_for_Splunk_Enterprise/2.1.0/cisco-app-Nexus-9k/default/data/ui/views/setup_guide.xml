<dashboard stylesheet="home.css" script="setup_page.js">
  <label>Setup Guide</label>
  <row>
    <panel>
      <html>
        <div class="container-fluid main-section-body">
          <div class="dashboard-header clearfix">
            <h2>Cisco Nexus 9k App for Splunk Enterprise</h2>
          </div>
          <p>The Cisco Nexus 9k App for Splunk Enterprise  is used to Build dashboard on indexed data provided by "Cisco Nexus 9k Add-on for Splunk Enterprise" app. Cisco Nexus 9k Add-on for Splunk Enterprise provides a scripted input for Splunk that automatically extracts response of CLI commands of Cisco Nexus 9000 Switches. Add-on app gathers Syslog from Cisco Nexus 9000 Switches and provides the same to the main app. It is tested on Splunk Versions 7.0, 7.1, 7.2, 7.3 and 8.0</p>
          <p>A number of dashboards and searches are also included to demonstrate how Splunk can be used to visualize Nexus 9k switch CLI and Syslog. </p>
          <div class="section-nav">
              <ul class="nav-buttons">
                  <li id="basic-components-button">
                      <a data-section="basiccomponents" href="#basiccomponents" style="width:auto">
                          Requirements
                      </a>
                  </li>
                   <li id="basic-components-button">
                      <a data-section="topology" href="#topology" style="width:auto">
                           Splunk Setup
                      </a>
                  </li>
                  <li id="toolkit-visualizations-button">
                      <a data-section="installation" href="#installation" style="width:auto">
                          Installation
                      </a>
                  </li>
                  <li id="toolkit-visualizations-button">
                      <a data-section="upgradation" href="#upgradation" style="width:auto">
                          Upgradation
                      </a>
                  </li>
                   <li id="toolkit-visualizations-button">
                      <a data-section="config" href="#config" style="width:auto">
                          Configuration
                      </a>
                  </li>
                  <li id="examples-button">
                      <a data-section="examples" href="#examples" style="width:auto">
                          Test Installation
                      </a>
                  </li>
                  <li id="examples-button">
                      <a data-section="datagen" href="#datagen" style="width:auto">
                          Data Generator
                      </a>
                  </li>
              </ul>
          </div>
          <div id="basiccomponents" class="toolkit-section clearfix">
            <h3>Requirements</h3>
	          <p>Requirements for Main App</p>
            <ul>
             <li>Splunk versions: 7.0, 7.1, 7.2, 7.3 and 8.0</li>
        	   <li>Splunk search head system should have 8 GB of RAM and a quad-core CPU to run this app smoothly.</li>
            </ul>
            <p>Requirements for Add-on App</p>
            <p class="list-description">
              <ul>
               <li>Splunk versions: 7.0, 7.1, 7.2, 7.3 and 8.0</li>
               <li>The forwarder system must have network access (HTTP/HTTPS) to one or more nexus 9k switches which are to be Splunked.</li>
          	   <li>Admin user ID and password for collecting data from nexus 9k switches</li>
          	   <li>Python version of minimum 2.7.x or higher must be installed on forwarder system.</li>
          	   <li>Make sure NX-API is running on your switch.<br/>
          	   <pre>SWITCH-1# conf<br/>SWITCH-1(config)# feature nxapi<br/>SWITCH-1(config)# show nxapi<br/>nxapi enabled<br/>Listen on port 80<br/>Listen on port 443</pre>
          	   </li>
  	           <li>Splunk forwarder system should have 4 GB of RAM and a quad-core CPU to run this app smoothly.</li>
              </ul>
            </p>
            <div id="basiccomponents-list" class="toolkit-item-list clearfix">
                 <p/>
            </div>
            <div id="basiccomponents-end"/>
            </div>
            <div id="topology" class="toolkit-section clearfix">
              <h3>Splunk Setup</h3>
              <p class="list-description">
                 <p>This app has been distributed in two parts.</p>
                 <p>1) Add-on app, which runs collector scripts and gathers data from Cisco Nexus 9k switch, does indexing on it and provides indexed data to Main app.<br/>
                    2) Main app, which receives indexed data from Add-on app, runs searches on it and builds dashboard using indexed data.</p>
                 <p>This App can be set up in two ways:</p>
                 <p> 1) <b>Standalone Mode</b>: Install  main app and Add-on app on a single machine.<br/>
                        <ul>
                        <li>Here both the app resides on a single machine.</li>
                        <li>Main app uses the data collected by Add-on app and builds dashboard on it<br/>
                      </li>
                        </ul>
                 </p>
                 <p> 2) <b>Distributed Environment</b>: Install main app and Add-on app on search head and only Add-on app on forwarder system.<br/>
                        <ul>
                         <li>Here also both the apps resides on search head machine.</li>
                         <li>Only Add-on app required to be installed on forwarder system.</li>
                         <li>Execute the following command to forward the collected data to the search head.<br/>
                             <code>/opt/splunk/bin/splunk add forward-server {search_head_ip_address}:9997</code>
                      </li>
                         <li>On Seach head machine, enable the event listening on port 9997 (recommended by Splunk).</li>
                         <li>Main app on search head uses the received data and builds dashboard on it.</li>
                        </ul>
                  </p>
              </p>
              <div id="topology-list" class="toolkit-item-list clearfix">
               <p/>
              </div>
              <div id="topology-end"/>
            </div>

   
            <div id="installation" class="toolkit-section clearfix">
              <h3>Installation</h3>
              <p class="list-description">Installation of Main App</p>
              	<ul>
            			<li>This app can be installed either through UI through "Manage Apps" or by extracting zip file into <i>/opt/splunk/etc/apps</i> folder.</li>
                  <li>The app data defaults to 'main' index.</li>
                  <li>If you have created custom index for your Nexus 9k data follow below steps:</li>
                  <ul>
                    <li>If local folder does not exists, then create local folder inside $SPLUNK_HOME/etc/apps/cisco-app-Nexus-9k folder.</li>
                    <li>Copy macros.conf file inside local folder from default folder.</li>
                    <li>Replace <b>definition = ()</b> with <b>definition = index = your_index</b> under nexus_index stanza.</li>
                  </ul>
                  <li>Restart Splunk</li>
        			  </ul>
                <p><b>Note: </b>If the previous version of App is already installed, remove the cisco-app-Nexus-9k folder from Splunk app folder before installation of newer version or the user can upgrade the app from Splunk UI.
                Further details related to upgradation are mentioned in the below stanza.</p>

                <p class="list-description">Installation of Add-on App</p>
        		      <ul>
              			<li>Add-on app can be installed either through UI through "Manage Apps" or by extracting zip file into <i>/opt/splunk/etc/apps</i> folder.</li>
                		<li>Enable Data collector Scripts using "<i>input.conf</i>" (default disabled = 0) or through UI (Settings -&gt; DataInputs -&gt; Scripts).</li>	
                    <li>Restart Splunk</li>
                  </ul>
                  <p><b>Note: </b>If the previous version of App is already installed, remove the TA_cisco-Nexus-9k folder from Splunk app folder before installation of newer version or the user can upgrade the app from Splunk UI.
                  Further details related to upgradation are mentioned in upgradation section.</p>
                <div id="toolkitvisualizations-list" class="toolkit-item-list clearfix">
                    <!-- Tooklkit Visualizations pages here -->
                </div>
                <div id="toolkitvisualizations-end"/>
            </div>

            <div id="upgradation" class="toolkit-section clearfix">
              <h3>Upgradation</h3>
              <p class="list-description">Upgradation of Main App</p>
              <ul>
                  <li>After upgrading the app from version 1.0/1.1 to the latest version, credentials.csv file will not be available (from which custom command read credentials), instead device credentials will be configured through setup page and custom command will fetch credentials for switch from Splunk's \storage\passwords endpoint.</li>
                  <li>Also, after upgradation it should be ensured that index, sourcetype and interval must be mentioned for each input in local/inputs.conf.</li>
                </ul>

                <p class="list-description">Upgradation of Add-on App</p>
                  <ul>
                    <li>After upgrading the app from version 1.0/1.1 to the latest version, the user needs to create custom index named n9000, because on upgrading n9000 index will be deleted, thus custom index is to be created to retrieve existing indexed data.</li>
                    <li>The app data defaults to 'main' index.</li>
                    <li>If you need to specify a particular index for your Nexus 9k data, for ex. n9000 follow below steps:</li>
                    <ul>
                    <li>If local folder does not exists, then create local folder inside $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k folder.</li>
                    <li>Create an indexes.conf file inside local folder.</li>
                    <li>Add following stanza inside indexes.conf file (<b>when index name is n9000</b>):</li>
                      <ul>
                        <li>[n9000]</li>
                        <li>coldPath = $SPLUNK_DB/n9000/colddb</li>
                        <li>homePath = $SPLUNK_DB/n9000/db</li>
                        <li>thawedPath = $SPLUNK_DB/n9000/thaweddb</li>
                      </ul>
                    <li>Restart Splunk.</li>
                    </ul>
                    <li>Also, after upgradation it should be ensured that index, sourcetype and interval must be mentioned for each input in local/inputs.conf.</li>
                    <li><b>If Add-on is configured on Windows environment, follow below steps:</b></li>
                      <ul>
                        <li>Copy the content of "default/inputs.conf.WINDOWS" to "default/inputs.conf"</li>
                        <li>Restart Splunk</li>
                      </ul>
        		      </ul>
                <div id="toolkitvisualizations-list" class="toolkit-item-list clearfix">
                    <!-- Tooklkit Visualizations pages here -->
                </div>
                <div id="toolkitvisualizations-end"/>
            </div> 

            <div id="config" class="toolkit-section clearfix">
              <h3>Configuration</h3>
	            <p>Configuration of Main App</p>
              <ul> 
                <li>When app is installed or there is no local/passwords.conf file found, then user will be redirected to setup page containing ip address, username, password.He/She won't be able to view dashboards untill credentials are not provided.</li>
                <li>If user wants to enter more credentials then he/she can go to Apps->Manage Apps->Set up cisco-app-Nexus-9k.It will open a set up screen which will ask for credentials.</li>
                <li>Splunk REST API will encrypt the password and store it in app itself(local/passwords.conf) in encrypted form, nxapicollector custom command will fetch these credentials through REST API to connect to the Nexus 9k.</li>
              </ul> 
              <p>
                <b>Note: </b>Whenever user wants to change the credentials, he/she needs to remove the current entry from directory cisco-app-Nexus-9k/local/passwords.conf first, restart the splunk then provide the credentials through UI. (This time credentials will be asked when app is opened for first time.)
              </p>
	            <p>Configuration of Add-on App</p>
              <ul>
                <li>After installation, go to the Apps-&gt;Manage Apps-&gt;Set up TA_cisco-Nexus-9k.It will open a  set up screen  which will ask for Nexus9k credentials.Please provide ip address, username, password and save them.</li>
                <li>Splunk REST API will encrypt the password and store it in app itself(local/passwords.conf) in encrypted form, Data collector script will fetch these credentials through REST API to connect to the Nexus 9k.</li>
                </ul>
                <p>Splunk App and Add-on, by default, supports <b>https</b> scheme for all its calls between the Nexus 9k switch and Splunk. If your switch is <b>http</b> configured, perform below steps:</p>
                <ul>
                  <li>Copy default/cisco_nexus_setup.conf file in your local folder.</li>
                  <li>Change the value of HTTP_SCHEME to http in your local/cisco_nexus_setup.conf file.</li>
                  <li>Restart Splunk</li>
                </ul>

              <p>
                <b>Note: </b>Whenever user wants to change the credentials, he/she needs to remove the current entry from directory TA_cisco-Nexus-9k/local/passwords.conf  first, restart the splunk then  provide the credentials through UI(This time from Apps-&gt;"Manage Apps"-&gt;Set up TA_cisco-Nexus-9k).</p>
	            <p>1) inputs.conf</p>
	            <p>This file contains filename paths which are different based on your OS platform. The app is configured out of the box to work for Unix/Linux/Mac OS systems. If you are running this app on a Windows system, perform the following steps:</p>
	            <pre>Copy the content of "default/inputs.conf.WINDOWS" to "default/inputs.conf" <br/>Now, Copy and Paste that default/inputs.conf to local/inputs.conf</pre>
              <p>Each entry in this file contains one field with name <b>passAuth</b> and its default value is admin.Basically, value of this field  is  used by collector script to fetch the credentials of Nexus 9k through REST API.User can assign any splunk username here but please make sure that username is having admin privileges to access the credentials through REST API.</p>
        
	            <p>2) input.txt</p>
            	<p>Write your CLI in this file. You can also give component name(optional). This will be helpful in filtering events based on your CLI.</p>
            	<p>
                <code>show module, nxmodule</code>
              </p>
            	<p>where <i>show module</i> is your cli and <i>nxmodule</i> is component.</p>
            	<p><b>Integration of Nexus 9k syslog messages with Splunk</b></p>
            	<b/>
            	<p>This app is also configured to receive syslog on udp port 514 with default splunk settings for syslog and then re-direct the logs to the app</p>
            	<ul>
            	  <li>Configure from UI</li>
            	  <ul>
            	    <li>Go to Settings->Data Inputs and click on UDP</li>
            	    <li>Click on <b>New Local UDP</b> to create UDP data input</li>
            	    <li>Configure UDP Port=514 for syslog</li>
            	    <li>Click on Next button</li>
            	    <li>Select Sourcetype=syslog, App Context=Cisco Nexus 9k Add-on for Splunk Enterprise and index=<b>index_name</b></li>
            	    <li>Click on Review button</li>
            	    <li>Click on Submit button</li>
            	  </ul>
            	  <li>Configure from Backend</li>
            	  <ul>
            	    <li>Add/Update inputs.conf in $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k/local folder</li>
            	    <li>Enter below content to inputs.conf</li>
            	    <pre>[udp://514]<br/>index = index_name<br/>sourcetype = syslog<br/>disabled = 0</pre>
            	    <li>Restart Splunk</li>
            	  </ul>
            	  <br/>
          	  </ul>
              <p><b>Note: </b> If you want to index data in different sourcetype, perform below steps:</p>
          	  <ul>
            	  <li>Change below content in $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k/local/inputs.conf</li>
            	  <pre>[udp://514]<br/>index = index_name<br/>sourcetype = your_sourcetype<br/>disabled = 0</pre>
            	  <li>Copy the content from $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k/default/eventtypes.conf to $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k/local/eventtypes.conf</li>
            	  <li>Change the sourcetype in your local/eventtypes.conf</li>
            	  <pre>[cisco_nexus_syslog]<br/>search = sourcetype=your_sourcetype</pre>
            	  <li>Restart Splunk</li>
          	  </ul>
              <div id="basiccomponents-list" class="toolkit-item-list clearfix"/>
            </div>
   
            <div id="examples" class="toolkit-section clearfix">
              <h3>Test your installation</h3>
              <p class="list-description">
        		  The main app dashboard can take some time before the data is returned which will populate some of the panels. A good test to see that you are receiving all of the data we expect is to run this search after several minutes:<br/>
        	      <pre>index="main" | stats count by sourcetype</pre>
        	    </p>
            	<p>
            		In particular, you should see the following sourcetype<br/>
            		<code>cisco:nexus:json</code>
            	</p>
            	<p>
            		If you don't see these sourcetypes, have a look at the messages output by the scripted input: collect.py. Here is a sample search that will show them:
            	<pre>index=_internal component="ExecProcessor" collect.py "Nexus Error"| table _time host log_level message</pre>
            	</p>
              <div id="toolkitvisualizations-list" class="toolkit-item-list clearfix">
                  <!-- Tooklkit Visualizations pages here -->
              </div>
              <div id="toolkitvisualizations-end"/>
            </div>
    
            <div id="datagen" class="toolkit-section clearfix">
              <h3>Data Generator</h3>
              <p class="list-description">
                <p>This app is provided with sample data which can be used to generate dummy data. To simulate this sample data, first of all Splunk Event generator, which is available at <a href="https://github.com/splunk/eventgen"> https://github.com/splunk/eventgen</a>, needs to be installed at $SPLUNK_HOME/etc/apps/. This app generates the dummy data for Cisco Nexus 9k switches and populates the dashboards of main app with the dummy data.</p>
              </p>
              <div id="datagen-list" class="toolkit-item-list clearfix">
                    <!-- Examples pages here -->
              </div>
              <div id="datagen-end"/>
            </div>
  

            <div id="about" class="toolkit-section clearfix">
            	<h3>About the data</h3>
            	<p class="list-description">
            		You can see what each event looks like by going to $SPLUNK_HOME/etc/apps/TA_cisco-Nexus-9k/bin and executing collect.py</p>
            	<p>
            		Field names are case sensitive in the nexus 9k. Every event starts with the timestamp, and always contains device from which that particular event came.For simplification we can add one additional field in each event  named "component" and provide appropriate value to it so that we can easily segregate the data on the basis of its component name.
            	</p>
            	<p>
            		Sample event records is as below. It gives system resource details in Json format.
            	</p>
            	<pre>
    {"device": "x.x.x.x", "timestamp": "2014-06-23 01:20:19", "Row_info": {"cpuid": "0", "kernel": "0.99", "idle": "99.00", "user": "0.00"}, "component": "nxresource"}
    {"device": "x.x.x.x", "timestamp": "2014-06-23 01:20:19", "Row_info": {"cpuid": "1", "kernel": "0.00", "idle": "100.00", "user": "0.00"}, "component": "nxresource"}
    {"device": "x.x.x.x", "timestamp": "2014-06-23 01:20:19", "Row_info": {"cpuid": "2", "kernel": "0.00", "idle": "100.00", "user": "0.00"}, "component": "nxresource"}
    {"device": "x.x.x.x", "timestamp": "2014-06-23 01:20:19", "Row_info": {"cpuid": "3", "kernel": "0.00", "idle": "100.00", "user": "0.00"}, "component": "nxresource"}
            	</pre>
	          </div>
	        </div>
      </html>
    </panel>
  </row>
</dashboard>
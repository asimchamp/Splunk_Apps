<dashboard>
  <label>Volumes</label>
  <row>
    <panel>
      <table>
        <search>
          <query>source="nimble:rest:volumes_detail" |  eval dataGB=round(vol_usage_compressed_bytes/1024/1024/1024, 1) | eval compression=round((vol_usage_uncompressed_bytes+snap_usage_uncompressed_bytes)/(vol_usage_compressed_bytes+snap_usage_compressed_bytes), 1) |  eval snapGB=round(snap_usage_compressed_bytes/1024/1024/1024, 1) | stats latest(host) as Array, latest(clone) as Clone, latest(read_only) As "Read Only", latest(dataGB) as "Data (GB)", latest(snapGB) as "Snap (GB)", latest(compression) as "Compression (X)", latest(num_connections) as Connections by name | rename name as Name | eval Clone=if(Clone == true, "Yes", "No") | eval "Read Only"=if("Read Only" == true, "Yes", "No")  | sort Array</query>
          <earliest>-4h@m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">20</option>
        <drilldown>
          <set token="volName">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Connections for $volName$</title>
        <search>
          <query>source="nimble:rest:volumes_detail" | spath name | search name=$volName$ | head 1 | spath iscsi_sessions{}.initiator_ip_addr output="Initiator IP" | spath iscsi_sessions{}.target_ip_addr output="Target IP" | spath iscsi_sessions{}.num_connections output="Connections" | spath iscsi_sessions{}.initiator_name output="Initiator" | table "Initiator IP", "Target IP", "Connections", "Initiator"</query>
          <earliest>-4h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">cell</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
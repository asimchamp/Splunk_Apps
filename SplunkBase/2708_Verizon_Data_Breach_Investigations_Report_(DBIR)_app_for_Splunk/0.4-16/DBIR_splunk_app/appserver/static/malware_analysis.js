//Translations for en_US
i18n_register({"plural": function(n) { return n == 1 ? 0 : 1; }, "catalog": {}});

require.config({
    paths: {
        mv_field_cell_renderer: '../app/DBIR_splunk_app/js/views/MVFieldExpansionCellRenderer',
        extra_field_row_renderer: '../app/DBIR_splunk_app/js/views/ExtraFieldExpansionRowRenderer',
    }
});

require(['jquery','underscore', 'splunkjs/mvc', 'mv_field_cell_renderer', 'extra_field_row_renderer', 'splunkjs/mvc/tableview', 'splunkjs/mvc/chartview', 'splunkjs/mvc/searchmanager', 'bootstrap.tab', 'bootstrap.dropdown', 'splunkjs/mvc/simplexml/ready!'],
		function($, _, mvc, MVFieldExpansionCellRenderer, ExtraFieldExpansionRowRenderer, TableView, ChartView, SearchManager){

	/*-------------------------- Setup the cell renderer --------------------------*/
    
    var mvTableRender = function(tableView){
        tableView.table.addCellRenderer(new MVFieldExpansionCellRenderer());
        tableView.table.render();
    };
    
    var setupTableRenderer = function(table){
    	
    	var component = mvc.Components.get(table.id);
    	
    	if( component && mvc.Components.get(table.id).el && mvc.Components.get(table.id).el.className.indexOf("dashboard-element table splunk-view") >= 0){
    		component.getVisualization(mvTableRender);
    	}
    };
    
    _.each(mvc.Components.attributes, setupTableRenderer);


    /*-------------------------- Setup the row renderer --------------------------*/

	var makeRowRenderer = function(columns) {
		return function(tableView) {
			var renderer = new ExtraFieldExpansionRowRenderer({fieldsToShowCount:columns});
			tableView.table.addRowExpansionRenderer(renderer);
			tableView.table.render();

			renderer.hideExtraColumns(tableView.table.cid);
		};
	};

	// Affected Systems
	mvc.Components.get('element1').getVisualization(makeRowRenderer(5));

	// Affected Users
	mvc.Components.get('element2').getVisualization(makeRowRenderer(4));
});
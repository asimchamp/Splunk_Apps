
[device_state_update]
alert.digest_mode = True
alert.suppress = 0
alert.track = 0
auto_summarize.dispatch.earliest_time = -1d@h
cron_schedule = * * * * *
description = Update file with last time all sources reported logs.
dispatch.earliest_time = -13h
dispatch.latest_time = now
enableSched = 1
search= | tstats max(_time) as _time, count where index=_* OR index=* by host,source,index | inputlookup append=t statefile.csv | stats max(_time) as _time by host, source, index | eval Status=if(now()-43200>_time, "Error", "Success") | sort Status, _time | outputlookup statefile.csv
iseval = 0

[device_state_update_population]
search= | tstats max(_time) as _time, count where index=_* OR index=* by host,source,index | inputlookup append=t statefile.csv | stats max(_time) as _time by host, source, index | eval Status=if(now()-43200>_time, "Error", "Success") | sort Status, _time | outputlookup statefile.csv
iseval = 0
dispatch.earliest_time = 1
dispatch.latest_time = now
run_on_startup = true

[current_device_state]
search = | inputlookup statefile.csv | eval _time=strftime(_time, "%H:%M:%S, %Y-%m-%d") | rename _time AS "Last Event Time" 
dispatch.earliest_time = -5m
dispatch.latest_time = now

[device_state_alert]
alert_condition = search Status="Error"
alert.digest_mode = False
alert.expires = 12h
alert.severity = 4
alert.suppress = 1
alert.suppress.fields = source, host
alert.suppress.period = 12h
alert.track = 1
auto_summarize.dispatch.earliest_time = -1d@h
cron_schedule = * * * * *
description = Display all devices that have not reported in over 12 hours.
dispatch.earliest_time = -5m
dispatch.latest_time = now
enableSched = 1
search = | inputlookup statefile.csv | eval _time=strftime(_time, "%H:%M:%S, %Y-%m-%d") | rename _time AS "Last Event Time" | where (Status="Error")


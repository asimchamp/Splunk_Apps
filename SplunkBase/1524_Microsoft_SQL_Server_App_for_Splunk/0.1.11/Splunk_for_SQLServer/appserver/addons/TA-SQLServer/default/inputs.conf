# This Technology Add-on assumes that the following Add-ons are already deployed
#
#   Splunk_TA_windows
#   SA-ModularInput-Windows
#
[WinEventLog:Microsoft-Windows-FailoverClustering]
disabled = 0
index = mssql
start_from = oldest
current_only = 0
checkpointInterval = 5

[powershell://DBInstances]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\dbinstances.ps1"
schedule = 0 */5 * ? * *
index = mssql
sourcetype = MSSQL:Instance:Information
source = Powershell

[powershell://Databases]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\databases.ps1"
schedule = 30 */5 * ? * *
index = mssql
sourcetype = MSSQL:Database:Information
source = Powershell

[powershell://DBUsers]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\dbusers.ps1"
schedule = 10 */5 * ? * *
index = mssql
sourcetype = MSSQL:Instance:User
source = Powershell

[powershell://DBHealth]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\dbhealth.ps1"
schedule = 15 */5 * ? * *
index = mssql
sourcetype = MSSQL:Database:Health
source = Powershell

[powershell://SQLServices]
script = Get-Service *SQL* | Select Name,DisplayName,Status
schedule = 45 * * ? * *
index = mssql
sourcetype = MSSQL:Instance:Service
source = Powershell

[powershell://HostInformation]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\hostinfo.ps1"
schedule = 30 */15 ? * *
index = mssql
sourcetype = MSSQL:Host:Information
source = Powershell

[powershell://Memory]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\memory.ps1"
schedule = 10 * * ? * *
index = mssql
sourcetype = MSSQL:Host:Memory
source = Powershell

[powershell://IndexStats]
script = & "$SplunkHome\etc\apps\TA-SQLServer\bin\Invoke-MonitoredScript.ps1" -Command ".\indexhealth.ps1"
schedule = 45 */10 * ? * *
index = mssql
sourcetype = Powershell
source = Powershell

#
# Standard Processor / Memory / Disk space usage
# #
[perfmon://Processor]
object = Processor
counters = % Processor Time
instances = _Total
interval = 60
index = perfmon
disabled = false

[perfmon://LogicalDisk]
object = LogicalDisk
counters = % Free Space; Disk Reads/sec; Disk Writes/sec; Avg. Disk sec/Read; Avg. Disk sec/Write; Avg. Disk sec/Transfer; Disk Read Bytes/sec; Disk Write Bytes/sec;Avg. Disk Queue Length
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://Network]
object = Network Interface
counters = Current Bandwidth; Bytes Total/sec
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://Memory]
object = Memory
counters = % Committed Bytes In Use;Pages/sec
interval = 60
index = perfmon
disabled = false

#
# MSSQL Statistics that do not change with the instance name
# 
[perfmon://SQLServer:Databases]
object = SQLServer:Databases
counters = *
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:Buffer Manager]
object = SQLServer:Buffer Manager
counters = *
interval = 30
index = perfmon
disabled = false

[perfmon://Process-SQL]
object = Process
counters = Private Bytes;% Processor Time
instances = *
interval = 60
index = perfmon
disabled = false
mode = multikv

#
# MSSQL Statistics that do change with the instance name (need Splunk 6 Universal Forwarder for these)
# 
[perfmon://SQLAgentV:Jobs]
object = SQLAgent[^:]*:Jobs
counters = Active jobs;Failed jobs;Queued jobs;Successful jobs
interval = 60
index = perfmon
disabled = false

[perfmon://SQLAgent:Jobs]
object = SQLAgent:Jobs
counters = Active jobs;Failed jobs;Queued jobs;Successful jobs
interval = 60
index = perfmon
disabled = false

[perfmon://MSSQL:Databases]
object = MSSQL[^:]*:Databases
counter = Active Transactions;Data File(s) Size (KB);Log File(s) Size (KB);Log File(s) Used Size (KB);Transactions/sec
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:Databases]
object = SQLServer:Databases
counter = Active Transactions;Data File(s) Size (KB);Log File(s) Size (KB);Log File(s) Used Size (KB);Transactions/sec
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://MSSQL:General Statistics]
object = MSSQL[^:]*:General Statistics
counters = User Connections;Processes blocked
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:General Statistics]
object = SQLServer:General Statistics
counters = User Connections;Processes blocked
interval = 60
index = perfmon
disabled = false

[perfmon://MSSQL:SQL Errors]
object = MSSQL[^:]*:SQL Errors
counters = Errors/sec
instances = DB Offline Errors;Info Errors;Kill Connection Errors;User Errors;_Total
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:SQL Errors]
object = SQLServer:SQL Errors
counters = Errors/sec
instances = DB Offline Errors;Info Errors;Kill Connection Errors;User Errors;_Total
interval = 60
index = perfmon
disabled = false

[perfmon://MSSQL:Locks]
object = MSSQL[^:]*:Locks
counters = Number of Deadlocks/sec;Average Wait Time (ms)
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:Locks]
object = SQLServer:Locks
counters = Number of Deadlocks/sec;Average Wait Time (ms)
instances = *
interval = 60
index = perfmon
disabled = false

[perfmon://MSSQL:Transactions]
object = MSSQL[^:]*:Transactions
counters = Transactions; Longest Transaction Running Time
interval = 60
index = perfmon
disabled = false

[perfmon://SQLServer:Transactions]
object = SQLServer:Transactions
counters = Transactions; Longest Transaction Running Time
interval = 60
index = perfmon
disabled = false


<form version="1.1">
  <label>HSM Statistics</label>
  <description></description>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" token="selectedHost" searchWhenChanged="true">
      <label>Select Appliance</label>
      <search>
        <query>| savedsearch "HSM Appliance List"</query>
        <earliest>-2h@h</earliest>
        <latest>now</latest>
        <!--<done>-->
        <!--  <set token="defaultHost">$result.host$</set>-->
        <!--</done>-->
      </search>
      <fieldForLabel>host</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <default></default>
      <!--<default>$defaultHost$</default>-->
      <change>
        <condition match="len($value$) == 0"></condition>
        <condition match="len($value$) > 0">
          <set token="submittedHost">$value$</set>
        </condition>
      </change>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Crypto Operations Frequency</title>
      <chart>
        <search ref="HSM Operations Frequency"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
    <panel>
      <title>HSM Utilization (%)</title>
      <chart>
        <search ref="HSM Utilization"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>HSM Operation Errors Frequency</title>
      <chart>
        <search ref="HSM Operation Errors"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
    <panel>
      <title>HSM Command Count Frequency</title>
      <chart>
        <search ref="HSM Command Count"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>HSM Operational State</title>
      <chart>
        <search ref="HSM Operational State"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
    <panel>
      <title>HSM Successful Client Connections</title>
      <chart>
        <search ref="NTLS successful client connections"></search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>HSM Failed Client Connections</title>
      <chart>
        <search>
          <query>index=hsm_operation ntlsFailedClientConnections=* host=$submittedHost$ | head 1 | stats values(ntlsFailedClientConnections) | rangemap field=ntlsFailedClientConnections low=0-3 elevated=4-20 default=severe</query>
          <earliest>-2h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
    <panel>
      <title>HSM Connected Clients</title>
      <chart>
        <search>
          <query>index=hsm_operation HSM_Connected_Clients=* host=$submittedHost$ | head 1 | stats values(HSM_Connected_Clients) as HSM_Connected_Clients | rangemap field=HSM_Connected_Clients low=0-50 elevated=50-2000 default=severe</query>
          <earliest>-2h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>
</form>

[Audit - Most Updated Documents]
search = eventtype=mssharepoint-audit ItemType=1 Event=5 | `IgnoreExtensions` | top limit=20 FarmId,SiteId,DocLocation | lookup SPFarm Id AS FarmId OUTPUTNEW DisplayName as FarmName | lookup SPSite FarmId Id AS SiteId OUTPUTNEW Url | table FarmName,Url,DocLocation,count,percent | eval percent=round(percent,2) | rename count AS Updates
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false


[SharePoint Exception - By Area]
search = eventtype=mssharepoint-uls Exception | top Area
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false

[SharePoint Exception - By Category]
search = eventtype=mssharepoint-uls Exception | top Category
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false

[SharePoint Exception - By Level]
search = eventtype=mssharepoint-uls Exception | top Level
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false

[SharePoint Exception - By Process]
search = eventtype=mssharepoint-uls Exception | top Process_Name
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false

[SharePoint Exception - By host]
search = eventtype=mssharepoint-uls Exception | top host
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false

[SharePoint Exception - By Message]
search = eventtype=mssharepoint-uls Exception | eval ExceptionMessage = replace(Message, "[:\.].*", "") | top ExceptionMessage
dispatch.earliest_time = -24h
dispatch.latest_time = now
is_visible = false
disabled = false


[Lookup - Host Information]
search = eventtype=mssharepoint-hostinfo | stats latest(_time) as _time, latest(BuildNumber) as OSBuildNumber, latest(Version) as OSVersion, latest(SerialNumber) as OSSerialNumber, latest(Name) as ComputerName, latest(Domain) as ComputerDomain, latest(TotalPhysicalMemoryKB) as TotalPhysicalMemoryKB, latest(data) as SharedToolsVersion by host | outputlookup SPHostInfo
dispatch.latest_time = now
enableSched = false

[Accumulator - Host Information]
search = eventtype=mssharepoint-hostinfo | stats latest(_time) as _time, latest(BuildNumber) as OSBuildNumber, latest(Version) as OSVersion, latest(SerialNumber) as OSSerialNumber, latest(Name) as ComputerName, latest(Domain) as ComputerDomain, latest(TotalPhysicalMemoryKB) as TotalPhysicalMemoryKB, latest(data) as SharedToolsVersion by host | inputlookup append=T SPHostInfo | sort _time | stats latest(_time) as _time, latest(OSBuildNumber) as OSBuildNumber, latest(OSVersion) as OSVersion, latest(OSSerialNumber) as OSSerialNumber, latest(ComputerName) as ComputerName, latest(ComputerDomain) as ComputerDomain, latest(TotalPhysicalMemoryKB) as TotalPhysicalMemoryKB, latest(SharedToolsVersion) as SharedToolsVersion by host | outputlookup SPHostInfo
cron_schedule = 33 * * * *
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = true
run_on_startup = true
is_visible = false

#
# Rebuilder for SPApplicationPool Lookup
#
[Lookup - SPApplicationPool]
search = eventtype=mssharepoint-inventory Type="ApplicationPool" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Username) as Username, latest(CurrentIdentityType) as CurrentIdentityType, latest(CurrentSecurityIdentifier) as CurrentSecurityIdentifier, latest(IsCredentialUpdateEnabled) as IsCredentialUpdateEnabled, latest(IsCredentialDeploymentEnabled) as IsCredentialDeploymentEnabled by FarmId, WebApplicationId, Id | where Action != "Delete" | outputlookup SPApplicationPool
dispatch.latest_time = now
enableSched = false

#
# Accumulator for SPApplicationPool Lookup
#
[Accumulator - SPApplicationPool]
search = eventtype=mssharepoint-inventory Type="ApplicationPool" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Username) as Username, latest(CurrentIdentityType) as CurrentIdentityType, latest(CurrentSecurityIdentifier) as CurrentSecurityIdentifier, latest(IsCredentialUpdateEnabled) as IsCredentialUpdateEnabled, latest(IsCredentialDeploymentEnabled) as IsCredentialDeploymentEnabled by FarmId, WebApplicationId, Id | inputlookup append=T SPApplicationPool | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Username) as Username, latest(CurrentIdentityType) as CurrentIdentityType, latest(CurrentSecurityIdentifier) as CurrentSecurityIdentifier, latest(IsCredentialUpdateEnabled) as IsCredentialUpdateEnabled, latest(IsCredentialDeploymentEnabled) as IsCredentialDeploymentEnabled by FarmId, WebApplicationId, Id | where Action != "Delete" | outputlookup SPApplicationPool
cron_schedule = 39 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for the SPContentDatabase
#
[Lookup - SPContentDatabase]
search = eventtype=mssharepoint-inventory Type="ContentDatabase" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(CurrentSiteCount) as CurrentSiteCount, latest(MaximumSiteCount) as MaximumSiteCount, latest(WarningSiteCount) as WarningSiteCount, latest(DatabaseConnectionString) as DatabaseConnectionString, latest(DiskSizeRequired) as DiskSizeRequired, latest(Exists) as Exists, latest(ExistsInFarm) as ExistsInFarm, latest(FailoverServer) as FailoverServer, latest(FailoverServiceInstance) as FailoverServiceInstance, latest(IncludeInVssBackup) as IncludeInVssBackup, latest(IsAttachedToFarm) as IsAttachedToFarm, latest(IsReadOnly) as IsReadOnly, latest(NormalizedDataSource) as NormalizedDataSource, latest(Server) as Server, latest(WebApplicationId) as WebApplicationId by FarmId, Id | where Action != "Delete" | outputlookup SPContentDatabase
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPContentDatabase
#
[Accumulater - SPContentDatabase]
search = eventtype=mssharepoint-inventory Type="ContentDatabase" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(CurrentSiteCount) as CurrentSiteCount, latest(MaximumSiteCount) as MaximumSiteCount, latest(WarningSiteCount) as WarningSiteCount, latest(DatabaseConnectionString) as DatabaseConnectionString, latest(DiskSizeRequired) as DiskSizeRequired, latest(Exists) as Exists, latest(ExistsInFarm) as ExistsInFarm, latest(FailoverServer) as FailoverServer, latest(FailoverServiceInstance) as FailoverServiceInstance, latest(IncludeInVssBackup) as IncludeInVssBackup, latest(IsAttachedToFarm) as IsAttachedToFarm, latest(IsReadOnly) as IsReadOnly, latest(NormalizedDataSource) as NormalizedDataSource, latest(Server) as Server, latest(WebApplicationId) as WebApplicationId by FarmId, Id | inputlookup append=T SPContentDatabase | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(CurrentSiteCount) as CurrentSiteCount, latest(MaximumSiteCount) as MaximumSiteCount, latest(WarningSiteCount) as WarningSiteCount, latest(DatabaseConnectionString) as DatabaseConnectionString, latest(DiskSizeRequired) as DiskSizeRequired, latest(Exists) as Exists, latest(ExistsInFarm) as ExistsInFarm, latest(FailoverServer) as FailoverServer, latest(FailoverServiceInstance) as FailoverServiceInstance, latest(IncludeInVssBackup) as IncludeInVssBackup, latest(IsAttachedToFarm) as IsAttachedToFarm, latest(IsReadOnly) as IsReadOnly, latest(NormalizedDataSource) as NormalizedDataSource, latest(Server) as Server, latest(WebApplicationId) as WebApplicationId by FarmId, Id | where Action != "Delete" | outputlookup SPContentDatabase
cron_schedule = 2 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for SPFarm Lookup
#
[Lookup - SPFarm]
search = eventtype=mssharepoint-inventory Type="Farm" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(BuildVersion) as BuildVersion, latest(DiskSizeRequired) as DiskSizeRequired, latest(PersistedFileChunkSize) as PersistedFileChunkSize, latest(CEIPEnabled) as CEIPEnabled, latest(DefaultServiceAccount) as DefaultServiceAccount, latest(DownloadErrorReportingUpdates) as DownloadErrorReportingUpdates, latest(ErrorReportingAutomaticUpload) as ErrorReportingAutomaticUpload, latest(ErrorReportingEnabled) as ErrorReportingEnabled, latest(IsBackwardsCompatible) as IsBackwardsCompatible, latest(PasswordChangeEmailAddress) as PasswordChangeEmailAddress, latest(PassswordChangeGuardTime) as PassswordChangeGuardTime, latest(PasswordChangeMaximumTries) as PasswordChangeMaximumTries, latest(DaysBeforePasswordExpirationToSendEmail) as DaysBeforePasswordExpirationToSendEmail by Id | where Action != "Delete" | outputlookup SPFarm
dispatch.latest_time = now
enableSched = false

#
# Accumulater for SPFarm Lookup
#
[Accumulator - SPFarm]
search = eventtype=mssharepoint-inventory Type="Farm" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(BuildVersion) as BuildVersion, latest(DiskSizeRequired) as DiskSizeRequired, latest(PersistedFileChunkSize) as PersistedFileChunkSize, latest(CEIPEnabled) as CEIPEnabled, latest(DefaultServiceAccount) as DefaultServiceAccount, latest(DownloadErrorReportingUpdates) as DownloadErrorReportingUpdates, latest(ErrorReportingAutomaticUpload) as ErrorReportingAutomaticUpload, latest(ErrorReportingEnabled) as ErrorReportingEnabled, latest(IsBackwardsCompatible) as IsBackwardsCompatible, latest(PasswordChangeEmailAddress) as PasswordChangeEmailAddress, latest(PassswordChangeGuardTime) as PassswordChangeGuardTime, latest(PasswordChangeMaximumTries) as PasswordChangeMaximumTries, latest(DaysBeforePasswordExpirationToSendEmail) as DaysBeforePasswordExpirationToSendEmail by Id | inputlookup append=T SPFarm | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(BuildVersion) as BuildVersion, latest(DiskSizeRequired) as DiskSizeRequired, latest(PersistedFileChunkSize) as PersistedFileChunkSize, latest(CEIPEnabled) as CEIPEnabled, latest(DefaultServiceAccount) as DefaultServiceAccount, latest(DownloadErrorReportingUpdates) as DownloadErrorReportingUpdates, latest(ErrorReportingAutomaticUpload) as ErrorReportingAutomaticUpload, latest(ErrorReportingEnabled) as ErrorReportingEnabled, latest(IsBackwardsCompatible) as IsBackwardsCompatible, latest(PasswordChangeEmailAddress) as PasswordChangeEmailAddress, latest(PassswordChangeGuardTime) as PassswordChangeGuardTime, latest(PasswordChangeMaximumTries) as PasswordChangeMaximumTries, latest(DaysBeforePasswordExpirationToSendEmail) as DaysBeforePasswordExpirationToSendEmail by Id | where Action != "Delete" | outputlookup SPFarm
cron_schedule = 5 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false
[Lookup - IP Address]
search = sourcetype=WinRegistry registry_type="baseline" key_path="\\REGISTRY\\MACHINE\\SYSTEM\\CURRENTCONTROLSET\\SERVICES\\TCPIP\\PARAMETERS\\INTERFACES\\*IPAddress" | rex field=key_path "{(?<InterfaceGUID>[^}]+)" | stats latest(_time) as _time,latest(data) as IPAddress by host,InterfaceGUID | outputlookup SPIPAddress
dispatch.latest_time = now
enableSched = false

[Accumulator - IP Address]
search = sourcetype=WinRegistry registry_type="baseline" key_path="\\REGISTRY\\MACHINE\\SYSTEM\\CURRENTCONTROLSET\\SERVICES\\TCPIP\\PARAMETERS\\INTERFACES\\*IPAddress" | rex field=key_path "{(?<InterfaceGUID>[^}]+)" | stats latest(_time) as _time,latest(data) as IPAddress by host,InterfaceGUID | inputlookup append=T SPIPAddress | sort _time | stats latest(_time) as _time,latest(IPAddress) as IPAddress by host,InterfaceGUID | outputlookup SPIPAddress
cron_schedule = 33 * * * *
dispatch.earliest_time = -24h
dispatch.latest_time = now
enableSched = true
run_on_startup = true
is_visible = false

#
# Rebuilder for the SPList Lookup
#
[Lookup - SPList]
search = eventtype=mssharepoint-inventory Type="List" | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(ItemCount) as ItemCount, latest(Hidden) as Hidden, latest(EmailAlias) as EmailAlias, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(Author) as Author, latest(Created) as Created, latest(EmailInsertsFolder) as EmailInsertsFolder, latest(EnableAssignToEmail) as EnableAssignToEmail, latest(EnableAttachments) as EnableAttachments, latest(EnableDeployingList) as EnableDeployingList, latest(EnableDeployWithDependentList) as EnableDeployWithDependentList, latest(EnableFolderCreation) as EnableFolderCreation, latest(EnableMinorVersions) as EnableMinorVersions, latest(EnableModeration) as EnableModeration, latest(EnablePeopleSelector) as EnablePeopleSelector, latest(EnableResourceSelector) as EnableResourceSelector, latest(EnableSchemaCaching) as EnableSchemaCaching, latest(EnableSyndication) as EnableSyndication, latest(EnableThrottling) as EnableThrottling, latest(EnableVersioning) as EnableVersioning, latest(EnforceDataValidation) as EnforceDataValidation, latest(ExcludeFromOfflineClient) as ExcludeFromOfflineClient, latest(ExcludeFromTemplate) as ExcludeFromTemplate, latest(ForceCheckout) as ForceCheckout, latest(HasExternalDataSource) as HasExternalDataSource, latest(ImageUrl) as ImageUrl, latest(IrmEnabled) as IrmEnabled, latest(IrmExpire) as IrmExpire, latest(IrmReject) as IrmReject, latest(IsApplicationList) as IsApplicationList, latest(IsCatalog) as IsCatalog, latest(IsSiteAssetsLibrary) as IsSiteAssetsLibrary, latest(IsThrottled) as IsThrottled, latest(LastItemDeletedDate) as LastItemDeletedDate, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(NoCrawl) as NoCrawl, latest(OnQuickLaunch) as OnQuickLaunch, latest(Ordered) as Ordered, latest(ParentWebId) as ParentWebId, latest(ReadSecurity) as ReadSecurity, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootWebOnly) as RootWebOnly, latest(SendToLocationName) as SendToLocationName, latest(SendToLocationUrl) as SendToLocationUrl, latest(ShowUser) as ShowUser, latest(Version) as Version, latest(WriteSecurity) as WriteSecurity, latest(ItemSize) as ItemSize by Id,WebId,FarmId | where Action != "Delete" | outputlookup SPList
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPList Lookup
#
[Accumulator - SPList]
search = eventtype=mssharepoint-inventory Type="List" | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(ItemCount) as ItemCount, latest(Hidden) as Hidden, latest(EmailAlias) as EmailAlias, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(Author) as Author, latest(Created) as Created, latest(EmailInsertsFolder) as EmailInsertsFolder, latest(EnableAssignToEmail) as EnableAssignToEmail, latest(EnableAttachments) as EnableAttachments, latest(EnableDeployingList) as EnableDeployingList, latest(EnableDeployWithDependentList) as EnableDeployWithDependentList, latest(EnableFolderCreation) as EnableFolderCreation, latest(EnableMinorVersions) as EnableMinorVersions, latest(EnableModeration) as EnableModeration, latest(EnablePeopleSelector) as EnablePeopleSelector, latest(EnableResourceSelector) as EnableResourceSelector, latest(EnableSchemaCaching) as EnableSchemaCaching, latest(EnableSyndication) as EnableSyndication, latest(EnableThrottling) as EnableThrottling, latest(EnableVersioning) as EnableVersioning, latest(EnforceDataValidation) as EnforceDataValidation, latest(ExcludeFromOfflineClient) as ExcludeFromOfflineClient, latest(ExcludeFromTemplate) as ExcludeFromTemplate, latest(ForceCheckout) as ForceCheckout, latest(HasExternalDataSource) as HasExternalDataSource, latest(ImageUrl) as ImageUrl, latest(IrmEnabled) as IrmEnabled, latest(IrmExpire) as IrmExpire, latest(IrmReject) as IrmReject, latest(IsApplicationList) as IsApplicationList, latest(IsCatalog) as IsCatalog, latest(IsSiteAssetsLibrary) as IsSiteAssetsLibrary, latest(IsThrottled) as IsThrottled, latest(LastItemDeletedDate) as LastItemDeletedDate, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(NoCrawl) as NoCrawl, latest(OnQuickLaunch) as OnQuickLaunch, latest(Ordered) as Ordered, latest(ParentWebId) as ParentWebId, latest(ReadSecurity) as ReadSecurity, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootWebOnly) as RootWebOnly, latest(SendToLocationName) as SendToLocationName, latest(SendToLocationUrl) as SendToLocationUrl, latest(ShowUser) as ShowUser, latest(Version) as Version, latest(WriteSecurity) as WriteSecurity, latest(ItemSize) as ItemSize by Id,WebId,FarmId | inputlookup append=T SPList | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(ItemCount) as ItemCount, latest(Hidden) as Hidden, latest(EmailAlias) as EmailAlias, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(Author) as Author, latest(Created) as Created, latest(EmailInsertsFolder) as EmailInsertsFolder, latest(EnableAssignToEmail) as EnableAssignToEmail, latest(EnableAttachments) as EnableAttachments, latest(EnableDeployingList) as EnableDeployingList, latest(EnableDeployWithDependentList) as EnableDeployWithDependentList, latest(EnableFolderCreation) as EnableFolderCreation, latest(EnableMinorVersions) as EnableMinorVersions, latest(EnableModeration) as EnableModeration, latest(EnablePeopleSelector) as EnablePeopleSelector, latest(EnableResourceSelector) as EnableResourceSelector, latest(EnableSchemaCaching) as EnableSchemaCaching, latest(EnableSyndication) as EnableSyndication, latest(EnableThrottling) as EnableThrottling, latest(EnableVersioning) as EnableVersioning, latest(EnforceDataValidation) as EnforceDataValidation, latest(ExcludeFromOfflineClient) as ExcludeFromOfflineClient, latest(ExcludeFromTemplate) as ExcludeFromTemplate, latest(ForceCheckout) as ForceCheckout, latest(HasExternalDataSource) as HasExternalDataSource, latest(ImageUrl) as ImageUrl, latest(IrmEnabled) as IrmEnabled, latest(IrmExpire) as IrmExpire, latest(IrmReject) as IrmReject, latest(IsApplicationList) as IsApplicationList, latest(IsCatalog) as IsCatalog, latest(IsSiteAssetsLibrary) as IsSiteAssetsLibrary, latest(IsThrottled) as IsThrottled, latest(LastItemDeletedDate) as LastItemDeletedDate, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(NoCrawl) as NoCrawl, latest(OnQuickLaunch) as OnQuickLaunch, latest(Ordered) as Ordered, latest(ParentWebId) as ParentWebId, latest(ReadSecurity) as ReadSecurity, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootWebOnly) as RootWebOnly, latest(SendToLocationName) as SendToLocationName, latest(SendToLocationUrl) as SendToLocationUrl, latest(ShowUser) as ShowUser, latest(Version) as Version, latest(WriteSecurity) as WriteSecurity, latest(ItemSize) as ItemSize by Id,WebId,FarmId | where Action != "Delete" | outputlookup SPList
cron_schedule = 27 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false


#
# Rebuilder for SPServer Lookup
#
[Lookup - SPServer]
search = eventtype=mssharepoint-inventory Type="Server" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Role) as Role by FarmId, Id | where Action != "Delete" | outputlookup SPServer
dispatch.latest_time = now
enableSched = false

#
# Accumulator for SPServer Lookup
#
[Accumulator - SPServer]
search = eventtype=mssharepoint-inventory Type="Server" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Role) as Role by FarmId, Id | inputlookup append=T SPServer | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Role) as Role by FarmId, Id | where Action != "Delete" | outputlookup SPServer
cron_schedule = 8 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for SPServiceInstance Lookup
#
[Lookup - SPServiceInstance]
search = eventtype=mssharepoint-inventory Type="ServiceInstance" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Hidden) as Hidden, latest(Instance) as Instance, latest(Roles) as Roles, latest(Service) as Service, latest(SystemService) as SystemService, by Server,FarmId,Id | where Action != "Delete" | outputlookup SPServiceInstance
dispatch.latest_time = now
enableSched = false

#
# Accumulater for SPServiceInstance Lookup
#
[Accumulator - SPServiceInstance]
search = eventtype=mssharepoint-inventory Type="Farm" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Hidden) as Hidden, latest(Instance) as Instance, latest(Roles) as Roles, latest(Service) as Service, latest(SystemService) as SystemService, by Server,FarmId,Id | inputlookup append=T SPServiceInstance | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Hidden) as Hidden, latest(Instance) as Instance, latest(Roles) as Roles, latest(Service) as Service, latest(SystemService) as SystemService, by Server,FarmId,Id | where Action != "Delete" | outputlookup SPServiceInstance
cron_schedule = 36 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false
#
# Rebuilder for the SPSite Lookup
#
[Lookup - SPSite]
search = eventtype=mssharepoint-inventory Type="Site" | stats latest(_time) as _time, latest(Action) as Action, latest(Url) as Url, latest(AdministrationSiteType) as AdministrationSiteType, latest(AllowDesigner) as AllowDesigner, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuditLogTrimmingCallout) as AuditLogTrimmingCallout, latest(AuditLogTrimmingRetention) as AuditLogTrimmingRetention, latest(AverageResourceUsage) as AverageResourceUsage, latest(BrowserDocumentsEnabled) as BrowserDocumentsEnabled, latest(CatchAccessDeniedException) as CatchAccessDeniedException, latest(CertificationDate) as CertificationDate, latest(ContentDatabaseId) as ContentDatabaseId, latest(CurrentResourceUsage) as CurrentResourceUsage, latest(DeadWebNotificationCount) as DeadWebNotificationCount, latest(HostHeaderIsSiteName) as HostHeaderIsSiteName, latest(HostName) as HostName, latest(IISAllowsAnonymous) as IISAllowsAnonymous, latest(Impersonating) as Impersonating, latest(LastContentModifiedDate) as LastContentModifiedDate, latest(LastSecurityModifiedDate) as LastSecurityModifiedDate, latest(LockIssue) as LockIssue, latest(Port) as Port, latest(PortalName) as PortalName, latest(PortalUrl) as PortalUrl, latest(Protocol) as Protocol, latest(QuotaID) as QuotaID, latest(InvitedUserMaximumLevel) as InvitedUserMaximumLevel, latest(StorageMaximumLevel) as StorageMaximumLevel, latest(StorageWarningLevel) as StorageWarningLevel, latest(UserCodeMaximumLevel) as UserCodeMaximumLevel, latest(UserCodeWarningLevel) as UserCodeWarningLevel, latest(ReadLocked) as ReadLocked, latest(ReadOnly) as ReadOnly, latest(ResourceQuotaExceeded) as ResourceQuotaExceeded, latest(ResourceQuotaExceededNotificationSent) as ResourceQuotaExceededNotificationSent, latest(ResourceQuotaWarningNotificationSent) as ResourceQuotaWarningNotificationSent, latest(RootWebId) as RootWebId, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(ShowURLStructure) as ShowURLStructure, latest(SystemAccount) as SystemAccount, latest(SyndicationEnabled) as SyndicationEnabled, latest(TrimAuditLog) as TrimAuditLog, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(Bandwidth) as Bandwidth, latest(DiscussionStorage) as DiscussionStorage, latest(Hits) as Hits, latest(Storage) as Storage, latest(Visits) as Visits, latest(UserAccountDirectoryPath) as UserAccountDirectoryPath, latest(UserCodeEnabled) as UserCodeEnabled, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled, latest(WebApplicationId) as WebApplicationId, latest(WriteLocked) as WriteLocked, latest(Zone) as Zone, latest(Owner) as Owner, latest(SecondaryContact) as SecondaryContact by FarmId,Id | where Action != "Delete" | outputlookup SPSite
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPSite Lookup
#
[Accumulator - SPSite]
search = eventtype=mssharepoint-inventory Type="Site" | stats latest(_time) as _time, latest(Action) as Action, latest(Url) as Url, latest(AdministrationSiteType) as AdministrationSiteType, latest(AllowDesigner) as AllowDesigner, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuditLogTrimmingCallout) as AuditLogTrimmingCallout, latest(AuditLogTrimmingRetention) as AuditLogTrimmingRetention, latest(AverageResourceUsage) as AverageResourceUsage, latest(BrowserDocumentsEnabled) as BrowserDocumentsEnabled, latest(CatchAccessDeniedException) as CatchAccessDeniedException, latest(CertificationDate) as CertificationDate, latest(ContentDatabaseId) as ContentDatabaseId, latest(CurrentResourceUsage) as CurrentResourceUsage, latest(DeadWebNotificationCount) as DeadWebNotificationCount, latest(HostHeaderIsSiteName) as HostHeaderIsSiteName, latest(HostName) as HostName, latest(IISAllowsAnonymous) as IISAllowsAnonymous, latest(Impersonating) as Impersonating, latest(LastContentModifiedDate) as LastContentModifiedDate, latest(LastSecurityModifiedDate) as LastSecurityModifiedDate, latest(LockIssue) as LockIssue, latest(Port) as Port, latest(PortalName) as PortalName, latest(PortalUrl) as PortalUrl, latest(Protocol) as Protocol, latest(QuotaID) as QuotaID, latest(InvitedUserMaximumLevel) as InvitedUserMaximumLevel, latest(StorageMaximumLevel) as StorageMaximumLevel, latest(StorageWarningLevel) as StorageWarningLevel, latest(UserCodeMaximumLevel) as UserCodeMaximumLevel, latest(UserCodeWarningLevel) as UserCodeWarningLevel, latest(ReadLocked) as ReadLocked, latest(ReadOnly) as ReadOnly, latest(ResourceQuotaExceeded) as ResourceQuotaExceeded, latest(ResourceQuotaExceededNotificationSent) as ResourceQuotaExceededNotificationSent, latest(ResourceQuotaWarningNotificationSent) as ResourceQuotaWarningNotificationSent, latest(RootWebId) as RootWebId, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(ShowURLStructure) as ShowURLStructure, latest(SystemAccount) as SystemAccount, latest(SyndicationEnabled) as SyndicationEnabled, latest(TrimAuditLog) as TrimAuditLog, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(Bandwidth) as Bandwidth, latest(DiscussionStorage) as DiscussionStorage, latest(Hits) as Hits, latest(Storage) as Storage, latest(Visits) as Visits, latest(UserAccountDirectoryPath) as UserAccountDirectoryPath, latest(UserCodeEnabled) as UserCodeEnabled, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled, latest(WebApplicationId) as WebApplicationId, latest(WriteLocked) as WriteLocked, latest(Zone) as Zone, latest(Owner) as Owner, latest(SecondaryContact) as SecondaryContact by FarmId,Id | inputlookup append=T SPSite | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Url) as Url, latest(AdministrationSiteType) as AdministrationSiteType, latest(AllowDesigner) as AllowDesigner, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuditLogTrimmingCallout) as AuditLogTrimmingCallout, latest(AuditLogTrimmingRetention) as AuditLogTrimmingRetention, latest(AverageResourceUsage) as AverageResourceUsage, latest(BrowserDocumentsEnabled) as BrowserDocumentsEnabled, latest(CatchAccessDeniedException) as CatchAccessDeniedException, latest(CertificationDate) as CertificationDate, latest(ContentDatabaseId) as ContentDatabaseId, latest(CurrentResourceUsage) as CurrentResourceUsage, latest(DeadWebNotificationCount) as DeadWebNotificationCount, latest(HostHeaderIsSiteName) as HostHeaderIsSiteName, latest(HostName) as HostName, latest(IISAllowsAnonymous) as IISAllowsAnonymous, latest(Impersonating) as Impersonating, latest(LastContentModifiedDate) as LastContentModifiedDate, latest(LastSecurityModifiedDate) as LastSecurityModifiedDate, latest(LockIssue) as LockIssue, latest(Port) as Port, latest(PortalName) as PortalName, latest(PortalUrl) as PortalUrl, latest(Protocol) as Protocol, latest(QuotaID) as QuotaID, latest(InvitedUserMaximumLevel) as InvitedUserMaximumLevel, latest(StorageMaximumLevel) as StorageMaximumLevel, latest(StorageWarningLevel) as StorageWarningLevel, latest(UserCodeMaximumLevel) as UserCodeMaximumLevel, latest(UserCodeWarningLevel) as UserCodeWarningLevel, latest(ReadLocked) as ReadLocked, latest(ReadOnly) as ReadOnly, latest(ResourceQuotaExceeded) as ResourceQuotaExceeded, latest(ResourceQuotaExceededNotificationSent) as ResourceQuotaExceededNotificationSent, latest(ResourceQuotaWarningNotificationSent) as ResourceQuotaWarningNotificationSent, latest(RootWebId) as RootWebId, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(ShowURLStructure) as ShowURLStructure, latest(SystemAccount) as SystemAccount, latest(SyndicationEnabled) as SyndicationEnabled, latest(TrimAuditLog) as TrimAuditLog, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(Bandwidth) as Bandwidth, latest(DiscussionStorage) as DiscussionStorage, latest(Hits) as Hits, latest(Storage) as Storage, latest(Visits) as Visits, latest(UserAccountDirectoryPath) as UserAccountDirectoryPath, latest(UserCodeEnabled) as UserCodeEnabled, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled, latest(WebApplicationId) as WebApplicationId, latest(WriteLocked) as WriteLocked, latest(Zone) as Zone, latest(Owner) as Owner, latest(SecondaryContact) as SecondaryContact by FarmId,Id | where Action != "Delete" | outputlookup SPSite
cron_schedule = 11 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for the SPUser Lookup
#
[Lookup - SPUser]
search = eventtype=mssharepoint-inventory Type="User" | rex field=LoginName "(i:)*(0#.w\|)*(?<src_user>.*)" | stats latest(_time) as _time,latest(Action) as Action,latest(src_user) as src_user, latest(LoginName) as LoginName, latest(Email) as Email, latest(Sid) as Sid, latest(DisplayName) as DisplayName, latest(RequireRequestToken) as RequireRequestToken, latest(IsSiteAdmin) as IsSiteAdmin, latest(IsSiteAuditor) as IsSiteAuditor, latest(IsDomainGroup) as IsDomainGroup, latest(IsApplicationPrincipal) as IsApplicationPrincipal by Id,WebId,FarmId | where Action != "Delete" | outputlookup SPUser
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPUser Lookup
#
[Accumulator - SPUser]
search = eventtype=mssharepoint-inventory Type="User" | rex field=LoginName "(i:)*(0#.w\|)*(?<src_user>.*)" | stats latest(_time) as _time,latest(Action) as Action,latest(src_user) as src_user, latest(LoginName) as LoginName, latest(Email) as Email, latest(Sid) as Sid, latest(DisplayName) as DisplayName, latest(RequireRequestToken) as RequireRequestToken, latest(IsSiteAdmin) as IsSiteAdmin, latest(IsSiteAuditor) as IsSiteAuditor, latest(IsDomainGroup) as IsDomainGroup, latest(IsApplicationPrincipal) as IsApplicationPrincipal by Id,WebId,FarmId | inputlookup append=T SPUser | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time,latest(Action) as Action,latest(src_user) as src_user, latest(LoginName) as LoginName, latest(Email) as Email, latest(Sid) as Sid, latest(DisplayName) as DisplayName, latest(RequireRequestToken) as RequireRequestToken, latest(IsSiteAdmin) as IsSiteAdmin, latest(IsSiteAuditor) as IsSiteAuditor, latest(IsDomainGroup) as IsDomainGroup, latest(IsApplicationPrincipal) as IsApplicationPrincipal by Id,WebId,FarmId | where Action != "Delete" | outputlookup SPUser
cron_schedule = 24 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for the SPWeb Lookup
#
[Lookup - SPWeb]
search = eventtype=mssharepoint-inventory Type="Web" | stats latest(_time) as _time, latest(Action) as Action, latest(Title) as Title, latest(Title) as Title, latest(SiteId) as SiteId, latest(AllowAnonymousAccess) as AllowAnonymousAccess, latest(AllowAutomaticASPXPageIndexing) as AllowAutomaticASPXPageIndexing, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AllWebTemplatesAllowed) as AllWebTemplatesAllowed, latest(AlternateCssUrl) as AlternateCssUrl, latest(AlternateHeader) as AlternateHeader, latest(ASPXPageIndexer) as ASPXPageIndexer, latest(ASPXPageIndexMode) as ASPXPageIndexMode, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuthenticationMode) as AuthenticationMode, latest(Author) as Author, latest(ClientTag) as ClientTag, latest(Configuration) as Configuration, latest(Created) as Created, latest(CurrencyLocaleID) as CurrencyLocaleID, latest(CustomJavaScriptFileUrl) as CustomJavaScriptFileUrl, latest(CustomMasterUrl) as CustomMasterUrl, latest(CustomUploadPage) as CustomUploadPage, latest(EffectivePresenceEnabled) as EffectivePresenceEnabled, latest(EmailInsertsEnabled) as EmailInsertsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(ExecuteUrl) as ExecuteUrl, latest(Exists) as Exists, latest(HasExternalSecurityProvider) as HasExternalSecurityProvider, latest(HasUniquePerm) as HasUniquePerm, latest(HasUniqueRoleAssignments) as HasUniqueRoleAssignments, latest(HasUniqueRoleDefinitions) as HasUniqueRoleDefinitions, latest(IncludeSupportingFolders) as IncludeSupportingFolders, latest(IsADAccountCreationMode) as IsADAccountCreationMode, latest(IsADEmailEnabled) as IsADEmailEnabled, latest(IsMultilingual) as IsMultilingual, latest(IsRootWeb) as IsRootWeb, latest(Language) as Language, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(Locale) as Locale, latest(MasterPageReferenceEnabled) as MasterPageReferenceEnabled, latest(MasterUrl) as MasterUrl, latest(NoCrawl) as NoCrawl, latest(OverwriteTranslationsOnChange) as OverwriteTranslationsOnChange, latest(ParentWeb) as ParentWeb, latest(ParserEnabled) as ParserEnabled, latest(PortalMember) as PortalMember, latest(PortalName) as PortalName, latest(PortalSubscriptionUrl) as PortalSubscriptionUrl, latest(PortalUrl) as PortalUrl, latest(PresenceEnabled) as PresenceEnabled, latest(Provisioned) as Provisioned, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(QuickLaunchEnabled) as QuickLaunchEnabled, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RequestAccessEmail) as RequestAccessEmail, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootFolder) as RootFolder, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(SiteLogoUrl) as SiteLogoUrl, latest(SyndicationEnabled) as SyndicationEnabled, latest(Theme) as Theme, latest(ThemeCssUrl) as ThemeCssUrl, latest(ThemeCssFolderUrl) as ThemeCssFolderUrl, latest(TreeViewEnabled) as TreeViewEnabled, latest(UIVersion) as UIVersion, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(WebTemplate) as WebTemplate, latest(WebTemplateId) as WebTemplateId by FarmId,Id | where Action != "Delete" | outputlookup SPWeb
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPWeb Lookup
#
[Accumulator - SPWeb]
search = eventtype=mssharepoint-inventory Type="Web" | stats latest(_time) as _time, latest(Action) as Action, latest(Title) as Title, latest(Title) as Title, latest(SiteId) as SiteId, latest(AllowAnonymousAccess) as AllowAnonymousAccess, latest(AllowAutomaticASPXPageIndexing) as AllowAutomaticASPXPageIndexing, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AllWebTemplatesAllowed) as AllWebTemplatesAllowed, latest(AlternateCssUrl) as AlternateCssUrl, latest(AlternateHeader) as AlternateHeader, latest(ASPXPageIndexer) as ASPXPageIndexer, latest(ASPXPageIndexMode) as ASPXPageIndexMode, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuthenticationMode) as AuthenticationMode, latest(Author) as Author, latest(ClientTag) as ClientTag, latest(Configuration) as Configuration, latest(Created) as Created, latest(CurrencyLocaleID) as CurrencyLocaleID, latest(CustomJavaScriptFileUrl) as CustomJavaScriptFileUrl, latest(CustomMasterUrl) as CustomMasterUrl, latest(CustomUploadPage) as CustomUploadPage, latest(EffectivePresenceEnabled) as EffectivePresenceEnabled, latest(EmailInsertsEnabled) as EmailInsertsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(ExecuteUrl) as ExecuteUrl, latest(Exists) as Exists, latest(HasExternalSecurityProvider) as HasExternalSecurityProvider, latest(HasUniquePerm) as HasUniquePerm, latest(HasUniqueRoleAssignments) as HasUniqueRoleAssignments, latest(HasUniqueRoleDefinitions) as HasUniqueRoleDefinitions, latest(IncludeSupportingFolders) as IncludeSupportingFolders, latest(IsADAccountCreationMode) as IsADAccountCreationMode, latest(IsADEmailEnabled) as IsADEmailEnabled, latest(IsMultilingual) as IsMultilingual, latest(IsRootWeb) as IsRootWeb, latest(Language) as Language, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(Locale) as Locale, latest(MasterPageReferenceEnabled) as MasterPageReferenceEnabled, latest(MasterUrl) as MasterUrl, latest(NoCrawl) as NoCrawl, latest(OverwriteTranslationsOnChange) as OverwriteTranslationsOnChange, latest(ParentWeb) as ParentWeb, latest(ParserEnabled) as ParserEnabled, latest(PortalMember) as PortalMember, latest(PortalName) as PortalName, latest(PortalSubscriptionUrl) as PortalSubscriptionUrl, latest(PortalUrl) as PortalUrl, latest(PresenceEnabled) as PresenceEnabled, latest(Provisioned) as Provisioned, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(QuickLaunchEnabled) as QuickLaunchEnabled, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RequestAccessEmail) as RequestAccessEmail, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootFolder) as RootFolder, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(SiteLogoUrl) as SiteLogoUrl, latest(SyndicationEnabled) as SyndicationEnabled, latest(Theme) as Theme, latest(ThemeCssUrl) as ThemeCssUrl, latest(ThemeCssFolderUrl) as ThemeCssFolderUrl, latest(TreeViewEnabled) as TreeViewEnabled, latest(UIVersion) as UIVersion, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(WebTemplate) as WebTemplate, latest(WebTemplateId) as WebTemplateId by FarmId,Id | inputlookup append=T SPWeb | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Title) as Title, latest(Title) as Title, latest(SiteId) as SiteId, latest(AllowAnonymousAccess) as AllowAnonymousAccess, latest(AllowAutomaticASPXPageIndexing) as AllowAutomaticASPXPageIndexing, latest(AllowRssFeeds) as AllowRssFeeds, latest(AllowUnsafeUpdates) as AllowUnsafeUpdates, latest(AllWebTemplatesAllowed) as AllWebTemplatesAllowed, latest(AlternateCssUrl) as AlternateCssUrl, latest(AlternateHeader) as AlternateHeader, latest(ASPXPageIndexer) as ASPXPageIndexer, latest(ASPXPageIndexMode) as ASPXPageIndexMode, latest(AuditFlags) as AuditFlags, latest(UseAuditFlagCache) as UseAuditFlagCache, latest(EffectiveAuditMask) as EffectiveAuditMask, latest(AuthenticationMode) as AuthenticationMode, latest(Author) as Author, latest(ClientTag) as ClientTag, latest(Configuration) as Configuration, latest(Created) as Created, latest(CurrencyLocaleID) as CurrencyLocaleID, latest(CustomJavaScriptFileUrl) as CustomJavaScriptFileUrl, latest(CustomMasterUrl) as CustomMasterUrl, latest(CustomUploadPage) as CustomUploadPage, latest(EffectivePresenceEnabled) as EffectivePresenceEnabled, latest(EmailInsertsEnabled) as EmailInsertsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(ExecuteUrl) as ExecuteUrl, latest(Exists) as Exists, latest(HasExternalSecurityProvider) as HasExternalSecurityProvider, latest(HasUniquePerm) as HasUniquePerm, latest(HasUniqueRoleAssignments) as HasUniqueRoleAssignments, latest(HasUniqueRoleDefinitions) as HasUniqueRoleDefinitions, latest(IncludeSupportingFolders) as IncludeSupportingFolders, latest(IsADAccountCreationMode) as IsADAccountCreationMode, latest(IsADEmailEnabled) as IsADEmailEnabled, latest(IsMultilingual) as IsMultilingual, latest(IsRootWeb) as IsRootWeb, latest(Language) as Language, latest(LastItemModifiedDate) as LastItemModifiedDate, latest(Locale) as Locale, latest(MasterPageReferenceEnabled) as MasterPageReferenceEnabled, latest(MasterUrl) as MasterUrl, latest(NoCrawl) as NoCrawl, latest(OverwriteTranslationsOnChange) as OverwriteTranslationsOnChange, latest(ParentWeb) as ParentWeb, latest(ParserEnabled) as ParserEnabled, latest(PortalMember) as PortalMember, latest(PortalName) as PortalName, latest(PortalSubscriptionUrl) as PortalSubscriptionUrl, latest(PortalUrl) as PortalUrl, latest(PresenceEnabled) as PresenceEnabled, latest(Provisioned) as Provisioned, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(QuickLaunchEnabled) as QuickLaunchEnabled, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RequestAccessEmail) as RequestAccessEmail, latest(RequestAccessEnabled) as RequestAccessEnabled, latest(RootFolder) as RootFolder, latest(ServerRelativeUrl) as ServerRelativeUrl, latest(SiteLogoUrl) as SiteLogoUrl, latest(SyndicationEnabled) as SyndicationEnabled, latest(Theme) as Theme, latest(ThemeCssUrl) as ThemeCssUrl, latest(ThemeCssFolderUrl) as ThemeCssFolderUrl, latest(TreeViewEnabled) as TreeViewEnabled, latest(UIVersion) as UIVersion, latest(UIVersionConfigurationEnabled) as UIVersionConfigurationEnabled, latest(WebTemplate) as WebTemplate, latest(WebTemplateId) as WebTemplateId by FarmId,Id | where Action != "Delete" | outputlookup SPWeb
cron_schedule = 14 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for the SPWebApplication Lookup
#
[Lookup - SPWebApplication]
search = eventtype=mssharepoint-inventory Type="WebApplication" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Url) as Url, latest(AlertFlags) as AlertFlags, latest(AlertsEnabled) as AlertsEnabled, latest(AlertsEventBatchSize) as AlertsEventBatchSize, latest(AlertsLimited) as AlertsLimited, latest(AlertsMaximum) as AlertsMaximum, latest(AlertsMaximumQuerySet) as AlertsMaximumQuerySet, latest(AllowAccessToWebPartCatalog) as AllowAccessToWebPartCatalog, latest(AllowContributorsToEditScriptableParts) as AllowContributorsToEditScriptableParts, latest(AllowDesigner) as AllowDesigner, latest(AllowInlineDownloadedMimeTypes) as AllowInlineDownloadedMimeTypes, latest(AllowHighCharacterListFolderNames) as AllowHighCharacterListFolderNames, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowOMCodeOverrideThrottleSettings) as AllowOMCodeOverrideThrottleSettings, latest(AllowPartToPartCommunication) as AllowPartToPartCommunication, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowSilverlightPrompt) as AllowSilverlightPrompt, latest(AlwaysProcessDocuments) as AlwaysProcessDocuments, latest(ApplicationPool) as ApplicationPool, latest(AutomaticallyDeleteUnusedSiteCollections) as AutomaticallyDeleteUnusedSiteCollections, latest(BrowserCEIPEnabled) as BrowserCEIPEnabled, latest(CascadeDeleteMaximumItemLimit) as CascadeDeleteMaximumItemLimit, latest(CascadeDeleteTimeoutMultiplier) as CascadeDeleteTimeoutMultiplier, latest(ChangeLogExpirationEnabled) as ChangeLogExpirationEnabled, latest(ChangeLogRetentionPeriod) as ChangeLogRetentionPeriod, latest(DaysToShowNewIndicator) as DaysToShowNewIndicator, latest(DefaultQuotaTemplate) as DefaultQuotaTemplate, latest(DefaultServerComment) as DefaultServerComment, latest(DefaultTimeZone) as DefaultTimeZone, latest(DisableCoathoring) as DisableCoathoring, latest(DiskSizeRequired) as DiskSizeRequired, latest(DocumentConversionsEnabled) as DocumentConversionsEnabled, latest(EmailToNoPermissionWorkflowParticipantsEnabled) as EmailToNoPermissionWorkflowParticipantsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(EventLogRetentionPeriod) as EventLogRetentionPeriod, latest(ExternalUrlZone) as ExternalUrlZone, latest(ExternalWorkflowParticipantsEnabled) as ExternalWorkflowParticipantsEnabled, latest(FileNotFoundPage) as FileNotFoundPage, latest(IncomingEmailServerAddress) as IncomingEmailServerAddress, latest(IsAdministrationWebApplication) as IsAdministrationWebApplication, latest(MaxDiscussionBoardItemsForSiteDataFolderQuery) as MaxDiscussionBoardItemsForSiteDataFolderQuery, latest(MaximumFileSize) as MaximumFileSize, latest(MaxItemsPerThrottledOperation) as MaxItemsPerThrottledOperation, latest(MaxItemsPerThrottledOperationOverride) as MaxItemsPerThrottledOperationOverride, latest(MaxItemsPerThrottledOperationWarningLevel) as MaxItemsPerThrottledOperationWarningLevel, latest(MaxListItemRowStorage) as MaxListItemRowStorage, latest(MaxQueryLookupFields) as MaxQueryLookupFields, latest(MaxSizePerCellStorageOperations) as MaxSizePerCellStorageOperations, latest(MaxUniquePermScopesPerList) as MaxUniquePermScopesPerList, latest(OfficialFileUrl) as OfficialFileUrl, latest(OutboundMailCodePage) as OutboundMailCodePage, latest(OutboundMailReplyToAddress) as OutboundMailReplyToAddress, latest(OutboundMailSenderAddress) as OutboundMailSenderAddress, latest(OutboundMailServiceInstance) as OutboundMailServiceInstance, latest(OutboundMmsServiceAccount) as OutboundMmsServiceAccount, latest(OutboundSmsServiceAccount) as OutboundSmsServiceAccount, latest(PresenceEnabled) as PresenceEnabled, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RecycleBinCleanupEnabled) as RecycleBinCleanupEnabled, latest(RecycleBinRetentionPeriod) as RecycleBinRetentionPeriod, latest(RenderingFromMetainfoEnabled) as RenderingFromMetainfoEnabled, latest(RequireContactForSelfServiceSiteCreation) as RequireContactForSelfServiceSiteCreation, latest(ScopeExternalConnectionsToSiteSubscriptions) as ScopeExternalConnectionsToSiteSubscriptions, latest(SecondStageRecycleBinQuota) as SecondStageRecycleBinQuota, latest(SelfServiceSiteCreationEnabled) as SelfServiceSiteCreationEnabled, latest(SendLoginCredentialsByEmail) as SendLoginCredentialsByEmail, latest(SendUnusedSiteCollectionNotifications) as SendUnusedSiteCollectionNotifications, latest(ShowURLStructure) as ShowURLStructure, latest(SyndicationEnabled) as SyndicationEnabled, latest(UnusedSiteNotificationPeriod) as UnusedSiteNotificationPeriod, latest(UnusedSiteNotificationsBeforeDeletion) as UnusedSiteNotificationsBeforeDeletion, latest(UseClaimsAuthentication) as UseClaimsAuthentication, latest(UserDefinedWorkflowMaximumComplexity) as UserDefinedWorkflowMaximumComplexity, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled by FarmId,Id | where Action != "Delete" | outputlookup SPWebApplication
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPWebApplication Lookup
#
[Accumulator - SPWebApplication]
search = eventtype=mssharepoint-inventory Type="WebApplication" | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Url) as Url, latest(AlertFlags) as AlertFlags, latest(AlertsEnabled) as AlertsEnabled, latest(AlertsEventBatchSize) as AlertsEventBatchSize, latest(AlertsLimited) as AlertsLimited, latest(AlertsMaximum) as AlertsMaximum, latest(AlertsMaximumQuerySet) as AlertsMaximumQuerySet, latest(AllowAccessToWebPartCatalog) as AllowAccessToWebPartCatalog, latest(AllowContributorsToEditScriptableParts) as AllowContributorsToEditScriptableParts, latest(AllowDesigner) as AllowDesigner, latest(AllowInlineDownloadedMimeTypes) as AllowInlineDownloadedMimeTypes, latest(AllowHighCharacterListFolderNames) as AllowHighCharacterListFolderNames, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowOMCodeOverrideThrottleSettings) as AllowOMCodeOverrideThrottleSettings, latest(AllowPartToPartCommunication) as AllowPartToPartCommunication, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowSilverlightPrompt) as AllowSilverlightPrompt, latest(AlwaysProcessDocuments) as AlwaysProcessDocuments, latest(ApplicationPool) as ApplicationPool, latest(AutomaticallyDeleteUnusedSiteCollections) as AutomaticallyDeleteUnusedSiteCollections, latest(BrowserCEIPEnabled) as BrowserCEIPEnabled, latest(CascadeDeleteMaximumItemLimit) as CascadeDeleteMaximumItemLimit, latest(CascadeDeleteTimeoutMultiplier) as CascadeDeleteTimeoutMultiplier, latest(ChangeLogExpirationEnabled) as ChangeLogExpirationEnabled, latest(ChangeLogRetentionPeriod) as ChangeLogRetentionPeriod, latest(DaysToShowNewIndicator) as DaysToShowNewIndicator, latest(DefaultQuotaTemplate) as DefaultQuotaTemplate, latest(DefaultServerComment) as DefaultServerComment, latest(DefaultTimeZone) as DefaultTimeZone, latest(DisableCoathoring) as DisableCoathoring, latest(DiskSizeRequired) as DiskSizeRequired, latest(DocumentConversionsEnabled) as DocumentConversionsEnabled, latest(EmailToNoPermissionWorkflowParticipantsEnabled) as EmailToNoPermissionWorkflowParticipantsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(EventLogRetentionPeriod) as EventLogRetentionPeriod, latest(ExternalUrlZone) as ExternalUrlZone, latest(ExternalWorkflowParticipantsEnabled) as ExternalWorkflowParticipantsEnabled, latest(FileNotFoundPage) as FileNotFoundPage, latest(IncomingEmailServerAddress) as IncomingEmailServerAddress, latest(IsAdministrationWebApplication) as IsAdministrationWebApplication, latest(MaxDiscussionBoardItemsForSiteDataFolderQuery) as MaxDiscussionBoardItemsForSiteDataFolderQuery, latest(MaximumFileSize) as MaximumFileSize, latest(MaxItemsPerThrottledOperation) as MaxItemsPerThrottledOperation, latest(MaxItemsPerThrottledOperationOverride) as MaxItemsPerThrottledOperationOverride, latest(MaxItemsPerThrottledOperationWarningLevel) as MaxItemsPerThrottledOperationWarningLevel, latest(MaxListItemRowStorage) as MaxListItemRowStorage, latest(MaxQueryLookupFields) as MaxQueryLookupFields, latest(MaxSizePerCellStorageOperations) as MaxSizePerCellStorageOperations, latest(MaxUniquePermScopesPerList) as MaxUniquePermScopesPerList, latest(OfficialFileUrl) as OfficialFileUrl, latest(OutboundMailCodePage) as OutboundMailCodePage, latest(OutboundMailReplyToAddress) as OutboundMailReplyToAddress, latest(OutboundMailSenderAddress) as OutboundMailSenderAddress, latest(OutboundMailServiceInstance) as OutboundMailServiceInstance, latest(OutboundMmsServiceAccount) as OutboundMmsServiceAccount, latest(OutboundSmsServiceAccount) as OutboundSmsServiceAccount, latest(PresenceEnabled) as PresenceEnabled, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RecycleBinCleanupEnabled) as RecycleBinCleanupEnabled, latest(RecycleBinRetentionPeriod) as RecycleBinRetentionPeriod, latest(RenderingFromMetainfoEnabled) as RenderingFromMetainfoEnabled, latest(RequireContactForSelfServiceSiteCreation) as RequireContactForSelfServiceSiteCreation, latest(ScopeExternalConnectionsToSiteSubscriptions) as ScopeExternalConnectionsToSiteSubscriptions, latest(SecondStageRecycleBinQuota) as SecondStageRecycleBinQuota, latest(SelfServiceSiteCreationEnabled) as SelfServiceSiteCreationEnabled, latest(SendLoginCredentialsByEmail) as SendLoginCredentialsByEmail, latest(SendUnusedSiteCollectionNotifications) as SendUnusedSiteCollectionNotifications, latest(ShowURLStructure) as ShowURLStructure, latest(SyndicationEnabled) as SyndicationEnabled, latest(UnusedSiteNotificationPeriod) as UnusedSiteNotificationPeriod, latest(UnusedSiteNotificationsBeforeDeletion) as UnusedSiteNotificationsBeforeDeletion, latest(UseClaimsAuthentication) as UseClaimsAuthentication, latest(UserDefinedWorkflowMaximumComplexity) as UserDefinedWorkflowMaximumComplexity, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled by FarmId,Id | inputlookup append=T SPWebApplication | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time, latest(Action) as Action, latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Status) as Status, latest(Version) as Version, latest(Url) as Url, latest(AlertFlags) as AlertFlags, latest(AlertsEnabled) as AlertsEnabled, latest(AlertsEventBatchSize) as AlertsEventBatchSize, latest(AlertsLimited) as AlertsLimited, latest(AlertsMaximum) as AlertsMaximum, latest(AlertsMaximumQuerySet) as AlertsMaximumQuerySet, latest(AllowAccessToWebPartCatalog) as AllowAccessToWebPartCatalog, latest(AllowContributorsToEditScriptableParts) as AllowContributorsToEditScriptableParts, latest(AllowDesigner) as AllowDesigner, latest(AllowInlineDownloadedMimeTypes) as AllowInlineDownloadedMimeTypes, latest(AllowHighCharacterListFolderNames) as AllowHighCharacterListFolderNames, latest(AllowMasterPageEditing) as AllowMasterPageEditing, latest(AllowOMCodeOverrideThrottleSettings) as AllowOMCodeOverrideThrottleSettings, latest(AllowPartToPartCommunication) as AllowPartToPartCommunication, latest(AllowRevertFromTemplate) as AllowRevertFromTemplate, latest(AllowSilverlightPrompt) as AllowSilverlightPrompt, latest(AlwaysProcessDocuments) as AlwaysProcessDocuments, latest(ApplicationPool) as ApplicationPool, latest(AutomaticallyDeleteUnusedSiteCollections) as AutomaticallyDeleteUnusedSiteCollections, latest(BrowserCEIPEnabled) as BrowserCEIPEnabled, latest(CascadeDeleteMaximumItemLimit) as CascadeDeleteMaximumItemLimit, latest(CascadeDeleteTimeoutMultiplier) as CascadeDeleteTimeoutMultiplier, latest(ChangeLogExpirationEnabled) as ChangeLogExpirationEnabled, latest(ChangeLogRetentionPeriod) as ChangeLogRetentionPeriod, latest(DaysToShowNewIndicator) as DaysToShowNewIndicator, latest(DefaultQuotaTemplate) as DefaultQuotaTemplate, latest(DefaultServerComment) as DefaultServerComment, latest(DefaultTimeZone) as DefaultTimeZone, latest(DisableCoathoring) as DisableCoathoring, latest(DiskSizeRequired) as DiskSizeRequired, latest(DocumentConversionsEnabled) as DocumentConversionsEnabled, latest(EmailToNoPermissionWorkflowParticipantsEnabled) as EmailToNoPermissionWorkflowParticipantsEnabled, latest(EventHandlersEnabled) as EventHandlersEnabled, latest(EventLogRetentionPeriod) as EventLogRetentionPeriod, latest(ExternalUrlZone) as ExternalUrlZone, latest(ExternalWorkflowParticipantsEnabled) as ExternalWorkflowParticipantsEnabled, latest(FileNotFoundPage) as FileNotFoundPage, latest(IncomingEmailServerAddress) as IncomingEmailServerAddress, latest(IsAdministrationWebApplication) as IsAdministrationWebApplication, latest(MaxDiscussionBoardItemsForSiteDataFolderQuery) as MaxDiscussionBoardItemsForSiteDataFolderQuery, latest(MaximumFileSize) as MaximumFileSize, latest(MaxItemsPerThrottledOperation) as MaxItemsPerThrottledOperation, latest(MaxItemsPerThrottledOperationOverride) as MaxItemsPerThrottledOperationOverride, latest(MaxItemsPerThrottledOperationWarningLevel) as MaxItemsPerThrottledOperationWarningLevel, latest(MaxListItemRowStorage) as MaxListItemRowStorage, latest(MaxQueryLookupFields) as MaxQueryLookupFields, latest(MaxSizePerCellStorageOperations) as MaxSizePerCellStorageOperations, latest(MaxUniquePermScopesPerList) as MaxUniquePermScopesPerList, latest(OfficialFileUrl) as OfficialFileUrl, latest(OutboundMailCodePage) as OutboundMailCodePage, latest(OutboundMailReplyToAddress) as OutboundMailReplyToAddress, latest(OutboundMailSenderAddress) as OutboundMailSenderAddress, latest(OutboundMailServiceInstance) as OutboundMailServiceInstance, latest(OutboundMmsServiceAccount) as OutboundMmsServiceAccount, latest(OutboundSmsServiceAccount) as OutboundSmsServiceAccount, latest(PresenceEnabled) as PresenceEnabled, latest(PublicFolderRootUrl) as PublicFolderRootUrl, latest(RecycleBinEnabled) as RecycleBinEnabled, latest(RecycleBinCleanupEnabled) as RecycleBinCleanupEnabled, latest(RecycleBinRetentionPeriod) as RecycleBinRetentionPeriod, latest(RenderingFromMetainfoEnabled) as RenderingFromMetainfoEnabled, latest(RequireContactForSelfServiceSiteCreation) as RequireContactForSelfServiceSiteCreation, latest(ScopeExternalConnectionsToSiteSubscriptions) as ScopeExternalConnectionsToSiteSubscriptions, latest(SecondStageRecycleBinQuota) as SecondStageRecycleBinQuota, latest(SelfServiceSiteCreationEnabled) as SelfServiceSiteCreationEnabled, latest(SendLoginCredentialsByEmail) as SendLoginCredentialsByEmail, latest(SendUnusedSiteCollectionNotifications) as SendUnusedSiteCollectionNotifications, latest(ShowURLStructure) as ShowURLStructure, latest(SyndicationEnabled) as SyndicationEnabled, latest(UnusedSiteNotificationPeriod) as UnusedSiteNotificationPeriod, latest(UnusedSiteNotificationsBeforeDeletion) as UnusedSiteNotificationsBeforeDeletion, latest(UseClaimsAuthentication) as UseClaimsAuthentication, latest(UserDefinedWorkflowMaximumComplexity) as UserDefinedWorkflowMaximumComplexity, latest(UserDefinedWorkflowsEnabled) as UserDefinedWorkflowsEnabled by FarmId,Id | where Action != "Delete" | outputlookup SPWebApplication
cron_schedule = 17 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false
#
# Rebuilder for the SPWebTemplate Lookup
#
[Lookup - SPWebTemplate]
search = eventtype=mssharepoint-inventory Type="WebTemplate" | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(IsCustomTemplate) as IsCustomTemplate, latest(IsHidden) as IsHidden, latest(IsRootWebOnly) as IsRootWebOnly, latest(IsSubWebOnly) as IsSubWebOnly, latest(IsUnique) as IsUnique, latest(ProvisionAssembly) as ProvisionAssembly, latest(ProvisionClass) as ProvisionClass, latest(ProvisionData) as ProvisionData, latest(SupportsMultilingualUI) as SupportsMultiLingualUI by FarmId,Id,Lcid,Name | where Action != "Delete" | outputlookup SPWebTemplate
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SPWebTemplate Lookup
#
[Accumulator - SPWebTemplate]
search = eventtype=mssharepoint-inventory Type="WebTemplate" | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(IsCustomTemplate) as IsCustomTemplate, latest(IsHidden) as IsHidden, latest(IsRootWebOnly) as IsRootWebOnly, latest(IsSubWebOnly) as IsSubWebOnly, latest(IsUnique) as IsUnique, latest(ProvisionAssembly) as ProvisionAssembly, latest(ProvisionClass) as ProvisionClass, latest(ProvisionData) as ProvisionData, latest(SupportsMultilingualUI) as SupportsMultiLingualUI by FarmId,Id,Lcid,Name | inputlookup append=T SPWebTemplate | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time,latest(Action) as Action,latest(Title) as Title, latest(IsCustomTemplate) as IsCustomTemplate, latest(IsHidden) as IsHidden, latest(IsRootWebOnly) as IsRootWebOnly, latest(IsSubWebOnly) as IsSubWebOnly, latest(IsUnique) as IsUnique, latest(ProvisionAssembly) as ProvisionAssembly, latest(ProvisionClass) as ProvisionClass, latest(ProvisionData) as ProvisionData, latest(SupportsMultilingualUI) as SupportsMultiLingualUI by FarmId,Id,Lcid,Name | where Action != "Delete" | outputlookup SPWebTemplate
cron_schedule = 21 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false

#
# Rebuilder for the SharepointGuid Lookup
#
[Lookup - SharepointGuid]
search = eventtype=mssharepoint-inventory Id="*-*-*-*" | stats latest(_time) as _time,latest(Action) as Action,latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Title) as Title by FarmId,Id,Type | eval DisplayName=case(Type="ServiceInstance",Name,isnotnull(DisplayName),DisplayName,isnotnull(Title),Title,isnotnull(Name),Name,isnotnull(Id),Type+" "+Id) | table _time,Action,FarmId,Id,Type,DisplayName | where Action != "Delete" | outputlookup SharePointGuid
dispatch.latest_time = now
enableSched = false

#
# Accumulator for the SharepointGuid Lookup
#
[Accumulator - SharepointGuid]
search = eventtype=mssharepoint-inventory Id="*-*-*-*" | stats latest(_time) as _time,latest(Action) as Action,latest(Name) as Name, latest(DisplayName) as DisplayName, latest(Title) as Title by FarmId,Id,Type | eval DisplayName=case(Type="ServiceInstance",Name,isnotnull(DisplayName),DisplayName,isnotnull(Title),Title,isnotnull(Name),Name,isnotnull(Id),Type+" "+Id) | table _time,Action,FarmId,Id,Type,DisplayName | inputlookup append=T SharePointGuid | eval Action=if(isnull(Action),"Existing",Action) | sort _time | stats latest(_time) as _time,latest(Action) as Action,latest(DisplayName) as DisplayName,by FarmId,Id,Type| where Action != "Delete" | outputlookup SharePointGuid
cron_schedule = 30 * * * *
run_on_startup = true
dispatch.lookups = 0
dispatch.earliest_time = -61m
dispatch.latest_time = now
is_visible = false


<form script="autodiscover.js,multi_select.js, multi_value_token.js">
  <label>Process: Network Drilldown</label>
  <fieldset autoRun="true" submitButton="false">
    <input type="time" searchWhenChanged="true">
      <default>
        <earliestTime>-24h@h</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="dropdown" token="basename" searchWhenChanged="true">
      <label>Select a Filename:</label>
      <populatingSearch fieldForValue="basename" fieldForLabel="basename">
        <![CDATA[sourcetype=ziften:zenith:networkconnect |eval basename = replace(trim(imagefilepath,"\""), ".*\\\\", "")|stats count by basename]]>
      </populatingSearch>
      <prefix>"</prefix>
      <suffix>"</suffix>
    </input>
    <input type="multiselect" token="port_exclude" searchWhenChanged="true">
      <delimiter>|</delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <populatingSearch earliest="-7d@h" latest="now" fieldForLabel="Description" fieldForValue="port">|inputlookup service-names-port-numbers.csv|search "Transport Protocol"=tcp|table Description "Port Number"|eval Description='Port Number'.":".'Description'|rename "Port Number" as port</populatingSearch>
      <choice value="None">None</choice>
      <default>None</default>
    </input>
  </fieldset>
  <row>
    <html>
      <h2>Application Network Connections</h2>
      <h5>Note: Results are limited to 100</h5>
      <div id="sunburstSearch" class="splunk-manager" data-require="splunkjs/mvc/searchmanager" data-options="{                    &quot;search&quot;: {                        &quot;type&quot;: &quot;token_safe&quot;,                        &quot;value&quot;: &quot;sourcetype=ziften:* message_type=networkconnect|where match(imagefilepath, $$basename$$)|stats values(imagefilemd5) as MD5s first(imagefilepath) as sample_path values(accountname) as users min(_time) as first_seen max(_time) as last_seen count by port ipaddress agentguid|head 100|lookup system_info agentguid|eval computername=if(isnull(computername), agentguid, computername)|where NOT match(port,\&quot;($$port_exclude$$)\&quot;)|fields port ipaddress computername MD5s sample_path users first_seen last_seen count|convert ctime(first_seen) ctime(last_seen)&quot;},                   &quot;earliest_time&quot;: { &quot;type&quot;: &quot;token_safe&quot;, &quot;value&quot;: &quot;$$earliest$$&quot; },                   &quot;latest_time&quot;: { &quot;type&quot;: &quot;token_safe&quot;, &quot;value&quot;: &quot;$$latest$$&quot; },                   &quot;status_buckets&quot;: 0,                   &quot;cancelOnUnload&quot;: true,                   &quot;auto_cancel&quot;: 90,                   &quot;preview&quot;: true,                   &quot;tokens&quot;: true               }"/>
      <div id="sunburstChart" class="splunk-view splunk-toolkit-sunburst" data-require="app/ziften/components/sunburst/sunburst" data-options="{                   &quot;managerid&quot;: &quot;sunburstSearch&quot;,                   &quot;nameField&quot;: &quot;tag&quot;,                   &quot;categoryFields&quot;: &quot;computername port ipaddress&quot;,                   &quot;valueField&quot;: &quot;count&quot;,                   &quot;width&quot;: 800,                   &quot;height&quot;: 800               }"/>
    </html>
  </row>
  <row>
    <html>
      <div id="mytable" class="splunk-view" data-require="splunkjs/mvc/tableview" data-options="{           &quot;managerid&quot;:&quot;sunburstSearch&quot;       }"/>
    </html>
  </row>
</form>
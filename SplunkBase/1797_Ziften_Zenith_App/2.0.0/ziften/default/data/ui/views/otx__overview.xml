<form>
  <label>OTX | Overview</label>
  <description>AlienVault Open Threat Exchange</description>
  <fieldset submitButton="false"/>
  <row>
    <panel>
      <input type="text" token="ipaddress">
        <label>Enter an IP Address to Lookup:</label>
        <default>127.0.0.1</default>
      </input>
      <table>
        <title>OTX results for $ipaddress$</title>
        <search><query>index=_internal|head 1|rename host as ipaddress|eval ipaddress="$ipaddress$"|table ipaddress|lookup otxlookup ipaddress|iplocation ipaddress|makemv delim="," classification</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <drilldown target="OTX Info">
          <link>
            <![CDATA[
  http://www.alienvault.com/apps/rep_monitor/ip/$row.ipaddress$
       ]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <search><query>sourcetype=ziften:zenith:alert feed=otx|stats dc(ipaddress)</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="drilldown">all</option>
        <option name="unit">distinct IP addresses with OTX Hits</option>
        <option name="unitPosition">after</option>
      </single>
    </panel>
    <panel>
      <single>
        <search><query>sourcetype=ziften:zenith:alert feed=otx|makemv delim="," details|mvexpand details|stats dc(details)</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="drilldown">all</option>
        <option name="unit">distinct OTX tags for your IP addresses</option>
        <option name="unitPosition">after</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <map>
        <title>Your Your OTX Tags by Geolocation</title>
        <search><query>sourcetype=ziften:zenith:alert feed=otx| iplocation ipaddress|makemv delim="," details|mvexpand details|geostats latfield=lat longfield=lon count by details</query></search>
        <option name="mapping.data.maxClusters">500</option>
        <option name="mapping.markerLayer.markerMaxSize">20</option>
        <option name="mapping.map.zoom">2</option>
        <option name="mapping.tileLayer.minZoom">2</option>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Your Recent OTX Tag Prevalence</title>
        <search><query>sourcetype=ziften:zenith:alert feed=otx|makemv delim="," details|mvexpand details|stats count by details|sort -count</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Your Recent High Risk Tags by Distinct IP</title>
        <search><query>sourcetype=ziften:zenith:alert feed=otx| makemv delim="," details|mvexpand details|search details!="Scanning*" AND details!="Spamming*"|stats dc(ipaddress) as connections by details|sort -connections</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Your Recent OTX Tag History</title>
        <search><query>sourcetype=ziften:zenith:alert feed=otx|table _time ipaddress details imagefilepath|makemv delim="," details</query></search>
        <earliestTime>0</earliestTime>
        <latestTime>now</latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">15</option>
        <drilldown target="OTX Info">
          <link>
            <![CDATA[
  http://www.alienvault.com/apps/rep_monitor/ip/$row.ipaddress$
       ]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>

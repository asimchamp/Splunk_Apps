<dashboard>
  <label>About</label>
  <row>
  <html>

<h2>Splunk GUI for SysStat</h2>

<p>The Splunk GUI for SysStat provides visualization of the system activity collected with the SysStat package. This includes I/O transfer rates, paging activity, process-related activities, interrupts, network activity, memory and swap space utilization, CPU utilization among others. The statistics can be collected near real-time from as many hosts as you like (potential thousands). The SysStat package is already present in all major Linux distribution and likely already installed, is non-intrusive, secure and lightweight way to collect system activity information.</p>

<b>Prerequisites:</b>
  <ol>
  <li>Splunk 6/7/8</li>
  <li>Modern Linux Distribution:</li>
    <ul>
    <li>RedHat/CentOS 5/6/7</li>
    <li>Debian 7/8/9</li>
    <li>Ubuntu 14+</li>
    </ul>
  <li>systat package</li>
  </ol>

<b>Single host installation:</b>
<pre>
1. install the sysstat package

   RPM-based distros (Redhat, CentOS):
     yum install sysstat

   DPKG-based distros (Debian, Ubuntu):
     apt-get install sysstat

2. Decrease the interval between samples and enable collection of all information.

   Redhat, Centos:
     Edit /etc/cron.d/sysstat and change
       */10 * * * * root /usr/lib64/sa/sa1 -S DISK 1 1
     to:
       * * * * * root /usr/lib64/sa/sa1 -S XALL 1 1


   Debian, Ubuntu:
     Edit /etc/cron.d/sysstat and change
       5-55/10 * * * * root command -v debian-sa1 > /dev/null &amp;&amp; debian-sa1 1 1
     to:
       * * * * * root command -v debian-sa1 > /dev/null &amp;&amp; debian-sa1 1 1

     Edit /etc/default/sysstat and change
       ENABLED="false"
     to
       ENABLED="true"

     Edit /etc/sysstat/sysstat and change
       SADC_OPTIONS="-S DISK"
     to
       SADC_OPTIONS="-S XALL"

3. Install splunk.

4. Install this app.
</pre>
<b>Distributed multihost installation (simplified):</b>
<pre>
1. Install sysstat package on each host which need to be monitored
2. Decrease the interval between samples and enable collection of all information
3. Install a central splunk instance (Search Head + Indexer) to collect the logs from the hosts
4. Install this app on the central splunk server
5. Install Splunk forwarder on each host which need to be monitored and configure to send logs to the Indexer
6. Install this app on each forwarder
</pre>

<b>Tuning:</b>
<pre>
1. Per default all possible statistics are collected. You can deactivate some less important or very verbose counters. For example on some systems the interrupt statistics contains more than 2500 individual counters, so you can tune the script to report a commulative interrupt statistics instead of ~2500 individual counters. To do so read 'man sar' and find a line in the man page which looks similar to '-A This is equivalent to specifying -bBdFHqSuvwWy -I SUM -I ALL -m ALL -n ALL -r ALL -u ALL -P ALL' (your line can differ). Then replace "-A" parameter in the sadf.sh script in the $SPLUNK_HOME/etc/apps/Sysstat/bin directory with a string from the manual page.

Per default the sadf.sh script looks like this:

LC_ALL=C sadf -t -s $(date -d "2 min ago" +%H:%M:%S) -- -A

Find an line in the man page and modify the script to:

LC_ALL=C sadf -t -s $(date -d "2 min ago" +%H:%M:%S) -- -bBdFHqSuvwWy -I SUM -I ALL -m ALL -n ALL -r ALL -u ALL -P ALL

then remove parameters which you don't need, for example "-I ALL", so the final string in the script will be similar to (your stirng can vary!):

LC_ALL=C sadf -t -s $(date -d "2 min ago" +%H:%M:%S) -- -bBdFHqSuvwWy -I SUM -m ALL -n ALL -r ALL -u ALL -P ALL

If after this change the sadf/sar stops to work, then you need to remove system activity files, please read the sysstat FAQ: http://sebastien.godard.pagesperso-orange.fr/faq.html#sar : "The list of activities that are saved in a file can no longer be modified once the file has been created. So it is important to use the proper options the first time sadc is called (whether via a crontab, a script like sa1(8) or even the script used to insert a RESTART message when the machine is rebooted)."

This optimisation is not enabled by default because the "-A" options includes different parameters depending on the version of sysstat package and used linux distribution. If you include parameters which your system doesn't support, the script will fail.

2. Reduce an interfal for scheduled searches, which collect monitored hosts names and parameters. Per default the searches run every minute to prepopulate the dropdown lists as soon as possible. But after the setup is completed the interfal can be increased to 10 or more minutes. The negavie impact of this change is that you have to wait up to 10 minutes to see your host in the dropdown menu.
</pre>


<b>Troubleshooting:</b>

<pre>
If there is no or wrong output:
1. check /opt/splunk/var/log/splunk/splunkd.log
2. run /opt/splunk/etc/apps/Sysstat/bin/sadf.sh manually
3. search via Splunk UI "sourcetype=sysstat"

For sysstat/sar related problems check http://sebastien.godard.pagesperso-orange.fr/faq.html
</pre>

<b>Examples of use:</b>
<pre>
Let's simulate on a test system an out of memory (OOM) condition and analyse it using sysstat.

1. Install vmtouch
2. Run this oneliner (modify the number of runs as needed, here 200 for 200*100MB=20GB memory allocation):
  for i in $(seq 1 200); do echo $i; date; free -m; dd if=/dev/zero of=/tmp/${i}_100MB.dat bs=1024 count=100000; vmtouch -d -l /tmp/${i}_100MB.dat; sleep 60; done
3. Sooner or later the OOM Killer should be triggered - check it with "grep -i killer /var/log/messages"
4. Go to Playground, choose the test systeme and some of the following parameters: %system, kbmemfree, kbbuffers, majflt/s, pgscank/s, bread/s, %util, runq-sz, ldavg-1.

</pre>
<p><img src="/static/app/Sysstat/Splunk_GUI_for_Sysstat_Out_of_Memory_Killer_Investigation.png" alt="Splunk GUI for Sysstat Out of Memory Investigation"></img></p>

<b>More information:</b>
<pre>
USE-Method: http://www.brendangregg.com/usemethod.html
USE-Method checklist: http://www.brendangregg.com/USEmethod/use-linux.html
NETDATA - Netdata is real-time health monitoring and performance troubleshooting for systems and applications. It helps you instantly diagnose slowdowns and anomalies in your infrastructure with thousands of metrics, interactive visualizations, and insightful health alarms.  https://www.netdata.cloud/ 
</pre>

<b>Contact:</b>

  <pre>splunk@compek.net</pre>

</html>
</row>
</dashboard>

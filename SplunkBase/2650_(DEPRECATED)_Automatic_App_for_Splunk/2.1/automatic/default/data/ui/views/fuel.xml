<form>
  <label>Fuel</label>
  <description>Fuel efficiency and consumption details.</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" searchWhenChanged="true">
      <default>
        <earliest>0</earliest>
        <latest></latest>
      </default>
    </input>
    <input type="radio" token="vehicle" searchWhenChanged="true">
      <label>Select Vehicle:</label>
      <search>
        <query>`automatic_index` `automatic_vehicle_sourcetype`
        | stats latest(display_name) AS display_name by host</query>
        <earliest>0</earliest>
        <latest></latest>
      </search>
      <fieldForLabel>display_name</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <prefix>host=</prefix>
      <default>*</default>
      <choice value="*">All</choice>
    </input>
  </fieldset>
  <row>
    <panel>
      <single>
        <title>Best Fuel Efficiency</title>
        <search>
          <query>$vehicle$ `automatic_index` `automatic_trip_sourcetype` duration_s&gt;300 average_mpg=*
 | stats max(average_mpg) AS best_mpg by _time
 | sort - best_mpg
 | head 1</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd93f3c","0xf58f39","0xf7bc38","0x6db7c6","0x65a637"]</option>
        <option name="rangeValues">[0,10,20,30]</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="unit">mpg</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Overall Fuel Efficiency</title>
        <search>
          <query>distance_mi=* fuel_volume_gal=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
 | stats sum(distance_mi) AS total_distance_mi sum(fuel_volume_gal) AS total_fuel_volume_gal
 | eval total_mpg = total_distance_mi / total_fuel_volume_gal
 | fields + total_mpg</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="colorBy">value</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd93f3c","0xf58f39","0xf7bc38","0x6db7c6","0x65a637"]</option>
        <option name="rangeValues">[0,10,20,30]</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="unit">mpg</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Total Fuel Consumed</title>
        <search>
          <query>fuel_volume_gal=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
 | stats sum(fuel_volume_gal) as sum</query>
        </search>
        <option name="numberPrecision">0.00</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="unit">gallons</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Fuel Efficiency Improvement</title>
        <search>
          <query>distance_mi=* fuel_volume_gal=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
| streamstats sum(distance_mi) as cumulative_distance_mi, sum(fuel_volume_gal) AS cumulative_fuel_volume_gal 
| eval cumulative_mpg = cumulative_distance_mi / cumulative_fuel_volume_gal 
| stats first(cumulative_mpg) as start last(cumulative_mpg) as end 
| eval improvement = ( ( ( end - start ) / start ) * 100 )
| fields + improvement</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd93f3c","0x65a637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
      <single>
        <title>Fuel Savings (Loss)</title>
        <search>
          <query>distance_mi=* fuel_volume_gal=* fuel_cost_usd=* $vehicle$ `automatic_trip_sourcetype`
 `automatic_index` 
| streamstats count AS trip_count, sum(distance_mi) AS cumulative_distance_mi, sum(fuel_volume_gal) AS cumulative_fuel_volume_gal, avg(fuel_cost_usd) AS avg_fuel_cost_usd
| eval cumulative_mpg = cumulative_distance_mi / cumulative_fuel_volume_gal 
| stats first(cumulative_mpg) AS start_mpg last(cumulative_mpg) AS end_mpg, last(avg_fuel_cost_usd) AS overall_avg_fuel_cost_usd, last(trip_count) AS trip_count
| eval savings = (( end_mpg - start_mpg ) / start_mpg ) * overall_avg_fuel_cost_usd * trip_count
| fields + savings</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xd93f3c","0x65a637"]</option>
        <option name="rangeValues">[0]</option>
        <option name="showSparkline">0</option>
        <option name="showTrendIndicator">0</option>
        <option name="unit">$</option>
        <option name="unitPosition">before</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Fuel Efficiency Over Time</title>
      <chart>
        <search>
          <query>distance_mi=* fuel_volume_gal=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
 | timechart sum(hard_*) as hard_*, sum(duration_over_*) as duration_over_*, sum(distance_mi) AS distance_mi, sum(fuel_volume_gal) AS fuel_volume_gal
 | eval average_mpg = distance_mi / fuel_volume_gal
 | fields - distance_mi, - fuel_volume_gal
 | rename average_mpg AS "Average MPG"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">1</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.overlayFields">"Average MPG"</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Fuel Efficiency by Metric</title>
      <input type="radio" token="metric" searchWhenChanged="true">
        <label>Metric</label>
        <choice value="average_speed_mi">Trip Average Speed (mph)</choice>
        <choice value="duration_s">Trip Duration (seconds)</choice>
        <choice value="idling_time_s">Idling Time (seconds)</choice>
        <choice value="night_driving_fraction">Night Driving Fraction</choice>
        <choice value="city_fraction">City Driving Fraction</choice>
        <choice value="highway_fraction">Highway Driving Fraction</choice>
        <default>average_speed_mi</default>
      </input>
      <chart>
        <search>
          <query>night_driving_fraction!=null idling_time_s!=null distance_mi=* fuel_volume_gal=* duration_s=* distance_mi=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
 | foreach *_fraction [ eval &lt;&lt;FIELD&gt;&gt; = ( &lt;&lt;FIELD&gt;&gt; * 100 ) ]
 | bin span=10 $metric$ 
 | stats sum(distance_mi) AS sum_distance_mi, sum(fuel_volume_gal) AS sum_fuel_volume_gal by $metric$
 | eval average_mpg = sum_distance_mi / sum_fuel_volume_gal
 | fields - sum*
 | sort num($metric$)
 | rename average_mpg AS "Average MPG", duration_s AS "Trip Duration (seconds)", average_speed_mi as "Trip Average Speed (mph)", idling_time_s AS "Idling Time (seconds)", night_driving_fraction AS "Night Driving Fraction (%)", city_fraction AS "City Driving Fraction (%)", highway_fraction AS "Highway Driving Fraction (%)"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Fuel Prices</title>
      <chart>
        <search>
          <query>fuel_price_per_gallon=* $vehicle$ `automatic_index` `automatic_trip_sourcetype` 
 | timechart avg(fuel_price_per_gallon) as fuel_price_per_gallon</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
    <panel>
      <title>Location of Cheapest Gas</title>
      <map>
        <search>
          <query>fuel_price_per_gallon=* end_location.lat=* end_location.lon=* $vehicle$ `automatic_index` `automatic_trip_sourcetype`
 | geostats latfield=end_location.lat, longfield=end_location.lon avg(fuel_price_per_gallon)</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="mapping.tileLayer.url">http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</option>
      </map>
    </panel>
  </row>
</form>
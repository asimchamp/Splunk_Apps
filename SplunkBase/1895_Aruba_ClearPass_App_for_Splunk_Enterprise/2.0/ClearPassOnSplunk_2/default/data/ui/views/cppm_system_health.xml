<form refresh="90">
  <label>System Monitor</label>

  <fieldset autoRun="True" submitButton="false">
    <input type="time" searchWhenChanged="true">
      <default>
        <earliestTime>-60m@m</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
  </fieldset>
  
  <row>
    <table>
      <title>Server Status</title>
      <searchString>
        eventtype=cppm CPPM_System_Stats  | dedup cphost | table cphost, uptime, data_inf_status, mgmt_inf_status
      </searchString>
    </table>

    <table>
      <title>CPU Usage by Servers</title>
      <searchString>
        eventtype=cppm |eval cpu_used=(100-round(cpu_raw_idle)) | stats sparkline(avg(cpu_used), 2m) as "CPU Used" avg(cpu_used) as avgcpu by cphost |eval avgcpu=round(avgcpu)|rename avgcpu to "%"
      </searchString>
    </table>

    <table>
      <title>CPU Available on Servers</title>
      <searchString>
        eventtype=cppm | eval cpu_idle=round(cpu_raw_idle)| stats sparkline(avg(cpu_idle), 2m) as "CPU Idle" avg(cpu_idle) as avgcpu by cphost | eval avgcpu=round(avgcpu)|rename avgcpu to "%"
      </searchString>
    </table>

  </row>

  <row>

    <table>
      <title>Memory Usage by Processes</title>
      <searchString>
	eventtype=cppm | stats sparkline(sum(res_mem_usage), 2m) as spk sum(res_mem_usage) as sum_mu by cphost |eval sum_mur=round(sum_mu/(1024*1024)) |fields cphost,spk, sum_mur|rename spk to "Memory Usage" | rename sum_mur to "MB"
      </searchString>
    </table>

    <table>
      <title>Memory Available on Servers</title>
      <searchString>
        eventtype=cppm | stats sparkline(avg(system_memory_avail), 2m) as spk avg(system_memory_avail) as avg_ma by cphost| eval avg_mar=round(avg_ma/1024) | fields cphost, spk, avg_mar|rename spk to "Memory Available" | rename avg_mar to "MB"
      </searchString>
    </table>

    <table>
      <title>Swap Size Usage by Servers</title>
      <searchString>
        eventtype=cppm | stats  sparkline(avg(swap_size_used), 2m) as spk avg(swap_size_used) as avg_su by cphost |  eval avg_sur=round(avg_su) |fields cphost, spk, avg_sur |rename spk to "Swap Usage" | rename avg_sur to "KB"

      </searchString>
    </table>

    <table>
      <title>Swap Size Available on Servers</title>
      <searchString>
        eventtype=cppm | stats  sparkline(avg(swap_memory_avail), 2m) as spk avg(swap_memory_avail) as avg_sa by cphost  |  eval avg_sar=round(avg_sa) |fields cphost, spk, avg_sar |rename spk to "Swap Usage" | rename avg_sar to "KB"

      </searchString>
    </table>
  </row>
  
</form>

<form>
  <label>ClearPass Alerts</label>

  <description>
	ClearPass Alerts
  </description>

  <fieldset autoRun="True" submitButton="false">
    <input type="time" searchWhenChanged="true">
      <default>
        <earliestTime>-15m@m</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
   <input type="dropdown" token="server">
      <label>ClearPass Server</label>
      <default>*</default>
      <choice value="*">All</choice>
      <populatingSearch fieldForValue="cphost" fieldForLabel="cphost">
        <![CDATA[eventtype=cppm | stats count by cphost]]>
      </populatingSearch>
    </input>
  </fieldset>

  <searchTemplate>
      eventtype=cppm-authentication cphost=$server$ 
  </searchTemplate>

  <row>
    <single>
      <option name="underLabel">Request Timed out </option>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ error_code=9002 | stats count 
      </searchString>
    </single>
    <single>
      <option name="underLabel">Denied by Policy </option>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=206 | stats count 
      </searchString>
    </single>
    <single>
      <option name="underLabel">User Authentication Failed </option>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=216 | stats count 
      </searchString>
    </single>
    <single>
      <option name="underLabel">Internal RADIUS Error </option>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=106 | stats count 
      </searchString>
    </single>
    <single>
      <option name="underLabel">User Not Found </option>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=201 | stats count 
      </searchString>
    </single>
    <single>
      <option name="underLabel">Wrong Shared Secret</option>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=9001 | stats count 
      </searchString>
    </single>
  </row>

  <row>
    <chart>
      <title>Timeout by Controller</title>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ error_code=9002 | stats count by nas_ip|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
    <chart>
      <title>Denied by Policy by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=206 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
    <chart>
      <title>User Authentication Failed by Server</title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=216 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
    <chart>
      <title>Internal RADIUS Error by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=106 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
    <chart>
      <title>User Not Found by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=201 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
    <chart>
      <title>Wrong Shared Secret by Controller </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=9001 | stats count by nas_ip|sort by count
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
  </row>

  <row>
    <chart>
      <title>Timeout by Controller</title>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ error_code=9002 | stats count by nas_ip|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Denied by Policy by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=206 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>User Authentication Failed by Server</title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=216 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Internal RADIUS Error by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=106 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>User Not Found by Server </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=201 | stats count by cphost|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Wrong Shared Secret by Controller </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=9001 | stats count by nas_ip|sort by count
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
  </row>

  <row>
    <chart>
      <title>Timeout by User</title>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ error_code=9002 | stats count by user_name |head 5 
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Denied by Policy by User </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=206 | stats count by user_name |head 5 
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>User Authentication Failed by User</title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=216 | stats count by user_name|head 5
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Internal RADIUS Error by User </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=106 | stats count by user_name|head 5
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>User Not Found by User </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=201 | stats count by user_name|head 5
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
    <chart>
      <title>Wrong Shared Secret by User </title>
      <searchString>
	       eventtype=cppm-fail-authentication error_code=9001 | stats count by user_name|head 5
      </searchString>
    <option name="charting.chart">column</option>
    </chart>
  </row>

  <row>
    <chart>
      <title>Failed Requests by Error type</title>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ | stats count by error_code_str |sort by count| head 10
      </searchString>
    <option name="charting.chart">bar</option>
    </chart>
    <chart>
      <title>Failed Requests by Error type</title>
      <searchString>
	       eventtype=cppm-fail-authentication cphost=$server$ | stats count by error_code_str
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
  </row>

  <row>
    <chart>
      <title>Successful vs Failed Requests</title>
      <searchString>
	eventtype=cppm-authentication cphost=$server$ login_status=ACCEPT |eval authres="successes" |timechart span=1h count by authres | eval hour=strftime(_time,"%H:00")| append [search eventtype=cppm-authentication cphost=$server$ login_status=REJECT |eval authres="fails" | timechart span=1h count by authres | eval hour=strftime(_time,"%H:00")]|chart sum(successes) as "Successful Logins" , sum(fails) as "Failed Logins" by hour
      </searchString>
    <option name="charting.axisTitleX.text"> Hour of Day </option>
    <option name="charting.axisTitleY.text"> Logins </option>
    <option name="charting.axisX.minimumNumber">0</option>
    <option name="charting.axisX.maximumNumber">24</option>
    <option name="charting.chart">area</option>
    </chart>
    <chart>
      <title>Successful vs Failed Requests</title>
      <searchString>
	       eventtype=cppm-authentication cphost=$server$ | stats count by login_status
      </searchString>
    <option name="charting.chart">pie</option>
    </chart>
  </row>

</form>

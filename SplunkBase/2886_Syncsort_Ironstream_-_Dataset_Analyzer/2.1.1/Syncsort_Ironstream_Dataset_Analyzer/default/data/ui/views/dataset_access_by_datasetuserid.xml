<form>
  <!--
 	Author		Syncsort/Mike Picou
	Date		08/12/2015
	Purpose:	List of Datasets by Userid with SMF80 details.  Drilldown to job detail.
	**************************************************************************************************************************  	
-->
  <label>Dataset Access by Dataset/Userid</label>
  <fieldset submitButton="true">
    <!-- ********************************** -->
    <!-- SET DEFAULT FOR Dataset TOKEN HERE -->
    <!-- ********************************** -->
    <input type="text" token="tokRESOURCE_NAME">
      <label>Dataset</label>
      <change>
        <unset token="tokSMFSID"></unset>
        <unset token="tokSMFJBN"></unset>
        <unset token="tokSMFRSD"></unset>
        <unset token="tokSMFRST"></unset>
      </change>
      <default>*</default>
    </input>
    <!-- ********************************** -->
    <!-- SET DEFAULT FOR Userid TOKEN HERE  -->
    <!-- ********************************** -->
    <input type="text" token="tokUserid">
      <label>Userid</label>
      <change>
        <unset token="tokSMFSID"></unset>
        <unset token="tokSMFJBN"></unset>
        <unset token="tokSMFRSD"></unset>
        <unset token="tokSMFRST"></unset>
      </change>
      <default>*</default>
    </input>
    <input type="radio" token="tokAccessType">
      <label>Access Type</label>
      <choice value="*">All Access</choice>
      <choice value="INSUFFICIENT_AUTHORITY">Failed Access</choice>
      <change>
        <unset token="tokSMFSID"></unset>
        <unset token="tokSMFJBN"></unset>
        <unset token="tokSMFRSD"></unset>
        <unset token="tokSMFRST"></unset>
      </change>
      <default>*</default>
    </input>
    <!-- ********************************************** -->
    <!-- SET DEFAULT FOR Date/Time Range TOKEN HERE -->
    <!-- ********************************************** -->
    <input type="time" token="tokTimeRange">
      <label>Date/Time Range</label>
      <change>
        <unset token="tokSMFSID"></unset>
        <unset token="tokSMFJBN"></unset>
        <unset token="tokSMFRSD"></unset>
        <unset token="tokSMFRST"></unset>
      </change>
      <default>
        <earliest>0</earliest>
        <latest>now</latest>
      </default>
    </input>
    <!-- ********************************** -->
    <!-- SET DEFAULT FOR Index TOKEN HERE   -->
    <!-- ********************************** -->
    <input type="text" token="tokINDEX">
      <label>Index</label>
      <change>
        <unset token="tokSMFSID"></unset>
        <unset token="tokSMFJBN"></unset>
        <unset token="tokSMFRSD"></unset>
        <unset token="tokSMFRST"></unset>
      </change>
      <default></default>
    </input>
  </fieldset>
  <!-- SMF80 PANEL -->
  <row>
    <panel depends="$tokRESOURCE_NAME$">
      <table>
        <title>$tokRESOURCE_NAME$ Access by Userid $tokUserid$</title>
        <search>
          <query>
            
            index=$tokINDEX$
            	MFSOURCETYPE  = SMF080
            	CLASS_NAME    = DATASET
            	SMF80RSD		!= "0000-00-00"
            	SMF80RST		!= "00:00:00.00"
            	SMF80USR      = $tokUserid$
            	RESOURCE_NAME = $tokRESOURCE_NAME$
            	AND             	
            	(RESOURCE			= $tokAccessType$ OR
            	 DEFINE_RESOURCE	= $tokAccessType$ OR
            	 DELETE_RESOURCE	= $tokAccessType$ OR
            	 RENAME_RESOURCE	= $tokAccessType$)
            
            |eval "Job/Userid"		= SMF80JBN
            |eval "User Name"		= USER_NAME_FROM_ACEE
            |eval "Data Set Name"	= RESOURCE_NAME
            |eval SystemID			= SMF80SID
            |eval "ACCESS ALLOWED"	= ACCESS_ALLOWED
            
            |eval RESULT	=if(!isnull(DEFINE_RESOURCE),DEFINE_RESOURCE," ")
            |eval RESULT	=if(!isnull(DELETE_RESOURCE),DELETE_RESOURCE,RESULT)
            |eval RESULT	=if(substr(RENAME_RESOURCE,1,10) == "SUCCESSFUL"	,"RENAMED" + " to "+NEW_DATA_SET_NAME,RESULT)
            |eval RESULT	=if(substr(RENAME_RESOURCE,1,12) == "INSUFFICIENT"	,RENAME_RESOURCE					 ,RESULT)
            |eval RESULT	=if(RESULT == " ",RESOURCE,RESULT)
            
            |eval "Access Requested"	=case(!isnull(DELETE_RESOURCE),"DELETE",
           									  !isnull(DEFINE_RESOURCE),"DEFINE",
            								  !isnull(RENAME_RESOURCE),"RENAME",
            								  !isnull(ACCESS_REQUESTED),ACCESS_REQUESTED)
            
            |sort DATETIME SMF80SID SMF80JBN SMF80RSD SMF80RST "Access Requested"
          
          </query>
          <earliest>$tokTimeRange.earliest$</earliest>
          <latest>$tokTimeRange.latest$</latest>
        </search>
        <drilldown>
          <set token="tokSMFSID">$row.SMF80SID$</set>
          <set token="tokSMFJBN">$row.SMF80JBN$</set>
          <set token="tokSMFRSD">$row.SMF80RSD$</set>
          <set token="tokSMFRST">$row.SMF80RST$</set>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">20</option>
        
        <fields>["Data Set Name","DATETIME","Job/Userid","User Name","Access Requested","RESULT"]</fields>
        
      </table>
    </panel>
  </row>
  <!-- DRILL DOWN PANEL -->
  <row>
    <panel depends="$tokSMFJBN$">
      <table>
        <title>Datasets Accessed by Job $tokSMFJBN$</title>
        <search>
          <query>
            
            index = $tokINDEX$ `SMFJobDetails($tokSMFSID$,$tokSMFJBN$,$tokSMFRSD$,$tokSMFRST$)`
          
          </query>
          <earliest>$tokTimeRange.earliest$</earliest>
          <latest>$tokTimeRange.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">50</option>
      </table>
    </panel>
  </row>
</form>
<!-- Copyright (C) 2010-2019 Sideview LLC.  All Rights Reserved. -->
<view autoCancelInterval="90" isVisible="true" onunloadCancelJobs="true" template="search.html">
  <label>Browse Sessions</label>
  <module name="AccountBar" layoutPanel="appHeader" />
  <module name="AppBar" layoutPanel="appHeader" />
  
  <module name="SideviewUtils" layoutPanel="appHeader">
    <param name="customJavascript">sideview_utils/save_create_patches.js</param>
    <param name="customStylesheet">observeit/custom.css observeit/browse.css</param>
  </module>

  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="maxSize">2</param>
    <param name="clearOnJobDispatch">False</param>
  </module>

  <module name="Message" layoutPanel="messaging">
    <param name="filter">splunk.search.*</param>
    <param name="maxSize">1</param>
    <param name="clearOnJobDispatch">True</param>
  </module>

  <module name="HTML" layoutPanel="viewHeader">
    <param name="html"><![CDATA[
    <h1>Browse Sessions (deprecated)</h1>
    <a href="browse">Use the new Browse view instead</a>
    ]]></param>
  </module>

  <module name="URLLoader" layoutPanel="viewHeader" autoRun="True">
    <param name="keepURLUpdated">True</param>

    <module name="TimeRangePicker" layoutPanel="mainSearchControls">
      <param name="label">time range</param>
      <param name="default">last 7 days</param>

      <module name="Search">
        <param name="search">`oit_cmlog` `fillnull_commands` | stats values(SessionId) as SessionId by UserName ApplicationName Command OS ServerName</param>

        <module name="CheckboxPulldown">
          <param name="name">OS</param>
          <param name="label">OS</param>
          <param name="valueField">$name$</param>
          <param name="labelField">label</param>
          <param name="template">$name$="$value$"</param>
          <param name="postProcess">stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
          <param name="selectAllOptimization">omit</param>

          <module name="CheckboxPulldown">
            <param name="name">ServerName</param>
            <param name="label">Server</param>
            <param name="valueField">$name$</param>
            <param name="labelField">label</param>
            <param name="template">$name$="$value$"</param>
            <param name="postProcess">search $OS$ | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
            <param name="selectAllOptimization">omit</param>

            <module name="CheckboxPulldown">
              <param name="name">UserName</param>
              <param name="label">User</param>
              <param name="valueField">$name$</param>
              <param name="labelField">label</param>
              <param name="template">$name$="$value$"</param>
              <param name="postProcess">search $OS$ $ServerName$ | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
              <param name="selectAllOptimization">omit</param>

              <module name="TextField">
                <param name="name">searchterms</param>
                <param name="label">misc. terms</param>
                <param name="width">330px</param>
                <param name="template">| search $value$</param>

                <module name="CheckboxPulldown">
                  <param name="name">ApplicationName</param>
                  <param name="label">Applications</param>
                  <param name="cssClass">applicationPulldown</param>
                  <param name="valueField">$name$</param>
                  <param name="labelField">label</param>
                  <param name="template">$name$="$value$"</param>
                  <param name="nullTemplate">isnull($name$)</param>
                  <param name="postProcess">search $OS$ $ServerName$ $UserName$ $name$!="N/A" | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
                  <param name="selectAllOptimization">omit</param>
                  
                  <module name="CheckboxPulldown">
                    <param name="name">Command</param>
                    <param name="label">Commands</param>
                    <param name="valueField">$name$</param>
                    <param name="labelField">label</param>
                    <param name="template">$name$="$value$"</param>
                    <param name="nullTemplate">isnull($name$)</param>
                    <param name="postProcess">search $OS$ $ServerName$ $UserName$ $name$!="N/A" | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")" </param>
                    <param name="selectAllOptimization">omit</param>

                    <module name="ValueSetter">
                      <param name="name">optionalOR</param>
                      <param name="requiredKeys">Command,ApplicationName</param>
                      <param name="value">OR</param>

                      <module name="ValueSetter">
                        <param name="name">ApplicationsAndCommands</param>
                        <param name="requiredKeysMode">OR</param>
                        <param name="requiredKeys">Command,ApplicationName</param>
                        <param name="value">| where $ApplicationName$ $optionalOR$ $Command$</param>

                        <module name="Button">
                          <param name="allowSoftSubmit">True</param>

                          <module name="Search">
                            <param name="search">
foo NOT foo 
| append [search `oit_cmlog` 
| head 1000
| fieldsummary 
| fields field 
| search field!="date_*" field!="splunk_server*" field!="index" 
| eval fieldLower=lower(field) 
| sort fieldLower 
| fields - fieldLower 
| stats count by field 
| eval foobar="1" 
| chart count over foobar by field limit=500 
| fields - foobar] 
| eval _time=0
| eval ended=1
| eval duration=1
                            </param>

                            <module name="FieldPicker" layoutPanel="resultsHeaderPanel">
                              <param name="fields">duration ApplicationsAndCommands LoginName UserName ServerName ClientName Slides</param>

                              <module name="Search" layoutPanel="resultsHeaderPanel">
                                <param name="search">
`oit_cmlog` $OS$ $ServerName$ $UserName$ 
`merge_applications_and_commands`
| `standard_stats_for_session_list`
$ApplicationsAndCommands$
| `conversions_for_session_list`
$searchterms$ 
| fields $results.fields$ SessionId ViewerURL actions
                                </param>

                                <module name="SearchControls">
                                  <param name="sections">jobControls info export print saveMenu</param>
                                  <param name="saveMenu">saveSearch</param>
                                </module>

                                <module name="Link">
                                  <param name="label">&#187; graph sessions over time</param>
                                  <param name="cssClass">clearRight</param>

                                  <module name="Redirector">
                                    <param name="url">general_report</param>
                                    
                                    <param name="generalSearchTermField">searchterms</param>
                                    <param name="arg.OS">$OS.rawValue$</param>
                                    <param name="arg.ServerName">$ServerName.rawValue$</param>
                                    <param name="arg.UserName">$UserName.rawValue$</param>
                                    <param name="arg.ApplicationName">$ApplicationName.rawValue$</param>
                                    <param name="arg.Command">$Command.rawValue$</param>
                                    

                                    <param name="arg.searchterms">$searchterms.rawValue$</param>
                                    <param name="arg.earliest">$search.timeRange.earliest$</param>
                                    <param name="arg.latest">$search.timeRange.latest$</param>
                                    <param name="target">_blank</param>
                                  </module>
                                </module>

                                <module name="Link">
                                  <param name="label">&#187; see full search syntax</param>

                                  <module name="Redirector">
                                    <param name="url">search</param>
                                    <param name="arg.q">$search$</param>
                                    <param name="arg.earliest">$search.timeRange.earliest$</param>
                                    <param name="arg.latest">$search.timeRange.latest$</param>
                                    <param name="target">_blank</param>
                                  </module>
                                </module>

                                <module name="HTML">
                                  <param name="html"><![CDATA[
                                    <h3 style="margin-top:0px;">$results.count$ matching sessions found $search.timeRange.label$</h3>
                                    <span class="doNotPrint">Click a row to see details for that session.</span>
                                  ]]></param>
                                </module>

                                <module name="Pulldown" layoutPanel="pageControls">
                                  <param name="name">results.count</param>
                                  <param name="staticOptions">
                                    <list><param name="value">10</param></list>
                                    <list><param name="value">20</param><param name="selected">True</param></list>
                                    <list><param name="value">50</param></list>
                                    <list><param name="value">100</param></list>
                                    <list><param name="value">200</param></list>
                                  </param>

                                
                                  <module name="JobProgressIndicator" layoutPanel="resultsAreaLeft"></module>

                                  <module name="Pager" layoutPanel="pageControls">

                                    <module name="Table" group=" " layoutPanel="resultsAreaLeft">
                                      <param name="hiddenFields">SessionId ViewerURL</param>
                                      <module name="HTML" group="row.fields.actions">
                                        <param name="html"><![CDATA[
                                          <a href="$row.fields.ViewerURL$" target="_blank"><img class="videoIcon" src="../../static/app/observeit/images/icon_video.gif"/></a>
                                          <img class="detailIcon" src="../../static/app/observeit/images/icon_arrow_right.png"/>
                                        ]]></param>
                                      </module>
                                      <module name="Redirector">
                                        <param name="url">session_detail</param>
                                        <param name="arg.UserName">$UserName.rawValue$</param>
                                        <param name="arg.SessionId">$row.fields.SessionId$</param>
                                        <param name="arg.ApplicationName">$ApplicationName.rawValue$</param>
                                        <param name="arg.Command">$Command.rawValue$</param>
                                        <param name="arg.autoRun">True</param>
                                      </module>
                                    </module>

                                    <module name="Pager"  layoutPanel="resultsAreaLeft" />

                                  </module>
                                </module>
                              </module>
                            </module>
                          </module>
                        </module>
                      </module>
                    </module>
                  </module>
                </module>
              </module>
            </module>
          </module>
        </module>
      </module>
    </module>
  </module>
  
</view>
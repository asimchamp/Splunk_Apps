<!-- Copyright (C) 2010-2019 Sideview LLC.  All Rights Reserved. -->
<view autoCancelInterval="90" isVisible="false" onunloadCancelJobs="true" template="dashboard.html" stylesheet="custom.css" isSticky="False">
  <label>Session Detail</label>
  <module name="AccountBar" layoutPanel="appHeader" />
  <module name="AppBar" layoutPanel="appHeader" />
  <module name="SideviewUtils" layoutPanel="appHeader" />
  
  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="maxSize">2</param>
    <param name="clearOnJobDispatch">False</param>
  </module>



  <module name="URLLoader" layoutPanel="viewHeader" autoRun="True">
    
    <module name="Link" layoutPanel="viewHeader">
      <param name="label">Browse Sessions &gt;</param>

      <module name="Redirector">
        <param name="url">browse</param>
        <param name="arg.field">SessionId</param>
        <param name="arg.earliest">$bc_earliest$</param>
        <param name="arg.latest">$bc_latest$</param>
        <param name="arg.OS">$bc_OS$</param>
        <param name="arg.ServerName">$bc_ServerName$</param>
        <param name="arg.UserName">$bc_UserName$</param>
        <param name="arg.ClientName">$bc_ClientName$</param>
        <param name="arg.Applications">$bc_Applications$</param>
        <param name="arg.Commands">$bc_Commands$</param>
        <param name="arg.searchterms">$bc_searchterms$</param>
      </module>
    </module>
      
    <module name="HTML" layoutPanel="viewHeader">
      <param name="html"><![CDATA[
      <h1>Session Detail</h1>
      ]]></param>
    </module>

    <module name="TimeRangePicker" layoutPanel="mainSearchControls">

      <module name="TextField">
        <param name="name">SessionId</param>
        <param name="label">$name$</param>
        <param name="width">220px</param>
        <param name="template">$name$="$value$"</param>

        <module name="Button">
          <param name="allowSoftSubmit">True</param>

          <module name="Search" layoutPanel="panel_row1_col1">
            <param name="search">
`custom_index` sourcetype=oit_cmlog OR sourcetype=oit_alerts $SessionId$ 
| fields ClientName ServerName DomainName LoginName UserName OS Alert AlertDetails sourcetype
| stats max(_time) as endTime min(_time) as startTime values(*) as *
            </param>
            <module name="ResultsValueSetter">
              <param name="fields">startTime endTime ClientName ServerName DomainName LoginName UserName OS Alert AlertDetails sourcetype</param>
              <module name="HTML">
                <param name="html"><![CDATA[
                  <h3>Properties</h3>
                  <table class="splTable propertyView">
                    <tr>
                      <th class="rowTh">ClientName</th>
                      <td>$ClientName$</td>

                      <th class="rowTh">ServerName</th>
                      <td>$ServerName$</td>

                      <th class="rowTh">DomainName</th>
                      <td>$DomainName$</td>
                    </tr>
                    <tr>
                      <th class="rowTh">LoginName</th>
                      <td>$LoginName$</td>

                      <th class="rowTh">UserName</th>
                      <td>$UserName$</td>

                      <th class="rowTh">OS</th>
                      <td>$OS$</td>
                    </tr>
                    <tr>
                      <th class="rowTh">Alerts</th>
                      <td>$Alert$</td>

                      <th class="rowTh">Sourcetypes</th>
                      <td>$sourcetype$</td>
                      <td> </td>
                      <td> </td>
                    </tr>

                  </table>
                ]]></param>
              </module>

              <module name="Search" layoutPanel="panel_row2_col1">
                <param name="search">`oit_cmlog` $SessionId$ `merge_applications_and_commands` | timechart count by ApplicationsAndCommands limit=4</param>
                <param name="earliest">$startTime$</param>
                <param name="latest">$endTime$</param>

                <module name="ValueSetter">
                  <param name="arg.charting.chart">column</param>
                  <param name="arg.charting.chart.stackMode">stacked</param>
                  <param name="arg.charting.axisTitleX.visibility">collapsed</param>

                  <module name="HTML">
                    <param name="html"><![CDATA[
                      <h3>Applications/Commands over time</h3>
                    ]]></param>
                  </module>
                  <module name="FlashChart">
                    <param name="height">100px</param>
                  </module>
                </module>
              </module>

              <module name="Search" layoutPanel="panel_row3_col1">
                <param name="search">`oit_alerts` $SessionId$ | timechart count by Alert</param>
                <param name="earliest">$startTime$</param>
                <param name="latest">$endTime$</param>


                <module name="ValueSetter">
                  <param name="arg.charting.chart">column</param>
                  <param name="arg.charting.chart.stackMode">stacked</param>
                  <param name="arg.charting.axisTitleX.visibility">collapsed</param>

                  <module name="HTML">
                    <param name="html"><![CDATA[
                      <h3>Alerts Triggered over time</h3>
                    ]]></param>
                  </module>
                  <module name="FlashChart">
                    <param name="height">100px</param>
                  </module>
                </module>
              </module>


              <module name="Search" layoutPanel="panel_row3_col1">
                <param name="search">
    `oit_alerts` $SessionId$ 
    | table _time Alert RuleDescription AlertDetails Severity UserName LoginName ServerName ProcessName PermissionLevel UsingRootPermissionLevel CommandName CommandArgument
                </param>
                <param name="earliest">$startTime$</param>
                <param name="latest">$endTime$</param>


                

                <module name="HTML">
                  <param name="html"><![CDATA[
                    <h3>Full Alert Details</h3>
                  ]]></param>
                </module>
                <module name="Pager">
                  <module name="Table" />
                </module>
                <module name="Link">
                  <param name="label">View raw alert events</param>
                  <module name="Redirector">
                    <param name="url">search</param>
                    <param name="arg.q">`oit_alerts` $SessionId$ | table * </param>
                    <param name="arg.earliest">all</param>
                    <param name="arg.latest">all</param>
                  </module>
                </module>
                    
              </module>
              
              <module name="Search" layoutPanel="panel_row4_col1">
                <param name="search">
    `oit_cmlog` $SessionId$ 
    `fillnull_commands` 
    | stats min(_time) as time by SessionId UserName LoginName ApplicationName WindowTitle Command CommandInvocation ViewerURL 
    | eval time=strftime(time,"%m/%d/%Y %H:%M:%S.%Q") 
    | table UserName LoginName ApplicationName WindowTitle Command CommandInvocation time ViewerURL
                </param>
                <param name="earliest">$startTime$</param>
                <param name="latest">$endTime$</param>


                <module name="JobProgressIndicator"></module>

                <module name="CheckboxPulldown">
                  <param name="name">ApplicationName</param>
                  <param name="label">Filter by Application</param>
                  <param name="valueField">$name$</param>
                  <param name="template">$name$="$value$"</param>
                  <param name="postProcess">dedup $name$ | sort $name$</param>
                  <param name="selectAllOptimization">omit</param>
                  <param name="outerTemplate">| search ( $value$ )</param>

                  <module name="CheckboxPulldown">
                    <param name="name">Command</param>
                    <param name="label">Filter by Command</param>
                    <param name="valueField">$name$</param>
                    <param name="template">$name$="$value$"</param>
                    <param name="postProcess">dedup $name$ | sort $name$</param>
                    <param name="selectAllOptimization">omit</param>
                    <param name="outerTemplate">| search ( $value$ )</param>

                    <module name="PostProcess">
                      <param name="search"><![CDATA[$ApplicationName$ $Command$ 
                      | eval user="" 
                      | eval activity="" 
                      | eval actions="" 
                      | eval Command=if(Command!="N/A",Command,null())
                      | eval CommandInvocation=if(CommandInvocation!="N/A",CommandInvocation,null())
                      | eval ApplicationName=if(ApplicationName!="N/A",ApplicationName,null())
                      | eval WindowTitle=if(WindowTitle!="N/A",WindowTitle,null())
                      | table time user activity actions *]]></param>

                      <module name="HTML" layoutPanel="viewHeader">
                        <param name="html"><![CDATA[
                        Click any of the video icons at the lower right to see screen-captured video of what the user was doing.
                        ]]></param>
                      </module>

                      <module name="Pager" >

                        <module name="Table">
                          <param name="hiddenFields">UserName LoginName ViewerURL ApplicationName WindowTitle Command CommandInvocation</param>
                          <param name="customBehavior">sessionDetailViewerLinks</param>

                          <module name="HTML" group="row.fields.user">
                            <param name="html"><![CDATA[
                              UserName=$row.fields.UserName$<br>
                              LoginName = $row.fields.LoginName$
                            ]]></param>
                          </module>

                          <module name="HTML" group="row.fields.activity">
                            <param name="html"><![CDATA[
                              <div>$row.fields.Command$</div>
                              <div>$row.fields.CommandInvocation$</div>
                              <div>$row.fields.ApplicationName$</div>
                              <div>$row.fields.WindowTitle$</div>
                            ]]></param>
                          </module>

                          <module name="HTML" group="row.fields.actions">
                            <param name="html"><![CDATA[
                              <a href="$row.fields.ViewerURL$" target="_blank"><img width="16" height="16" src="../../static/app/observeit/images/icon_video.gif"/></a>
                            ]]></param>
                          </module>

                        </module>
                        <module name="Pager" />
                      </module>
                    </module>
                  </module>
                </module>
              </module>
            </module>
          </module>

        </module>
      </module>
    </module>
  </module>
</view>

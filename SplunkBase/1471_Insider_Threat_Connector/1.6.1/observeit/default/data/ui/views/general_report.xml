<!-- Copyright (C) 2010 Sideview LLC.  All Rights Reserved. -->
<view autoCancelInterval="90" onunloadCancelJobs="true" template="search.html" isSticky="False" stylesheet="custom.css">
  <label>Build Report</label>
  <module name="AccountBar" layoutPanel="appHeader" />
  <module name="AppBar" layoutPanel="appHeader" />
  <module name="SideviewUtils" layoutPanel="appHeader">
    <param name="customJavascript">sideview_utils/report.js sideview_utils/save_create_patches.js</param>
  </module>

  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="maxSize">2</param>
    <param name="clearOnJobDispatch">False</param>
  </module>

  <module name="Message" layoutPanel="messaging">
    <param name="filter">splunk.search.*</param>
    <param name="maxSize">1</param>
    <param name="clearOnJobDispatch">True</param>
  </module>

  <module name="HTML" layoutPanel="viewHeader">
    <param name="html"><![CDATA[
    <h1>Report</h1>
    ]]></param>
  </module>
  
  <module name="URLLoader" layoutPanel="viewHeader" autoRun="True">
    <param name="keepURLUpdated">True</param>
    
    <module name="TimeRangePicker" layoutPanel="mainSearchControls">
      <param name="label">Time range</param>
      <param name="default">last 7 days</param>

      <module name="Search">
        <param name="search">
  `oit_cmlog` 
  `fillnull_commands` 
| stats values(SessionId) as SessionId by UserName LoginName ApplicationName Command OS ServerName
        </param>

        <module name="CheckboxPulldown">
          <param name="name">OS</param>
          <param name="label">OS</param>
          <param name="valueField">$name$</param>
          <param name="labelField">label</param>
          <param name="template">$name$="$value$"</param>
          <param name="postProcess">stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
          <param name="selectAllOptimization">omit</param>

          <module name="CheckboxPulldown">
            <param name="name">ServerName</param>
            <param name="label">Server</param>
            <param name="valueField">$name$</param>
            <param name="labelField">label</param>
            <param name="template">$name$="$value$"</param>
            <param name="postProcess">search $OS$ | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
            <param name="selectAllOptimization">omit</param>

            <module name="CheckboxPulldown">
              <param name="name">UserName</param>
              <param name="label">User</param>
              <param name="valueField">$name$</param>
              <param name="labelField">label</param>
              <param name="template">$name$="$value$"</param>
              <param name="postProcess">search $OS$ $ServerName$ | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
              <param name="selectAllOptimization">omit</param>

              <module name="CheckboxPulldown">
                <param name="name">LoginName</param>
                <param name="label">Login</param>
                <param name="valueField">$name$</param>
                <param name="labelField">label</param>
                <param name="template">$name$="$value$"</param>
                <param name="postProcess">search $OS$ $ServerName$ $UserName$ | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
                <param name="selectAllOptimization">omit</param>

                
                  
                <module name="CheckboxPulldown">
                  <param name="name">Command</param>
                  <param name="label">Commands</param>
                  <param name="valueField">$name$</param>
                  <param name="labelField">label</param>
                  <param name="template">$name$="$value$"</param>
                  <param name="nullTemplate">isnull($name$)</param>
                  <param name="postProcess">search $OS$ $ServerName$ $UserName$ $LoginName$ $name$!="N/A" | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")" </param>
                  <param name="selectAllOptimization">omit</param>

                  <module name="CheckboxPulldown">
                    <param name="name">ApplicationName</param>
                    <param name="label">Applications</param>
                    <param name="cssClass">applicationPulldown</param>
                    <param name="valueField">$name$</param>
                    <param name="labelField">label</param>
                    <param name="template">$name$="$value$"</param>
                    <param name="nullTemplate">isnull($name$)</param>
                    <param name="postProcess">search $OS$ $ServerName$ $UserName$ $LoginName$ $name$!="N/A" | stats dc(SessionId) as sessionCount by $name$ | sort $name$ | eval label=$name$+" (" + sessionCount + ")"</param>
                    <param name="selectAllOptimization">omit</param>

                    <module name="ValueSetter">
                      <param name="name">optionalOR</param>
                      <param name="requiredKeys">Command,ApplicationName</param>
                      <param name="value">OR</param>

                      <module name="ValueSetter">
                        <param name="name">ApplicationsAndCommands</param>
                        <param name="requiredKeysMode">OR</param>
                        <param name="requiredKeys">Command,ApplicationName</param>
                        <param name="value">| where $ApplicationName$ $optionalOR$ $Command$</param>

                        <module name="TextField">
                          <param name="name">searchterms</param>
                          <param name="label">Misc. terms</param>
                          <param name="template">| search $value$</param>

                          <module name="Search">
                            <param name="search">
`custom_index` (sourcetype=oit_cmlog $OS$ $ServerName$ $UserName$ $LoginName$ ) OR (`oit_alerts`) 
| fields - source sourcetype index req_time date_mday date_month date_minute date_second date_year date_zone  
  `merge_applications_and_commands`
| stats values(ApplicationName) as ApplicationName values(Command) as Command values(*) as * by SessionId
| eval duration=ended - _time
| head 1000
  $ApplicationsAndCommands$
  $searchterms$ 
| stats dc(*) as * 
| eval divider=1 
| transpose 
| rename "row 1" as "count" column as field 
| eval label=field + " (" + count + ")" 
| table field label 
                            </param>

                            <module name="CustomBehavior">
                              <param name="requiresDispatch">True</param>
                            </module>

                            <module name="Pulldown" layoutPanel="graphArea">
                              <param name="name">stat</param>
                              <param name="label">Chart the</param>
                              <param name="cssClass">firstChartingPulldown</param>
                              <param name="staticOptions">
                                <list>
                                  <param name="label">distinct count of</param>
                                  <param name="value">dc</param>
                                </list>
                                <list>
                                  <param name="label">average</param>
                                  <param name="value">avg</param>
                                </list>
                                <list>
                                  <param name="label">max</param>
                                  <param name="value">max</param>
                                </list>
                                <list>
                                  <param name="label">min</param>
                                  <param name="value">min</param>
                                </list>
                                <list>
                                  <param name="label">sum</param>
                                  <param name="value">sum</param>
                                </list>
                                <list>
                                  <param name="label">95th percentile</param>
                                  <param name="value">perc95</param>
                                </list>
                                <list>
                                  <param name="label">5th percentile</param>
                                  <param name="value">perc5</param>
                                </list>
                              </param>

                              <module name="Pulldown">
                                <param name="name">yField</param>
                                <param name="valueField">field</param>
                                <param name="labelField">label</param>
                                <param name="staticOptions"></param>
                                <param name="customBehavior">yFieldPulldown</param>
                                <param name="staticOptions">
                                  <list>
                                    <param name="value">SessionId</param>
                                    <param name="label">sessions</param>
                                  </list>
                                  <list>
                                    <param name="value">duration</param>
                                    <param name="label">duration</param>
                                  </list>
                                  <list>
                                    <param name="value"></param>
                                    <param name="label">--------------</param>
                                  </list>
                                </param>

                                <module name="Pulldown">
                                  <param name="name">xField</param>
                                  <param name="postProcess">eval label=if(field=="divider",label,"over " + label)</param>
                                  <param name="valueField">field</param>
                                  <param name="labelField">label</param>
                                  <param name="staticOptions">
                                    <list>
                                      <param name="label">over time</param>
                                      <param name="value">_time</param>
                                    </list>
                                  </param>

                                  <module name="Pulldown">
                                    <param name="name">zField</param>
                                    <param name="label">split by</param>
                                    <param name="valueField">field</param>
                                    <param name="labelField">label</param>
                                    <param name="staticOptions">
                                      <list>
                                        <param name="label">(none)</param>
                                        <param name="value"></param>
                                      </list>
                                    </param>

                                    <module name="Search">
                                      <param name="search">
| stats count 
| fields - count 
| eval field1=if(len("$stat$")==0,"count","$stat$($yField$)")
| eval field2=field1+" (ascending)" 
| eval field1=field1+" (descending)"
| eval field3="$xField$  (ascending)" 
| eval field4="$xField$  (descending)" 
| transpose | rename "row 1" as sortByLabel | eval sortByValue=replace(replace(sortByLabel,"\(ascending\)",""),"\(descending\)","desc")
                                      </param>

                                      <module name="Pulldown">
                                        <param name="name">sortBy</param>
                                        <param name="label">sort by</param>
                                        <param name="template"> | sort by $value$</param>
                                        <param name="valueField">sortByValue</param>
                                        <param name="labelField">sortByLabel</param>
                                        <param name="staticOptions"></param>
                                        <param name="customBehavior">customSortByPulldown</param>
                                    
                                        <module name="Button">
                                          <param name="allowSoftSubmit">True</param>

                                          <module name="Report">
                                            <param name="name">report</param>
                                            <param name="stat">$stat$</param>
                                            <param name="xField">$xField$</param>
                                            <param name="yField">$yField$</param>
                                            <param name="zField">$zField$</param>

                                            <module name="CustomBehavior">
                                              <param name="customBehavior">buildMainReportingTokens</param>

                                              <module name="Search" layoutPanel="resultsAreaLeft">
                                                <param name="search">
`custom_index` (sourcetype=oit_cmlog $OS$ $ServerName$ $UserName$ $LoginName$ ) OR (`oit_alerts`) 
$ApplicationsAndCommands$
$transformation$
$searchterms$ 
| $report$ $sortBy$
                                                </param>

                                                <module name="ValueSetter" layoutPanel="resultsAreaLeft">
                                                  <param name="name">zFieldLabel</param>
                                                  <param name="value">by $zField$</param>
                                                  <param name="requiredKeys">zField</param>

                                                  
                                                  <module name="Link">
                                                    <param name="label">&#187; see sessions</param>

                                                    <module name="Redirector">
                                                      <param name="url">browse</param>
                                                      <param name="generalSearchTermField">searchterms</param>
                                                      <param name="arg.OS">$OS.rawValue$</param>
                                                      <param name="arg.ServerName">$ServerName.rawValue$</param>
                                                      <param name="arg.UserName">$UserName.rawValue$</param>
                                                      <param name="arg.searchterms">$searchterms.rawValue$</param>
                                                      <param name="arg.ApplicationName">$ApplicationName.rawValue$</param>
                                                      <param name="arg.Command">$Command.rawValue$</param>

                                                      <param name="arg.earliest">$search.timeRange.earliest$</param>
                                                      <param name="arg.latest">$search.timeRange.latest$</param>
                                                      <param name="target">_blank</param>
                                                    </module>
                                                  </module>

                                                  <module name="Link">
                                                    <param name="label">&#187; see raw search syntax</param>
                                                    <module name="Redirector">
                                                      <param name="url">search</param>
                                                      <param name="arg.q">search $search$</param>
                                                      <param name="arg.earliest">$search.timeRange.earliest$</param>
                                                      <param name="arg.latest">$search.timeRange.latest$</param>
                                                      <param name="target">_blank</param>
                                                    </module>
                                                  </module>

                                                  <module name="HTML">
                                                    <param name="html"><![CDATA[
                                                      <h3>$stat.label$ $yField.label$ $xField.label$ $zFieldLabel$ $search.timeRange.label$ ($results.count$ rows returned.  $results.scanCount$ events scanned.)</h3>
                                                    ]]></param>
                                                  </module>
                                                </module>

                                                <module name="SearchControls" layoutPanel="graphArea">
                                                  <param name="saveMenu">saveSearch</param>
                                                  <param name="createMenu">createDashboardPanel createAlert createScheduledSearch</param>
                                                </module>

                                                <module name="Tabs" layoutPanel="graphArea">
                                                  <param name="name">selectedTab</param>
                                                  <param name="staticTabs">
                                                    <list><param name="value">Chart</param></list>
                                                    <list><param name="value">Table</param></list>
                                                    <list>
                                                      <param name="value">Table,Chart</param>
                                                      <param name="label">Both</param>
                                                    </list>
                                                  </param>
                                                  
                                                  <module name="JobProgressIndicator"  layoutPanel="resultsAreaLeft"></module>

                                                  <module name="Switcher" layoutPanel="graphArea">
                                                    <param name="selectedGroup">$selectedTab$</param>

                                                    <module name="Pulldown" group="Chart" layoutPanel="resultsAreaLeft">
                                                      <param name="name">charting.chart</param>
                                                      <param name="label">Chart type</param>
                                                      <param name="clear">left</param>
                                                      <param name="staticOptions">
                                                        <list>
                                                          <param name="value">column</param>
                                                          <param name="label">Column</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">line</param>
                                                          <param name="label">Line</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">area</param>
                                                          <param name="label">Area</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">bar</param>
                                                          <param name="label">Bar</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">bubble</param>
                                                          <param name="label">Bubble</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">pie</param>
                                                          <param name="label">Pie</param>
                                                        </list>
                                                        <list>
                                                          <param name="value">ratio</param>
                                                          <param name="label">Ratio</param>
                                                        </list>
                                                      </param>

                                                      <module name="Pulldown">
                                                        <param name="name">charting.chart.stackMode</param>
                                                        <param name="label">Stack mode</param>
                                                        <param name="staticOptions">
                                                          <list>
                                                            <param name="value">stacked</param>
                                                            <param name="label">Stacked</param>
                                                            <param name="selected">True</param>
                                                          </list>
                                                          <list>
                                                            <param name="value">default</param>
                                                            <param name="label">None</param>
                                                          </list>
                                                          <list>
                                                            <param name="value">stacked100</param>
                                                            <param name="label">100% Stacked</param>
                                                          </list>
                                                        </param>
                                                        <param name="customBehavior">stackModePulldown</param>
                                                        
                                                        <module name="Pulldown">
                                                          <param name="name">charting.chart.nullValueMode</param>
                                                          <param name="label">Null Values</param>
                                                          <param name="staticOptions">
                                                            <list>
                                                              <param name="value">zero</param>
                                                              <param name="label">Treat as zero</param>
                                                            </list>
                                                            <list>
                                                              <param name="value">gaps</param>
                                                              <param name="label">Omit</param>
                                                            </list>
                                                            <list>
                                                              <param name="value">connect</param>
                                                              <param name="label">Connect</param>
                                                            </list>
                                                          </param>
                                                          <param name="customBehavior">nullValueModePulldown</param>

                                                          <module name="Pulldown">
                                                            <param name="name">charting.chart.showMarkers</param>
                                                            <param name="label">Display markers</param>
                                                            <param name="staticOptions">
                                                              <list>
                                                                <param name="value">true</param>
                                                                <param name="label">Yes</param>
                                                              </list>
                                                              <list>
                                                                <param name="value">false</param>
                                                                <param name="label">No</param>
                                                              </list>
                                                            </param>
                                                            <param name="customBehavior">showMarkersPulldown</param>
                                                    
                                                            <module name="ValueSetter">
                                                              <param name="name">charting.legend.placement</param>
                                                              <param name="value">right</param>
                                                              <param name="requiredKeys">zField</param>
                                                              
                                                              <module name="EnablePreview">
                                                                <param name="enable">True</param>
                                                                <param name="display">False</param>
                                                              </module>

                                                              <module name="FlashChart">
                                                                <param name="height">300px</param>

                                                                <module name="Redirector">
                                                                  <param name="url">general_report</param>
                                                                  <param name="generalSearchTermField">searchterms</param>
                                                                  <param name="arg.ServerName">$ServerName.rawValue$</param>
                                                                  <param name="arg.UserName">$UserName.rawValue$</param>
                                                                  <param name="arg.LoginName">$LoginName.rawValue$</param>
                                                                  <param name="arg.ApplicationName">$ApplicationName.rawValue$</param>
                                                                  <param name="arg.Command">$Command.rawValue$</param>
                                                                  <param name="arg.searchterms">$searchterms.rawValue$</param>
                                                                  
                                                                  <param name="arg.earliest">$search.timeRange.earliest$</param>
                                                                  <param name="arg.latest">$search.timeRange.latest$</param>

                                                                  <param name="arg.autoRun">True</param>
                                                                </module>
                                                                
                                                                <!-- <module name="HTML">
                                                                  <param name="html"><![CDATA[
                                                                    click.value = $click.value$<br>
                                                                    click.name2 = $click.name2$<br>
                                                                    click.searchTerms = $click.searchTerms$<br>
                                                                    click.splitByTerm = $click.splitByTerm$<br>
                                                                    click.xTerm = $click.xTerm$<br>
                                                                    <br>
                                                                    ServerName = $ServerName.rawValue$<br>
                                                                    UserName = $UserName.rawValue$<br>
                                                                    ApplicationName = $ApplicationName.rawValue$<br>
                                                                    searchterms = $searchterms.rawValue$
                                                                    
                                                                    
                                                                  ]]></param>
                                                                </module>
                                                                -->
                                                              </module>
                                                            </module>
                                                          </module>
                                                        </module>
                                                      </module>
                                                    </module>

                                                    <module name="Pulldown" group="Table" layoutPanel="resultsAreaLeft">
                                                      <param name="name">results.count</param>
                                                      <param name="label">results per page</param>
                                                      <param name="float">right</param>
                                                      <param name="staticOptions">
                                                        <list><param name="value">10</param></list>
                                                        <list><param name="value">20</param></list>
                                                        <list><param name="value">50</param></list>
                                                        <list><param name="value">100</param></list>
                                                      </param>

                                                      <module name="Pager">
                                                        <module name="SimpleResultsTable">
                                                          <param name="drilldown">row</param>

                                                          <module name="Redirector">
                                                            <param name="url">general_report</param>
                                                            <param name="generalSearchTermField">searchterms</param>
                                                            <param name="arg.ServerName">$ServerName.rawValue$</param>
                                                            <param name="arg.UserName">$UserName.rawValue$</param>
                                                            <param name="arg.LoginName">$LoginName.rawValue$</param>
                                                            <param name="arg.ApplicationName">$ApplicationName.rawValue$</param>
                                                            <param name="arg.Command">$Command.rawValue$</param>
                                                            <param name="arg.searchterms">$searchterms.rawValue$</param>
                                                            
                                                            <param name="arg.earliest">$search.timeRange.earliest$</param>
                                                            <param name="arg.latest">$search.timeRange.latest$</param>

                                                            <param name="arg.autoRun">True</param>
                                                          </module>
                                                        </module>
                                                      </module>
                                                    </module>
                                                  </module>
                                                </module>
                                              </module>
                                            </module>
                                          </module>
                                        </module>
                                      </module>
                                    </module>
                                  </module>
                                </module>
                              </module>
                            </module>
                          </module>
                        </module>
                      </module>
                    </module>
                  </module>
                </module>
              </module>
            </module>
          </module>
        </module>
      </module>
    </module>
  </module>

</view>

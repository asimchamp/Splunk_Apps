<!-- Copyright (C) 2010-2019 Sideview LLC.  All Rights Reserved. -->
<view autoCancelInterval="90" isVisible="true" onunloadCancelJobs="true" template="dashboard.html" stylesheet="custom.css" isSticky="False">
  <label>Home</label>
  <module name="AccountBar" layoutPanel="appHeader" />
  <module name="AppBar" layoutPanel="appHeader" />
  <module name="SideviewUtils" layoutPanel="appHeader" />

  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="maxSize">2</param>
    <param name="clearOnJobDispatch">False</param>
  </module>

  <module name="HTML" layoutPanel="viewHeader">
    <param name="html"><![CDATA[
      <h1>Welcome to the Insider Threat Connector App 1.6.1</h1>
      <p>(this app was formerly known as "ObserveIT Connector")</p>
    ]]></param>
  </module>

  
  <module name="Search" layoutPanel="panel_row1_col1" autoRun="True">
    <param name="search">
| `check_for_missing_sourcetypes("oit_alerts,oit_cmlog")` | eval severity_level=2 | search instance="all_instances" | eval metric="Health Check Failed - required sourcetypes missing - " + metric | fields metric instance
    </param>
    
    <module name="Multiplexer">
      <param name="fields">metric</param>
      
      <module name="HTML">
        <param name="html"><![CDATA[
        <div class="error">$metric.rawValue$</div>
        ]]></param>
      </module>
    </module>
  </module>


  <module name="Search" layoutPanel="panel_row1_col1" autoRun="True">
    <param name="search">
`oit_cmlog_and_alerts` | head 1000 | stats dc(ServerName) as ServerName dc(SessionId) as SessionId by sourcetype splunk_server | search ServerName=0 SessionId=0 | rename splunk_server as instance | eval severity_level=2 | eval metric="Health Check Failed - sourcetype \"" + sourcetype + "\" is indexed but its fields are not being extracted properly. (Hint - check whether the TA_observeit app is installed on your Splunk forwarder.)" | fields severity_level metric instance
    </param>
    
    <module name="Multiplexer">
      <param name="fields">metric</param>
      
      <module name="HTML">
        <param name="html"><![CDATA[
        <div class="error">$metric.rawValue$</div>
        ]]></param>
      </module>
    </module>
  </module>


  <module name="URLLoader" layoutPanel="viewHeader" autoRun="True">
    <param name="keepURLUpdated">True</param>

    <module name="HTML" layoutPanel="panel_row1_col1">
      <param name="html"><![CDATA[

        <h3 style="margin-top:0px;">Getting Started</h3>
        <ul>
            <li>Click around in the chart below.
            <li>Try out the <a href="browse">Browse</a> view, explore the session metadata and click a user session to see the "Session Detail" view.</li>
            <li>Try out the <a href="general_report">Report Builder</a>.</li>
            <li>Try out the <a href="dashboard">Activity Dashboard</a>.</li>
        </ul>
        <p>
            Remember, whenever you see a chart or a table in this app and you want to click it to drill down, go right ahead.  
        </p>
        <h3>Licensing</h3>
        <p>
          This app is owned and developed by Sideview, LLC. It is distributed under the <a href="../../static/app/observeit/sideview_free_internal_use_license_agreement.pdf">Sideview Free Internal Use License Agreement</a> which allows use for free, with some restrictions.  <a href="https://sideviewapps.com/contact">Contact Sideview</a> with any questions. 
        </p>
      ]]></param>
    </module>
    
    <module name="TimeRangePicker" layoutPanel="panel_row2_col1">
      <param name="default">last 7 days</param>
      
      <module name="Pulldown">
        <param name="name">selectedField</param>
        <param name="label">Show top 10 values of</param>
        <param name="staticOptions">
          <list>
              <param name="value">Alert</param>
              <param name="label">alert</param>
            </list>
          <list>
            <param name="value">ServerName</param>
            <param name="label">server</param>
          </list>
          <list>
            <param name="value">UserName</param>
            <param name="label">user</param>
          </list>
          <list>
            <param name="value">LoginName</param>
            <param name="label">login</param>
          </list>
          <list>
            <param name="value">ApplicationName</param>
            <param name="label">application</param>
          </list>
          <list>
            <param name="value">Command</param>
            <param name="label">command</param>
          </list>
        </param>

        <module name="Pulldown">
          <param name="name">splitBy</param>
          <param name="label">split by</param>
          <param name="staticOptions">
            
            <list>
              <param name="value">ServerName</param>
              <param name="label">server</param>
            </list>
            <list>
              <param name="value">UserName</param>
              <param name="label">user</param>
            </list>
            <list>
              <param name="value">LoginName</param>
              <param name="label">login</param>
              <param name="selected">True</param>
            </list>
            <list>
              <param name="value">ApplicationName</param>
              <param name="label">application</param>
            </list>
            <list>
              <param name="value">Command</param>
              <param name="label">command</param>
            </list>
          </param>

          <module name="Search">
            <param name="search">
(`oit_cmlog`) OR (`oit_alerts`)
| fields ServerName UserName LoginName ApplicationName Command SessionId Alert
| stats values(*) as * by SessionId
| chart dc(SessionId) over $selectedField$ by $splitBy$ 
| addtotals 
| sort - Total 
| head 10 | fields - Total
            </param>

            <module name="HTML">
              <param name="html"><![CDATA[      
                (click to see session details for the given $selectedField.label$ and $splitBy.label$)
              ]]></param>
            </module>
            <module name="JobProgressIndicator" layoutPanel="panel_row2_col1_grp1"></module>

            <module name="ValueSetter">
              <param name="arg.charting.chart">bar</param>
              <param name="arg.charting.chart.stackMode">stacked</param>
              <!-- patch because inferring it by default from this type of SPL doesn't work.  -->
              <param name="arg.sideview.splitByField">$splitBy$</param>

              <module name="JSChart" layoutPanel="panel_row2_col1_grp1">
                <param name="drilldownPrefix">chartClick</param>

                <module name="Search">
                  <param name="search">
(`oit_cmlog`) OR (`oit_alerts`)
 [search (`oit_cmlog`) OR (`oit_alerts`) $chartClick.searchTerms$ | dedup SessionId | fields SessionId ] 
`merge_applications_and_commands`
| `standard_stats_for_session_list`
| `conversions_for_session_list`
| fields `fields_for_session_list` 
| eval actions=""
                  </param>
                  
                  <module name="HTML">
                    <param name="html"><![CDATA[      
                      <h3>$results.count$ sessions found for $chartClick.searchTerms$ $search.timeRange.label$</h3>
                      (click to see the full details for the given session, including video)

                    ]]></param>
                  </module>

                  <module name="JobProgressIndicator"></module>

                  <module name="Pager">
                    
                    <module name="Table">
                      <param name="hiddenFields">SessionId ViewerURL</param>

                      <module name="HTML" group="row.fields.actions">
                        <param name="html"><![CDATA[
                          <a href="$row.fields.ViewerURL$" target="_blank"><img width="16" height="16" src="../../static/app/observeit/images/icon_video.gif"/></a>
                        ]]></param>
                      </module>re

                      <module name="Redirector">
                        <param name="url">session_detail</param>
                        <param name="arg.SessionId">$row.fields.SessionId$</param>
                        
                      </module>
                    </module>

                  </module>
                </module>
              </module>
            </module>
          </module>
        </module>
      </module>
    </module>
   

    <module name="HTML" layoutPanel="viewHeader">
      <param name="src">error_messages.html</param>
    </module>


  </module>

</view>

<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>Dashboard</label>

  <fieldset autoRun="true">
    <input type="time">
      <default>Last 4 hours</default>
    </input>
  </fieldset>

  <row>
	<single>
		<searchTemplate>sourcetype="DASP4" | where isnotnull(applicationID) | stats dc(application) as nb | rangemap field=nb default=low</searchTemplate>
		<option name="afterLabel">protected applications</option>
		<option name="classField">range</option>
	</single>
	<single>
		<searchTemplate>sourcetype="DASP4" alert_id="4.*" | stats count  as nb | rangemap field=nb default=severe</searchTemplate>
		<option name="afterLabel">security alerts</option>
		<option name="classField">range</option>
	</single>
	<single>
		<searchTemplate>sourcetype="DASP4" alert_id="2.*" | stats count as nb | rangemap field=nb default=elevated</searchTemplate>
		<option name="afterLabel">system events</option>
		<option name="classField">range</option>
	</single>

	</row>
  <row>
	<chart>
		<title>Traffic per device</title>
		<searchTemplate>sourcetype="DASP4" | timechart eval(((sum(bytes_sent)+sum(bytes_received))/1000)) AS "kB" by device | rename device AS "Device"</searchTemplate>
		<option name="charting.chart">line</option>
		<option name="charting.primaryAxisTitle.text">Time</option>
		<option name="charting.secondaryAxisTitle.text">kB</option>
	</chart>
	</row>
	<row>
    <chart>
		<title>Top 10 applications response time</title>
		<searchTemplate>sourcetype="DASP4" (HTTP_method="GET" OR HTTP_method="POST") AND HTTP_response_code="200" | stats avg(eval(HTTP_response_time/1000)) AS "Response Time" by application | sort 10 "Response Time" desc</searchTemplate>
		<option name="charting.chart">bar</option>
		<option name="charting.legend.placement">none</option>
    </chart>
     <table>
		<title>Top applications errors</title>
		<searchTemplate>sourcetype="DASP4" (HTTP_response_code="404" OR HTTP_response_code="5*") | stats count AS "# Errors" by HTTP_response_code,application,device | rename HTTP_response_code AS "Error Code", application as "Application", device as "Device" | sort 10 "# Errors" desc </searchTemplate>
		<option name="charting.chart">pie</option>
		<option name="charting.legend.placement">none</option>
    </table>
  </row>
  <row>
    <chart>
		<title>Attacks</title>
		<searchTemplate>sourcetype="DASP4" (alert_id="4.1.*" OR alert_id="4.2.*") | replace "4.1.*" with "HTTP" in alert_id | replace "4.2.*" with "XML" in alert_id | timechart count by alert_id</searchTemplate>
		<option name="charting.chart">line</option>
		<option name="charting.primaryAxisTitle.text">Time</option>
    </chart>
    <table>
		<title>10 last events</title>
		<searchTemplate>sourcetype="DASP4" | where isnotnull(alert_id) | convert ctime(_time) as time timeformat="%H:%M:%S" | table time,device, alert_message, free_description | rename time AS "Time", device AS "Device", alert_message AS "Event", free_description AS "Description" | sort 10 _time desc</searchTemplate>
    </table>
  </row>
</form>

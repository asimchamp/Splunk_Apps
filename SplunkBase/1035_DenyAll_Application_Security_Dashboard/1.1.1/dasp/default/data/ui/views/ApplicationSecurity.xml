<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>Security Metrics</label>

  <fieldset>
    <input type="dropdown" token="application">
      	<label>Select Application</label>
   	<populatingSearch fieldForValue="app" fieldForLabel="app">
     		<![CDATA[sourcetype="DASP4" | where isnotnull(applicationID) | stats values(application) AS "app"]]>
  	 </populatingSearch>
    </input>
    <input type="time" />
  </fieldset>
  <row>
    <chart>
		<title>Attacks</title>
		<searchTemplate>sourcetype="DASP4" application="$application$" AND (HTTP_response_code="407" OR HTTP_response_code="413" OR HTTP_response_code="400" OR HTTP_response_code="403" OR HTTP_response_code="406"  OR HTTP_response_code="408"  OR HTTP_response_code="409"  OR HTTP_response_code="414"  OR HTTP_response_code="417") | timechart count by alert_id</searchTemplate>
		<option name="charting.chart">line</option>
		<option name="charting.primaryAxisTitle.text">Time</option>
		<option name="charting.secondaryAxisTitle.text"># of Attacks</option>
		<option name="charting.legend.placement">none</option>
    </chart>
    <table>
		<title>Top 10 Targeted URLs</title>
		<searchTemplate>sourcetype="DASP4" application="$application$" AND (HTTP_response_code="407" OR HTTP_response_code="413" OR HTTP_response_code="400" OR HTTP_response_code="403" OR HTTP_response_code="406"  OR HTTP_response_code="408"  OR HTTP_response_code="409"  OR HTTP_response_code="414"  OR HTTP_response_code="417") | stats count AS "Number of Attacks" by URL | sort 10 "Number of Attacks" desc</searchTemplate>
    </table>
	</row>
	<row>
    <chart>
      <title>Top 10 Sources</title>
      <searchTemplate>sourcetype="DASP4" application="$application$" AND (HTTP_response_code="407" OR HTTP_response_code="413" OR HTTP_response_code="400" OR HTTP_response_code="403" OR HTTP_response_code="406"  OR HTTP_response_code="408"  OR HTTP_response_code="409"  OR HTTP_response_code="414"  OR HTTP_response_code="417") | stats count AS "Number of Attacks" by source_ip | sort 10 "Number of Attacks" desc | rename "source_ip" AS "Source"</searchTemplate>
      <option name="charting.chart">bar</option>
      <option name="charting.legend.placement">none</option>
    </chart>
	<table>
		<title>Attacks Sources per Country</title>
		<searchTemplate>sourcetype="DASP4" application="$application$" AND (HTTP_response_code="407" OR HTTP_response_code="413" OR HTTP_response_code="400" OR HTTP_response_code="403" OR HTTP_response_code="406"  OR HTTP_response_code="408"  OR HTTP_response_code="409"  OR HTTP_response_code="414"  OR HTTP_response_code="417") | fields source_ip | iplocation | stats count(source_ip) AS "# Attacks" by Country</searchTemplate>
    </table>
  </row>
  <row>
	<table>
		<title>Attacks Detail</title>
		<searchTemplate>sourcetype="DASP4" application="$application$" AND (HTTP_response_code="407" OR HTTP_response_code="413" OR HTTP_response_code="400" OR HTTP_response_code="403" OR HTTP_response_code="406"  OR HTTP_response_code="408"  OR HTTP_response_code="409"  OR HTTP_response_code="414"  OR HTTP_response_code="417") | where isnull(alert_id) | convert ctime(_time) as date timeformat="%d/%m/%Y" | convert ctime(_time) as time timeformat="%H:%M:%S" | table date,time,source_ip,application,HTTP_response_code,HTTP_method,URL,URL_options | rename date AS "Date", time AS "Time",source_ip AS "Source",application AS "Application",HTTP_response_code AS "Code", HTTP_method AS "Method",URL AS "URL", URL_options AS "Parameters"</searchTemplate>
    </table>
  </row>
</form>

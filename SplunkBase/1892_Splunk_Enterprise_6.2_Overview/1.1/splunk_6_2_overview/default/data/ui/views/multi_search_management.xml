<dashboard>
  <label>Multi-Search Management</label>
  <description></description>
  <row>
    <panel>
      <title>Health Inspection Violations by Neighborhood</title>
      <search id="violations_by_neighborhood">
        <query>index="sf_food_health" sourcetype=sf_food_violations risk_category="*" neighborhood="*"  
| stats count(eval(risk_category="High Risk")) as "High Risk" count(eval(risk_category="Moderate Risk")) as "Moderate Risk" count(eval(risk_category="Low Risk")) as "Low Risk" count as "Total Violations" by neighborhood
        </query>
        <earliest>0</earliest>
        <latest></latest>   
      </search>
      <single>
        <search base="violations_by_neighborhood">
          <query>stats sum(High Risk)</query>
        </search>
        <option name="beforeLabel">High Risk Violations:</option>
        <option name="refresh.time.visible">false</option>
      </single>
      <single>
        <search base="violations_by_neighborhood">
          <query>stats sum(Moderate Risk)</query>
        </search>
        <option name="beforeLabel">Moderate Risk Violations:</option>
        <option name="refresh.time.visible">false</option>
      </single>
      <single>
        <search base="violations_by_neighborhood">
          <query>stats sum(Low Risk)</query>
        </search>
        <option name="beforeLabel">Low Risk Violations:</option>
        <option name="refresh.time.visible">false</option>
      </single>
      <chart>
        <title>Health Inspection Violations by Neighborhood</title>
        <search base="violations_by_neighborhood">
          <query>sort -"Total Violations" limit=10 
| fields - "Total Violations"</query>
        </search>
          <option name="charting.chart">bar</option>
          <option name="charting.chart.stackMode">stacked</option>
          <option name="charting.fieldColors">{"High Risk":0xD85E3D, "Moderate Risk":0xFAC61D,"Low Risk":0x6BB7C8}</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h2>Multi-Search and Post-Process</h2>
        <p>Configure multiple background searches, with explicit post process references throughout your dashboard.</p>
        <p>This allows users to:</p>
        <ul>
          <li>Optimize performance of the page by executing a single search that multiple visualizations leverage</li>
          <ul>
            <li>Note that there is a limit of 10k results passed down to post process search (for event-based searches)</li>
          </ul>
          <li>Drive multiple related form inputs from a single global search, and post process within each input</li>
          <li>In some cases, perform token-based searches within a post process so that you don't have to execute an expensive global search every time a new input is selected</li>
        </ul>
        <h3>How it Works</h3>
        <ul>
          <li>Global searches may be instantiated anywhere on the page (including within panels)</li>
          <li>Global searches (any search that you want to later perform a post process against) must include an "id" 
            <code>
              <![CDATA[<search id="global_search">...</search>]]>
            </code>
          </li>
          <li>Explicitly bind a postprocess query to any search using a base=""
            <code>
              <![CDATA[<search id="post_process_1" base="global_search">...</search>]]>
            </code>
          </li>
          <li>Included a saved search within a dashboard now uses the syntax ref=""
            <code>
              <![CDATA[<search ref="mySavedSearch">...</search>]]>
            </code>
          </li>          
          <li>New search syntax uses new syntax for earliest and latest (NOT earliestTime or latestTime)</li>
        </ul>
        <h3>Examples</h3>
        <h5>Global Search</h5>
        <pre>
          <![CDATA[
<!-- adding an id to the search allows for this to be referenced by any other searches on the page -->

   <search id="globalSearch">
      <query>index=_internal | top sourcetype</query>
      <earliest>-60m@m</earliest>
      <latest>now</latest>
   </search>
]]>
        </pre>
        <h5>Global Saved Search</h5>        
        <pre>
          <![CDATA[
<!-- Run a saved search by using the ref attribute within your search object -->

   <search id="globalSearch" ref="mySavedSearch"/>
]]>
        </pre>
        <h5>Global Saved Search using page-scope time range picker</h5>        
        <pre>
          <![CDATA[
<!-- Run a saved search by using the ref attribute within your search object -->

   <search id="globalSearch" ref="mySavedSearch">
      <earliest>$time.earliest$</earliest>
      <latest>$time.latest$</latest>
   </search>
]]>
        </pre>
        <h5>Use a Global Search In Multiple Visualizations</h5>        
        <pre>
          <![CDATA[
<!-- add an explicit search reference within dashboard elements to bind to global search results -->

   <search id="globalSearch">
      <query>index=_internal | top sourcetype</query>
      <earliest>-60m@m</earliest>
      <latest>now</latest>
   </search>

   <chart>
      <search base="globalSearch" />
   </chart>

   <table>
      <search base="globalSearch" />
   </table>
]]>
        </pre>
        <h5>Search Post Process</h5>        
        <pre>
          <![CDATA[

<!-- Search Post Process -->

   <search id="globalSearch">
      <query>index=_internal | top sourcetype</query>
      <earliest>-60m@m</earliest>
      <latest>now</latest>
   </search>

   <search base="globalSearch">
      <query>search sourcetype=splunkd</query>
   </search>  
]]>
        </pre>

        <h5>New Syntax for form input populaingSearch</h5>        
        <pre>
          <![CDATA[
<!-- New Syntax for form input populatingSearch -->

   <input type="dropdown" token="selected_sourcetype">
      <label>Sourcetype:</label>
      <search>
         <query>index=_internal | head 100 | stats count by sourcetype</query>
         <earliest>-60m@m</earliest>
         <latest>now</latest>
      </search>
      <fieldForLabel>sourcetype</fieldForLabel>
      <fieldForValue>sourcetype</fieldForValue>
   </input>  

]]>
        </pre>
      </html>
    </panel>
  </row>
</dashboard>

<dashboard>
  <label>Input Multi-token Setter</label>
  <description></description>
  <row>
    <panel>
      <title>Multi-token setter - conditional logic</title>
      <input type="dropdown" token="level">
        <label>Log Level:</label>
        <choice value="ANY">ANY</choice>
        <choice value="ERROR">ERROR</choice>
        <choice value="WARNING">WARNING</choice>
        <choice value="INFO">INFO</choice>
        <default>ANY</default>
        <change>
          <condition value="ANY">
            <set token="s_level"> </set>
          </condition>
          <condition value="*">
            <set token="s_level">log_level=$value|s$</set>
          </condition>
        </change>
      </input>
      <table>
        <title>Events List (if log_level is "ANY", also return events without log_level field)</title>
        <search>
          <query>index=_internal $s_level$ | table _time log_level _raw</query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">5</option>
      </table>
      <html>
        <p>Search query is:</p>
        <ul>
          <li><code><![CDATA[index=_internal $$s_level$$ | table _time log_level _raw]]></code></li>
        </ul>
        <p>Search query gets evaluated to:</p>
        <ul>
          <li><code><![CDATA[index=_internal $s_level$ | table _time log_level _raw]]></code></li>
        </ul>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h2>Input Multi-token Setter</h2>
        <p>Set multiple tokens within form inputs to drive multiple searches, better labeling, and more.</p>
        <p>Key use cases include:</p>
        <ul>
          <li>Set tokens for both label and value to use throughout your dashboard</li>
          <li>Use this to create a special empty/null choice that includes a unique token transformation</li>
          <li>Use the selection of a given form input to unset other tokens on the page</li>
          <li>Create a "simple" time range picker dropdown input that sets a unique earliest and latest token</li>
          <li>Set multiple tokens based on search results</li>
        </ul>
        <h3>How it Works</h3>
        <ul>
          <li>Ability to set/unset multiple tokens within a form input is only available via the xml editor</li>
          <li>Functional gets triggered on a user selected change event, <code><![CDATA[<change>]]></code></li>
          <li>Add conditions if you want to set/unset specific tokens and values based on user selection</li>
          <ul>
            <li>conditions can be based on user selected values, <code><![CDATA[<condition value="last_24hr">]]></code></li>
            <li>conditions can be based on user selected labels, <code><![CDATA[<condition label="Last 24 hours">]]></code></li>
            <li>wildcard (partial matching) is NOT support in conditions</li>
            <li>asterisk ("*") is interpreted as all other values, <code><![CDATA[<condition value="*">]]></code></li>
          </ul>
          <li>Note - conditions are not supported for multi-select and checkbox form inputs (any multi-value input)</li>
          <li>You have the following click information available for use in set/unset, <code><![CDATA[$label$, $value$]]></code></li>
          <li>For dynamic choices where you run a search, you can set tokens based on search results, <code><![CDATA[$row.field_name]]></code></li>
          <li>set and unset syntax works identical to contextual drilldown</li>
          <ul>
            <li><code><![CDATA[<set token="my_token_value">$value$</set>]]></code></li>
            <li><code><![CDATA[<set token="my_token_label">$label$</set>]]></code></li>
            <li><code><![CDATA[<set token="my_token">field=$value|s$</set>]]></code></li>
            <li><code><![CDATA[<set token="my_token" prefix="(" suffix=")" delimiter=" OR ">field=$value|s$</set>]]></code></li>
            <li><code><![CDATA[<set token="my_token">$row.sourcetype$</set>]]></code></li>
            <li><code><![CDATA[<unset token="showTable"/>]]></code></li>
          </ul>
        </ul>
        <br/>
        <h5>Use a static choice "ANY" to represent an empty/null value, where it searches for events both with and without the existence of the field</h5>
        <pre>
<![CDATA[
      <input type="dropdown" token="level">
        <label>Log Level:</label>
        <choice value="ANY">ANY</choice>
        <choice value="ERROR">ERROR</choice>
        <choice value="WARNING">WARNING</choice>
        <choice value="INFO">INFO</choice>
        <default>ANY</default>
        <change>
          <condition value="ANY">
            <set token="s_level"> </set>
          </condition>
          <condition value="*">
            <set token="s_level">log_level=$value|s$</set>
          </condition>
        </change>
      </input>]]>
        </pre>
        <h5>Simple Time Range Picker</h5>
        <pre>
<![CDATA[
      <input type="dropdown" token="simple">
        <label>Simple Time Picker</label>
        <choice value="last_24h">Last 24 Hours</choice>
        <choice value="last_7d">Last 7 days</choice>
        <choice value="last_30d">Last 30 days</choice>
        <default>last_24h</default>
        <change>
          <condition value="last_24h">
            <set token="simple.label">$label$</set>
            <set token="simple.earliest">-24h</set>
            <set token="simple.latest">now</set>
          </condition>
          <condition value="last_7d">
            <set token="simple.label">$label$</set>
            <set token="simple.earliest">-7d</set>
            <set token="simple.latest">now</set>
          </condition>
          <condition value="last_30d">
            <set token="simple.label">$label$</set>
            <set token="simple.earliest">-30d</set>
            <set token="simple.latest">now</set>
          </condition>
        </change>
      </input>]]>
        </pre>      
        <h5>Setting token to represent the user selected label</h5>
        <pre>
<![CDATA[
      <input type="time" token="time">
        <label></label>
        <default>
           <earliest>-60m@m</earliest>
           <latest>now</latest>
        </default>
        <change>
           <set token="time.label">$label$</set>
        </change>
      </input>]]>
        </pre>  
        <h5>Hidden Search Swapper</h5>
        <pre>
<![CDATA[
<!-- Based on user selected value, set a token to represent the full search string -->

      <form>
        <label>test search swapper</label>
        <fieldset submitButton="false">
          <input type="time" token="field1">
          <label></label>
          <default>
            <earliest>-60m@m</earliest>
            <latest>now</latest>
          </default>
          <change>
            <condition label="All time">
              <set token="new_search">`set_sos_index` sourcetype="ps" $host$
                | multikv
                | `get_splunk_process_type`
                | eval RSZ_MB=RSZ_KB/1024
                | eval VSZ_MB=VSZ_KB/1024
                | bin _time span=5s
                | stats first(pctCPU) AS pctCPU, first(RSZ_MB) AS RSZ_MB, first(VSZ_MB) AS VSZ_MB first(type) AS type by PID _time
                | stats sum(pctCPU) AS pctCPU, sum(RSZ_MB) AS RSZ_MB, sum(VSZ_MB) AS VSZ_MB by type, _time
                | bin _time span=10s
                | sistats avg(pctCPU), median(pctCPU), median(RSZ_MB), median(VSZ_MB) by type, _time</set>
            </condition>
            <condition label="Last 24 hours">
              <set token="new_search">index=_internal sourcetype=splunkd | table _time sourcetype message</set>
            </condition>
            <condition value="*">
              <set token="new_search">index=_internal sourcetype=splunkd | table _time source sourcetype message</set>
            </condition>
          </change>
        </input>
      </fieldset>
   </form>]]>
        </pre>          
      </html>
    </panel>
  </row>
</dashboard>

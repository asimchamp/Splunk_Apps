<form>
  <label>Neighborhood Details</label>
  <description></description>
  <fieldset submitButton="false">
    <input type="dropdown" token="neighborhood">
      <label>Neighborhood</label>
      <choice value="*">All</choice>
      <populatingSearch fieldForLabel="neighborhood" fieldForValue="neighborhood">index="sf_food_health" sourcetype=sf_food_violations risk_category="*" neighborhood="*" 
| stats count by neighborhood
| sort +neighborhood</populatingSearch>
      <selectFirstChoice>true</selectFirstChoice>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Top Businesses by Violations</title>
      <table>
        <searchString>index="sf_food_health" sourcetype=sf_food_violations risk_category="*" neighborhood="$neighborhood$" | stats values(name) as name values(address) as address values(neighborhood) as neighborhood count(eval(risk_category="High Risk")) as "High Risk" count(eval(risk_category="Moderate Risk")) as "Moderate Risk" count(eval(risk_category="Low Risk")) as "Low Risk" count as "Total Violations" by business_id | fields - business_id | sort -"Total Violations"</searchString>
        <earliestTime>0</earliestTime>
        <latestTime></latestTime>
        <option name="wrap">true</option>
        <option name="rowNumbers">true</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top Businesses by Violations</title>
      <map>
        <searchString>index="sf_food_health" sourcetype=sf_food_violations risk_category="*" neighborhood="$neighborhood$"
| geostats latfield="latitude" longfield="longitude" count by risk_category</searchString>
        <earliestTime>0</earliestTime>
        <latestTime></latestTime>
        <option name="mapping.data.maxClusters">100</option>
        <option name="mapping.map.center">(37.76,-122.44)</option>
        <option name="mapping.map.zoom">12</option>
        <option name="mapping.markerLayer.markerMaxSize">50</option>
        <option name="mapping.markerLayer.markerMinSize">10</option>
        <option name="mapping.markerLayer.markerOpacity">0.8</option>
        <option name="mapping.tileLayer.maxZoom">20</option>
        <option name="mapping.tileLayer.minZoom">0</option>
        <option name="mapping.tileLayer.url">http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png</option>
        <option name="drilldown">all</option>
      </map>
    </panel>
  </row>
</form>

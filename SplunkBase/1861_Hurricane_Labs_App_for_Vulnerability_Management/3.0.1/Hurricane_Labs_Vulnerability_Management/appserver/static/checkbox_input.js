require(['jquery',
    'underscore',
    'splunkjs/mvc',
    'splunkjs/mvc/checkboxgroupview',
    'splunkjs/mvc/searchmanager',
    'splunkjs/mvc/simplexml/ready!'], 
    function($, _, mvc, CheckBoxGroupView,SearchManager){
        //Overview Checkboxes
        multiSelectOverview = new CheckBoxGroupView({
            "id": "overview_checkboxes",
            "value": "$submitted:multiToken$",
            "el": $('#risk_overview'),
            "labelField": "severity",
            "valueField": "severity",
            "managerid": "multiSearchOverview"
        }, {tokens: true}).render();
        var multiSearchOverview = new SearchManager({
            "id": "multiSearchOverview",
            "earliest_time": "$earliest$",
            "status_buckets": 0,
//            "search": "index=nessus sourcetype=nessus* | lookup risk_lookup Risk OUTPUTNEW Risk_Level  | stats count by Risk, Risk_Level | sort -Risk_Level",
            "search": "tag=vulnerability tag=report report_id=$scan_id$ | stats count by display_severity,severity_id | sort -severity_id | rename display_severity as severity",
            "cancelOnUnload": true,
            "latest_time": "$latest$",
            "auto_cancel": 90,
            "preview": true
        }, {tokens: true});
        //Event Checkboxes

        multiSelectEvent = new CheckBoxGroupView({
            "id": "event_checkboxes",
            "value": "$submitted:multiToken$",
            "el": $('#risk_event'),
            "labelField": "severity",
            "valueField": "severity",
            "managerid": "multiSearchEvent"
        }, {tokens: true}).render();
        var multiSearchEvent = new SearchManager({
            "id": "multiSearchEvent",
            "earliest_time": "$earliest$",
            "status_buckets": 0,
//            "search": 'index=nessus sourcetype=nessus* Host="$_host$" CVE="$_cve$" | lookup risk_lookup Risk OUTPUTNEW Risk_Level  | stats count by Risk, Risk_Level | sort -Risk_Level',
            "search": 'tag=vulnerability tag=report report_id=$scan_id$ dest="$_host$" cve=* | makemv delim="," cve | mvexpand cve | search cve="$_cve$" | stats count by display_severity,severity_id | sort -severity_id | rename display_severity as severity',
            "cancelOnUnload": true,
            "latest_time": "$latest$",
            "auto_cancel": 90,
            "preview": true
        }, {tokens: true});

        //Plugin ID Checkboxes
        multiSelectPlugin = new CheckBoxGroupView({
            "id": "plugin_checkboxes",
            "value": "$submitted:multiToken$",
            "el": $('#risk_by_plugin'),
            "labelField": "severity",
            "valueField": "severity",
            "managerid": "multiSearchPlugin"
        }, {tokens: true}).render();
        var multiSearchPlugin = new SearchManager({
            "id": "multiSearchPlugin",
            "earliest_time": "$earliest$",
            "status_buckets": 0,
//            "search": 'index=nessus sourcetype=nessus* PluginID="$PluginID$" | lookup risk_lookup Risk OUTPUTNEW Risk_Level | stats count by Risk, Risk_Level | sort -Risk_Level',
            "search": 'tag=vulnerability tag=report report_id=$scan_id$ signature_id="$PluginID$" | stats count by display_severity,severity_id | sort -severity_id | rename display_severity as severity",
            "cancelOnUnload": true,
            "latest_time": "$latest$",
            "auto_cancel": 90,
            "preview": true
        }, {tokens: true});
    }
);

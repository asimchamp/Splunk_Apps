<form>
  <label>Universal View</label>
  <description>A single universal view on the THOR events</description>
  <fieldset submitButton="false" autoRun="true">
    <input type="checkbox" token="eventlevel_selection" searchWhenChanged="true">
      <label>Event Level</label>
      <choice value="level=Alarm OR level=Alert">Alerts</choice>
      <choice value="level=Warning">Warnings</choice>
      <choice value="level=Notice">Notices</choice>
      <choice value="level=Error">Errors</choice>
      <choice value="level=Info">Infos</choice>
      <choice value="level=Debug">Debug</choice>
      <delimiter> OR </delimiter>
      <default>level=Alarm OR level=Alert,level=Warning</default>
    </input>
    <input type="checkbox" token="module_selection" searchWhenChanged="true">
      <label>Modules</label>
      <delimiter> OR </delimiter>
      <choice value="module=DNSCache OR module=Hosts OR module=Mutex OR module=NamedPipe">Caches Mutexes Pipes</choice>
      <choice value="module=DeepDive">DeepDive</choice>
      <choice value="module=Eventlog">Eventlog</choice>
      <choice value="module=Filescan OR module=ArchiveCheck OR module=MFT">Files</choice>
      <choice value="module=Connections OR module=NetworkShares OR module=Firewall">Network</choice>
      <choice value="module=Process*">Processes</choice>
      <choice value="module=Registry* OR module=SHIMCache">Registry</choice>
      <choice value="module=ScheduledTaks OR module=AtJobs OR module=AtJobFile OR module=AutoRuns">Scheduled Elements</choice>
      <choice value="module=*Startup OR module=RunKeyCheck">Startup</choice>
      <choice value="module=VulnerabilityCheck OR module=HotfixCheck">Vulnerabilities</choice>
      <choice value="module=CommandCheck OR module=Decompressor OR module=Prefetch OR module=UserAccounts OR module=UserDir OR module=WER OR module=STIX OR module=OpenFiles OR module=LSASessions">Miscellaneous</choice>
      <default>module=DNSCache OR module=Hosts OR module=Mutex OR module=NamedPipe,module=Eventlog,module=Filescan OR module=ArchiveCheck OR module=MFT,module=Connections OR module=NetworkShares OR module=Firewall,module=Process*,module=Registry* OR module=SHIMCache,module=*Startup OR module=RunKeyCheck,module=VulnerabilityCheck OR module=HotfixCheck,module=ScheduledTaks OR module=AtJobs OR module=AtJobFile,module=ScheduledTaks OR module=AtJobs OR module=AtJobFile OR module=AutoRuns</default>
    </input>
    <input type="checkbox" token="special_selection" searchWhenChanged="true">
      <label>Special Selection</label>
      <choice value="*">All Events</choice>
      <choice value="&quot;*HVS Client*&quot;">Custom Client Signatures</choice>
      <choice value="APT">APT</choice>
      <choice value="hacktool OR &quot;hack tool&quot; OR hackertool OR Dumper OR Dump">Hacktools</choice>
      <choice value="&quot;webshell&quot; OR &quot;web shell&quot;">Web Shells</choice>
      <choice value="NOT &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;T&quot;  NOT &quot;*_thor_*&quot; NOT &quot;changelog&quot; NOT &quot;\\thor&quot;">No THOR Reports</choice>
      <choice value="NOT tag=typical_false_positives">No Typical False Positives</choice>
      <choice value="NOT tag=known_compromised">No Known Compromised</choice>
      <delimiter> </delimiter>
      <default>*</default>
    </input>
    <input type="text" token="search_value" searchWhenChanged="true">
      <label>Search</label>
      <default>*</default>
    </input>
    <input type="text" token="falsepositive_definition" searchWhenChanged="true">
      <label>Filter</label>
      <prefix>NOT (</prefix>
      <suffix>)</suffix>
      <default>"quick false positive definition filter"</default>
    </input>
    <input type="time" token="timepicker1" searchWhenChanged="true">
      <label>Time Frame</label>
      <default>
        <earliest>-30d@d</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="decrypt" searchWhenChanged="true">
      <label>Log Type</label>
      <choice value="THOR">plain text</choice>
      <choice value="`decrypt_thor_events`">encrypted</choice>
      <default>THOR</default>
      <initialValue>THOR</initialValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Base Analysis</title>
        <search>
          <query>eventtype=thor_events $search_value$ NOT tag=false_positive ( $eventlevel_selection$ ) ( $module_selection$ ) ( $special_selection$ ) ( $falsepositive_definition$ ) | eval reason=MESSAGE | eval element=file | eval reason=if(mainreason!="",mainreason,reason) | eval reason = if(DESCRIPTION!="",DESCRIPTION,reason) | eval reason = if(PATTERN!="",PATTERN,reason) | eval element = if(STRING!="",STRING,element) | eval element = if(ENTRY!="",ENTRY,element) | eval element = if(COMMAND!="",COMMAND,element) | eval element = if(KEY!="",KEY,element) | eval score=if(isnull(score) AND (level=="Notice"),50,score) | eval score=if(isnull(score) AND (level=="Warning"),70,score) | eval score=if(isnull(score) AND (level=="Alarm"),100,score) | eval score=if(isnull(score) AND (level=="Alert"),100,score) | table system,module,score,reason,element,_raw | sort -score</query>
          <earliest>$timepicker1.earliest$</earliest>
          <latest>$timepicker1.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>
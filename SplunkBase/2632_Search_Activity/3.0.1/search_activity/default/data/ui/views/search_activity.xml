<form script="check_data_availability.js,AddDescriptions.js,ShowPanelsSelectively.js">
  <label>Search Activity</label>
  <search id="globalmetrics">
    <query>| tstats `SearchActivitySummaries` prestats=t count as NumSearches dc(Search_History.user) as NumUsers sum(Search_History.result_count) as NumResults from `SA_SearchHistory` by _time span=1d 
| tstats `SearchActivitySummaries` prestats=t append=t sum(Log_Events.is_exported) as NumExports sum(Log_Events.is_shared) as NumShares from `SA_Events` by _time span=1d 
| timechart span=1d  count as NumSearches dc(Search_History.user) as NumUsers sum(Search_History.result_count) as NumResults sum(Log_Events.is_exported) as NumExports sum(Log_Events.is_shared) as NumShares
| fillnull</query>
    <earliest>-30d@d</earliest>
    <latest>@d</latest>
  </search>
  <fieldset submitButton="false">
    <input type="time" token="field1" searchWhenChanged="true">
      <label></label>
      <default>
        <earliestTime>-30d@d</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="multiselect" token="sh_clause">
      <label>Search Head</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` groupby Search_History.SearchHead | `SARename`</query>
      </search>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>Search_History.SearchHead=</valuePrefix>
      <delimiter> OR </delimiter>
      <default>*</default>
      <fieldForLabel>SearchHead</fieldForLabel>
      <fieldForValue>SearchHead</fieldForValue>
    </input>
    <input type="dropdown" token="user_criteria" searchWhenChanged="true">
      <label>Select Leader (Based on Org Chart)</label>
      <choice value="*">All</choice>
      <default>*</default>
      <populatingSearch earliest="$earliest$" latest="$latest$" fieldForLabel="MyName" fieldForValue="tstats_search_criteria">| inputlookup LDAPMgmtChain | makemv delim="|" ManagementChain_sAMAccountName | stats values(sAMAccountName) as user by ManagementChain_sAMAccountName | eval tstats_search_criteria="(Search_History.user=" . mvjoin(user," OR Search_History.user=") . ")" | lookup LDAPSearch sAMAccountName as ManagementChain_sAMAccountName OUTPUTNEW name | eval MyName=coalesce(name . " (" . ManagementChain_sAMAccountName . ")", ManagementChain_sAMAccountName) | sort MyName</populatingSearch>
    </input>
    <input type="dropdown" token="tagged_user_criteria" searchWhenChanged="true">
      <label>Tagged Users</label>
      <choice value="*">All Users</choice>
      <searchString>|inputlookup TaggedUsers | stats values(user) as user by category | eval search="(Search_History.user=" . mvjoin(user, " OR Search_History.user=") . ")" | stats values(category) as category by search | eval category=mvjoin(category," / ")</searchString>
      <fieldForLabel>category</fieldForLabel>
      <fieldForValue>search</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>
  <search>
    <query>| makeresults | eval search=$sh_clause|s$ | rex mode=sed field=search "s/Search_History.SearchHead/Log_Events.SearchHead/"  </query>
    <done>
      <set token="events_sh_clause">$result.search$</set>
    </done>
  </search> 
  <row>
    <panel>
      <title>Yesterday Daily Active Users</title>
      <single>
        <search base="globalmetrics">
          <query>| table _time NumUsers</query>
        </search>
        <option name="colorBy">trend</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Yesterday # of Searches</title>
      <single>
        <search base="globalmetrics">
          <query>| table _time NumSearches</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="trendDisplayMode">percent</option>
      </single>
    </panel>
    <panel>
      <title>Yesterday # of Results</title>
      <single>
        <search base="globalmetrics">
          <query>| table _time NumResults</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="trendDisplayMode">percent</option>
      </single>
    </panel>
    <panel>
      <title>Yesterday # of Shares</title>
      <single>
        <search base="globalmetrics">
          <query>| table _time NumShares</query>
        </search>
      </single>
    </panel>
    <panel>
      <title>Yesterday # of Exports</title>
      <single>
        <search base="globalmetrics">
          <query>| table _time NumExports</query>
        </search>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Overall Metrics</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  groupby Search_History.searchtype, Search_History.user _time span=1d | multireport [ | stats sum(count) as count sum(eval(if('Search_History.searchtype'="adhoc",count,0))) as "Adhoc Search Count" sum(eval(if('Search_History.searchtype'="dashboard",count,0))) as "Dashboard Search Count" sum(eval(if('Search_History.searchtype'="realtime",count,0))) as "Realtime Search Count" sum(eval(if('Search_History.searchtype'="scheduled",count,0))) as "Scheduled Search Count" sum(eval(if('Search_History.searchtype'="summarization",count,0))) as "Summarization Search Count" by Search_History.user | stats sum(count) as "Total Number of Searches" count as "Number of Users" count(eval(count&gt;30)) as "Number of Users with &gt; 30 searches" sum("* Search Count") as "* Search Count" | eval Type = "Total"   ]  [ | stats sum(count) as count sum(eval(if('Search_History.searchtype'="adhoc",count,0))) as "Adhoc Search Count" sum(eval(if('Search_History.searchtype'="dashboard",count,0))) as "Dashboard Search Count" sum(eval(if('Search_History.searchtype'="realtime",count,0))) as "Realtime Search Count" sum(eval(if('Search_History.searchtype'="scheduled",count,0))) as "Scheduled Search Count" sum(eval(if('Search_History.searchtype'="summarization",count,0))) as "Summarization Search Count" by Search_History.user, _time     | stats sum(count) as "Total Number of Searches" count as "Number of Users" count(eval(count&gt;30)) as "Number of Users with &gt; 30 searches" sum("* Search Count") as "* Search Count" by _time     | stats avg(*) as *     | eval Type = "Daily Average"    ] | foreach *Number* *Count*     [ eval "&lt;&lt;FIELD&gt;&gt;"=round('&lt;&lt;FIELD&gt;&gt;',1)] | fields Type *Number* *Count*</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Top Users</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count sum(Search_History.total_run_time) as total_run_time sum(Search_History.Accuracy) as Accuracy sum(Search_History.search_command_complexity) as Complexity sum(Search_History.ShouldInvestigate) as ShouldInvestigate from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  groupby _time Search_History.user Search_History.searchtype span=1d
| stats sum(count) as NumSearches count(eval('Search_History.searchtype'="adhoc")) as NumAdHocSearches sparkline(sum(count)) as UsageTrend sum(total_run_time) as HoursOfSearchTime sum(eval(if('Search_History.searchtype'="adhoc", total_run_time,0))) as HoursOfAdHocSearchTime sum(Accuracy) as Accuracy sum(Complexity) as Complexity sum(ShouldInvestigate) as ShouldInvestigate avg(eval(if('Search_History.searchtype'="adhoc", total_run_time,0))) as AvgSearchTime by Search_History.user
| join type=left Search_History.user [ | tstats `SearchActivitySummaries` sum(Log_Events.is_exported) as "# Exports" sum(Log_Events.is_shared) as "# Shares"  from `SA_Events` where $events_sh_clause$ groupby Log_Events.user  | rename Log_Events.user as Search_History.user]
| eval Accuracy = Accuracy / NumSearches, Complexity=Complexity / NumSearches
    | eval HoursOfSearchTime = round(HoursOfSearchTime/3600,2) 
    | eval HoursOfAdHocSearchTime = round(HoursOfAdHocSearchTime/3600,2) 
   | eval comment = "I need to add exports back in, once that datamodel is set"
   | sort 0 "Accuracy" | streamstats count as "Accuracy Order" | eventstats count(eval(isnotnull('Accuracy') AND 'Accuracy'&gt;=0)) as "NumAccuracyUsers" | eval "Accuracy Order" = 'Accuracy Order' . " out of " . NumAccuracyUsers 
   | sort 0 "Complexity" | streamstats count as "Complexity Order" | eventstats count(eval(isnotnull('Complexity') AND 'Complexity'&gt;=0)) as "NumComplexityUsers"| eval "Search Complexity Order" = 'Complexity Order' . " out of " . NumComplexityUsers 
   | sort 0 - "ShouldInvestigate" | streamstats count as "ShouldInvestigate Order" | eventstats count(eval(isnotnull('ShouldInvestigate') AND 'ShouldInvestigate'&gt;=0)) as "NumShouldInvestigateUsers" | eval "Questionable Search Order" = 'ShouldInvestigate Order' . " out of " . NumShouldInvestigateUsers 
   | sort 0 - "AvgSearchTime" | streamstats count as "AvgSearchTime Order" | eventstats count(eval(isnotnull('AvgSearchTime') AND 'AvgSearchTime'&gt;=0)) as "NumAvgSearchTimeUsers"| eval "Slow Search Runtime Order" = 'AvgSearchTime Order' . " out of " . NumAvgSearchTimeUsers
   | rename Search_History.user as User
   | `ldapsearch_lookup(User,mail)`
| fields User NumSearches NumAdHocSearches UsageTrend "#*" HoursOfSearchTime HoursOfAdHocSearchTime "Accuracy Order" "Search Complexity Order"  "Questionable Search Order" "Slow Search Runtime Order" mail 
| sort - NumSearches 
| where NumSearches&gt;0  
| fillnull value="N/A"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$row.User$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Top Apps and Views</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count  from `SA_Events` where $events_sh_clause$ $tagged_user_criteria$ $user_criteria$  Log_Events.type=weblog  groupby Log_Events.myapp Log_Events.myview | `SARename` | stats sum(count) as count by myapp, myview  | sort myapp,  -count | streamstats count as mycount by myapp | where mycount &lt;=5 | stats sum(count) as "Total Hits" list(count) as "Hits Per View" list(myview) as "Views" by myapp | rename myapp to "App" | sort - "Total Hits"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row depends="$OnNothingHideThis$">
    <panel>
      <html>
      <div id="ProvideQuestions">
      </div>
    </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Top Users</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  groupby _time Search_History.user span=1d |  `SARename`| `ldapsearch_lookup(user, cn)` | eval user=coalesce(cn . " (" . user . ")", user)  | timechart  sum(count) by user useother=f limit=20 | fields - splunk-system-user</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$click.name2$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Count by Search Type</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$ groupby _time Search_History.searchtype span=1d | `SARename` | timechart sum(count) by searchtype</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/user_search?form.searchtype=$click.name2$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Activity By Search Head</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$ groupby Search_History.searchtype, Search_History.SearchHead | `SARename` | chart sum(count) over SearchHead by searchtype</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Exported Search Results (Filters Not Supported)</title>
        <search>
          <query>| tstats `SearchActivitySummaries` prestats=t count dc(Log_Events.user) values(Log_Events.user) from `SA_Events` where Log_Events.is_exported=1 groupby Log_Events.searchid
| tstats `SearchActivitySummaries` prestats=t append=t values(Search_History.actualsearch) values(Search_History.user) values(Search_History.result_count) from `SA_SearchHistory` where [| tstats `SearchActivitySummaries` count from `SA_Events` where Log_Events.is_exported=1 groupby Log_Events.searchid | rename Log_Events.searchid as Search_History.searchid | table Search_History.searchid ] groupby Search_History.searchid
| eval searchid=coalesce('Log_Events.searchid', 'Search_History.searchid') 
| stats count as Num_Exports dc(Log_Events.user) as Num_Users values(Log_Events.user)  as Users_Who_Exported values(Search_History.actualsearch) as Search_String values(Search_History.user) as User_Who_Started_Search values(Search_History.result_count) as Num_Results by searchid
| table Num_Results Num_Exports Num_Users Users_Who_Exported User_Who_Started_Search Search_String searchid</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$row.user$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <chart>
        <title>Number of Shared Searches over Time</title>
        <search>
          <query>| tstats `SearchActivitySummaries` prestats=t count from `SA_Events` where Log_Events.is_shared=1 groupby  Log_Events.user _time span=1d | timechart span=1d count by Log_Events.user</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$click.name2$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Search Commands Associated with Expensive Searches</title>
        <search>
          <query>| tstats `SearchActivitySummaries` count as "Number of Searches" avg(Search_History.total_run_time) as Avg_Total_Run_Time stdev(Search_History.total_run_time) as StDev_Total_Run_Time  from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  Search_History.searchtype=adhoc Search_History.total_run_time&gt;300 groupby Search_History.searchcommands | sort - Avg_Total_Run_Time | foreach *Total* [ | eval &lt;&lt;FIELD&gt;&gt; = round(&lt;&lt;FIELD&gt;&gt;,2)]</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Average Search Timespan by User</title>
        <search>
          <query>| tstats `SearchActivitySummaries` sum(Search_History.total_run_time) as total_run_time avg(Search_History.searchspan_m) as searchspan_m  avg(Search_History.searchspan_h) as searchspan_h avg(Search_History.searchspan_d) as searchspan_d   from `SA_SearchHistory`  where * $sh_clause$ $tagged_user_criteria$ $user_criteria$ groupby Search_History.user | `SARename` | eval total_run_time=round(total_run_time/3600,2)  | where user!="n/a" | rename searchspan_m as "Search Timespan (min)" searchspan_d as "Search Timespan (day)" searchspan_h as "Search Timespan (hour)" total_run_time as "Total Search Runtime (h)" | sort - "Total Search Runtime (h)" | where user!="splunk-system-user" | foreach *Timespan* [| eval "&lt;&lt;FIELD&gt;&gt;" = round('&lt;&lt;FIELD&gt;&gt;',2)]</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$row.user$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Change in User Search Settings</title>
        <search>
          <query>| tstats `SearchActivitySummaries` sum(Search_History.total_run_time) as total_run_time avg(Search_History.Accuracy) as accuracy sum(Search_History.result_count) as result_count sum(Search_History.scan_count) as scan_count sum(Search_History.searchspan_m) as searchspan_m  from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  groupby _time | eval ResultsPerSecond=result_count / total_run_time | eval ScannedPerSecond=scan_count / total_run_time| timechart span=1d avg(accuracy) as accuracy avg(*PerSecond) as *PerSecond avg(searchspan_m) as searchspan_m  avg(result_count) as result_count  | eventstats avg(accuracy) as avgaccuracy avg(ResultsPerSecond) as avgResultsPerSecond avg(ScannedPerSecond) as avgScannedPerSecond avg(searchspan_m) as avgsearchspan_m avg(result_count) as avgresult_count | eval accuracy=round(100*(accuracy/avgaccuracy)) | eval ResultsPerSecond=round(100*(ResultsPerSecond/avgResultsPerSecond)) | eval ScannedPerSecond=round(100*(ScannedPerSecond/avgScannedPerSecond)) | eval searchspan_m=round(100*(searchspan_m/avgsearchspan_m)) | eval result_count=round(100*(result_count/avgresult_count)) | fields - avg* | rename accuracy AS "Accuracy (% Delta)" ResultsPerSecond as "Results/Second (% Delta)" ScannedPerSecond as "Scanned/Second (% Delta)" searchspan_m as "Timespan (% Delta)" result_count as "# Results (% Delta)" | fields _time  "*Results *" "Accuracy*" "Timespan*"  | timechart  bins=50 avg(*) as *</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$click.name2$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Change in System Search Performance Metrics</title>
        <search>
          <query>| tstats `SearchActivitySummaries` sum(Search_History.total_run_time) as total_run_time avg(Search_History.Accuracy) as accuracy sum(Search_History.result_count) as result_count sum(Search_History.event_count) as event_count sum(Search_History.scan_count) as scan_count sum(Search_History.searchspan_m) as searchspan_m  from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$  groupby _time | eval EventsPerSecond=event_count / total_run_time | eval ScannedPerSecond=scan_count / total_run_time| timechart span=1d avg(accuracy) as accuracy avg(*PerSecond) as *PerSecond avg(searchspan_m) as searchspan_m  avg(result_count) as result_count  | eventstats avg(accuracy) as avgaccuracy avg(EventsPerSecond) as avgEventsPerSecond avg(ScannedPerSecond) as avgScannedPerSecond avg(searchspan_m) as avgsearchspan_m avg(result_count) as avgresult_count | eval accuracy=round(100*(accuracy/avgaccuracy)) | eval EventsPerSecond=round(100*(EventsPerSecond/avgEventsPerSecond)) | eval ScannedPerSecond=round(100*(ScannedPerSecond/avgScannedPerSecond)) | eval searchspan_m=round(100*(searchspan_m/avgsearchspan_m)) | eval result_count=round(100*(result_count/avgresult_count)) | fields - avg* | rename accuracy AS "Accuracy (% Delta)" EventsPerSecond as "Events/Second (% Delta)" ScannedPerSecond as "Scanned/Second (% Delta)" searchspan_m as "Timespan (% Delta)" result_count as "# Results (% Delta)" | fields _time "*Second*" | timechart  bins=50 avg(*) as *</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisEnd</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link>
            <![CDATA[/app/search_activity/per_user_dashboard?form.user=$click.name2$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]>
          </link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Median Search Runtime Over Time</title>
        <search>
          <query>| tstats `SearchActivitySummaries` prestats=t median(Search_History.total_run_time) from `SA_SearchHistory` where * $sh_clause$ $tagged_user_criteria$ $user_criteria$ groupby Search_History.searchtype _time span=1d  | timechart median(Search_History.total_run_time) by  Search_History.searchtype</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
</form>
<form script="check_data_availability.js">
  <label>Find Searches</label>
  <description></description>
  <fieldset submitButton="true">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliestTime>-30d@d</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="text" token="total_run_time_gt">
      <label>Total Run Time &gt;=</label>
      <default>0</default>
      <prefix>Search_History.total_run_time&gt;=</prefix>
    </input>
    <input type="text" token="result_count_gt">
      <label>Result Count &gt;=</label>
      <default>0</default>
      <prefix>Search_History.result_count&gt;=</prefix>
    </input>
    <input type="text" token="scan_count_gt">
      <label>Scan Count &gt;=</label>
      <default>0</default>
      <prefix>Search_History.scan_count&gt;=</prefix>
    </input>
    <input type="multiselect" token="searchtype">
      <label>Search Type(s)</label>
      <choice value="adhoc">Adhoc</choice>
      <choice value="scheduled">Scheduled</choice>
      <choice value="summarization">Summarization</choice>
      <choice value="realtime">Realtime</choice>
      <choice value="dashboard">Dashboard</choice>
      <valuePrefix>Search_History.searchtype=</valuePrefix>
      <valueSuffix>*</valueSuffix>
      <delimiter> OR </delimiter>
      <default>adhoc,summarization,scheduled,realtime,dashboard</default>
    </input>
    <input type="dropdown" token="searchcommands">
      <label>Search Commands</label>
      <choice value="*">Any</choice>
      <populatingSearch fieldForLabel="searchcommands" fieldForValue="searchcommands">| tstats `SearchActivitySummaries` count from `SA_SearchHistory` by Search_History.searchcommands | `SARename`  | where searchcommands!="search"</populatingSearch>
      <default>*</default>
      <prefix>Search_History.searchcommands=</prefix>
    </input>
    <input type="text" token="user">
      <label>Username (Wildcards Supported)</label>
      <default>*</default>
      <prefix>Search_History.user=</prefix>
    </input>
    <input type="radio" token="shouldinvestigate">
      <label>Questionable Searches</label>
      <choice value="*">Either</choice>
      <choice value="Search_History.ShouldInvestigate&gt;0">Yes</choice>
      <choice value="Search_History.ShouldInvestigate=0">No</choice>
      <default>*</default>
    </input>
    <input type="multiselect" token="sh_clause">
      <label>Search Head</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats `SearchActivitySummaries` count from `SA_SearchHistory` groupby Search_History.SearchHead | `SARename`</query>
      </search>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>Search_History.SearchHead=</valuePrefix>
      <delimiter> OR </delimiter>
      <default>*</default>
      <fieldForLabel>SearchHead</fieldForLabel>
      <fieldForValue>SearchHead</fieldForValue>
    </input>
    <input type="text" token="searchString">
      <label>Search Keywords (Inclusive Only)</label>
      <default>*</default>
      <prefix>Search_History.actualsearch="*</prefix>
      <suffix>*"</suffix>
    </input>
  </fieldset>
  <row>
      <table>
        <title>Results</title>
        <searchString>| tstats `SearchActivitySummaries` min(_time) as _time values(Search_History.actualsearch) as actualsearch values(Search_History.savedsearch_name) as savedsearch_name values(Search_History.searchtype) as searchtype values(Search_History.total_run_time) as total_run_time values(Search_History.result_count) as result_count values(Search_History.scan_count) as scan_count values(Search_History.event_count) as event_count values(Search_History.ShouldInvestigate) as ShouldInvestigate from `SA_SearchHistory` where *  $searchString$ $total_run_time_gt$  $result_count_gt$  $scan_count_gt$  $searchtype$  $searchcommands$  $sh_clause$  $user$  $shouldinvestigate$  by Search_History.searchid | `SARename`  | lookup LDAPSearch sAMAccountName as user OUTPUTNEW name mail telephoneNumber  | lookup LDAPMgmtChain sAMAccountName as user OUTPUT ManagementChain| makemv delim="|" ManagementChain | eval ManagementChain=if(isnull(ManagementChain)," ",ManagementChain)</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <drilldown>
          <link>/app/search_activity/per_user_dashboard?form.user=$row.user$</link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
</form>
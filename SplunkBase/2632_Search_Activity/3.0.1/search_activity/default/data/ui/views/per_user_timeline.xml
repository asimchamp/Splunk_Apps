<form script="per_user_timeline.js">
  <label>Per User Timeline</label>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="field1" searchWhenChanged="true">
      <label></label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="user" searchWhenChanged="true">
      <label>User</label>
      <search>
        <query>| tstats `SearchActivitySummaries` count  from `SA_SearchHistory` groupby Search_History.user | fields - count | `SARename` | `ldapsearch_lookup(user, cn)` | eval name=coalesce(cn . " (" . user . ")", user) |  sort user| eval realtime=_time</query>
        <earliest>$field1.earliest$</earliest>
        <latest>$field1.latest$</latest>
      </search>
      <fieldForLabel>user</fieldForLabel>
      <fieldForValue>user</fieldForValue>
    </input>
    <input type="radio" token="sched">
      <label>Scheduled and Summarization</label>
      <choice value="OR searchtype=scheduled* OR searchtype=summarization*">Include</choice>
      <choice value="">Exclude</choice>
    </input>
  </fieldset>
  <row>
    <panel>
      <chart>
        <title>User Activity</title>
        <search id="annotationsForChart" type="annotation">
          <query>| makeresults | eval _time=now()-3600*36, annotation_label="Loookie here!", annotation_category="Anomalous", annotation_color="0xffb886" | where a=b</query>
        </search>
        <search id="superfastSearch">
          <query/>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <selection>
          <set token="selection.earliest">$start$</set>
          <set token="selection.latest">$end$</set>
          <set token="start.count">$start.count$</set>
          <set token="end.count">$end.count$</set>
        </selection>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.annotation.categoryColors">{"Score\: 1":"0x98c697","Score\: 2":"0xfde5ae","Score\: 3":"0xf7b48c","Score\: 4":"0xea958d","Score\: 5":"0x9c3529"}</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row depends="$searching$">
    <panel>
      <title>Searching...</title>
      <html>
        <style> 
        /* Configuration Screen Modal Options */
        
        #configModal.modal {
          width: 90%;
          height: 90%;
          margin: 0;
          padding: 0;
          left: 5%;
          top: 5%;
        }
        
        #configModal .modal-content {
          height: auto;
          min-height: 100%;
          border-radius: 0;
        }
        
        .search-config-container {
          border-radius: 25px;
          border: 2px solid #73AD21;
          padding: 20px; 
          width: 90%;
          
        }
        
        .search-config-object {
          display: inline-block;
          width: 350px;
          height: 200px;
        }
        
        .search-config-label {
          display: inline;
          margin-right: 8px;
          font-weight: bold;
        }
        
        .search-config-restore {
          cursor: pointer;
        }
          
        .search-config-object input, .search-config-object textarea{
          display: block;
          }
        
        /* Screwing with the eventsviewer css to override !important from the results table */
        .shared-eventsviewer-shared-rawfield, .shared-eventsviewer-list-body-row-selectedfields {
          white-space: normal
        }
        
        .results-table tr.expanded-content-row td {
          background-color: white !important;
        }
        
        .dveventsviewer .results-table tr.expanded-content-row td {
          background-color: white !important;
        }
        table tr.expanded-row td {
          background-color: white !important;
        }
        
        /* Green */
          #detailtable tr.range-level1 td {
            background-color: #eef6ee !important;
            
        }
        #detailtable tr.range-level1 {
            border: 1px solid #98c697 !important;
            
        }
/* Light Yellow */        
        #detailtable tr.range-level2 td {
            background-color: #fff9eb !important;
            
        }
        #detailtable tr.range-level2 {
            border: 1px solid #fde5ae !important;
            
        }
/* Light Orange */
        #detailtable tr.range-level3 td {
            background-color: #fef3ec !important;
            
        }
        #detailtable tr.range-level3 {
            border: 1px solid #f7b48c !important;
            
        }
/* light red */
        #detailtable tr.range-level4 td {
            background-color: #fcedec !important;
            
        }
        #detailtable tr.range-level4 {
            border: 1px solid #ea958d !important;
            
        }
/* red */
        #detailtable tr.range-level5 td {
            background-color: #dc4e41 !important;
            color: white;
            
        }
        #detailtable tr.range-level5 {
            border: 1px solid #9c3529 !important;
            
        }
/* Red Red w/ white text */
        #detailtable tr.range-extreme td {
            background-color: #6f261d !important;
            color: white;
        }
        #detailtable tr.range-extreme {
            border: 1px solid #000000 !important;
            
        }
        </style>
        <p>Running Historical Searches...</p>
        <table class="table">
          <thead>
            <tr>
              <th>Search Name</th>
              <th>Status</th>
              <th>Baseline Status (if applicable)</th>
              <th>Open in New Tab</th>
            </tr>
          </thead>
          <tbody id="listOfStatusTRs">
          </tbody>
        </table>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detailtable">
        <title>Activities</title>
        <search id="detailsearch">
          <query>| makeresults | eval Message="Awaiting Data.." | eval note="This search is configured via javascript. This should get wiped out momentarily as some of the earlier searches run." | table Message</query>
          <earliest>0</earliest>
          <latest>now</latest>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <fields>["_time","Message", "risk_score"]</fields>
      </table>
    </panel>
  </row>
</form>
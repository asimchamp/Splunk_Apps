<form script="check_data_availability.js">
  <label>Find Users</label>
  <description/>
  <fieldset submitButton="true">
    <input type="time" token="field1">
      <label/>
      <default>
        <earliestTime>-30d@d</earliestTime>
        <latestTime>now</latestTime>
      </default>
    </input>
    <input type="text" token="total_run_time_gt">
      <label>Total Run Time &gt;=</label>
      <default>0</default>
      <prefix>Search_History.total_run_time&gt;=</prefix>
    </input>
    <input type="text" token="result_count_gt">
      <label>Result Count &gt;=</label>
      <default>0</default>
      <prefix>Search_History.result_count&gt;=</prefix>
    </input>
    <input type="text" token="scan_count_gt">
      <label>Scan Count &gt;=</label>
      <default>0</default>
      <prefix>Search_History.scan_count&gt;=</prefix>
    </input>
    <input type="multiselect" token="searchtype">
      <label>Search Type(s)</label>
      <choice value="adhoc">Adhoc</choice>
      <choice value="scheduled">Scheduled</choice>
      <choice value="summarization">Summarization</choice>
      <choice value="realtime">Realtime</choice>
      <choice value="dashboard">Dashboard</choice>
      <valuePrefix>Search_History.searchtype=</valuePrefix>
      <valueSuffix>*</valueSuffix>
      <delimiter> OR </delimiter>
      <default>adhoc,summarization,scheduled,realtime,dashboard</default>
    </input>
    <input type="dropdown" token="searchcommands">
      <label>Search Commands</label>
      <choice value="*">Any</choice>
      <populatingSearch fieldForLabel="searchcommands" fieldForValue="searchcommands">| tstats `SearchActivitySummaries` count from `SA_SearchHistory` by Search_History.searchcommands | `SARename` | where searchcommands!="search"</populatingSearch>
      <default>*</default>
      <prefix>Search_History.searchcommands=</prefix>
    </input>
    <input type="text" token="username">
      <label>Username (Wildcards Supported)</label>
      <default>*</default>
      <prefix>Search_History.user=</prefix>
    </input>
  </fieldset>
  <row>
      <table>
        <title>Results</title>
        <searchString>| tstats `SearchActivitySummaries`  count sum(Search_History.total_run_time) as total_run_time sum(Search_History.NumExports) as NumExports from `SA_SearchHistory` where * $username$  $total_run_time_gt$ $result_count_gt$ $scan_count_gt$ $searchtype$ $searchcommands$ by _time Search_History.user span=1d | `SARename` | stats sum(count) as count sparkline(sum(count)) as UsageSparkline sum(total_run_time) as HoursOfSearchTime sum(NumExports) as NumberOfExports by user | where user!="splunk-system-user" | eval HoursOfSearchTime = round(HoursOfSearchTime/3600,2) | sort - count | lookup LDAPSearch sAMAccountName as user OUTPUTNEW name mail telephoneNumber  | lookup LDAPMgmtChain sAMAccountName as user OUTPUT ManagementChain| makemv delim="|" ManagementChain | eval ManagementChain=if(isnull(ManagementChain)," ",ManagementChain) </searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <drilldown>
          <link><![CDATA[/app/search_activity/per_user_dashboard?form.user=$row.user$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]></link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
  <row>
      <table>
        <title>Searches</title>
        <searchString>| tstats `SearchActivitySummaries`  sum(Search_History.total_run_time) as total_run_time sum(Search_History.result_count) as Result_Count sum(Search_History.scan_count) as Scan_Count sum(Search_History.NumExports) as NumExports values(Search_History.searchspan_h) as "Search Span (Hours)" values(Search_History.searchspan_d) as "Search Span (Days)" values(Search_History.searchtype) as "Search Type" values(Search_History.searchcommands) as "Search Commands"  from `SA_SearchHistory` where * $total_run_time_gt$ $result_count_gt$ $scan_count_gt$ $searchtype$ $searchcommands$ by _time Search_History.searchid Search_History.user | `SARename` | fields user "Search Type" total_run_time Result_Count Scan_Count NumExports "Search Span (Hours)" "Search Span (Days)"  "Search Comands" searchid</searchString>
        <earliestTime>$field1.earliest$</earliestTime>
        <latestTime>$field1.latest$</latestTime>
        <fields>_time user "Search Type" total_run_time Result_Count Scan_Count NumExports "Search Span (Hours)" "Search Span (Days)"  "Search Comands" </fields>
        <drilldown>
          <link><![CDATA[/app/search_activity/per_search_view?form.searchid=$row.searchid$&form.field1.earliest=$field1.earliest$&form.field1.latest=$field1.latest$]]></link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
  </row>
</form>

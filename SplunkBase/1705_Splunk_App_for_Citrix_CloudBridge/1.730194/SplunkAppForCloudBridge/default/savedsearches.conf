# -----------------------------------------------------------------------------------------------------
# ------------------------------------------ Overview -------------------------------------------------
# -----------------------------------------------------------------------------------------------------

[Overview - Total Bandwidth Savings Percent]
search = index=cloudbridge observationPointId=$observationPointId$ TemplateName="604_ACCELERATED" | `BW_SAVINGS_PERCENT` 

[Overview - Total Bandwidth Savings by Top Applications]
search = index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS")     | stats count by appName `CONNECTION`     | join type=inner `CONNECTION`     [ search index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED"         | eval clear  = decompressionClearTextDeltaBytes + compressionClearTextDeltaBytes         | eval cipher = decompressionCipherTextDeltaBytes + compressionCipherTextDeltaBytes         | stats sum(clear) AS clear_sum sum(cipher) AS cipher_sum BY `CONNECTION`     ]     | stats sum(clear_sum) AS clear_sum_app_conn sum(cipher_sum) AS cipher_sum_app_conn values(appName) as appName by `CONNECTION`    |`ICA_APP_NAME_FIX(appName)`    | stats sum(clear_sum_app_conn) AS clear_sum_app sum(cipher_sum_app_conn) AS cipher_sum_app by appName     | eval ratio = if((clear_sum_app > 0), (clear_sum_app - cipher_sum_app) / clear_sum_app, 0)     | eval percent = round(ratio*100, 2)     | eval percent = if(percent < 0, 0, percent)     | eval percent = if(percent > 99.99, 99.99, percent)     | eval "% Bandwidth Savings" = percent."%"      | eval Application = appName     | fields Application "% Bandwidth Savings"     | chart sum("% Bandwidth Savings") BY Application     | sort -num(sum("% Bandwidth Savings"))     | head 10

[Overview - LAN Throughput]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") (flowId=2 OR flowId=3) |     stats sum(octetDeltaCount) AS traffic `TIME_BOUNDARY_STATS` |     `SEARCH_SECONDS` |     eval rate=traffic*8/search_seconds |     eval formattedRate=`formatRate(rate)` |     fields formattedRate

[Overview - WAN Throughput]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") (flowId=1 OR flowId=4) |     stats sum(octetDeltaCount) AS traffic `TIME_BOUNDARY_STATS`|     `SEARCH_SECONDS` |     eval rate=traffic*8/search_seconds |     eval formattedRate=`formatRate(rate)` |     fields formattedRate

[Overview - Total Connections]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName = "256_INGRESS" flowId = 1 |     stats count by `CONNECTION` |     stats count AS "Total Number of Connections"

[Overview - Total Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName = "256_INGRESS" flowId = 1 |     stats distinct_count(sourceIPv4Address) AS "Total Number of Clients"

[Overview - Total Partners]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName = "604_ACCELERATED" partnerCbInstanceId != "0.0.0.0" |     stats distinct_count(partnerCbInstanceId) AS "Total Number of Partners"

[Overview - WAN Traffic by Top Applications]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="257_EGRESS" OR TemplateName="256_INGRESS") (flowId=1 OR flowId=4) |     stats sum(octetDeltaCount) AS TrafficConn values(appName) as appName BY `CONNECTION` |     `ICA_APP_NAME_FIX(appName)` |    chart sum(TrafficConn) AS Traffic BY appName |     sort -num(Traffic) 

[Overview - LAN Traffic by Top Applications]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="257_EGRESS" OR TemplateName="256_INGRESS") (flowId=2 OR flowId=3) |     stats sum(octetDeltaCount) AS TrafficConn values(appName) as appName BY `CONNECTION` |     `ICA_APP_NAME_FIX(appName)` |    chart sum(TrafficConn) AS Traffic BY appName |     sort -num(Traffic) 

[Overview - WAN Throughput Over Time]
search =  index=cloudbridge (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") (flowId=1 OR flowId=4) | eval sent=if(flowId==4, octetDeltaCount, 0) | eval received=if(flowId==1, octetDeltaCount, 0) | eval sent = `BYTES_TO_MBITS(sent)` | eval received = `BYTES_TO_MBITS(received)` | timechart  per_second(sent) As Send  per_second(received) as Receive

# -----------------------------------------------------------------------------------------------------
# ------------------------------------------ Application ----------------------------------------------
# -----------------------------------------------------------------------------------------------------

[App - WAN Traffic Sent]
search =   index=cloudbridge observationPointId="$observationPointId$" TemplateName="257_EGRESS" flowId=4 |     `megabyte_timechart(octetDeltaCount, appName)` 
[App - WAN Traffic Received]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="256_INGRESS" flowId=1 |     `megabyte_timechart(octetDeltaCount, appName)` 
# -----------------------------------------------------------------------------------------------------

[App - Diag - Network Latency By Top Applications]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="257_EGRESS") (flowId = 2 OR flowId=4) roundTripTime>=0|     eval flowIdType = if(flowId == 4, "WAN Latency", "LAN Latency") |     stats avg(roundTripTime)  AS rtt_conn values(appName) as appName BY `CONNECTION` flowIdType|     `ICA_APP_NAME_FIX(appName)` |    chart avg(rtt_conn) BY appName flowIdType |     sort -num("WAN Latency") |     head 10

[App - Diag - RTOs By Top Applications]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") |         fields `CONNECTION` appName     ] |     stats sum(slowRTOs) AS slow_rtos_conn sum(fastRTOs) AS fast_rtos_conn values(appName) as appName BY `CONNECTION`|     `ICA_APP_NAME_FIX(appName)` |    chart sum(slow_rtos_conn) AS "RTO WAN Side" sum(fast_rtos_conn) AS "RTO LAN Side" BY appName |     sort -num("RTO WAN Side") |     head 10

[App - Diag - Retran WAN By Top Applications]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") |         fields `CONNECTION` appName     ] |     eval mb = retranWanSendBytes/1000000 |     stats sum(mb) AS mb_conn values(appName) as appName BY `CONNECTION` |     `ICA_APP_NAME_FIX(appName)` |    chart sum(mb_conn) AS "Retransmission on WAN Side" BY appName |     sort -num("Retransmission on WAN Side") |     head 10

[App - Diag - Retran LAN By Top Applications]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") |         fields `CONNECTION` appName     ] |     eval mb = retranLanSendBytes/1000000 |     stats sum(mb) AS mb_conn values(appName) as appName BY `CONNECTION` |     `ICA_APP_NAME_FIX(appName)` |    chart sum(mb_conn) AS "Retransmission on LAN Side" BY appName |     sort -num("Retransmission on LAN Side") |     head 10

# -----------------------------------------------------------------------------------------------------
# ------------------------------------------ Client ----------------------------------------------
# -----------------------------------------------------------------------------------------------------

[Client - WAN Traffic By Top Clients]
search =     index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS"  OR TemplateName="257_EGRESS") (flowId=1 OR flowId=4) |     chart sum(octetDeltaCount) AS Traffic BY sourceIPv4Address

[Client - LAN Traffic By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS"  OR TemplateName="257_EGRESS") (flowId=2 OR flowId=3) |     chart sum(octetDeltaCount) AS Traffic BY sourceIPv4Address

[Client - WAN Traffic Sent By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="257_EGRESS" flowId=4 octetDeltaCount >0 |     `megabyte_timechart(octetDeltaCount, sourceIPv4Address)`

[Client - WAN Traffic Received By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="256_INGRESS" flowId=1 octetDeltaCount >0 |     `megabyte_timechart(octetDeltaCount, sourceIPv4Address)`

# -----------------------------------------------------------------------------------------------------

[Client - Diag - Network Latency By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" (TemplateName="257_EGRESS") (flowId = 2 OR flowId=4) roundTripTime>=0|     eval flowIdType = if(flowId == 4, "WAN Latency", "LAN Latency") |     chart avg(roundTripTime) BY sourceIPv4Address flowIdType |     sort -num("WAN Latency") |     head 10

[Client - Diag - RTOs By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" ((TemplateName="256_INGRESS" OR TemplateName="257_EGRESS"))     ] |     chart sum(slowRTOs) AS "RTO WAN Side" sum(fastRTOs) AS "RTO LAN Side" BY sourceIPv4Address |     sort -num("RTO WAN Side") |     head 10

[Client - Diag - Retran WAN By Top Clients]
search =  index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS")    ] |     eval mb = retranWanSendBytes/1000000 |     chart sum(mb) AS "Retransmission on WAN Side" BY sourceIPv4Address |     sort -num("Retransmission on WAN Side") |     head 10

[Client - Diag - Retran LAN By Top Clients]
search =   index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS")     ] |     eval mb = retranLanSendBytes/1000000 |     chart sum(mb) AS "Retransmission on LAN Side" BY sourceIPv4Address |    sort -num("Retransmission on LAN Side") |     head 10

# -----------------------------------------------------------------------------------------------------
# ------------------------------------------ Partner ----------------------------------------------
# -----------------------------------------------------------------------------------------------------

[Partner - WAN Traffic By Top Partner]
search =     index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") (flowId=1 OR flowId=4) |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="604_ACCELERATED")     ] |     eval "Partner IP" = partnerCbInstanceId |     chart sum(octetDeltaCount) AS Traffic BY "Partner IP" |     sort -num(sum(octetDeltaCount)) |     head 10 

[Partner - LAN Traffic By Top Partner]
search =     index=cloudbridge observationPointId="$observationPointId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS") (flowId=2 OR flowId=3) |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="604_ACCELERATED")     ] |     eval "Partner IP" = partnerCbInstanceId |     chart sum(octetDeltaCount) AS Traffic BY "Partner IP" |     sort -num(sum(octetDeltaCount)) |    head 10 

[Partner - WAN Traffic Sent By Top Partner]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="257_EGRESS" flowId=4 octetDeltaCount >0 |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="604_ACCELERATED")     ] |     `megabyte_timechart(octetDeltaCount, partnerCbInstanceId)`

[Partner - WAN Traffic Received By Top Partner]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="256_INGRESS" flowId=1 octetDeltaCount >0 |     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="604_ACCELERATED")     ] |     `megabyte_timechart(octetDeltaCount, partnerCbInstanceId)`

# -----------------------------------------------------------------------------------------------------

[Partner - Diag - Network Latency By Top Partners]
search =     index=cloudbridge observationPointId="$observationPointId$" (TemplateName="257_EGRESS") (flowId = 2 OR flowId=4) roundTripTime>=0|     join type=inner `CONNECTION`     [         search index=cloudbridge observationPointId="$observationPointId$" (TemplateName="604_ACCELERATED")     ] |     eval flowIdType = if(flowId == 4, "WAN Latency", "LAN Latency") |     chart avg(roundTripTime) BY partnerCbInstanceId flowIdType |     sort -num("WAN Latency") |     head 10

[Partner - Diag - RTOs By Top Partners]
search =   index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" partnerCbInstanceId > 0 |     chart sum(slowRTOs) AS "RTO WAN Side" sum(fastRTOs) AS "RTO LAN Side" BY partnerCbInstanceId |     sort -num("RTO WAN Side") |     head 10

[Partner - Diag - Retran WAN By Top Partners]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" partnerCbInstanceId > 0 |     eval mb = retranWanSendBytes/1000000 |     chart sum(mb) AS "Retransmission on WAN Side" BY partnerCbInstanceId |     sort -num("Retransmission on WAN Side") |     head 10

[Partner - Diag - Retran LAN By Top Partners]
search =     index=cloudbridge observationPointId="$observationPointId$" TemplateName="604_ACCELERATED" partnerCbInstanceId > 0 |     eval mb = retranLanSendBytes/1000000 |     chart sum(mb) AS "Retransmission on LAN Side" BY partnerCbInstanceId |     sort -num("Retransmission on LAN Side") |     head 10


# -----------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------
# -----------------------------------------------------------------------------------------------------

[Build AppId to Application Name Lookup]
cron_schedule = */5 * * * *
run_on_startup = true
displayview = flashtimeline
enableSched = 1
request.ui_dispatch_view = flashtimeline
search = index=cloudbridge  Template=265  | dedup appNameAppId deviceInstanceId | eval sortNewAppFirst=0| append [inputlookup CloudBridgeAppName.csv append=t | eval appName="[deleted] ".appName | eval sortNewAppFirst=1]| replace "[deleted] [deleted]*" with "[deleted]*" in appName| stats count by appNameAppId deviceInstanceId appName sortNewAppFirst| dedup appNameAppId sortby sortNewAppFirst      | table deviceInstanceId appNameAppId appName         | outputlookup CloudBridgeAppName.csv   

[Build Observer Lookup]
cron_schedule = */5 * * * *
run_on_startup = true
displayview = flashtimeline
enableSched = 1
request.ui_dispatch_view = flashtimeline
search = index=cloudbridge  | stats count by observationPointId Address | table observationPointId Address | stats count by observationPointId Address | table observationPointId Address | outputlookup CloudBridgeObserver.csv            
       
[Avg Compression Ratio by App]
displayview = flashtimeline
request.ui_dispatch_view = flashtimeline
search = index=cloudbridge observationPointId="$observationPointId$" TemplateName=""604_ACCELERATED""        | stats sum(decompressionClearTextDeltaBytes) AS d sum(compressionClearTextDeltaBytes) AS c BY `CONNECTION`        | eval cr = d/c        | join type=inner `CONNECTION`          [             search index=cloudbridge observationPointId="$observationPointId$" TemplateName="256_INGRESS"            | fields `CONNECTION` appName          ]        | sort -cr        | lookup CloudBridgeAppNameLookup appNameAppId        | chart avg(cr) by appName        | rename avg(cr) AS "Avg. Compression Ratio" appName AS "Application Name"

[Missing Sequence Number Count]
search = index=cloudbridge observationPointId="$observationPointId$" | fields Sequence | sort Sequence | delta Sequence as ds | eval missing_count = if(ds > 1, ds, 0) | stats sum(missing_count) as "missing sequence number count"

[Missing Sequence Numbers Over Time]
search = index=cloudbridge observationPointId="$observationPointId$" | fields Sequence | sort Sequence | delta Sequence as ds | eval missing_count = if(ds > 1, ds, 0) | timechart sum(missing_count) as "missing sequence number count"



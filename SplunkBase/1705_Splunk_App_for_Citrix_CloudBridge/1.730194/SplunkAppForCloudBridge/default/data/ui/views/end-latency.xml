<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>End To End Latency(RTT)</label>
  
  <searchTemplate>
  index=cloudbridge TemplateName="257_EGRESS" (flowId=2 OR flowId=4) (observationPointId=$dc_side$ OR observationPointId=$branch_side$) roundTripTime>=0 
        | eval dc     = if(observationPointId=$dc_side$, 1, 0) 
        | eval branch = if(observationPointId=$branch_side$, 1, 0) 
        | eval leg    = "?"
        | eval leg=if(dc=1 AND flowId=4, "WAN", leg) 
        | eval leg=if(dc=1 AND flowId=2, "DC LAN", leg) 
        | eval leg=if(branch=1 AND flowId=4, "WAN", leg) 
        | eval leg=if(branch=1 AND flowId=2, "Branch LAN", leg) 
        | timechart avg(roundTripTime) as latency by leg
        | fields _time "DC LAN" "WAN" "Branch LAN"    
  </searchTemplate>
  <fieldset autoRun="true">
    <input type="time">
      <default>Last 60 minutes</default>
    </input>

    <input type="dropdown" token="branch_side">
      <label>Branch:</label>
      <populatingSearch fieldForValue="observationPointId" fieldForLabel="Address">
          index=cloudbridge Template=256 OR Template=257 | dedup observationPointId | fields Address observationPointId 
      </populatingSearch>
    </input>

    <input type="dropdown" token="dc_side">
      <label>Data Center:</label>
      <populatingSearch fieldForValue="observationPointId" fieldForLabel="Address">
          index=cloudbridge Template=256 OR Template=257 | dedup observationPointId | fields Address observationPointId 
      </populatingSearch>
    </input>
    </fieldset>

  <row>
    <chart>
      <title>End to End Average Latency(RTT)</title>
      <searchPostProcess></searchPostProcess>
      <option name="charting.chart">area</option>
      <option name="charting.chart.stackMode">stacked</option> 
      <option name="charting.axisTitleX.text">Time</option> 
      <option name="charting.chart.nullValueMode">zero</option>
      <option name="charting.axisTitleY.text">ms</option> 
      <option name="charting.legend.placement">right</option>
    </chart>
  </row>
</form>

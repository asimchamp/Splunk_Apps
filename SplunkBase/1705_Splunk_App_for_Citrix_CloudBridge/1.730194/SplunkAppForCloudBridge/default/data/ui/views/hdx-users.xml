<?xml version='1.0' encoding='utf-8'?>
<form>
  <label>HDX Users</label>
  
  <fieldset autoRun="true">
    <input type="time">
      <default>Last 24 hours</default>
    </input>
    <input type="dropdown" token="observerId">
       <label>Observer</label>
       <choice value="*">All</choice>
       <populatingSearch fieldForValue="observationPointId" fieldForLabel="Address">
           | inputlookup CloudBridgeObserver.csv
       </populatingSearch>
       <default>*</default>
    </input>
  </fieldset>
  
<row>
       <chart>
        <title>Active Users Over Time</title>
        <searchString>
             index=cloudbridge observationPointId="$observerId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS")  
            | `JOIN_ICA_USER_NAME($observerId$)` 
            | timechart distinct_count(userName)
        </searchString>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.text">Time</option> 
        <option name="charting.axisTitleY.text">Active Users</option> 
    </chart>

</row>
<row>

  <chart>
      <title>HDX Data Usage By Top User</title>
      <option name="charting.legend.placement">none</option>
      <option name="charting.chart">column</option>
      <option name="charting.axisTitleX.text">User</option> 
      <option name="charting.axisTitleY.text">MB</option> 
      <searchString>
        index=cloudbridge observationPointId="$observerId$" (TemplateName="256_INGRESS" OR TemplateName="257_EGRESS")                    
        | `JOIN_ICA_USER_NAME($observerId$)` 
        | eval user = userName
        | stats sum(octetDeltaCount) as bytes by user
        | `FORMAT_MB(bytes)`
        | sort -num(bytes)            
        | head 10
      </searchString>
    </chart>
     
    <chart>
      <title>Data Reduction By Top User</title>
      <option name="charting.legend.placement">none</option>
      <option name="charting.chart">column</option>
      <option name="charting.axisTitleX.text">Users</option> 
      <option name="charting.axisTitleY.text">MB</option> 
      <searchString>
              index=cloudbridge observationPointId="$observerId$" TemplateName="604_ACCELERATED" 
            | `JOIN_ICA_USER_NAME($observerId$)` 
            | eval clearText = decompressionClearTextDeltaBytes + compressionClearTextDeltaBytes 
            | eval cipherText = decompressionCipherTextDeltaBytes + compressionCipherTextDeltaBytes
            | stats sum(clearText) AS clearTextSum sum(cipherText) AS cipherTextSum values(userName) as user BY userName `CONNECTION`
            | where clearTextSum > 0 AND cipherTextSum > 0
            | eval dataReduction=clearTextSum - cipherTextSum 
            | `FORMAT_MB(dataReduction)`
            | eval user = userName
            | stats sum(dataReduction) as sum_dataReduction by user
            | sort -num(sum_dataReduction) 
            | head 10
      </searchString>
    </chart>

    </row>
</form>



<form version="1.1">
  <label>Node Details</label>
  <search id="baseSearch">
    <query>|`node_details($cluster$)`</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time</label>
      <default>
        <earliest>-2h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="cluster" searchWhenChanged="true">
      <label>Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>| `cluster_list`</query>
        <earliest>$time.earliest$</earliest>
        <latest>$time.latest$</latest>
      </search>
      <fieldForLabel>Cluster_Name</fieldForLabel>
      <fieldForValue>Cluster_Name</fieldForValue>
    </input>
    <input type="dropdown" token="node" searchWhenChanged="true">
      <label>Node</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search base="baseSearch">
        <query>| dedup lnn |  eval Node_ID="Node".'lnn' | table Node_ID</query>
      </search>
      <fieldForLabel>Node_ID</fieldForLabel>
      <fieldForValue>Node_ID</fieldForValue>
    </input>
  </fieldset>
  <row>
    <panel>
    <title>Node Events</title>
      <table>
        <search>
          <query>|`events_list($cluster$)` | eval Node_ID="Node".'events.devid' | search Node_ID = "$node$" | dedup events.id | table "Start Time" events.id events.message events.severity | rename events.id AS "Event_ID" events.message AS "Message" "events.severity" AS Severity "Start Time" AS Time| fillnull value="N/A"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">4</option>
      </table>
    </panel>
    <panel>
    <title>Events by Severity</title>
      <chart>
        <search>
          <query>|`events_list($cluster$)`|  eval Node_ID="Node".'events.devid' | search Node_ID = "$node$" | dedup events.id | table events.id,"Start Time",events.severity,events.message | rename events.message AS Message events.id AS Event_Id events.severity AS Severity "Start Time" as Time | stats count by Severity</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
    <title>Disk Details</title>
      <table>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" stats.key = "node.disk.name.*" | lookup NodeDiskLookup Node_ID AS lnn Bay AS "stats.value" Cluster_Name AS Cluster_Name output "Disk Index" as "Disk Index" "Bay" AS "Bay" "Logical Number" AS "Logical Number" "Type" AS "Type" "Health" AS "Health" | lookup DiskHealthLookup Status AS Health output Health AS Status  | stats latest(Logical Number)  AS "Logical Number" latest(Type) AS Type latest(Status) AS Status by "Disk Index",Bay | sort "Disk Index"</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
    <title>Disk Usage over Time</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" stats.key = "node.ifs.bytes.used" OR stats.key="node.ifs.bytes.total" | bucket _time span=2m | chart avg(stats.value) by _time, stats.key | eval Used = round(('node.ifs.bytes.used')*100/('node.ifs.bytes.total'),2) | timechart span=10m max(Used) AS Used(%) | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.text">Disk Usage (%)</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
    <panel>
    <title>Disk Usage</title>
      <chart>
        <search base="baseSearch">
          <query>|  search Node_ID="$node$" (stats.key="node.ifs.bytes.free" OR stats.key="node.ifs.bytes.used" OR stats.key="node.ifs.ssd.bytes.free" OR stats.key="node.ifs.ssd.bytes.used") | eval Usage=case('stats.key'="node.ifs.bytes.free","HDD Free",'stats.key'="node.ifs.bytes.used","HDD Used",'stats.key'="node.ifs.ssd.bytes.free","SSD Free",'stats.key'="node.ifs.ssd.bytes.used","SSD Used") | `bytes_to_gb_tb_pb('stats.value')` | eval Usage = Usage . " (in GB)" | stats latest(bytes_gb) AS Space by Usage</query>
        </search>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
    <title>CPU Usage over Time</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" (stats.key="node.cpu.sys.max" OR stats.key="node.cpu.user.max") | eval usage_by = case('stats.key'="node.cpu.user.max", "User", 'stats.key'="node.cpu.sys.max", "System") | eval stats.value = round(('stats.value'/10),1) | timechart span=2m avg(stats.value) by usage_by | fields - NULL</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisTitleY.text">CPU Usage (%)</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
      </chart>
    </panel>
    <panel>
    <title>Memory Usage</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" (stats.key="node.memory.free" OR stats.key="node.memory.used") | eval Usage=case('stats.key'="node.memory.free","Memory Free",'stats.key'="node.memory.used","Memory Used") | `bytes_to_gb_tb_pb('stats.value')` | eval Usage = Usage . " (in GB)" | stats latest(bytes_gb) AS Memory by Usage</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
    <title>File System Throughput</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" (stats.key="node.ifs.bytes.in.rate" OR stats.key="node.ifs.bytes.out.rate") | eval traffic_type = case('stats.key'="node.ifs.bytes.in.rate", "Inbound", 'stats.key'="node.ifs.bytes.out.rate", "Outbound") | eval stats.value = ifnull(round(('stats.value'*8)/(1000*1000),2),0) | timechart span=2m sum(stats.value) by traffic_type | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisTitleY.text">Data Transfer (Mbps)</option>
      </chart>
    </panel>
    <panel>
    <title>External Network Throughput</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" ( stats.key="node.net.ext.bytes.out.rate" OR stats.key="node.net.ext.bytes.in.rate" ) | `bytes_to_kb_mb_gb('stats.value'*8)` | timechart span=2m sum(bytes_mb) as "Throughput Rate (Mbps)" | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisTitleY.text">Throughput (Mbps)</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
    <title>Power details over Time (Max)</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" stats.key="node.sensor.volt.volts.*" | rex field="stats.key" ".*\.(?&lt;id&gt;\d+)" | eval sensor = "sensor".'id'| timechart span=2m  max(stats.value) as volts by sensor | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisTitleY.text">Volts</option>
      </chart>
    </panel>
    <panel>
    <title>Temperature details over Time (Max)</title>
      <chart>
        <search base="baseSearch">
          <query>| search Node_ID="$node$" stats.key="node.sensor.temp.celsius.*" | rex field="stats.key" ".*\.(?&lt;id&gt;\d+)" | eval sensor = "sensor".'id'| timechart span=2m max(stats.value) as temperature by sensor | fields - NULL</query>
        </search>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.axisTitleY.text">Celsius</option>
      </chart>
    </panel>
  </row>
</form>
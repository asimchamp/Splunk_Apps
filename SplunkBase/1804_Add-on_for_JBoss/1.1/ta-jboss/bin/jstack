#!/bin/sh
##############################################
#
#  Copyright Radoslaw Zak-Brodalko (c) 2013
#  The Jstack Wrapper for Splunk
#
##############################################

[ $# -ne 1 ] && { echo "syntax: $0 <instance>"; exit 1; }

JSTACK="jstack"
JPS="jps -ml"
exit_status=0

for pid in `$JPS | grep 'org\.jboss\.Main' | grep -- "-c $instance"  | cut -f1 -d' '`
do
  $JSTACK $pid | tail -n +4
  cmd_status=$?
  if [ $cmd_status -gt $exit_status ]
  then
    exit_status=$cmd_status
  fi
done

exit $exit_status


#!/bin/sh

[ $# -ne 1 ] && { echo "syntax: $0 <collector_id>"; exit 2; }

RTI="rti"
COLLECTOR_ID="${1}"
LASTFILE="jmxta_rtict_$COLLECTOR_ID"
LASTFILEDIR="$SPLUNK_HOME/var/run/splunk"
LOGDESTDIR="$SPLUNK_HOME/etc/apps/jmxta/spool"

if [ "${SPLUNK_HOME}x" = "x" ]
then
  LASTFILEDIR="/tmp"
  LOGDESTDIR="/tmp"
fi

currtime=`date +%Y%m%d%H%M%S`
if [ -f $LASTFILE ];
then
  colltime=`cat $LASTFILE`
else
  colltime=$currtime
fi

outputfile="$LOGDESTDIR/rti_${COLLECTOR_ID}_${currtime}"

$RTI get_collector_data -c "$COLLECTOR_ID" -s $colltime -o "$outputfile" && mv "$outputfile.rtz" "$outputfile.gz"

echo $currtime > "$LASTFILEDIR/$LASTFILE"


<form version="1.1">
  <label>Tanium Data Leakage</label>
  <description>Non-Approved Connections and Open Ports</description>
  <fieldset submitButton="false">
    <input type="time" token="field16">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <chart>
        <title>Non-Approved Connections Sources</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" | timechart count by Computer_Name  | bucket span=1d _time</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.text">Count</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Number of Alerts</option>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Non Approved Connections By Source Computer Name</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" | stats count by Computer_Name |top limit=20 Computer_Name</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">search?q=`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" | join Computer_Name type=left [search `tanium_index` Question="Splunk-Basic-Asset"] | table _time,Computer_Name,Last_Logged_In_User,Chassis_Type,Operating_System,Process,Dest_IP&amp;earliest=&amp;latest=</link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Non Approved Connections by Process</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" |stats count by Process |top limit=20 Process</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <drilldown>
          <link target="_blank">search?q=`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" | iplocation Dest_IP | lookup dnslookup clientip as Dest_IP OUTPUT clienthost as Target_DNS_Name | table _time,Computer_Name,Last_Logged_In_User,Process,Dest_IP,Target_DNS_Name,Region,Country,City&amp;earliest=$field16.earliest$&amp;latest=$field16.latest$</link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Non Approved Connections By User</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" |stats count by Last_Logged_In_User |top limit=20 Last_Logged_In_User</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">search?q=`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error" | iplocation Target_IP | lookup dnslookup clientip as Target_IP OUTPUT clienthost as Target_DNS_Name |table _time,Computer_Name,Last_Logged_In_User,Process,Target_IP,Target_DNS_Name,Region,Country,City&amp;earliest=$field16.earliest$&amp;latest=$field16.latest$</link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Top Non Approved Destinations</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Missing" |stats count by Target_IP |top limit=20 Target_IP</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">search?q=`tanium_index` Question="Splunk-Non-Approved-Established-Connections"  NOT "Error*" | iplocation Target_IP | lookup dnslookup clientip as Target_IP OUTPUT clienthost as Target_DNS_Name | table _time,Computer_Name,Last_Logged_In_User,Process,Target_IP,Target_DNS_Name,Region,Country,City&amp;earliest=$field16.earliest$&amp;latest=$field16.latest$</link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <single>
        <title>Open Share - Everyone Full Control</title>
        <search>
          <query>`tanium_index` Question="Splunk-Open-Shares" "(Allow)EVERYONE-FULL Control" | dedup Computer_Name,Name | stats count(Computer_Name)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,2]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">search?q=%60tanium_index%60%20Question=%22Splunk-Open-Shares%22%20%22(Allow)EVERYONE-FULL%20Control%22%20%7C%20table%20_time,Computer_Name,Last_Logged_In_User,Name,Patch,Type,Permissions&amp;earliest=-24h@h&amp;latest=now</link>
        </drilldown>
      </single>
    </panel>
    <panel>
      <single>
        <title>Open Share - Guest Full Control</title>
        <search>
          <query>`tanium_index` Question="Splunk-Open-Shares" "(Allow)GUEST-FULL Control" | dedup Computer_Name,Name | stats count(Computer_Name)</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["0x53a051","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,2]</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">1</option>
        <drilldown>
          <link target="_blank">search?q=%60tanium_index%60%20Question=%22Splunk-Open-Shares%22%20%22(Allow)GUEST-FULL%20Control%22%20%7C%20table%20_time,Computer_Name,Last_Logged_In_User,Name,Path,Type,Permissions&amp;earliest=-24h@h&amp;latest=now</link>
        </drilldown>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Top Enterprise Open Ports</title>
        <search>
          <query>`tanium_index` Question="Splunk-Open-Ports" Computer_Name=* Open_Ports=* | stats count(Computer_Name) by Open_Ports |top limit=20 Open_Ports</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <link target="_blank">`tanium_index` Question="Splunk-Open-Ports" Computer_Name=* Open_Ports=*</link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Rare Enterprise Open Ports</title>
        <search>
          <query>`tanium_index` Question="Splunk-Open-Ports" Computer_Name=* Open_Ports=* | stats count(Computer_Name) by Open_Ports | rare limit=20 Open_Ports</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">search?q=`tanium_index` Question="Splunk-Open-Ports" Computer_Name=* Open_Ports=*</link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <map>
        <title>Non Approved Established Connections Destination Locations</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" | rex field=Target_IP "(?&lt;Dest_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?&lt;Port&gt;\d{1,7})"| iplocation Dest_IP |geostats count(Dest_IP)</query>
          <earliest>$field16.earliest$</earliest>
          <latest>$field16.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="mapping.choroplethLayer.colorBins">5</option>
        <option name="mapping.choroplethLayer.colorMode">auto</option>
        <option name="mapping.choroplethLayer.maximumColor">0xDB5800</option>
        <option name="mapping.choroplethLayer.minimumColor">0x2F25BA</option>
        <option name="mapping.choroplethLayer.neutralPoint">0</option>
        <option name="mapping.choroplethLayer.shapeOpacity">0.75</option>
        <option name="mapping.choroplethLayer.showBorder">1</option>
        <option name="mapping.data.maxClusters">100</option>
        <option name="mapping.legend.placement">bottomright</option>
        <option name="mapping.map.center">(0,0)</option>
        <option name="mapping.map.panning">1</option>
        <option name="mapping.map.scrollZoom">0</option>
        <option name="mapping.map.zoom">2</option>
        <option name="mapping.markerLayer.markerMaxSize">50</option>
        <option name="mapping.markerLayer.markerMinSize">10</option>
        <option name="mapping.markerLayer.markerOpacity">0.8</option>
        <option name="mapping.showTiles">1</option>
        <option name="mapping.tileLayer.maxZoom">7</option>
        <option name="mapping.tileLayer.minZoom">0</option>
        <option name="mapping.tileLayer.tileOpacity">1</option>
        <option name="mapping.type">marker</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <input type="time" token="field10" searchWhenChanged="true">
        <label>Time Search</label>
        <default>
          <earliest>-30d@d</earliest>
          <latest>now</latest>
        </default>
      </input>
      <input type="dropdown" token="fieldCN" searchWhenChanged="true">
        <label>Computer Name</label>
        <choice value="*">All Computers</choice>
        <fieldForLabel>Computer_Name</fieldForLabel>
        <fieldForValue>Computer_Name</fieldForValue>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections"
            | dedup Computer_Name | fields Computer_Name</query>
          <earliest>$field10.earliest$</earliest>
          <latest>$field10.latest$</latest>
        </search>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="dropdown" token="field21" searchWhenChanged="true">
        <label>Process Search</label>
        <default>*</default>
        <initialValue>*</initialValue>
        <choice value="*">All Processes</choice>
        <fieldForLabel>Process</fieldForLabel>
        <fieldForValue>Process</fieldForValue>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections" NOT "Error*"
            |dedup Process | fields Process 
        </query>
        </search>
      </input>
      <input type="dropdown" token="field22">
        <label>Destination IP</label>
        <choice value="*">All Target_IPs</choice>
        <fieldForLabel>Target_IP</fieldForLabel>
        <fieldForValue>Target_IP</fieldForValue>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections"
         | rex field=Target_IP "(?&lt;Target_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?&lt;Port&gt;\d{1,7})" | dedup Target_IP | fields Target_IP</query>
          <earliest>$field10.earliest$</earliest>
          <latest>$field10.latest$</latest>
        </search>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="dropdown" token="fieldCountry">
        <label>Country</label>
        <choice value="*">All Countries</choice>
        <fieldForLabel>Country</fieldForLabel>
        <fieldForValue>Country</fieldForValue>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections"
         | rex field=Target_IP "(?&lt;Target_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?&lt;Port&gt;\d{1,7})" | iplocation Target_IP | dedup "Country" | fields "Country"</query>
          <earliest>$field10.earliest$</earliest>
          <latest>$field10.latest$</latest>
        </search>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <table>
        <title>Non Approved Established Connections Table</title>
        <search>
          <query>`tanium_index` Question="Splunk-Non-Approved-Established-Connections"
           Computer_Name=$fieldCN$ Process=$field21$ | rex field=Target_IP "(?&lt;Target_IP&gt;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?&lt;Port&gt;\d{1,7})" | iplocation Target_IP | table _time,Computer_Name,Process,Tanium_Client_IP_Address,Target_IP,Port,Region,Country,City | search Target_IP=$field22$ | search Country="$fieldCountry$"</query>
          <earliest>$field10.earliest$</earliest>
          <latest>$field10.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <input type="time" token="field7">
        <label>Time Search</label>
        <default>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
        </default>
      </input>
      <input type="text" token="field8">
        <label>Computer Name</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="field9">
        <label>Open Port</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <table>
        <search>
          <query>`tanium_index` Question="Splunk-Open-Ports" Computer_Name=$field8$ Open_Ports=$field9$ |dedup Computer_Name,Open_Ports |table Computer_Name,Open_Ports</query>
          <earliest>$field7.earliest$</earliest>
          <latest>$field7.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel>
      <input type="time" token="field17">
        <label></label>
        <default>
          <earliest>-7d@h</earliest>
          <latest>now</latest>
        </default>
      </input>
      <input type="text" token="field18">
        <label>Source Computer Name</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="field19">
        <label>Destination Target IP</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <table>
        <search>
          <query>`tanium_index` Computer_Name=$field18$ Target_IP=$field19$ | table _time,Computer_Name,Name,Target_IP</query>
          <earliest>$field17.earliest$</earliest>
          <latest>$field17.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <input type="time" token="field20">
        <label></label>
        <default>
          <earliest>0</earliest>
          <latest></latest>
        </default>
      </input>
      <input type="text" token="field21">
        <label>Source Computer Name</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="field24">
        <label>Process</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="field22">
        <label>Port</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="field23">
        <label>MD5 Hash</label>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <table>
        <title>Process Port and MD5 Hash</title>
        <search>
          <query>`tanium_index` Question="Splunk-Listening-Ports-with-MD5-Hash" NOT Process="Missing*" NOT Process="Please*" Computer_Name=$field21$ Process=$field24$ Port=$field22$ MD5_Hash=$field23$ |table Computer_Name,Process,Name,Port,MD5_Hash</query>
          <earliest>$field20.earliest$</earliest>
          <latest>$field20.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
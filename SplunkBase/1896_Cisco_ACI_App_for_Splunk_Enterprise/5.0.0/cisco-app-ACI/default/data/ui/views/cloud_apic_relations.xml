<form script="remove_all_from_multiselect.js">
  <label>Cloud APIC Relations</label>
  <init>
    <set token="filtername">*</set>
  </init>
  <fieldset submitButton="false">
    <input type="time" token="timeToken" searchWhenChanged="true">
      <label>Time Picker</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Host</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>eventtype="cisco_apic_*" component=credentials type=cloud | fields apic_host | dedup apic_host | table apic_host | SORT apic_host</query>
        <earliest>$timeToken.earliest$</earliest>
        <latest>$timeToken.latest$</latest>
      </search>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
    </input>
    <input type="dropdown" token="component" searchWhenChanged="true">
      <label>APIC Class</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>sourcetype=cisco:apic:* apic_host=* ctxClass=* | dedup component | table component | SORT component</query>
        <earliest>$timeToken.earliest$</earliest>
        <latest>$timeToken.latest$</latest>
      </search>
      <fieldForLabel>component</fieldForLabel>
      <fieldForValue>component</fieldForValue>
    </input>
    <input type="multiselect" token="related">
      <default>*</default>
      <label>Related Object</label>
      <prefix>(ctxClass=</prefix>
      <suffix>)</suffix>
      <choice value="*">All</choice>
      <delimiter> OR ctxClass=</delimiter>
      <search>
        <query>sourcetype=cisco:apic:* apic_host=* component=$component$ ctxClass=* | dedup ctxClass | fields ctxClass | SORT ctxClass</query>
        <earliest>$timeToken.earliest$</earliest>
        <latest>$timeToken.latest$</latest>
      </search>
      <fieldForLabel>ctxClass</fieldForLabel>
      <fieldForValue>ctxClass</fieldForValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=$component$ $related$ |stats dc(ctxClass) AS "Total Related Objects" by name | rename name AS $component$</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <set token="filtername">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Related Objects Summary</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ name=$filtername$ component=$component$ $related$ | table name, related_* | rename related_* AS * | rename modTs AS "Last Modified" adminSt AS "Admin State" name AS "Related Object" Brc AS "Contract" Ctx AS "VRF" Sgroup AS "Security Group" Rscons AS "Consumed Contract" Rsprov AS "Provided Contract" Provp AS "Cloud Provider" Cidr AS "CIDR" Ep AS "End Point" Ctxprofile AS "Context Profile" Csr AS CSR Vrf AS VRF Inst AS "Instance" Subj AS "Subject" Cloudepg AS "Cloud EPG" Cloudapp AS "Cloud App"| fields - component</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
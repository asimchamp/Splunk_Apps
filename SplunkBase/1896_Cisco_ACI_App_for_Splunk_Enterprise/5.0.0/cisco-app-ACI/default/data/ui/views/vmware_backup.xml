<form stylesheet="vmware_dropdown_width.css">
  <label>VMware</label>
  <description></description>
  <search id="baseSearch">
    <query>|`vmware_counter_details`</query>
    <earliest>$earliest$</earliest>
    <latest>$latest$</latest>
  </search>
  <fieldset autoRun="true" submitButton="false">
    <input type="time" searchWhenChanged="true">
      <label>Time Picker</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Sites/Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>eventtype="cisco_apic_*" component=credentials | fields apic_host | dedup apic_host | SORT apic_host</query>
      </search>
      <earliest>$earliest$</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
    </input>
    <input type="dropdown" token="tn" searchWhenChanged="true">
      <label>Tenants</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats dc(apic.dn) AS dn from datamodel=Health  where apic.component=fvTenant groupby apic.name,apic.apic_host | search apic.apic_host=$apic_host$ | rename apic.name AS Tenant | Table Tenant | dedup Tenant</query>
      </search>
      <earliest>$earliest</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>Tenant</fieldForLabel>
      <fieldForValue>Tenant</fieldForValue>
      <default>*</default>
    </input>
    <input type="dropdown" token="app" searchWhenChanged="true">
      <label>Applications</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats dc(apic.dn)  AS dn  from datamodel=Health where apic.component=fvAp groupby apic.name,apic.Tenant.TenantName,apic.apic_host | search apic.apic_host=$apic_host$  | search apic.Tenant.TenantName=$tn$ | rename apic.name AS Application| table Application | dedup Application</query>
      </search>
      <earliest>$earliest</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>Application</fieldForLabel>
      <fieldForValue>Application</fieldForValue>
      <default>*</default>
    </input>
    <input type="dropdown" token="epg" searchWhenChanged="true">
      <label>EPGs</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats dc(apic.dn) AS dn from datamodel=Health where apic.component=fvEPg groupby apic.name,apic.Tenant.TenantName,apic.Tenant.ApplicationName,apic.apic_host | search apic.apic_host=$apic_host$ | search apic.Tenant.TenantName=$tn$ apic.Tenant.ApplicationName=$app$ | rename apic.name AS EPG | dedup EPG | table EPG</query>
      </search>
      <earliest>$earliest</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>EPG</fieldForLabel>
      <fieldForValue>EPG</fieldForValue>
      <default>*</default>
    </input>
    <input type="dropdown" token="hv" searchWhenChanged="true">
      <label>ESX hosts</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats latest(classInfo.VM_Relation.Tenant) AS Tenant latest(classInfo.VM_Relation.Application) AS Application latest(classInfo.VM_Relation.EPG) AS EPG values(classInfo.VM_Relation.ESXHost) AS host from datamodel=Systems where classInfo.component=fvRsVm  groupby classInfo.VM_Relation.mac_addr,classInfo.apic_host | search classInfo.apic_host=$apic_host$ | search Tenant=$tn$ Application=$app$ EPG=$epg$ | dedup host | table host</query>
      </search>
      <earliest>$earliest</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>host</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <default>*</default>
    </input>
    <input type="dropdown" token="vm" searchWhenChanged="true">
      <label>VMs</label>
      <choice value="*">All</choice>
      <search>
        <query>| tstats latest(classInfo.VM_Relation.Tenant) AS Tenant latest(classInfo.VM_Relation.Application) AS Application latest(classInfo.VM_Relation.EPG) AS EPG values(classInfo.VM_Relation.VirtualMachine) AS VM from datamodel=Systems where classInfo.component=fvRsVm  groupby classInfo.VM_Relation.mac_addr,classInfo.apic_host | search classInfo.apic_host=$apic_host$ | search Tenant=$tn$ Application=$app$ EPG=$epg$ | dedup VM | table VM</query>
      </search>
      <earliest>$earliest</earliest>
      <latest>$latest$</latest>
      <fieldForLabel>VM</fieldForLabel>
      <fieldForValue>VM</fieldForValue>
      <default>*</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html id="overview">
      <h1>Dashboard Overview</h1>
        <p>This dashboard provides VMware Statistics along with Client End Points, ESX host Error Logs, Virtual Machine Alarms, etc.
          <ul>
            <li>Further details on VM Statistics is shown only if the Splunk VMware Architecture is set up for the required vCenter and ESX Hosts on the same machine.</li>
          </ul>
        </p>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Client End Point Details</title>
        <search>
          <query>| `end_point_detail` | search apic_host = $apic_host$ | search Tenant=$tn$ Application=$app$ EPG=$epg$ VirtualMachine=$vm|s$ ESX-Host=$hv$  | table Tenant,Application,EPG,EPG-Health,VirtualMachine,state,Network-Adapter,ESX-Host,vCenter,Interface|  rename VirtualMachine AS "Virtual Machine" ESX-Host AS "ESX host" Network-Adapter AS "Network Adapter" EPG-Health AS "EPG Health" state AS "State"</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$panel_show1$">
      <html id="overview1">
      <h1>ESX host Error Logs</h1>
     <p>This  Panel displays data only if the Splunk VMware Architecture is set up for the required vCenter and ESX Hosts on the same machine.</p>
    </html>
      <table>
        <search>
          <query>| tstats  latest(classInfo.VM_Relation.Tenant) AS Tenant latest(classInfo.VM_Relation.Application) AS Application latest(classInfo.VM_Relation.EPG) AS EPG   latest(classInfo.VM_Relation.ESXHost) AS host from datamodel=Systems where classInfo.component=fvRsVm groupby classInfo.VM_Relation.mac_addr,classInfo.apic_host | search classInfo.apic_host=$apic_host$ | search Tenant=$tn$ Application=$app$ EPG=$epg$ host=$hv$ | join type=inner max=0 host [ search sourcetype="vmware:esxlog:*" | search Level=error | eval Time = strftime(_time,"%Y-%m-%d %H:%M:%S.%f") |table Time,host,Object,Message ] | table Time,host,Object,Message| rename host AS Host</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show1">true</set>
            </condition>
          </progress>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">8</option>
      </table>
    </panel>
    <panel depends="$panel_show2$">
      <html>
      <h1>Virual Machine Alarms</h1>
     <p>This  Panel displays data only if the Splunk VMware Architecture is set up for the required vCenter and ESX Hosts on the same machine.</p>
     </html>
      <table>
        <search>
          <query>| tstats  latest(classInfo.VM_Relation.Tenant) AS Tenant latest(classInfo.VM_Relation.Application) AS Application latest(classInfo.VM_Relation.EPG) AS EPG   latest(classInfo.VM_Relation.VirtualMachine) AS VirtualMachine from datamodel=Systems where classInfo.component=fvRsVm groupby classInfo.VM_Relation.mac_addr,classInfo.apic_host | search classInfo.apic_host=$apic_host$ | search Tenant=$tn$ Application=$app$ EPG=$epg$ VirtualMachine=$vm|s$ | join type=inner max=0 VirtualMachine [ search sourcetype="vmware:events" | spath alarm | search alarm=* | spath entity.name output=VirtualMachine | spath fullFormattedMessage output="Alarm-message" | spath createdTime output="Created Time" | spath alarm.name output=Type | table "Created Time",VirtualMachine,Type, Alarm-message] | table "Created Time",VirtualMachine,Type,Alarm-message| rename VirtualMachine AS "Virtual Machine" "Alarm-message" AS "Alarm Message"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show2">true</set>
            </condition>
          </progress>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">8</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$panel_show3$">
      <table>
        <title>Virtual Machine Statistics</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | search "Virtual Machine"=$vm|s$ component=compHostStats1h | chart latest(cpuUsageAvg) AS "Cpu Usage(Percentage)", sparkline(avg(cpuUsageAvg)) AS "Cpu Usage Trend(Percentage)", latest(memUsageAvg) AS "Memory Usage(Percentage)", sparkline(avg(memUsageAvg)) AS "Memory Usage Trend" by "Virtual Machine"</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show3">true</set>
            </condition>
          </progress>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <format type="sparkline" field="Cpu Usage Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
        <format type="sparkline" field="Memory Usage Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
      </table>
    </panel>
    <panel depends="$panel_show4$">
      <table>
        <title>ESX host Statistics</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | search Host=$hv$ component=compHostStats1h | chart  latest(cpuUsageAvg) AS "Cpu Usage(Percentage)", sparkline(avg(cpuUsageAvg)) AS "Cpu Usage Trend", latest(memUsageAvg) AS "Memory Usage(Percentage)", sparkline(avg(memUsageAvg)) AS "Memory Usage Trend" by Host</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show4">true</set>
            </condition>
          </progress>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="count">10</option>
        <format type="sparkline" field="Cpu Usage Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
        <format type="sparkline" field="Memory Usage Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$panel_show5$">
      <chart>
        <title>Top Transmitted Errored Packets Reporting VMs</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | search component=compTrnsmtdErrPkts1h | rename "Transmitting Virtual Machine" AS VirtualMachine | timechart avg("Errored_Packets") AS "Transmitted_Errored_Packets"  by VirtualMachine   | SORT Transmitted_Errored_Packets | reverse  |  head 5 | rename "VirtualMachine" AS "Virtual Machine",Transmitted_Errored_Packets AS "Transmitted Errored Packets" | fields - NULL</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show5">true</set>
            </condition>
          </progress>
        </search>
        <option name="count">5</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel depends="$panel_show6$">
      <chart>
        <title>Top Received Errored Packets Reporting VMs</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | search component=compRcvdErrPkts1h | rename "Receiving Virtual Machine" AS VirtualMachine | timechart avg("Errored_Packets") AS "Received_Errored_Packets"  by VirtualMachine   | SORT Received_Errored_Packets | reverse  |  head 5 | rename "VirtualMachine" AS "Virtual Machine",Received_Errored_Packets AS "Received Errored Packets" | fields - NULL</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show6">true</set>
            </condition>
          </progress>
        </search>
        <option name="count">5</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$panel_show7$">
      <chart>
        <title>Top Transmitted Errored Packets Reporting ESX Hosts</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | search component=compTrnsmtdErrPkts1h | rename "Transmitting Host" AS Host | timechart avg("Errored_Packets") AS "Transmitted_Errored_Packets"  by Host  | SORT Transmitted_Errored_Packets | reverse  |  head 5 | rename Transmitted_Errored_Packets AS "Transmitted Errored Packets" | fields - NULL</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show7">true</set>
            </condition>
          </progress>
        </search>
        <option name="count">5</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
    <panel depends="$panel_show8$">
      <chart>
        <title>Top Received Errored Packets Reporting ESX Hosts</title>
        <search base="baseSearch">
          <query>|search apic_host=$apic_host$ | search component=compRcvdErrPkts1h | rename "Receiving Host" AS Host | timechart avg("Errored_Packets") AS "Received_Errored_Packets"  by Host  | SORT Received_Errored_Packets | reverse  |  head 5 | rename Received_Errored_Packets AS "Received Errored Packets" | fields - NULL</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <progress>
            <condition match="'job.resultCount' &gt; 0">
              <set token="panel_show8">true</set>
            </condition>
          </progress>
        </search>
        <option name="count">5</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.chart">line</option>
        <option name="charting.legend.placement">right</option>
      </chart>
    </panel>
  </row>
</form>
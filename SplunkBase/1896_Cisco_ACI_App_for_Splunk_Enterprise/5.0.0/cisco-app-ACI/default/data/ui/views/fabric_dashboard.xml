<form script="set_apic_token.js" stylesheet="table_decorations.css">
  <label>Fabric Details</label>
  <description></description>
  <search id="baseSearch">
    <query>| `apic-fabric-overview`</query>
    <earliest>$time_token.earliest$</earliest>
    <latest>$time_token.latest$</latest>
  </search>
  <search>
    <query>| inputlookup mso_site_details | dedup apic_host | table apic_host | eval apic_host="apic_host!=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " AND ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition>
        <set token="not_search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'==0">
        <unset token="hide_filter"></unset>
        <set token="non_mso_filter">non_mso_filter</set>
        <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials | fields apic_host | dedup apic_host | SORT apic_host</set>
      </condition>
      <condition>
        <set token="hide_filter">hide_filter</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host | eval apic_host="apic_host=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " OR ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'&gt;0">
        <set token="search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <fieldset autoRun="true" submitButton="false">
    <input type="time" token="time_token" searchWhenChanged="true">
      <label>Time Picker</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="mso_host" searchWhenChanged="true" depends="$hide_filter$">
      <label>Multi-Site Orchestrator</label>
      <fieldForLabel>mso_host</fieldForLabel>
      <fieldForValue>mso_host</fieldForValue>
      <search>
        <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="non_mso_sites">Non MSO Sites</choice>
      <change>
        <condition value="non_mso_sites">
          <set token="host_filter">$not_search_apic_host$</set>
          <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials $not_search_apic_host$ | fields apic_host | dedup apic_host | SORT apic_host</set>
        </condition>
        <condition>
          <set token="host_filter">$search_apic_host$</set>
          <set token="apic_host_query">| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host</set>
        </condition>
      </change>
      <default>non_mso_sites</default>
    </input>
    <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Sites/Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>$apic_host_query$</query>
        <earliest>$time_token.earliest$</earliest>
        <latest>$time_token.latest$</latest>
        <done>
          <condition match="job.resultCount==0">
            <unset token="formed_apic_host"></unset>
          </condition>
        </done>
      </search>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
      <choice value="all">All</choice>
      <change>
        <condition match="$value$==&quot;all&quot; AND $non_mso_filter$==&quot;non_mso_filter&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">apic_host=*</set>
        </condition>
        <condition match="$value$==&quot;all&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">$not_search_apic_host$</set>
        </condition>
        <condition value="all">
          <set token="formed_apic_host">$search_apic_host$</set>
        </condition>
        <condition>
          <set token="formed_apic_host">apic_host=$apic_host$</set>
        </condition>
      </change>
    </input>
    <input type="text" token="healthRange" searchWhenChanged="true">
      <label>Enter Max required Health score: 1-100</label>
      <default>100</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html id="role">
        <h3>APIC User Role Privileges</h3>
       <div>APIC user role required: Read-All. For TCAM and Leaf Port Ingress and Egress Utilization, 'Admin' role privilege is required for the configured user account.</div>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <html id="overview">
      <h1>Dashboard Overview</h1>
     <p>This dashboard provides Health and Fault details for fabric components over the time period specified using the time picker.<br/> Following drilldown capabilities are provided:<br/>
          <ul>
            <li>Drilldown on Top Affected Leafs/Spines - Provide details of chasis, linecards, supevisor, power supply, fan tray and interfaces including their health.</li>
            <li>Provides information on Top TCAM used nodes. Drilldown further on Ingress/Egress Port Utilization</li>
            <li>Provides information on Name Port Utilization and Threshold - Provide details of Egress and Ingress Port utilization of all the interfaces </li>
          </ul>
        </p>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Top Affected Leafs</title>
        <search>
          <query>| `apic-fabric-overview` |  search component=fabricNode AND id &gt; 16 Role=leaf  $formed_apic_host$| stats  latest(CurrentHealth) AS "Health" by id,node,apic_host |  where $healthRange$ &gt;=  Health | eval "Health &lt; 60" = case(Health &lt; 60, Health) | eval "Health &lt; 80" = case(Health &gt;= 60 AND Health &lt;80, Health) | eval "Health &lt; 100" = case(Health &gt;=80 AND Health &lt;=100, Health) | eval Node= node.":".apic_host | table Node,"Health &lt; 60","Health &lt; 80","Health &lt; 100"  | SORT Health| fields - Health | head 10</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.legend.labels">["Health &lt; 60","Health &lt; 80","Health &lt; 100"]</option>
        <option name="charting.seriesColors">[0xFF3333,0xFFA500,0x088A08]</option>
        <drilldown>
          <eval token="apicHost">mvindex(split(tostring($click.value$),":"),1)</eval>
          <eval token="apicNode">mvindex(split(tostring($click.value$),":"),0)</eval>
          <set token="nodeName">$click.value$</set>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Top Affected Spines</title>
        <search>
          <query>| `apic-fabric-overview` |  search component=fabricNode AND id &gt; 16 Role=spine $formed_apic_host$ | stats  latest(CurrentHealth) AS "Health" by id,node,apic_host | where $healthRange$ &gt;=  Health | eval "Health &lt; 60" = case(Health &lt; 60, Health) | eval "Health &lt; 80" = case(Health &gt;= 60 AND Health &lt;80, Health) | eval "Health &lt; 100" = case(Health &gt;=80 AND Health &lt;=100, Health) | eval Node= node.":".apic_host | table Node,"Health &lt; 60","Health &lt; 80","Health &lt; 100" | SORT Health| fields - Health | head 10</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.legend.labels">["Health &lt; 60","Health &lt; 80","Health &lt; 100"]</option>
        <option name="charting.seriesColors">[0xFF3333,0xFFA500,0x088A08]</option>
        <drilldown>
          <eval token="apicHost">mvindex(split(tostring($click.value$),":"),1)</eval>
          <eval token="apicNode">mvindex(split(tostring($click.value$),":"),0)</eval>
          <set token="nodeName">$click.value$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table depends="$nodeName$">
        <title>$nodeName$ - Chassis</title>
        <search base="baseSearch">
          <query>| search component="eqptCh" node=$apicNode$ apic_host=$apicHost$ | stats dc(Fault Creation Time) AS "Faults" latest(CurrentHealth) AS "Health" latest(Role) AS Role latest(state) AS State latest(Revision) AS Revision latest(Type) AS Type latest(ser) AS "Serial Number" by id,node | strcat "Chassis" id Name | table Name,Health,Faults,Role,State,Type,Revision,"Serial Number" | SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <table id="detail2" depends="$nodeName$">
        <title>$nodeName$ - Supervisor Card</title>
        <search base="baseSearch">
          <query>| search component="eqptSupC" node=$apicNode$ apic_host=$apicHost$ | stats dc(Fault Creation Time) AS "Faults" latest(CurrentHealth) AS "Health" latest(state) AS State latest(numP) AS "Total Ports" latest(model) AS Model by id,node | strcat "SupC" id Name | table Name,Health,Faults,State,"Total Ports",Model | SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <table id="detail3" depends="$nodeName$">
        <title>$nodeName$ - Affected Interfaces</title>
        <search base="baseSearch">
          <query>| search  (component="eqptFabP" OR component=eqptLeafP ) node=$apicNode$ apic_host=$apicHost$ |strcat "eth" lcSlot "/" id Interface | stats dc(Fault Creation Time) AS "Access-Faults"  latest(CurrentHealth) AS "Health"  latest(speed) AS Speed latest(nodeID) AS "nodeID"  by Interface | join type=inner max=0 nodeID,Interface [ search sourcetype="cisco:apic:health" component=ethpmPhysIf code=* apic_host=$apicHost$ |dedup dn | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" |stats count(code) AS "Layer1-Faults" by Interface,nodeID ]  | table Interface,Health,"Access-Faults","Layer1-Faults",Speed | rename Interface AS Name | SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail4" depends="$nodeName$">
        <title>$nodeName$ - Line Card</title>
        <search base="baseSearch">
          <query>| search component="eqptLC" node=$apicNode$ apic_host=$apicHost$ | stats dc(Fault Creation Time) AS "Faults" latest(CurrentHealth) AS "Health" latest(state) AS State latest(numP) AS "Total Ports" latest(model) AS Model latest(ser) AS "Serial Number" latest(macB) AS "mac" by id,node | strcat "LC" id Name | table Name,Health,Faults,State,Model,"Serial Number","Total Ports",mac |  SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
      <table id="detail7" depends="$nodeName$">
        <title>$nodeName$ - TCAM Percentage Value</title>
        <search>
          <query>eventtype="cisco_apic_health" component=fabricNode apic_host=$apicHost$ role=leaf OR role=spine AND id&gt;16 | dedup dn | search name=$nodeName$ dn="*/sys/health" | rename dn AS nodeDn | table nodeDn, name | join nodeDn [search eventtype="cisco_apic_health" component=eqptcapacityPolEntry5min apic_host=$apicHost$ | dedup dn | eval tdn=rtrim(dn, "/eqptcapacity/CDeqptcapacityPolEntry15min") | eval nodeDn=tdn+"/health" | rename normalizedLast AS "TCAM Percentage Used" | table nodeDn, dn, "TCAM Percentage Used"] | rename name AS Name | table Name,  "TCAM Percentage Used"</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <table id="detail5" depends="$nodeName$">
        <title>$nodeName$ - Power Supply</title>
        <search base="baseSearch">
          <query>| search component="eqptPsu" node=$apicNode$ apic_host=$apicHost$ | stats dc(Fault Creation Time) AS "Faults" latest(CurrentHealth) AS "Health" latest(state) AS State latest(model) AS Model latest(ser) AS "Serial Number" latest(volt) AS Volt by id,node | strcat  "Psu" id Name| table Name,Health,Faults,State,Volt,Model,"Serial Number"| SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <table id="detail6" depends="$nodeName$">
        <title>$nodeName$ - Fan Tray</title>
        <search base="baseSearch">
          <query>| search component="eqptFt" node=$apicNode$ apic_host=$apicHost$ | stats dc(Fault Creation Time) AS "Faults" latest(CurrentHealth) AS "Health" latest(state) AS State latest(model) AS Model latest(ser) AS "Serial Number" by id,node | strcat "Ft" id Name| table Name,Health,Faults,State,Model,"Serial Number" | SORT Health</query>
        </search>
        <option name="count">5</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Heath/Fault Details: Leafs</title>
        <search base="baseSearch">
          <query>|search component="fabricNode" $formed_apic_host$ Role=leaf AND  id &gt; 16   | stats values(health) AS "allHealth" latest(CurrentHealth) AS "Health" sparkline(avg(health),450s) AS "Health Trend" dc(Fault Creation Time) AS "Faults" latest(adSt) AS "Administrative State" latest(model) AS Model by id,node,apic_host  |  where $healthRange$ &gt;=  Health | eval "APIC Site/Cluster"=apic_host | table "APIC Site/Cluster",node,Health,"Health Trend",Faults,"Administrative State",Model | rename node AS nodeName  | SORT Health | head 10</query>
        </search>
        <option name="count">5</option>
        <format type="sparkline" field="Health Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <format field="Health Trend" type="sparkline">
          <option name="width">75</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineColor">#5379af</option>
          <option name="height">25</option>
          <option name="lineWidth">1</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="width">75</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineColor">#5379af</option>
          <option name="height">25</option>
          <option name="lineWidth">1</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="height">25</option>
          <option name="lineColor">#5379af</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="width">75</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="spotRadius">3</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="width">75</option>
          <option name="lineColor">#5379af</option>
          <option name="lineWidth">1</option>
          <option name="height">25</option>
          <option name="fillColor">#CCDDFF</option>
        </format>
      </table>
    </panel>
    <panel>
      <table>
        <title>Health/Fault Details: Spines</title>
        <search base="baseSearch">
          <query>|search component="fabricNode" $formed_apic_host$ Role=spine  AND  id &gt; 16  | stats values(health) AS "allHealth" latest(CurrentHealth) AS "Health" sparkline(avg(health),450s) AS "Health Trend" dc(Fault Creation Time) AS "Faults" latest(adSt) AS "Administrative State" latest(model) AS Model by id,node,apic_host | where $healthRange$ &gt;=  Health | eval "APIC Site/Cluster"=apic_host | table "APIC Site/Cluster",node,Health,"Health Trend",Faults,"Administrative State",Model | rename node AS nodeName | SORT Health | head 10</query>
        </search>
        <option name="count">5</option>
        <format type="sparkline" field="Health Trend">
          <option name="lineColor">#5379af</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="height">25</option>
          <option name="width">75</option>
        </format>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <format field="Health Trend" type="sparkline">
          <option name="width">75</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineColor">#5379af</option>
          <option name="height">25</option>
          <option name="lineWidth">1</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="width">75</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineColor">#5379af</option>
          <option name="height">25</option>
          <option name="lineWidth">1</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="height">25</option>
          <option name="lineColor">#5379af</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="width">75</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="height">25</option>
          <option name="lineColor">#5379af</option>
          <option name="lineWidth">1</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="width">75</option>
          <option name="spotRadius">3</option>
          <option name="fillColor">#CCDDFF</option>
        </format>
        <format field="Health Trend" type="sparkline">
          <option name="spotRadius">3</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="width">75</option>
          <option name="lineColor">#5379af</option>
          <option name="lineWidth">1</option>
          <option name="height">25</option>
          <option name="fillColor">#CCDDFF</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>TCAM Percentage Threshold Statistics</title>
        <search>
          <query>| inputlookup tcamThreshold.csv | stats values(warningThreshold) AS warningThreshold , values(criticalThreshold) AS criticalThreshold | eval maxThreshold =100 | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <title>Top TCAM Usage by Node</title>
        <search base="baseSearch">
          <query>| search component="eqptcapacityPolEntry5min" | stats avg(normalizedLast) AS avg_normalizedLast by node, apic_host | eval avg_normalizedLast=round(avg_normalizedLast,2) | table node, avg_normalizedLast, apic_host | join [inputlookup tcamThreshold.csv | stats values(warningThreshold) AS WarningThr, values(criticalThreshold) AS CriticalThr] | where 100 &gt;= avg_normalizedLast | eval "Normal" = case(avg_normalizedLast &lt; WarningThr, avg_normalizedLast ) | eval "Warning" = case(avg_normalizedLast &gt;= WarningThr AND avg_normalizedLast &lt; CriticalThr, avg_normalizedLast) | eval "Critical" = case(avg_normalizedLast &gt;=CriticalThr AND avg_normalizedLast &lt;=100, avg_normalizedLast) | search $formed_apic_host$ | SORT - avg_normalizedLast | head 10 | eval Node= node.":".apic_host | table Node, "Normal","Warning","Critical" | rename Node AS "Top TCAM Used Nodes"</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleY.text">TCAM Percentage</option>
        <option name="charting.legend.labels">["Normal","Warning","Critical"]</option>
        <option name="charting.seriesColors">[0x088A08,0xFFA500,0xFF3333]</option>
        <drilldown>
          <eval token="apicHost">mvindex(split(tostring($click.value$),":"),1)</eval>
          <eval token="apicNode">mvindex(split(tostring($click.value$),":"),0)</eval>
          <set token="gress">$click.value$</set>
        </drilldown>
      </chart>
      <html id="thr">
       <p>Click below to change the TCAM threshold values</p>
       <a href="change_tcam_threshold_html" target="_blank"> Change Threshold </a>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail8" depends="$gress$">
        <title>$gress$ - Egress Port Utilization</title>
        <search>
          <query>eventtype=cisco_apic_stats apic_host=$apicHost$ component=eqptEgrTotal5min OR component=eqptEgrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesLast), avg(bytesRate), avg(pktsLast), avg(pktsRate), avg(utilLast) by Interface, nodeID | rename avg(bytesLast) AS avg_bytesLast, avg(bytesRate) AS avg_bytesRate, avg(pktsLast) AS avg_pktsLast, avg(pktsRate) AS avg_pktsRate, avg(utilLast) AS avg_utilLast | eval avg_bytesLast=round(avg_bytesLast,2), avg_bytesRate=round(avg_bytesRate,2), avg_pktsLast=round(avg_pktsLast,2), avg_pktsRate=round(avg_pktsRate,2), avg_utilLast=round(avg_utilLast,2) | table nodeID, avg_bytesLast, avg_bytesRate, avg_pktsLast, avg_pktsRate, avg_utilLast, Interface | join nodeID [search sourcetype="cisco:apic:health" apic_host=$apicHost$ component=fabricNode role=leaf OR role=spine AND id&gt;16 | dedup dn | search name=$apicNode$ dn="*/sys/health" | rename dn AS nodeDn | rename id as nodeID | table nodeDn, name, nodeID] | table Interface, avg_bytesLast, avg_bytesRate, avg_pktsLast, avg_pktsRate, avg_utilLast | SORT Interface | rename avg_bytesLast AS "Total egress bytes", avg_bytesRate AS "Total egress bytes rate(bytes/sec)", avg_pktsLast AS "Total egress packets", avg_pktsRate AS "Total egress packets rate(pkts/sec)", avg_utilLast AS "Egress port utilization"</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table id="detail9" depends="$gress$">
        <title>$gress$ - Ingress Port Utilization</title>
        <search>
          <query>eventtype=cisco_apic_stats apic_host=$apicHost$ component=eqptIngrTotal5min OR component=eqptIngrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesLast), avg(bytesRate), avg(pktsLast), avg(pktsRate), avg(utilLast) by Interface, nodeID | rename avg(bytesLast) AS avg_bytesLast, avg(bytesRate) AS avg_bytesRate, avg(pktsLast) AS avg_pktsLast, avg(pktsRate) AS avg_pktsRate, avg(utilLast) AS avg_utilLast | eval avg_bytesLast=round(avg_bytesLast,2), avg_bytesRate=round(avg_bytesRate,2), avg_pktsLast=round(avg_pktsLast,2), avg_pktsRate=round(avg_pktsRate,2), avg_utilLast=round(avg_utilLast,2) | table nodeID, avg_bytesLast, avg_bytesRate, avg_pktsLast, avg_pktsRate, avg_utilLast, Interface | join nodeID [search sourcetype="cisco:apic:health" apic_host=$apicHost$ component=fabricNode role=leaf OR role=spine AND id&gt;16 | dedup dn | search name=$apicNode$ dn="*/sys/health" | rename dn AS nodeDn | rename id as nodeID | table nodeDn, name, nodeID] | table Interface, avg_bytesLast, avg_bytesRate, avg_pktsLast, avg_pktsRate, avg_utilLast | SORT Interface | rename avg_bytesLast AS "Total ingress bytes", avg_bytesRate AS "Total ingress bytes rate(bytes/sec)", avg_pktsLast AS "Total ingress packets", avg_pktsRate AS "Total ingress packets rate(pkts/sec)", avg_utilLast AS "Ingress port utilization"</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="master3">
        <title>Leafs – Port Utilization and Thresholds</title>
        <search>
          <query>eventtype=cisco_apic_stats $formed_apic_host$ component=eqptEgrTotal5min OR component=eqptEgrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesRate), avg(utilLast) by nodeID, apic_host | rename avg(bytesRate) AS egr_bytesRate, avg(utilLast) AS egr_utilLast | eval egr_bytesRate=round(egr_bytesRate,2),  egr_utilLast=round(egr_utilLast,2) | table apic_host, nodeID, egr_bytesRate, egr_utilLast, Interface | join nodeID, apic_host [ search sourcetype="cisco:apic:stats" $formed_apic_host$ component=eqptIngrTotal5min OR component=eqptIngrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesRate),  avg(utilLast) by nodeID, apic_host | rename avg(bytesRate) AS ingr_bytesRate, avg(utilLast) AS ingr_utilLast | eval ingr_bytesRate=round(ingr_bytesRate,2),  ingr_utilLast=round(ingr_utilLast,2) | table apic_host, nodeID, ingr_bytesRate, ingr_utilLast, Interface] | join nodeID, apic_host [search sourcetype="cisco:apic:health" $formed_apic_host$ component=fabricNode role=leaf AND id&gt;16 | dedup dn, apic_host | search dn="*/sys/health" | rename dn AS nodeDn | rename id as nodeID | table apic_host, nodeDn, name, nodeID] | JOIN [inputlookup portutilThreshold.csv | stats values(warningThreshold) AS "Warning Threshold", values(criticalThreshold) AS "Critical Threshold"] | table apic_host, name, egr_bytesRate, egr_utilLast, ingr_bytesRate, ingr_utilLast, "Warning Threshold", "Critical Threshold" | rename egr_bytesRate AS "Avg egress bytes rate Per Interface", egr_utilLast AS "Avg egress port utilization Per Interface", ingr_bytesRate AS "Avg ingress bytes rate Per Interface", ingr_utilLast AS "Avg ingress port utilization Per Interface", name AS Name, apic_host AS "APIC Site/Cluster" | head 10</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="master4">
        <title>Spines – Port Utilization and Thresholds</title>
        <search>
          <query>eventtype=cisco_apic_stats $formed_apic_host$ component=eqptEgrTotal5min OR component=eqptEgrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesRate), avg(utilLast) by nodeID, apic_host | rename avg(bytesRate) AS egr_bytesRate, avg(utilLast) AS egr_utilLast | eval egr_bytesRate=round(egr_bytesRate,2),  egr_utilLast=round(egr_utilLast,2) | table apic_host,nodeID, egr_bytesRate, egr_utilLast, Interface | join nodeID, apic_host [ search sourcetype="cisco:apic:stats" $formed_apic_host$ component=eqptIngrTotal5min OR component=eqptIngrTotal15min | rex field=dn "node-(?&lt;nodeID&gt;\d+)\/sys\/phys-\[(?&lt;Interface&gt;.*?)\]" | stats avg(bytesRate),  avg(utilLast) by nodeID, apic_host | rename avg(bytesRate) AS ingr_bytesRate, avg(utilLast) AS ingr_utilLast | eval ingr_bytesRate=round(ingr_bytesRate,2),  ingr_utilLast=round(ingr_utilLast,2) | table apic_host,  nodeID, ingr_bytesRate, ingr_utilLast, Interface] | join nodeID, apic_host [search sourcetype="cisco:apic:health" $formed_apic_host$ component=fabricNode role=spine AND id&gt;16 | dedup dn | search dn="*/sys/health" | rename dn AS nodeDn | rename id as nodeID | table apic_host,  nodeDn, name, nodeID] | join [inputlookup portutilThreshold.csv | stats values(warningThreshold) AS "Warning Threshold", values(criticalThreshold) AS "Critical Threshold"] | table apic_host,  name, egr_bytesRate, egr_utilLast, ingr_bytesRate, ingr_utilLast, "Warning Threshold", "Critical Threshold" | rename egr_bytesRate AS "Avg egress bytes rate Per Interface", egr_utilLast AS "Avg egress port utilization Per Interface", ingr_bytesRate AS "Avg ingress bytes rate Per Interface", ingr_utilLast AS "Avg ingress port utilization Per Interface", name AS Name, apic_host AS "APIC Site/Cluster" | head 10</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html id="thr1">
       <p>Click below to change the Port Utilization threshold values for Leafs and Spines</p>
       <a href="change_portutil_threshold_html" target="_blank"> Change Threshold </a>
     </html>
    </panel>
  </row>
</form>

<form script="set_apic_token.js" stylesheet="table_decorations.css">
  <label>System Threshold</label>
  <search>
    <query>| inputlookup mso_site_details | dedup apic_host | table apic_host | eval apic_host="apic_host!=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " AND ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition>
        <set token="not_search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'==0">
        <unset token="hide_filter"></unset>
        <set token="non_mso_filter">non_mso_filter</set>
        <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials | fields apic_host | dedup apic_host | SORT apic_host</set>
      </condition>
      <condition>
        <set token="hide_filter">hide_filter</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host | eval apic_host="apic_host=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " OR ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'&gt;0">
        <set token="search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" searchWhenChanged="true" token="time_token">
      <label>Time Picker</label>
      <default>
        <earliest>-15m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="mso_host" searchWhenChanged="true" depends="$hide_filter$">
      <label>Multi-Site Orchestrator</label>
      <fieldForLabel>mso_host</fieldForLabel>
      <fieldForValue>mso_host</fieldForValue>
      <search>
        <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="non_mso_sites">Non MSO Sites</choice>
      <change>
        <condition value="non_mso_sites">
          <set token="host_filter">$not_search_apic_host$</set>
          <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials $not_search_apic_host$ | fields apic_host | dedup apic_host | SORT apic_host</set>
        </condition>
        <condition>
          <set token="host_filter">$search_apic_host$</set>
          <set token="apic_host_query">| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host</set>
        </condition>
      </change>
      <default>non_mso_sites</default>
    </input>
    <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Sites/Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>$apic_host_query$</query>
        <earliest>$time_token.earliest$</earliest>
        <latest>$time_token.latest$</latest>
        <done>
          <condition match="job.resultCount==0">
            <unset token="formed_apic_host"></unset>
          </condition>
        </done>
      </search>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
      <choice value="all">All</choice>
      <change>
        <condition match="$value$==&quot;all&quot; AND $non_mso_filter$==&quot;non_mso_filter&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">apic_host=*</set>
        </condition>
        <condition match="$value$==&quot;all&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">$not_search_apic_host$</set>
        </condition>
        <condition value="all">
          <set token="formed_apic_host">$search_apic_host$</set>
        </condition>
        <condition>
          <set token="formed_apic_host">apic_host=$apic_host$</set>
        </condition>
      </change>
    </input>
  </fieldset>
  <row>
    <panel>
      <html id="role">
        <h3>APIC User Role Privileges</h3>
       <div>APIC user role required: Read-All.</div>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <html id="overview">
      <h1>Dashboard Overview</h1>
      <p>This dashboard provides monitoring the KPI's for number of tenants, EPG's, Contracts, Filters, BD's and L3OUT Networks by setting threshold.<br/>Following capabilities are provided:<br/>
          <ul>
            <li> The threshold statistics displays the threshold set for each components.</li>
        	<li> Click on the "Change Threshold" link to modify threshold values for respective components.
        	     Click on the "More Information" link to drilldown on respective components.</li>
            <li> Generates alerts in "Triggered Alerts" and sends an Email when threshold limit is exceeded. </li>
          </ul>
        </p>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Tenant Threshold Statistics</title>
        <search>
          <query>| inputlookup tenantThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>Tenant Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=fvTenant) $formed_apic_host$ NOT "code" |dedup name,apic_host| stats count(name) AS TCOUNT  | gauge TCOUNT [ inputlookup tenantThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr1">
       <p>Click below to change the tenant threshold values</p>
       <a href="change_tenant_threshold_html" target="_blank"> Change Threshold </a>
       <a href="tenant_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
    <panel>
      <table>
        <title>EPG Threshold Statistics</title>
        <search>
          <query>| inputlookup epgThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>EPG Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=fvAEPg) dn="*/health" $formed_apic_host$ NOT "code" | stats dc(name) by dn,apic_host | stats count(dc(name))  AS TCOUNT  | gauge TCOUNT [ inputlookup epgThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr2">
       <p>Click below to change the epg threshold values</p>
       <a href="change_epg_threshold_html" target="_blank"> Change Threshold </a>
       <a href="epg_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
    <panel>
      <table>
        <title>Bridge Domain Threshold Statistics</title>
        <search>
          <query>| inputlookup bdThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>Bridge Domain Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=fvBD) dn="*/health" $formed_apic_host$ NOT "code" | stats dc(name) by dn,apic_host | stats count(dc(name)) AS TCOUNT  | gauge TCOUNT [ inputlookup bdThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr5">
       <p>Click below to change the bridge domain threshold values</p>
       <a href="change_bd_threshold_html" target="_blank"> Change Threshold </a>
       <a href="bd_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Filters Threshold Statistics</title>
        <search>
          <query>| inputlookup filtersThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>Filters Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=vzFilter ) $formed_apic_host$ NOT "code" | stats dc(name) by dn,apic_host | stats count(dc(name)) AS TCOUNT  | gauge TCOUNT [ inputlookup filtersThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr4">
       <p>Click below to change the filters threshold values</p>
       <a href="change_filter_threshold_html" target="_blank"> Change Threshold </a>
       <a href="filters_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
    <panel>
      <table>
        <title>Contracts Threshold Statistics</title>
        <search>
          <query>| inputlookup contractsThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>Contracts Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=vzBrCP) $formed_apic_host$ NOT "code" | stats dc(name) by dn,apic_host | stats count(dc(name)) AS TCOUNT  | gauge TCOUNT [ inputlookup contractsThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr3">
       <p>Click below to change the contracts threshold values</p>
       <a href="change_contract_threshold_html" target="_blank"> Change Threshold </a>
       <a href="contracts_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
    <panel>
      <table>
        <title>L3OUT Networks Threshold Statistics</title>
        <search>
          <query>| inputlookup l3outnetworksThreshold.csv | table warningThreshold, criticalThreshold, maxThreshold | rename warningThreshold as "Warning Threshold", criticalThreshold as "Critical Threshold", maxThreshold as "Max Threshold"</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
      <chart>
        <title>L3OUT Networks Threshold Guage</title>
        <search>
          <query>eventtype=cisco_apic_health (component=l3extOut) $formed_apic_host$ NOT "code" | stats dc(name) by dn,apic_host | stats count(dc(name)) AS TCOUNT  | gauge TCOUNT [ inputlookup l3outnetworksThreshold.csv | stats values(warningThreshold) AS TWarning, values(criticalThreshold) AS TCritical, values(maxThreshold) AS TMax | eval first=0 | eval warning=TWarning | eval critical=TCritical | eval max=TMax  | eval range=first+" "+warning+" "+critical+" "+max | return $range]</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html id="thr6">
       <p>Click below to change the L3OUT Networks threshold values</p>
       <a href="change_l3outnetworks_threshold_html" target="_blank"> Change Threshold </a>
       <a href="l3outnetworks_details" style="margin-left:275px" target="_blank"> More Info... </a>
     </html>
    </panel>
  </row>
</form>
<form script="tenant_dashboard.js" stylesheet="table_decorations.css">
  <label>Cloud Topology</label>
  <search id="baseSearch">
    <query>| `apic-tenant-overview` </query>
    <earliest>$timeToken.earliest$</earliest>
    <latest>$timeToken.latest$</latest>
  </search>
  <fieldset submitButton="false">
    <input type="time" token="timeToken" searchWhenChanged="true">
      <label>Time Picker</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Host</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>eventtype="cisco_apic_*" component=credentials type=cloud | fields apic_host | dedup apic_host | table apic_host | SORT apic_host</query>
        <earliest>$timeToken.earliest$</earliest>
        <latest>$timeToken.latest$</latest>
      </search>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
    </input>
    <input type="text" token="healthRange" searchWhenChanged="true">
      <label>Enter Max required Health Score: 1-100</label>
      <default>100</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <chart id="master">
        <title>Top 10 Afftected Tenant's Health</title>
        <search base="baseSearch">
          <query>| search component="fvTenant" apic_host = $apic_host$| stats latest(health) AS "Health" by TenantName |  where $healthRange$ &gt;= Health | eval "Health &lt; 60" = case(Health &lt; 60, Health) | eval "Health &lt; 80" = case(Health &gt;= 60 AND Health &lt;80, Health) | eval "Health &lt; 100" = case(Health &gt;=80 AND Health &lt;=100, Health) | SORT Health | head 10 | table TenantName,"Health &lt; 60","Health &lt; 80","Health &lt; 100" | rename TenantName AS Tenant</query>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Tenant</option>
        <option name="charting.legend.labels">["Health &lt; 60","Health &lt; 80","Health &lt; 100"]</option>
        <option name="charting.seriesColors">[0xFF3333,0xFFA500,0x088A08]</option>
        <drilldown>
          <set token="tenantName">$click.value$</set>
          <unset token="faultTenant"></unset>
          <unset token="tenantToken"></unset>
          <unset token="tenantToken1"></unset>
          <unset token="tenantToken2"></unset>
        </drilldown>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Top 10 Affected Tenant's Faults</title>
        <search base="baseSearch">
          <query>| search apic_host=$apic_host$ | dedup dn| stats latest(health) AS "Health" count(eval(match(code,".*"))) AS Faults by TenantName | rename TenantName AS name | where Faults &gt; 0 | SORT Health | head 10 | fields - Health,NULL</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="faultTenant">$click.value$</set>
          <unset token="tenantName"></unset>
          <unset token="tenantToken"></unset>
          <unset token="tenantToken1"></unset>
          <unset token="tenantToken2"></unset>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail1" depends="$tenantName$" rejects="$faultTenant$,$tenantToken$,$tenantToken1$,$tenantToken2$">
        <title>Application Health for Tenant: $tenantName$</title>
        <search base="baseSearch">
          <query>| search component="fvAp" TenantName=$tenantName$ health="*" apic_host=$apic_host$| dedup dn| stats latest(health) AS "Health" by ApplicationName | table ApplicationName,"Health" | rename ApplicationName AS Application</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table id="detail2" depends="$tenantName$" rejects="$faultTenant$,$tenantToken$,$tenantToken1$,$tenantToken2$">
        <title>End Point Group Health for Tenant: $tenantName$</title>
        <search base="baseSearch">
          <query>| search component="fvEPg" TenantName=$tenantName$ health=* apic_host=$apic_host$ | dedup dn| stats latest(health) AS "Health" count(eval(match(code,".*"))) AS Faults latest(ApplicationName) AS Application  by dn,EndPointGroupName | table EndPointGroupName,Application,Health,Faults | dedup EndPointGroupName, Application | fields - dn | rename EndPointGroupName AS EPG |SORT Health</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail3" depends="$tenantName$" rejects="$faultTenant$,$tenantToken$,$tenantToken1$,$tenantToken2$">
        <title>Application Statistics for Tenant: $tenantName$</title>
        <search>
          <query>| tstats  values(Stats.dropCum) AS dropCum values(Stats.floodCum) AS floodCum values(Stats.multicastCum) AS multicastCum values(Stats.unicastCum) AS unicastCum values(Stats.dn) AS dn from datamodel=Statistics where Stats.component=l2IngrBytesAg15min groupby Stats.App_Stats.Tenant,Stats.App_Stats.Application,_time | rename Stats.App_Stats.Tenant AS Tenant, Stats.App_Stats.Application AS Application | search Tenant= $tenantName$ | where dn LIKE "%/CDl2IngrBytesAg15min" | stats latest(dropCum) AS "Ingress Total Drop Bytes" sparkline(avg(dropCum)) AS "Drop Bytes Trend" latest(floodCum) AS "Ingress Total Flood Bytes" latest(unicastCum) AS "Ingress Total Unicast Bytes" latest(multicastCum) AS "Ingress Total Multicast Bytes" by Tenant,Application</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <format field="Drop Bytes Trend" type="sparkline">
          <option name="spotRadius">3</option>
          <option name="width">75</option>
          <option name="fillColor">#CCDDFF</option>
          <option name="lineColor">#5379af</option>
          <option name="maxSpotColor">#A2FFA2</option>
          <option name="lineWidth">1</option>
          <option name="height">25</option>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail4" depends="$tenantName$" rejects="$faultTenant$,$tenantToken$,$tenantToken1$,$tenantToken2$">
        <title>Client End Point Details for Tenant: $tenantName$</title>
        <search>
          <query>|`end_point_detail`| search Tenant=$tenantName$ | table Tenant,Application,EPG,EPG-Health,VirtualMachine,state,Network-Adapter,ESX-Host,vCenter,Interface | rename VirtualMachine AS "Virtual Machine" ESX-Host AS "ESX host" Network-Adapter AS "Network Adapter" EPG-Health AS "EPG Health" state AS "State"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="highlight" depends="$faultTenant$" rejects="$tenantName$,$tenantToken$,$tenantToken1$,$tenantToken2$">
        <title>$faultTenant$ Tenant Fault Details</title>
        <search>
          <query>| tstats values(apic.code) AS "Fault-code"  latest(apic.ack) AS Ack values(apic.descr) AS Descr latest(apic.cause) AS Cause  latest(apic.created) AS Created latest(apic.changeSet) AS ChangeSet latest(apic.rule) AS Rule latest(apic.severity) AS severity  values(apic.name) AS Name values(apic.Tenant.TenantName) AS Tenant values(apic.Tenant.ApplicationName) AS Application from datamodel=Health WHERE apic.component="fvTenant" groupby apic.dn,apic.Tenant.group_field |lookup APICFaultDetails code AS "Fault-code" OUTPUT description  AS Explanation "Recommended Action" AS "Recommended Action" | search Tenant=$faultTenant$ Fault-code=*| rename apic.dn AS dn | table Name,dn,Fault-code,Ack,severity,Created,Explanation,"Recommended Action",Cause,Rule,Descr,ChangeSet</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="wrap">true</option>
        <drilldown>
          <unset token="tenantName"></unset>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Cloud Application Profiles per Tenant</title>
      <chart>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=fvTenant |dedup name | table name | join type=outer name [search sourcetype=cisco:apic:*  component=fvTenant ctxClass=cloudApp ctxDn=*|stats dc(ctxDn) AS "Total Cloud Application Profiles" by name] | fillnull value=0 | rename name AS Tenant</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <set token="tenantToken">$click.value$</set>
          <unset token="tenantName"></unset>
          <unset token="faultTenant"></unset>
          <unset token="tenantToken1"></unset>
          <unset token="tenantToken2"></unset>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Cloud Regions per Tenant</title>
      <chart>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=fvTenant |dedup name | table name | join type=outer name [search sourcetype=cisco:apic:*  component=fvTenant ctxClass=cloudRegion |stats dc(ctxDn) AS "Total Cloud Regions" by name ] | fillnull value=0 | rename name AS Tenant</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <set token="tenantToken1">$click.value$</set>
          <unset token="tenantName"></unset>
          <unset token="faultTenant"></unset>
          <unset token="tenantToken"></unset>
          <unset token="tenantToken2"></unset>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Cloud VRF Profiles for Tenant</title>
      <chart>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=fvTenant |dedup name | table name | join type=outer name [search sourcetype=cisco:apic:*  component=fvTenant ctxClass=fvCtx |stats dc(ctxDn) AS "Total Cloud VRF Profiles" by name ] | fillnull value=0 | rename name AS Tenant</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <set token="tenantToken2">$click.value$</set>
          <unset token="tenantName"></unset>
          <unset token="faultTenant"></unset>
          <unset token="tenantToken1"></unset>
          <unset token="tenantToken"></unset>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$tenantToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>EPGs per Cloud Application Profile</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=cloudApp dn=uni/tn-$tenantToken$/cloudapp-* |dedup name | table name | join type=outer name [search sourcetype=cisco:apic:*  component=cloudApp ctxClass=cloudEPg ctxDn=*|stats dc(ctxDn) AS "Total EPGs" by name] | fillnull value=0 | rename name AS "Application Profile"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="drilldown">cell</option>
        <drilldown>
          <set token="cloudappToken">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$cloudappToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <html id="app">
        <h3>Cloud Application Profile Relations</h3>
     </html>
    </panel>
  </row>
  <row>
    <panel depends="$cloudappToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>EndPoints per EPGs</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=cloudEPg dn=uni/tn-$tenantToken$/cloudapp-$cloudappToken$/cloudepg-* |dedup name | table name | join type=outer name [search sourcetype=cisco:apic:*  component=cloudEPg ctxClass=hcloudEndPoint ctxDn=*|stats dc(ctxDn) AS "Total Cloud Application Profiles" by name] | fillnull value=0| rename name AS EPG</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="drilldown">cell</option>
        <drilldown>
          <set token="epgToken">$click.value$</set>
        </drilldown>
      </table>
    </panel>
    <panel depends="$cloudappToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>VRF and Region relations for Cloud App</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudApp $cloudappToken$ ctxClass=fvCtx  apic_host=$apic_host$| dedup  ctxDn  | table  name, related_Ctx, annotation|join type=outer name [search sourcetype="cisco:apic:*" component=cloudApp ctxClass=cloudZone  apic_host=$apic_host$| dedup  ctxDn  | table  name,related_Provp, related_Region, related_Zone]| rename related_* AS * annotation AS Annotation name AS name  | rename  Provp AS Provider Ctx AS VRF | fields - name</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel depends="$cloudappToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>End point relations for Cloud App</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudApp $cloudappToken$ ctxClass=cloudEPg  apic_host=$apic_host$| dedup  ctxDn  | table  name, related_Cloudepg, annotation|join type=outer name [search sourcetype="cisco:apic:*" component=cloudApp ctxClass=hcloudEndpoint  apic_host=$apic_host$| dedup  ctxDn  | table  name,related_Ep, related_Subnet, related_Cidr ] | rename related_* AS * annotation AS Annotation | rename Cloudepg AS "Cloud EPG" Cidr AS CIDR Ep AS "End Point"| fields - name</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$epgToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <html id="epg">
        <h3>Cloud EPG Profile Relations</h3>
     </html>
    </panel>
  </row>
  <row>
    <panel depends="$epgToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>EPG Security Groups</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudEPg $epgToken$ ctxClass=hcloudSecurityGroup apic_host=$apic_host$| dedup  ctxDn | table  name, related_* | join name [search sourcetype="cisco:apic:*" component=cloudEPg ctxClass=fvCtx apic_host=$apic_host$| dedup  ctxDn | table  name, related_Ctx]| rename related_* AS * annotation AS Annotation name AS name| rename Sgroup AS "Security Group" | fields - component, Tenant, name, Cntext | rename Ctx AS VRF | fields - name</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel depends="$epgToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>EPG Relations</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudEPg $epgToken$ ctxClass=vzBrCP  apic_host=$apic_host$| dedup  ctxDn  | table  name, related_Brc|join type=outer name [search sourcetype="cisco:apic:*" component=cloudEPg ctxClass=hcloudEndpoint $epgToken$ apic_host=$apic_host$| dedup  ctxDn  | table  name,related_Ep, related_Subnet, related_Cidr|join type=left related_Ep [search sourcetype="cisco:apic:*" component=hcloudEndpoint  apic_host=$apic_host$ | table name, primaryIpV4Addr| rename name AS related_Ep primaryIpV4Addr AS IP]] | rename related_* AS * annotation AS Annotation name AS name| fields - name| rename Brc AS Contract Cidr AS CIDR Ep AS "End Point"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$epgToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken2$">
      <title>End Points per EPG</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=hcloudEndPoint ctxClass=cloudEPg | rex field=ctxDn "uni\/tn-(?&lt;tenant_name&gt;[^\/]+)\/cloudapp-(?&lt;cloudApp&gt;[^\/]+)\/cloudepg-(?&lt;cloudEPg&gt;[^\/]+)" |rex field=dn "acct-\[(?&lt;tenantAccount&gt;[^\]]+)\]\/region-\[(?&lt;cloudRegion&gt;[^\]]+)\]\/context-\[(?&lt;Context&gt;[^\]]+)\]\/cidr-\[(?&lt;CIDR&gt;[^\]]+)\]\/subnet-\[(?&lt;Subnet&gt;[^\]]+)\]\/ep-\[(?&lt;EP&gt;[^\]]+)\]" | search tenantAccount=$tenantToken$ cloudApp=$cloudappToken$ cloudEPg=$epgToken$| stats latest(tenantAccount) AS "Tenant", latest(cloudRegion) AS "Cloud Region", latest(Context) AS "VRF" , latest(CIDR) AS "CIDR" , latest(Subnet) AS "Subnet", latest(modTs) AS "Modified Timestamp",latest(ctxDn) AS "Context DN" by EP, primaryIpV4Addr | rename EP AS "End Point", primaryIpV4Addr AS "IP Address" | fields - Tenant</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$tenantToken1$" rejects="$tenantName$,$faultTenant$,$tenantToken$,$tenantToken2$">
      <title>Cloud Regions for Tenant: $tenantToken1$</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=cloudRegion ctxClass=fvTenant ctxDn=uni/tn-$tenantToken1$| rex field=dn "uni\/clouddomp\/provp-(?&lt;cloudProvider&gt;[^\/]+)\/region-(?&lt;cloudRegion&gt;[^.]+)"| stats latest(cloudProvider) AS "Cloud Provider" latest(adminSt) AS "Admin State" latest(capicDeployed) AS "Cloud APIC Deployed" latest(modTs) AS "Last Modified At" by ctxDn, name | fields - ctxDn | join type=outer name [search sourcetype=cisco:apic:* apic_host=$apic_host$ related_component=cloudZone component=cloudRegion ctxDn=uni/clouddomp/provp-aws/region-*/*| rex field=ctxDn "uni\/clouddomp\/provp-(?&lt;cloudProvider&gt;[^\/]+)\/region-(?&lt;cloudRegion&gt;[^\/]+)\/zone-(?&lt;cloudZone&gt;[^.]+)" |dedup cloudZone,cloudRegion,cloudProvider| table cloudRegion, cloudZone| mvcombine delim=", "  cloudZone | rename cloudRegion as name] |rename cloudZone AS "Cloud Zone"| join type=outer name [search sourcetype=cisco:apic:*  apic_host=$apic_host$ related_component=hcloudCtx component=cloudRegion ctxDn=* | rex field=ctxDn "acct-\[(?&lt;tenantAccount&gt;[^\]]+)\]\/region-\[(?&lt;cloudRegion&gt;[^\]]+)\]\/context-\[(?&lt;Context&gt;[^\]]+)\]"|search tenantAccount=$tenantToken1$ | dedup Context, cloudRegion, tenantAccount | table Context,cloudRegion | rename cloudRegion AS name | mvcombine delim=", " Context]| rename name AS "Cloud Region"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <set token="cloudregionToken">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$cloudregionToken$" rejects="$tenantName$,$faultTenant$,$tenantToken$,$tenantToken2$">
      <html id="region">
        <h3>Cloud Region Relations</h3>
     </html>
    </panel>
  </row>
  <row>
    <panel depends="$cloudregionToken$" rejects="$tenantName$,$faultTenant$,$tenantToken$,$tenantToken2$">
      <title>Cloud Zones for Region</title>
      <table>
        <search>
          <query>sourcetype=cisco:apic:* apic_host=$apic_host$ component=cloudRegion ctxClass=cloudZone $cloudregionToken$| dedup ctxDn| table name, related_Zone | rename related_* AS * |join type=outer name [search sourcetype="cisco:apic:*" component=cloudRegion  ctxClass=hcloudCsr $cloudregionToken$ apic_host=$apic_host$| dedup  ctxDn| table  name, related_* | rename related_* AS *| fields - Tenant,component|rename Csr AS CSR]| fields - name</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
    <panel depends="$cloudregionToken$" rejects="$tenantName$,$faultTenant$,$tenantToken$,$tenantToken2$">
      <title>Cloud Region Relation for $cloudregionToken$</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudRegion ctxClass=hcloudEndpoint $cloudregionToken$ apic_host=$apic_host$| dedup  ctxDn  | table  name,related_Ep, related_Subnet, related_Cidr|join type=left related_Ep [search sourcetype="cisco:apic:*" component=hcloudEndpoint  apic_host=$apic_host$ | table name, primaryIpV4Addr| rename name AS related_Ep primaryIpV4Addr AS IP] | rename related_* AS * annotation AS Annotation name AS name|join [search sourcetype="cisco:apic:*" component=cloudRegion  ctxClass=hcloudCsr $cloudregionToken$ apic_host=$apic_host$| dedup  ctxDn| table  name, related_* | rename related_* AS *| fields - Tenant,component|rename Csr AS CSR]| fields - name, Region| rename Brc AS Contract Cidr AS CIDR Ep AS "End Point"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$tenantToken2$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken$">
      <html id="ctx">
        <h3>Cloud Context Profile Relations</h3>
     </html>
    </panel>
  </row>
  <row>
    <panel depends="$tenantToken2$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken$">
      <title>Cloud Context Profiles for Tenant: $tenantToken2$</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=fvTenant ctxClass=cloudCtxProfile dn=uni/tn-$tenantToken2$*| dedup ctxDn | table related_Ctxprofile,annotation  | rename related_Ctxprofile AS "Cloud Context Profile" annotation AS Annotation</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <set token="ctxprofileToken">$click.value$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$ctxprofileToken$" rejects="$tenantName$,$faultTenant$,$tenantToken1$,$tenantToken$">
      <title>Context Profile of $ctxprofileToken$</title>
      <table>
        <search>
          <query>sourcetype="cisco:apic:*" component=cloudCtxProfile ctxClass=hcloudCtx apic_host=$apic_host$ dn=uni/tn-$tenantToken2$/ctxprofile-$ctxprofileToken$|dedup ctxDn| table name, annotation, ctxProfileOwner, related_Context | join type=outer name [search sourcetype="cisco:apic:*" apic_host=$apic_host$ component=cloudCtxProfile ctxClass=fvCtx dn=uni/tn-$tenantToken2$/ctxprofile-$ctxprofileToken$ |dedup ctxDn| table name, annotation, ctxProfileOwner, related_Ctx]| join type=left name [search sourcetype="cisco:apic:*" apic_host=$apic_host$ component=cloudCtxProfile ctxClass=cloudRegion | table name,related_Region| fields - component]| rename related_* AS *|rename name AS "VRF Profile" ctxProfileOwner AS "Profile Owner" Ctx AS VRF annotation AS "Annotation"</query>
          <earliest>$timeToken.earliest$</earliest>
          <latest>$timeToken.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
</form>
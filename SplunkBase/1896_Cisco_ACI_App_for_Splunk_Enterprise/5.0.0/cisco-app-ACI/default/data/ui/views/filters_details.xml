<form script="home_inpage_drilldown.js" stylesheet="table_decorations.css">
  <label>Filters Details</label>
  <description></description>
  <search>
    <query>| inputlookup mso_site_details | dedup apic_host | table apic_host | eval apic_host="apic_host!=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " AND ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition>
        <set token="not_search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'==0">
        <unset token="hide_filter"></unset>
        <set token="non_mso_filter">non_mso_filter</set>
        <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials | fields apic_host | dedup apic_host | SORT apic_host</set>
      </condition>
      <condition>
        <set token="hide_filter">hide_filter</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host | eval apic_host="apic_host=".apic_host | mvcombine apic_host | eval apic_host=mvjoin(apic_host, " OR ")</query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
    <done>
      <condition match="'job.resultCount'&gt;0">
        <set token="search_apic_host">$result.apic_host$</set>
      </condition>
    </done>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="time" searchWhenChanged="true" token="time_token">
      <label>Time Picker</label>
      <default>
        <earliest>-15m</earliest>
        <latest>now</latest>
      </default>
    </input>
     <input type="dropdown" token="mso_host" searchWhenChanged="true" depends="$hide_filter$">
      <label>Multi-Site Orchestrator</label>
      <fieldForLabel>mso_host</fieldForLabel>
      <fieldForValue>mso_host</fieldForValue>
      <search>
        <query>| inputlookup mso_site_details | dedup mso_host | table mso_host</query>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </search>
      <choice value="non_mso_sites">Non MSO Sites</choice>
      <change>
        <condition value="non_mso_sites">
          <set token="host_filter">$not_search_apic_host$</set>
          <set token="apic_host_query">eventtype="cisco_apic_*" component=credentials $not_search_apic_host$ | fields apic_host | dedup apic_host | SORT apic_host</set>
        </condition>
        <condition>
          <set token="host_filter">$search_apic_host$</set>
          <set token="apic_host_query">| inputlookup mso_site_details | search mso_host=$mso_host$ | dedup apic_host | table apic_host</set>
        </condition>
      </change>
      <default>non_mso_sites</default>
    </input>
     <input type="dropdown" token="apic_host" searchWhenChanged="true">
      <label>APIC Site/Cluster</label>
      <selectFirstChoice>true</selectFirstChoice>
      <search>
        <query>$apic_host_query$</query>
        <earliest>$time_token.earliest$</earliest>
        <latest>$time_token.latest$</latest>
        <done>
          <condition match="job.resultCount==0">
            <unset token="formed_apic_host"></unset>
          </condition>
        </done>
      </search>
      <fieldForLabel>apic_host</fieldForLabel>
      <fieldForValue>apic_host</fieldForValue>
      <choice value="all">All</choice>
      <change>
        <condition match="$value$==&quot;all&quot; AND $non_mso_filter$==&quot;non_mso_filter&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">apic_host=*</set>
        </condition>
        <condition match="$value$==&quot;all&quot; AND $mso_host$==&quot;non_mso_sites&quot;">
          <set token="formed_apic_host">$not_search_apic_host$</set>
        </condition>
        <condition value="all">
          <set token="formed_apic_host">$search_apic_host$</set>
        </condition>
        <condition>
          <set token="formed_apic_host">apic_host=$apic_host$</set>
        </condition>
      </change>
    </input>
    <input type="text" token="countRange" searchWhenChanged="true">
      <label>Enter No. of Filters/Tenant: 1-MAX</label>
      <default>100000</default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html id="overview">
      <h1>Dashboard Overview</h1>
      <p>This dashboard provides Number of Filters per Tenant. Also it provides Filter details for all Tenants. <br/>Following drilldown capabilities are provided:<br/>
          <ul>
            <li> Drilldown on Tenant - Provides list of Filters for specific Tenant.</li>
          </ul>
        </p>
     </html>
    </panel>
  </row>
  <row>
    <panel>
      <chart id="master">
        <title>Top No. of Filters Per Tenant</title>
        <search>
          <query>eventtype=cisco_apic_health (component=vzFilter ) $formed_apic_host$ NOT "code" | SORT _time | fields _time dn name component  | dedup dn | rex field=dn "uni\/tn-(?&lt;Tenant&gt;[^\/]+)" | stats count(name) as CountFilters by Tenant | where $countRange$ &gt;= CountFilters | rename CountFilters as "Number of Filters's" | SORT - "Number of Filters's" | head 40</query>
           <earliest>$time_token.earliest$</earliest>
           <latest>$time_token.latest$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Tenant</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <table id="detail2">
        <title>Tenant $tenant$ - Filters Entry Details</title>
        <search>
          <query>eventtype=cisco_apic_health (component=vzEntry ) $formed_apic_host$ NOT "code" | SORT _time |eval "srctofrom" = sFromPort+ " / " + sToPort|eval "dsttofrom" = dFromPort+ " / " + dToPort | rex field=dn "uni\/tn-(?&lt;Tenant&gt;[^\/]+)"| rex field=dn "flt-(?&lt;Filter&gt;[^\/]+)" | search Tenant=$tenant$| stats latest(name) AS "Filter Entry" latest(etherT) AS "Ether Type" latest(prot) AS "IP Protocol" latest(srctofrom) AS "Source Port Range From/To" latest(dsttofrom) AS "Destination Port Range From/To"  by 
Filter, name| rename name AS "Filter Entry" Filter AS "Filter Name"</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>The List of Filters Names</title>
        <search>
          <query>eventtype=cisco_apic_health (component=vzFilter ) $formed_apic_host$ NOT "code" | SORT _time | fields _time dn name component | dedup dn | rex field=dn "uni\/tn-(?&lt;Tenant&gt;[^\/]+)" | table name, Tenant | rename name as "Filters Name" | SORT Tenant</query>
          <earliest>$time_token.earliest$</earliest>
          <latest>$time_token.latest$</latest>
        </search>
       
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</form>
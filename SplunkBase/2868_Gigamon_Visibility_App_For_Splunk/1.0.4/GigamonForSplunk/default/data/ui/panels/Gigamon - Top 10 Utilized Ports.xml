<panel>
	<input type="dropdown" token="topPortsclusterId" searchWhenChanged="true">
      		<label>Cluster/Node - $topPortsclusterId$</label>
      		<search>        <query>|inputlookup giga_clusters | table clusterId</query>      </search>
	        <fieldForLabel>clusterId</fieldForLabel>
	        <fieldForValue>clusterId</fieldForValue>
		<choice value="*">All</choice>
		<default>*</default>
		<change>
			<set token="topPortsclusterId">$value$</set>
		</change>
    		</input>
	<input type="dropdown" token="topPortsportId" searchWhenChanged="true">
		<label>Port ($topPortsportId$)</label>
	        <search>       <query>|inputlookup giga_ports | search clusterId=$topPortsclusterId$ | stats count by portId | fields - count</query>      </search>
		<fieldForLabel>portId</fieldForLabel>
		<fieldForValue>portId</fieldForValue>
	        <default>*</default>
		<choice value="*">All</choice>
		<change>
			<set token="topPortsportId">$value$</set>
		</change>
	</input>
	<input type="dropdown" token="topPortmetric" searchWhenChanged="true">
		<label>Port Metric - $topPortmetric$</label>
		<default>port.utilztn</default>
		<choice value="port.utilztn">Utilization</choice>
		<choice value="port.octets">Octets</choice>
		<choice value="port.packetDiscard">Discards</choice>
		<choice value="port.packetDrop">Drops</choice>
		<choice value="port.packetErr">Errors</choice>
		<choice value="port.packets">Packets</choice>
		<change>
			<set token="topPortmetric">$value$</set>
		</change>
	</input>
	<input type="dropdown" token="earliest_tok" searchWhenChanged="true">
	       <label>Time Range</label>
	      <choice value="-24h@h">Last 24 Hours</choice>
	      <choice value="-7d@d">Last 7 Days</choice>
	      <choice value="-30d@d">Last 30 Days</choice>
	      <default>-24h@h</default>
	
	      <change>
	          <set token="earliest_tok">$value$</set>
	      </change>
	</input>
	<table>
		<title>Top 10 Ports</title>
	<search id="top10ports_base_search">
          <query>`giga_service("stats")` metric="$topPortmetric$" clusterId="$topPortsclusterId$" portId="$topPortsportId$"  | stats sparkline(avg(value)) as "Average Metric" avg(value) as avgval by clusterId portId metric| sort - avgval | head 10 | eval m=replace(metric,"port.","")| lookup psd field AS m | sort - avgval | head 10 | eval "Average Value" = tostring(avgval,"commas")." ".unit | fields - avgval unit m excludes description metric
          </query>
                <earliest>$earliest_tok$</earliest>
                <latest>now</latest>
        </search>
      </table>
    </panel>

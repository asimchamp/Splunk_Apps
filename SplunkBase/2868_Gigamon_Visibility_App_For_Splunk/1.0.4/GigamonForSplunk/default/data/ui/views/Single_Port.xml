<form script="cubism_wrap.js, dashboard.js, tabs.js, d3.v2.min.js" stylesheet="dashboard.css, tabs.js">
  <label>Single Port</label>
  <search id="base_stats">
    <query>`giga_port_status($clusterId$,$portId$)`|table *</query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>
  <search id="lookup_ports">
    <query>|inputlookup giga_ports | search clusterId=$clusterId$ portId=$portId$</query>
  </search>
  <search id="base_statistics">
    <query>`giga_service("stats")` clusterId=$clusterId$ portId=$portId$ |rename port.* as * | table *</query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>
  <fieldset submitButton="true" autoRun="true">
    <input type="dropdown" token="clusterId">
      <label>Cluster/Node</label>
      <search>
        <query>|inputlookup giga_clusters | stats count by clusterId</query>
      </search>
      <fieldForLabel>clusterId</fieldForLabel>
      <fieldForValue>clusterId</fieldForValue>
    </input>
    <input type="dropdown" token="portId" searchWhenChanged="true">
      <label>Port (x/x/x)</label>
      <search>
        <query>|inputlookup giga_ports | search clusterId=$clusterId$ | stats count by portId | fields - count</query>
      </search>
      <fieldForLabel>portId</fieldForLabel>
      <fieldForValue>portId</fieldForValue>
    </input>
    <input type="time" token="time_range">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <search id="cubism_stats_search">
    <query>|`giga_cubism_port_stats_single($clusterId$,$portId$)`</query>
    <earliest>$time_range.earliest$</earliest>
    <latest>$time_range.latest$</latest>
  </search>
  <row id="tabs">
    <panel>
      <html>
	      <ul id="tabs" class="nav nav-tabs">
            <li class="active">
            <a href="#" class="toggle-tab" data-toggle="tab" data-elements="portadmin,port_important,portoptions">Administrative</a>
                    </li>
		    <li>
            <a href="#" class="toggle-tab" data-toggle="tab" data-elements="porttrend,portpkts">Port Trends</a>
          </li>
            <li>
            <a href="#" class="toggle-tab" data-toggle="tab" data-elements="portstats">Port Metrics</a>
          </li>
		   </ul>
	      </html>
    </panel>
  </row>
  <row id="portadmin">
    <panel>
      <single>
        <title>Administrative Status</title>
        <search base="lookup_ports">
          <query>fields adminStatus</query>
        </search>
        <option name="drilldown">none</option>
        <option name="classField">adminStatus</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="linkView">search</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Operational Status Status</title>
        <search base="lookup_ports">
          <query>fields operStatus</query>
        </search>
        <option name="drilldown">none</option>
        <option name="classField">operStatus</option>
        <option name="linkView">search</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Last Check</title>
        <search base="lookup_ports">
          <query>fields timestamp</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>
  <row id="portoptions">
    <panel>
      <table>
        <title>Assigned Maps</title>
        <search base="base_stats">
          <query>search `giga_service("maps")` | stats values(srcPorts{}) as "Source Ports" values(dstPorts{}) as "Destination Ports" latest(type) as "Map Type" latest(subType) as "Map Sub Type" by alias clusterId</query>
        </search>
        <option name="drilldown">cell</option>
        <option name="linkView">search</option>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Assigned GigaSMART Operations</title>
        <search>
          <query>|inputlookup giga_smart | mvexpand ports | search ports=$portId$ AND clusterId=$clusterId$  | fields - *_attr _key _mkv_child | transpose | rename column AS Key "row 1" AS Value</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">cell</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
        <drilldown>
          <link><![CDATA[
            	/app/GigamonForSplunk/GigaSMART?form.time_range.earliest=-24h%40h&form.time_range.latest=now&earliest=0&latest=&form.clusterId=$clusterId$&form.alias=$click.value2$
				]]>
          </link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <table>
        <title>Port Attributes</title>
        <search base="base_stats">
          <query>search `giga_service("port")`|stats latest(comment) as "Alias" latest(configSpeed) as "Configuration Speed" latest(duplex) as "Duplex Mode" latest(portType) as "Port Type" latest(licensed) as Licensed  latest(autoNeg) as "Auto Negotiation" latest(medium) as Medium latest(sfp.sfpType) as "SFP Type" | transpose | rename column as "Item" "row 1" as Value</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="drilldown">row</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row id="porttrend">
    <panel>
      <title>Port Ups and Downs over Time</title>
      <chart>
        <title>Up = 10, Down = 5, No column = missing data.</title>
        <search base="base_stats">
          <query>eval updown = case(operStatus=="up",10,operStatus=="down",5,1==1,0) | search `giga_service("port")`|timechart bins=100 max(updown) as Up by portId | eval down = 5</query>
        </search>
        <option name="linkView">search</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.chart.overlayFields">down</option>
        <option name="charting.axisTitleX.text">Time</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Utilization</title>
        <search base="base_statistics">
          <query>search metric=port.utilztn| timechart bins=100 avg(value) as "Port Utilization"</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisY2.enabled">undefined</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">1</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Time</option>
      </chart>
    </panel>
  </row>
  <row id="portpkts">
    <panel>
      <chart>
        <title>Packet Rates</title>
        <search base="base_statistics">
          <query>eval port_{metric} = value | timechart bins=100 avg(port_*) as * | rename port.* as *</query>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.axisY2.enabled">undefined</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.axisTitleX.text">Time</option>
      </chart>
    </panel>
  </row>
  <row id="portstats">
    <panel>
      <html>
          <div class="cubism" data-managerid="cubism_stats_search" ></div>
        </html>
    </panel>
  </row>
</form>

[port53tttt]
TIME_PREFIX =
MAX_TIMESTAMP_LOOKAHEAD = 30
TIME_FORMAT =%Y-%m-%d %H:%M:%S.%3N
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)
TRUNCATE = 999999 
EVENT_BREAKER_ENABLE = true
EVENT_BREAKER = ([\r\n]+)
MAX_DAYS_AGO = 10000

# TODO reply_code_id https://tools.ietf.org/html/rfc2929#section-2.3. 0-10, 16-21
# NoError, FormErr, ServFail, NXDomain, NotImp, Refused, YXDomain, YXRRSet, NotAuth, NotZone, BADVERS, BADSIG, BADKEY, BADTIME, BADMODE, BADNAME, BADALG, unknown
# TODO reply_code validation

EXTRACT-query_or_response = \s[A-Z]+(?<is_query>\?)\s
EXTRACT-length = \slength\s(?<length>\d+)

REPORT-1-pass-udp = tcpdump_output_1_udp
REPORT-1-pass-tcp = tcpdump_output_1_tcp_1, tcpdump_output_1_tcp_2, tcpdump_output_1_tcp_3, tcpdump_output_1_tcp_4
REPORT-2-pass = tcpdump_output_2_dns_len
REPORT-3-pass = tcpdump_output_3_answer_count
REPORT-4-pass = tcpdump_output_4_get_response_1
REPORT-5-pass = tcpdump_output_5_parse_response_1
REPORT-6-pass = tcpdump_output_6_get_flags_1
REPORT-7-pass = tcpdump_output_7_get_anomalies
REPORT-8-pass = tcpdump_output_8_get_query

FIELDALIAS-query_type = record_type AS query_type
FIELDALIAS-vendor_product = sourcetype AS vendor_product

EVAL-transport = CASE ( dns_tcp =  "Flags" AND length != 0 , "tcp" ,\
                        isnull(dns_tcp)                    , "udp" )
EVAL-answer       = coalesce (A, AAAA)
EVAL-dest_port    = if ( d_port = 53      , d_port  , s_port)
EVAL-src_port     = if ( d_port = 53      , s_port  , d_port)
EVAL-dest         = if ( d_port = 53      , d_ip    , s_ip     )
EVAL-src          = if ( d_port = 53      , s_ip    , d_ip     )
EVAL-message_type = if (isnotnull(is_query)  , "QUERY"   , "RESPONSE" )
EVAL-reply_code   = CASE (isnotnull(reply_code) AND isnull(is_query), reply_code,\
                          isnull(is_query)                          , "NoError"  )


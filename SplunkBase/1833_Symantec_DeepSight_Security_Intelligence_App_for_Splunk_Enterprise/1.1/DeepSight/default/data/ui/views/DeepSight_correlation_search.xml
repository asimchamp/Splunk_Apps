<form>
  <label>DeepSight Correlation Search</label>
  <fieldset autoRun="false" submitButton="true">
    <input type="radio" token="ip_url">
      <label>Searching Deepsight for:</label>
      <choice value="ip">IPs</choice>
      <choice value="url">URLs</choice>
      <default>ip</default>
    </input>
    <input type="text" token="user_sourcetype">
      <label>Enter a vaild sourcetype from your environment:</label>
      <default>entry required</default>
    </input>
    <input type="text" token="user_field">
      <label>Enter a valid field name containing IPs or URLs from your environment:</label>
      <default>entry required</default>
    </input>
    <input type="multiselect" token="confidence">
      <label>Confidence</label>
      <default>*</default>
      <choice value="*">All</choice>
      <choice value="1">1</choice>
      <choice value="2">2</choice>
      <choice value="3">3</choice>
      <choice value="4">4</choice>
      <choice value="5">5</choice>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>confidence=</valuePrefix>
      <delimiter> OR </delimiter>
    </input>
    <input type="multiselect" token="hostility">
      <label>Hostility</label>
      <default>*</default>
      <choice value="*">All</choice>
      <choice value="1">1</choice>
      <choice value="2">2</choice>
      <choice value="3">3</choice>
      <choice value="4">4</choice>
      <choice value="5">5</choice>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>hostility=</valuePrefix>
      <delimiter> OR </delimiter>
    </input>
    <input type="multiselect" token="reputation">
      <label>Reputation</label>
      <default>*</default>
      <choice value="*">All</choice>
      <choice value="1">1</choice>
      <choice value="2">2</choice>
      <choice value="3">3</choice>
      <choice value="4">4</choice>
      <choice value="5">5</choice>
      <choice value="6">6</choice>
      <choice value="7">7</choice>
      <choice value="8">8</choice>
      <choice value="9">9</choice>
      <choice value="10">10</choice>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>reputation=</valuePrefix>
      <delimiter> OR </delimiter>
    </input>
    <input type="multiselect" token="behavior">
      <label>Behavior</label>
      <choice value="*">All</choice>
      <choice value="attack">attack</choice>
      <choice value="bot">bot</choice>
      <choice value="CnC">CnC</choice>
      <choice value="fraud">fraud</choice>
      <choice value="malware">malware</choice>
      <choice value="phish_host">phish_host</choice>
      <choice value="spam">spam</choice>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>behavior=</valuePrefix>
      <delimiter> OR </delimiter>
    </input>
    <input type="time" searchWhenChanged="true">
      <default>Last 24 hours</default>
    </input>
  </fieldset>
  <searchTemplate>(sourcetype=$user_sourcetype$ $user_field$=*) OR (index=deepsight sourcetype=deepsight_$ip_url$ $reputation$ $confidence$ $behavior$ $hostility$) 
    [search (sourcetype=$user_sourcetype$ $user_field$=*) OR (index=deepsight sourcetype=deepsight_$ip_url$ $reputation$ $confidence$ $behavior$ $hostility$) 
    | eval $ip_url$=coalesce($ip_url$,$user_field$) 
    | stats count by $ip_url$ sourcetype | stats count by $ip_url$ | where count&gt;1 | eval $user_field$=$ip_url$ 
    | fields $ip_url$ $user_field$ 
    | format "(" "(" "OR" ")" "OR" ")"]
  </searchTemplate>
  <row>
    <single>
      <title>Entries Matched</title>
      <searchPostProcess>stats dc($ip_url$)</searchPostProcess>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="linkView">search</option>
    </single>
    <single>
      <title>Max Reputation Score</title>
      <searchPostProcess>stats max(reputation)</searchPostProcess>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
    </single>
    <single>
      <title>Max Confidence Score</title>
      <searchPostProcess>stats max(confidence)</searchPostProcess>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
    </single>
    <!--
    <single>
      <title>Max Behavior Type</title>
      <searchPostProcess> stats max(behavior)</searchPostProcess>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
      <option name="linkView">search</option>
    </single>
    -->
    <single>
      <title>Max Hostility Score</title>
      <searchPostProcess>stats max(hostility)</searchPostProcess>
      <earliestTime>$earliest$</earliestTime>
      <latestTime>$latest$</latestTime>
    </single>
  </row>
  <row>
    <table>
      <title>DeepSight Hits</title>
      <searchPostProcess>chart list(_time) AS Time list(confidence) AS Confidence list(hostility) AS Hostility list(reputation) AS Reputation list(behavior) AS Behavior by $ip_url$ | convert ctime(Time)</searchPostProcess>
      <earliestTime>-30d@d</earliestTime>
      <latestTime>now</latestTime>
      <drilldown>
        <link field="ip">https://mss.symantec.com/PortalNextgen/Research/IP?ip=$click.value$</link>
        <link field="url">https://mss.symantec.com/PortalNextgen/Research/URL?url=$click.value$</link>
      </drilldown>
    </table>
  </row>
  <row>
    <table>
      <title>Event Details</title>
      <searchPostProcess>table _time $user_field$ _raw | search $user_field$=*</searchPostProcess>
      <earliestTime>-30d@d</earliestTime>
      <latestTime>now</latestTime>
    </table>
  </row>
</form>
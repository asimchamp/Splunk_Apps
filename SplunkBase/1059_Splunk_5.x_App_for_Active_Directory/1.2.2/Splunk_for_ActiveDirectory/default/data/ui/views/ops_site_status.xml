<?xml version="1.0" encoding="UTF-8"?>
<view onUnloadCancelJob="True" template="dashboard.html">
	<label>Site Status</label>
	<module name="AccountBar" layoutPanel="appHeader" />
	<module name="AppBar" layoutPanel="appHeader" />
	<module name="SideviewUtils" layoutPanel="appHeader" />

	<module name="Message" layoutPanel="messaging">
		<param name="filter">*</param>
		<param name="clearOnJobDispatch">False</param>
		<param name="maxSize">1</param>
	</module>

	<module name="TitleBar" layoutPanel="viewHeader"/>

	<module name="GenericHeader" layoutPanel="panel_row1_col1"><param name="label">Site Status</param></module>
	
	<module name="URLLoader" layoutPanel="panel_row1_col1" autoRun="true">
		<module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp1">
			<param name="default">Last 60 minutes</param>
			<param name="searchWhenChanged">true</param>
			
			<module name="Search">
				<param name="search"><![CDATA[|inputlookup DomainSelector.csv|stats count by Site,DomainNetBIOSName]]></param>
				
				<module name="Pulldown" layoutPanel="panel_row1_col1_grp2">
					<param name="name">Site</param>
					<param name="size">1</param>
					<param name="width">300px</param>
					<param name="staticFieldsToDisplay"></param>
					<param name="label">Site Name: </param>
					<param name="postProcess">dedup $name$|sort $name$</param>
					<param name="staticFieldsToDisplay"></param>
					<param name="searchFieldsToDisplay">
						<list>
							<param name="label">Site</param>
							<param name="value">Site</param>
						</list>
					</param>
					
					<module name="Pulldown" layoutPanel="panel_row1_col1_grp3">
						<param name="name">DomainNetBIOSName</param>
						<param name="size">1</param>
						<param name="width">300px</param>
						<param name="staticFieldsToDisplay"></param>
						<param name="label">Domain: </param>
						<param name="postProcess">search Site="$Site$"|dedup $name$|sort $name$</param>
						<param name="staticFieldsToDisplay"></param>
						<param name="searchFieldsToDisplay">
							<list>
								<param name="label">DomainNetBIOSName</param>
								<param name="value">DomainNetBIOSName</param>
							</list>
						</param>
						
						<module name="Search" layoutPanel="panel_row2_col1">
							<param name="search"><![CDATA[eventtype=msad-dc-health Site="$Site$"|dedup host|fields *]]></param>
							<module name="JobProgressIndicator"></module>
							
							<module name="PostProcess" layoutPanel="panel_row2_col1"> 
								<param name="search"><![CDATA[search IsIntersiteTopologyGenerator="True"|head 1|table Server]]></param>
								<module name="SingleValue">
									<param name="beforeLabel">Intersite Topology Generator: </param>
									<param name="additionalClass">single_istg</param>
								</module>
							</module>
							<module name="GenericHeader" layoutPanel="panel_row3_col1_grp1">
								<param name="label">Domains in Site</param>
								<module name="PostProcess">
									<param name="search"><![CDATA[table DomainDNSName,DomainNetBIOSName|dedup DomainDNSName|sort -DomainDNSName|rename DomainDNSName as "Domain Name", DomainNetBIOSName as "NetBIOS Name"]]></param>
									<module name="Pager">
										<module name="SimpleResultsTable">
											<param name="drilldown">row</param>
											<module name="Redirector">
												<param name="url">ops_domain_status</param>
												<param name="arg.autoRun">True</param>
												<param name="arg.DomainName">$click.cell0.value$</param>
												<param name="arg.earliest">$search.timeRange.earliest$</param>
												<param name="arg.latest">$search.timeRange.latest$</param>
											</module> <!-- Redirector -->
										</module> <!-- SimpleResultsTable -->
									</module> <!-- Pager -->
								</module> <!-- PostProcess for Domain Name -->
							</module> <!-- GenericHeader#Domains In Site -->
							
							<module name="GenericHeader" layoutPanel="panel_row3_col1_grp2">
								<param name="label">Domain Controllers in Site</param>
								<module name="PostProcess">
									<param name="search"><![CDATA[table host,DCWeight|dedup host|sort -host|rename host as "Domain Controller", DCWeight as "Weight"]]></param>
									<module name="Pager">
										<module name="SimpleResultsTable">
											<param name="drilldown">row</param>
											<module name="Redirector">
												<param name="url">ops_dc_status</param>
												<param name="arg.autoRun">True</param>
												<param name="arg.host">$click.cell0.value$</param>
												<param name="arg.earliest">$search.timeRange.earliest$</param>
												<param name="arg.latest">$search.timeRange.latest$</param>
											</module> <!-- Redirector -->
										</module> <!-- SimpleResultsTable -->
									</module> <!-- Pager -->
								</module> <!-- PostProcess for Domain Name -->
							</module> <!-- GenericHeader#DCs in Site -->
						</module> <!-- Search -->
							
						<module name="GenericHeader" layoutPanel="panel_row3_col1_grp3">
							<param name="label">Subnets in Site</param>
							<module name="Search">
								<param name="search"><![CDATA[eventtype=msad-subnetinfo Site="$Site$"|dedup Name|table Name,Location]]></param>
								<module name="Pager">
									<module name="SimpleResultsTable">
									</module> <!-- SimpleResultsTable -->
								</module> <!-- Pager -->
							</module> <!-- Search -->
						</module> <!-- GenericHeader#Subnets in Site -->
						
						<module name="GenericHeader" layoutPanel="panel_row4_col1">
							<param name="label">Site Links</param>
							<module name="Search">
								<param name="search"><![CDATA[eventtype=msad-sitelinkinfo Site="$Site$"|dedup Name|eval ReplicationInterval=tostring(ReplicationIntervalSecs,"duration")|table Name,TransportType,Cost,ReplicationInterval,Site|rename Name as "Site Link", TransportType as "Type", ReplicationInterval as "Replication Interval", Site as "Contained Sites"]]></param>
								<module name="Pager">
									<module name="SimpleResultsTable">
									</module> <!-- SimpleResultsTable -->
								</module> <!-- Pager -->
							</module> <!-- Search -->
						</module> <!-- GenericHeader#SiteLink Info -->
						
						<module name="GenericHeader" layoutPanel="panel_row5_col1">
							<param name="label">Domain Controller Weighting</param>
							<module name="StaticContentSample">
								<param name="text"><![CDATA[The chart on the left indicates the weighting that has been configured on the domain controllers 
								in this site for that domain.  The chart on the right indicates the observed weighting, based on the client computer 
								authentications to the domain controllers.  Over a reasonable amount of time, they should be consistent.]]></param>
							</module> <!-- StaticContentSample -->
							
							<module name="Search" layoutPanel="panel_row5_col1_grp1">
								<param name="search"><![CDATA[eventtype=msad-dc-health Site="$Site$" DomainNetBIOSName="$DomainNetBIOSName$"|stats avg(DCWeight) by host|sort host]]></param>

								<module name="GenericHeader"><param name="label">Target Weighting</param></module>
								<module name="HiddenChartFormatter">
									<param name="chart">pie</param>
									<param name="legend.placement">left</param>
									<module name="JSChart">
										<param name="height">200px</param>
										<param name="enableResize">True</param>
									</module>
								</module> <!-- HiddenChartFormatter -->
							</module> <!-- Search for the Target DC Weighting -->
								
							<module name="Search" layoutPanel="panel_row5_col1_grp2">
								<param name="search"><![CDATA[eventtype=msad-successful-computer-logons|stats count by host|join type=inner host [search eventtype=msad-dc-health Site="$Site$" DomainNetBIOSName="$DomainNetBIOSName$"|dedup host|fields host]|table host,count|rename count as "Computer Logons"|sort host]]></param>

								<module name="GenericHeader"><param name="label">Actual Weighting</param></module>
								<module name="HiddenChartFormatter">
									<param name="chart">pie</param>
									<param name="legend.placement">right</param>
									<module name="JSChart">
										<param name="height">200px</param>
										<param name="enableResize">True</param>
									</module>
								</module> <!-- HiddenChartFormatter -->
							</module> <!-- Search for the Target DC Weighting -->
							
						</module> <!-- GenericHeader#DC Weighting -->
					</module> <!-- Pulldown for host -->
				</module> <!-- Pulldown for Site -->
			</module> <!-- Search for Pulldowns -->
		</module> <!-- TimeRangePicker -->
	</module> <!-- URLLoader -->
</view>

<?xml version="1.0" encoding="UTF-8"?>
<view onUnloadCancelJob="True" template="dashboard.html">
	<label>Computer Audit</label>
	<module name="AccountBar" layoutPanel="appHeader" />
	<module name="AppBar" layoutPanel="appHeader" />
	<module name="SideviewUtils" layoutPanel="appHeader" />

	<module name="Message" layoutPanel="messaging">
		<param name="filter">*</param>
		<param name="clearOnJobDispatch">False</param>
		<param name="maxSize">1</param>
	</module>

	<module name="TitleBar" layoutPanel="viewHeader"/>

	<module name="URLLoader" layoutPanel="panel_row1_col1">
		<module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp1" autoRun="True">
			<param name="default">Last 60 minutes</param>
			<param name="searchWhenChanged">True</param>
			
			<module name="Search">
				<param name="search"><![CDATA[|`domain-dropdown`]]></param>
				<module name="Pulldown" layoutPanel="panel_row1_col1_grp2">
					<param name="name">domain</param>
					<param name="label">Account Domain:</param>
					<param name="staticFieldsToDisplay"></param>
					<param name="searchFieldsToDisplay">
						<list>
							<param name="label">nt_domain</param>
							<param name="value">nt_domain</param>
						</list>
					</param>
					<module name="TextField" layoutPanel="panel_row1_col1_grp3">
						<param name="name">computer</param>
						<param name="label">Computer Account:</param>
						
						<!-- R2C1 - LDAP Record -->
						<module name="Search" layoutPanel="panel_row2_col1">
							<param name="search"><![CDATA[|ldapsearch domain=$domain$ search="(&(objectclass=computer)(|(cn=$computer$)(sAMAccountName=$computer$)))"|fields *]]></param>
							<module name="GenericHeader"><param name="label">Active Directory Record</param></module>
							<module name="JobProgressIndicator"></module>
							<module name="LDAPRecord"></module>
						</module>
						
						<!--  R2C2 Group Membership -->
						<module name="Search" layoutPanel="panel_row2_col2">
							<param name="search"><![CDATA[|ldapsearch domain=$domain$ search="(objectclass=group)" attrs="cn,description,primaryGroupToken"|eval joiner=mvappend(dn,primaryGroupToken)|rename dn as groupDN,cn as groupName,primaryGroupToken as primaryGroupID|table groupDN,groupName,primaryGroupID,joiner|mvexpand joiner|join type=inner joiner [ldapsearch domain=$domain$ search="(&(objectclass=computer)(|(cn=$computer$)(sAMAccountName=$computer$)))" attrs="memberOf,primaryGroupID"|eval joiner=mvappend(memberOf,primaryGroupID)|table joiner|mvexpand joiner]|dedup groupDN|table groupDN,groupName,primaryGroupID|sort primaryGroupID]]></param>
							<module name="GenericHeader"><param name="label">Group Membership</param></module>
							<module name="JobProgressIndicator"></module>
							<module name="Pager">
								<module name="SimpleResultsTable"></module>
							</module>
						</module>
						
						<!-- R2C2 IP Address Activity -->
						<module name="Search" layoutPanel="panel_row2_col2">
							<param name="search"><![CDATA[eventtype=msad-successful-computer-logons user="$computer$$$" dest_nt_domain="$domain$"|table _time,host,src_ip|dedup consecutive=T src_ip|lookup SiteInfo host|table _time,src_ip,Site]]></param>
							<module name="GenericHeader"><param name="label">IP Address History</param></module>
							<module name="JobProgressIndicator"></module>
							<module name="Pager">
								<module name="SimpleResultsTable"></module>
							</module>
						</module>
						
						<!-- R2C2 Failed Logon Activity -->
						<module name="Search" layoutPanel="panel_row2_col2">
							<param name="search"><![CDATA[eventtype=msad-failed-computer-logons|rename User_ID as userSid|join type=inner userSid [ldapsearch domain=$domain$ search="(&(objectclass=computer)(|(cn=$computer$)(sAMAccountName=$computer$)))" attrs="objectSid"|eval userSid="%{"+objectSid+"}"|fields userSid]|stats min(_time) as mintime,max(_time) as maxtime,count by src_ip,signature|`ip-to-host`|`fix-localhost`|eval mintime=strftime(mintime,"%F %T")|eval maxtime=strftime(maxtime,"%F %T")|rename mintime as "Earliest",maxtime as "Latest",src_host as Workstation,src_ip as "IP Address", signature as "Reason"]]></param>
							<module name="GenericHeader"><param name="label">Failed Logon Activity</param></module>
							<module name="JobProgressIndicator"></module>
							<module name="Pager">
								<module name="SimpleResultsTable"></module>
							</module>
						</module>
					</module> <!-- TextField#Account User -->
				</module> <!-- Pulldown#Account Domain -->
			</module> <!-- Search driving Pulldown -->
		</module> <!-- TimeRangePicker -->
	</module> <!-- URLLoader -->
</view>

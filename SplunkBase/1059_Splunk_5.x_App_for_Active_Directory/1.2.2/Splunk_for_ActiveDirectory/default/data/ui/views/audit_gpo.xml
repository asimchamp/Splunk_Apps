<?xml version="1.0" encoding="UTF-8"?>
<view onUnloadCancelJob="True" template="dashboard.html">
	<label>Group Policy Audit</label>
	<module name="AccountBar" layoutPanel="appHeader" />
	<module name="AppBar" layoutPanel="appHeader" />
	<module name="SideviewUtils" layoutPanel="appHeader" />

	<module name="Message" layoutPanel="messaging">
		<param name="filter">*</param>
		<param name="clearOnJobDispatch">False</param>
		<param name="maxSize">1</param>
	</module>

	<module name="TitleBar" layoutPanel="viewHeader"/>

	<module name="URLLoader" layoutPanel="panel_row1_col1">
		<module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp1" autoRun="True">
			<param name="default">Last 60 minutes</param>
			<param name="searchWhenChanged">True</param>
			
			<module name="Search">
				<param name="search"><![CDATA[|`domain-dropdown`]]></param>
				<module name="Pulldown" layoutPanel="panel_row1_col1_grp2">
					<param name="name">nt_domain</param>
					<param name="label">Domain:</param>
					<param name="staticFieldsToDisplay"></param>
					<param name="searchFieldsToDisplay">
						<list>
							<param name="label">nt_domain</param>
							<param name="value">nt_domain</param>
						</list>
					</param>
					<module name="TextField" layoutPanel="panel_row1_col1_grp3">
						<param name="name">object</param>
						<param name="label">Group Policy Name:</param>
						
						<!-- R2C1 - LDAP Record -->
						<module name="Search" layoutPanel="panel_row2_col1">
							<param name="search"><![CDATA[|ldapsearch domain=$nt_domain$ search="(&(objectclass=groupPolicyContainer)(|(cn=$object$)(displayName=$object$)))"|fields *]]></param>
							<module name="GenericHeader"><param name="label">Active Directory Record</param></module>
							<module name="JobProgressIndicator"></module>
							<module name="LDAPRecord"></module>
						</module>
						
						<!-- R3C1 - Linkage -->
						<module name="Search" layoutPanel="panel_row2_col2">
							<param name="search"><![CDATA[|ldapsearch domain=$nt_domain$ search="(&(objectclass=groupPolicyContainer)(|(cn=$object$)(displayName=$object$)))" attrs="displayName,cn,versionNumber"|join type=outer cn [ldapsearch domain=$nt_domain$ search="(gPLink=*)" attrs="distinguishedName,gPLink"|where isnotnull(gPLink)|rex field=gPLink max_match=10 "\[LDAP://(CN|cn)=(?<cn>[^,]+),"|table cn,distinguishedName|mvexpand cn|mvcombine distinguishedName|eval lc=mvjoin(distinguishedName,"###")|fields cn,lc]|eval linkedContainers=split(lc,"###")|table linkedContainers|mvexpand linkedContainers|rename linkedContainers as "Linked Containers"]]></param>
							<module name="JobProgressIndicator"></module>
							<module name="GenericHeader"><param name="label">Linked Containers</param></module>
							<module name="Pager"><module name="SimpleResultsTable"></module></module>
						</module>
						
						<!-- R4C1 - Changes -->
						<module name="Search" layoutPanel="panel_row2_col2">
							<param name="search"><![CDATA[`audit-gpo-changes($nt_domain$)`|search (displayName="$object$" OR cn="$object$")|`session-to-host`|table _time,adminuser,login_host|rename adminuser as "Administrator",login_host as "Workstation"]]></param>
							<module name="JobProgressIndicator"></module>
							<module name="GenericHeader"><param name="label">Changes</param></module>
							<module name="Pager"><module name="SimpleResultsTable"></module></module>
						</module>						
					</module> <!-- TextField#Account User -->
				</module> <!-- Pulldown#Account Domain -->
			</module> <!-- Search driving Pulldown -->
		</module> <!-- TimeRangePicker -->
	</module> <!-- URLLoader -->
</view>

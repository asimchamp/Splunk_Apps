<?xml version="1.0" encoding="UTF-8"?>
<view onUnloadCancelJob="True" template="dashboard.html">
	<label>User Record Changes</label>
	<module name="AccountBar" layoutPanel="appHeader" />
	<module name="AppBar" layoutPanel="appHeader" />
	<module name="SideviewUtils" layoutPanel="appHeader" />

	<module name="Message" layoutPanel="messaging">
		<param name="filter">*</param>
		<param name="clearOnJobDispatch">False</param>
		<param name="maxSize">1</param>
	</module>

	<module name="TitleBar" layoutPanel="viewHeader"/>
		
	<!-- The Time Range Picker feeds the picker for the MSADDomainSelector -->
	<module name="TimeRangePicker" layoutPanel="panel_row3_col1_grp1" autoRun="True">
		<param name="default">Last 60 minutes</param>
		<param name="searchWhenChanged">True</param>
			
		<!-- Search for the MSAD Topology so we can render it in the Domain Selector -->
		<module name="Search">
			<param name="search">|`domain-selector`</param>
		
			<module name="JobProgressIndicator" layoutPanel="panel_row2_col1"></module>

			<module name="ColumnSelector" layoutPanel="panel_row2_col1">
				<param name="drilldownPrefix">domainselection</param>
				<param name="defaultState">true</param>
				<param name="autoSelector">both</param>
				<param name="loadFromCookie">true</param>
				<param name="cookieName">domainselection</param>
				<param name="columns">
					<param name="ForestName">
						<param name="title">Forest</param>
						<param name="weight">0</param>
					</param>
					<param name="Site">
						<param name="title">Site</param>
						<param name="weight">1</param>
					</param>
					<param name="DomainDNSName">
						<param name="title">Domain</param>
						<param name="weight">2</param>
					</param>
					<param name="host">
						<param name="title">Server</param>
						<param name="weight">3</param>
					</param>
				</param>
				
				<module name="TextField" layoutPanel="panel_row3_col1_grp2">
					<param name="name">user</param>
					<param name="label">Account User:</param>
					<param name="default">*</param>
					
					<module name="Search" layoutPanel="panel_row4_col1">
						<param name="search"><![CDATA[eventtype=msad-user-changes $domainselection.host$ user="$user$"|eval adminuser=src_nt_domain."\\".src_user|eval dest_user_subject=dest_nt_domain."\\".user|`msad-changed-attributes`|`session-to-host`|`ip-to-host`|`fix-localhost`|table _time,src_ip,src_host,adminuser,msad_action,dest_user_subject,MSADChanges|rename src_ip as "Admin IP",src_host as "Workstation",adminuser as "Administrator",msad_action as "Action",dest_user_subject as "Target User",MSADChanges as "Changes"]]></param>
						<module name="JobProgressIndicator"></module>
						<module name="GenericHeader"><param name="label">Security-Relevant Changes</param></module>
						<module name="Pager">
							<module name="SimpleResultsTable"></module>
						</module>
					</module>
					
					<module name="Search" layoutPanel="panel_row5_col1">
						<param name="search"><![CDATA[eventtype=admon objectClass="*person*" NOT objectClass="*computer*" sAMAccountName="$user$" $domainselection.host$|dedup distinguishedName,uSNChanged|rex field=_raw "(?ms)Additional Details:\s*[\r\n]+(?<MSADChangedAttributes>.*)"|`msad-changed-attributes`|table _time,sAMAccountName,MSADChanges|where mvcount(MSADChanges)>0]]></param>
						<module name="GenericHeader"><param name="label">Directory Record Changes</param></module>
						<module name="Pager">
							<module name="SimpleResultsTable"></module>
						</module>
					</module>
				</module> <!-- TextField -->
			</module> <!-- ColumnSelector -->
		</module> <!-- Search#domainselection -->
	</module> <!-- TimeRangePicker -->
</view>

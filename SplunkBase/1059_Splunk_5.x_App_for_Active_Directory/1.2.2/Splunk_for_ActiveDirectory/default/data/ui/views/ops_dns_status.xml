<?xml version="1.0" encoding="UTF-8"?>
<view onUnloadCancelJob="True" template="dashboard.html">
	<label>DNS Status</label>
	<module name="AccountBar" layoutPanel="appHeader" />
	<module name="AppBar" layoutPanel="appHeader" />
	<module name="SideviewUtils" layoutPanel="appHeader" />

	<module name="Message" layoutPanel="messaging">
		<param name="filter">*</param>
		<param name="clearOnJobDispatch">False</param>
		<param name="maxSize">1</param>
	</module>

	<module name="TitleBar" layoutPanel="viewHeader"/>

	<module name="GenericHeader" layoutPanel="panel_row1_col1_grp1"><param name="label">DNS Service Status</param></module>


	<module name="TimeRangePicker" layoutPanel="panel_row1_col1_grp1" autoRun="True">
		<param name="default">Last 24 hours</param>
		<module name="SubmitButton" layoutPanel="panel_row1_col1_grp2">
			<param name="allowSoftSubmit">True</param>
			
			<module name="Search" layoutPanel="panel_row2_col1">
				<param name="search"><![CDATA[eventtype=perfmon-dns counter="Total Query Received/sec"|stats sparkline(avg(Value),1m) as "Average Queries/sec" by host|join host [search eventtype=msad-dns-zoneinfo|stats values(Zone) as zz by host|eval zz=mvjoin(zz,";")|table host,zz]|join host [search eventtype=msad-dns-health|stats last(OperatingSystem) as "Operating System",last(ServicePack) as "Service Pack",last(ProcsOK) as ProcsOK by host]|eval Zones=split(zz,";")|table host,ProcsOK,Zones,"Operating System","Service Pack","Average Queries/sec"|sort -ProcsOK]]></param>
				<module name="GenericHeader"><param name="label">DNS Servers</param></module>
				<module name="Pager">
					<param name="count">20</param>
					<module name="SimpleResultsTable">
						<param name="count">20</param>
						<param name="drilldown">row</param>
						<module name="Redirector">
							<param name="url">ops_dns_server_status</param>
							<param name="arg.autoRun">True</param>
							<param name="arg.host">$click.cell0.value$</param>
							<param name="arg.earliest">$search.timeRange.earliest$</param>
							<param name="arg.latest">$search.timeRange.latest$</param>
						</module> <!-- Redirector#Drill Down -->
					</module> <!-- SimpleResultsTable -->
				</module> <!-- Pager -->
			</module> <!-- Search#Host List -->

			<module name="Search" layoutPanel="panel_row3_col1">
				<param name="search"><![CDATA[eventtype=msad-dns-zoneinfo|eval Breakdown="A:".A.", AAAA:".AAAA.", CNAME:".CNAME.", HINFO:".HINFO.", MX:".MX.", NS:".NS.", SOA:".SOA.", SRV:".SRV.", TXT:".TXT|dedup host,Zone|stats values(host) as "DNS Servers",values(TotalRecords) as "Total Records",values(Breakdown) as Breakdown by Zone]]></param>
				<module name="HTML"><param name="html"><![CDATA[<div class="GenericHeader"><h3>DNS Zones</h3><p>Note that the Breakdown and values do not necessarily correspond to the listed host.  Differing breakdowns mean that one or more servers are out-of-sync within the zone.  Further investigation is needed if this occurs.</p></div>]]></param></module>
				<module name="Pager">
					<param name="count">20</param>
					<module name="SimpleResultsTable">
						<param name="count">20</param>
						<param name="drilldown">row</param>
						<module name="Redirector">
							<param name="url">ops_dns_zoneinfo</param>
							<param name="arg.autoRun">True</param>
							<param name="arg.Zone">$click.cell0.value$</param>
							<param name="arg.earliest">$search.timeRange.earliest$</param>
							<param name="arg.latest">$search.timeRange.latest$</param>
						</module> <!-- Redirector#Drill Down -->
					</module> <!-- SimpleResultsTable -->
				</module> <!-- Pager -->
			</module> <!-- Search#Zone List -->
			

			<module name="Search" layoutPanel="panel_row4_col1">
				<param name="search"><![CDATA[eventtype=msad-dns-events|lookup EventCodes EventCode,LogName OUTPUTNEW desc|eval desc=if(isnull(desc),"Unknown EventCode",desc)|stats count by host,Type,EventCode,LogName,desc]]></param>
				<module name="GenericHeader"><param name="label">Anomalous Events</param></module>
				<module name="Pager">
					<param name="entityName">results</param>
					<module name="SimpleResultsTable">
						<param name="drilldown">row</param>
						<module name="Redirector">
							<param name="url">flashtimeline</param>
							<param name="arg.autoRun">True</param>
							<param name="arg.q"><![CDATA[eventtype=msad-dns-events host="$click.cell0.value$" Type="$click.cell1.value$" EventCode="$click.cell2.value$" LogName="$click.cell3.value$"]]></param>
							<param name="arg.earliest">$search.timeRange.earliest$</param>
							<param name="arg.latest">$search.timeRange.latest$</param>
						</module>
					</module>
				</module>	
			</module>
		</module>
	</module>
</view>

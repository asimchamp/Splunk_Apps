<form version="1.1" script="timerange.js">
  <label>Failure Summary</label>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="field1" searchWhenChanged="true" id="timerange">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="arrayId_tkn" searchWhenChanged="true">
      <label>Array</label>
      <search>
        <query>| inputlookup nesa_volume_groups | stats count by arrayId, arrayName</query>
      </search>
      <fieldForLabel>arrayName</fieldForLabel>
      <fieldForValue>arrayId</fieldForValue>
    </input>
  </fieldset>
  <row>
    <panel>
      <table>
        <title>Failure Details</title>
        <search>
          <query>`get_nesa_index` host="$arrayId_tkn$" sourcetype=eseries:failures | dedup  failureType  objectRef objectType objectData extraData | eval arrayId=if(objectType=="storageSystem",objectRef,NULL) | eval diskId=if(objectType=="drive",objectRef,NULL) | eval volumeGroupRef=if(objectType=="pool",objectRef,NULL) | lookup nesa_controllers arrayId OUTPUT arrayName | eval arrayName=mvdedup(arrayName) | lookup nesa_drives diskId OUTPUT driveLabel | lookup nesa_volume_groups volumeGroupRef OUTPUT volumeGroup | eval "Object Name"=case(objectType=="storageSystem",arrayName,objectType=="drive",driveLabel,objectType=="pool",volumeGroup) | table failureType objectType "Object Name" objectRef objectData extraData | rename failureType as "Failure Type" objectType as "Object Type" objectData as "Object Data"  extraData as "Extra Data" objectRef as "Object Reference"</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
      </table>
    </panel>
  </row>
</form>
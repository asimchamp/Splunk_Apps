<form version="1.1" script="autodiscover.js">
  <label>Configuration - Hierarchical Drives view</label>
  <fieldset submitButton="false">
    <input type="dropdown" token="arrayId" searchWhenChanged="true">
      <label>Array</label>
      <search>
        <query>
          | inputlookup nesa_volume_groups | stats count by arrayId, arrayName
        </query>
      </search>
      <fieldForLabel>arrayName</fieldForLabel>
      <fieldForValue>arrayId</fieldForValue>
    </input>
  </fieldset>
	  <row>
	    <html><span>
                This dashboard shows the parent-child relationships for array, volume groups/pools and disk drives.  Hover the mouse over objects to see names.  The drives are the smallest circles and are represented in their parent volume group or pool.  Click on an object to zoom in; click outside the object to zoom out.
	    </span></html>
  	</row>
    <row>
	<html>
      	<div id="bubbleSearchD"
        	class="splunk-manager"
            data-require="splunkjs/mvc/searchmanager"
            data-options='{
				"search": {"type": "token_safe", "value": "`get_nesa_index` sourcetype=eseries:graph | search host=$$arrayId$$ | `expand_json_array(drive)` | lookup nesa_volume_groups volumeGroupRef AS currentVolumeGroupRef, arrayId AS host OUTPUT volumeGroup | lookup nesa_drives arrayId AS host, diskId AS id OUTPUT driveLabel | table driveLabel, volumeGroup, host, hotSpare | rename driveLabel AS Location | JOIN type=LEFT host [inputlookup array_controller_label.csv | rename arrayId as host | table host, arrayName] | eval tempCol = if(isnull(volumeGroup),\"\",volumeGroup).\"UNDEFINED GHS=\".hotSpare | eval newVolumeGroup=if(isnull(volumeGroup),tempCol,volumeGroup) | stats count by arrayName, newVolumeGroup, Location"},
            	"earliest_time": "-7d",
            	"status_buckets": 0,
            	"cancelOnUnload": true,
            	"auto_cancel": 90,
            	"preview": true
        	}'>
        </div>
        <div id="bubbleChartD"
            class="splunk-view"
      		data-require="app/netapp_app_eseries_perf/bubblechart"
            data-options='{
            	"managerid": "bubbleSearchD",
				"param": {"type": "token_safe", "value": "$$arrayId$$"},
				"host": "arrayName",
				"controller": "newVolumeGroup",
				"volumegroup": "Location",
                "volumename": "-",
                "height": 1000
            }'>
        </div>
	</html>
  </row>
</form>
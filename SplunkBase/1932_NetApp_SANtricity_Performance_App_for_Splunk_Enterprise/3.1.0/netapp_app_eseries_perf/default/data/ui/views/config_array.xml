<form version="1.1" stylesheet="row_coloring.css,tooltip.css,application.css" script="preferred_controller_row_coloring.js,drive_optimal_row_coloring.js,tooltip.js,custom.js">
  <label>Configuration - Array Summary</label>
  <fieldset>
    <input type="dropdown" token="arrayId" searchWhenChanged="true">
      <label>Array</label>
      <search>
        <query>
          | inputlookup nesa_volume_groups | stats count by arrayId, arrayName
        </query>
      </search>
      <fieldForLabel>arrayName</fieldForLabel>
      <fieldForValue>arrayId</fieldForValue>
    </input>
    <input type="checkbox" token="chkToolTip" id="chkShowToolTip">
      <label>More Information</label>
      <choice value="true">Show Tool Tip</choice>
      <default>true</default>
    </input>
  </fieldset>
  <search id="baseSearch">
    <query>
      `get_nesa_index` sourcetype=eseries:graph host="$arrayId$" | head 1
    </query>
    <earliest>-2h@h</earliest>
    <latest>now</latest>
  </search>
  <row>
    <panel>
      <single>
        <option name="field">label</option>
        <option name="refresh.time.visible">false</option>
        <search>
          <query>| stats count | eval class="None" | eval label="Configuration - Overall Summary"</query>
        </search>
        <drilldown>
          <link>/app/netapp_app_eseries_perf/config_summary</link>
        </drilldown>
      </single>
      <single>
        <option name="field">label</option>
        <option name="refresh.time.visible">false</option>
        <search>
          <query>| stats count | eval class="None" | eval label="Performance - Array by Controller"</query>
        </search>
        <drilldown>
          <link>
            <![CDATA[/app/netapp_app_eseries_perf/perf_array?form.arrayId=$form.arrayId$]]>
          </link>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Array Configuration Summary</title>
        <search base="baseSearch">
          <query>spath sa.saData.needsAttention output=needsAttention | eval state=if(needsAttention="false", "Healthy", "Needs Attention") | spath sa.saData.fixing output=repairing | spath sa.saData.bootTime output=boot | `ctime(boot)` | spath controller{}.modelName output=modelName | eval modelName=mvindex(modelName, 0) | spath volumeGroup{} output=volumeGroup | eval volumeGroup_count=mvcount(volumeGroup) | spath volume{} output=volume | eval volume_count=mvcount(volume) | spath drive{} output=drive | eval drive_count=mvcount(drive) | spath tray{} output=tray | eval tray_count=mvcount(tray) | spath controller{} output=controller | eval controller_count=mvcount(controller)  | fillnull value=0 controller_count, tray_count, volumeGroup_count, volume_count, drive_count | table state, repairing, boot, modelName, controller_count, tray_count, volumeGroup_count, volume_count, drive_count | rename state AS State  repairing AS Repairing  boot AS "Boot Time"  modelName AS "Model Name"  controller_count AS Controllers  tray_count AS Trays  volumeGroup_count AS "Volume Groups/Pools/Disk Pools" volume_count AS Volumes  drive_count AS Drives</query>
        </search>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="tblConfArrayVolumeGroupsPools">
        <title>Volume Groups/Pools</title>
        <search base="baseSearch">
          <query>`expand_json_array(volumeGroup)` | search volumeGroupData.diskPoolData="null" | `nesa_full_volume_group_table_field_list` | eval raidLevel=upper(raidLevel) | eval securityType=upper(securityType) | foreach freeSpace, usedSpace, totalRaidedSpace [ `_bytes_to_GiB(&lt;&lt;FIELD&gt;&gt;)` ] | rename protectionInformationCapabilities.protectionType as ptnew | eval ptnew=substr(ptnew,1, 5) | rename ptnew AS protectionInformationCapabilities.protectionType | `nesa_full_volume_group_field_renames`</query>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link>
            <![CDATA[
/app/netapp_app_eseries_perf/config_vgroups?form.arrayId=$form.arrayId$&form.volumeGroup=$row.Volume Groups/Pools$&form.controllerLabel=*]]>
          </link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="tblConfArrayDiskPools">
        <title>Disk Pools</title>
        <search base="baseSearch">
          <query>`expand_json_array(volumeGroup)` | search volumeGroupData.type="diskPool" | rename volumeGroupData.diskPoolData.reconstructionReservedAmt AS reservedAmt | rename comment AS "_bytes_to_GiB does not like dots in field names" | `_bytes_to_GiB(reservedAmt)` | eval reserve=reservedAmt . " GiB (" . tostring('volumeGroupData.diskPoolData.reconstructionReservedDriveCount') | eval reservations=if('volumeGroupData.diskPoolData.reconstructionReservedDriveCount' &gt; 1, reserve . " Drives)", reserve . "Drive)") | `nesa_full_disk_pool_table_field_list` | eval securityType=upper(securityType) | foreach freeSpace, usedSpace, totalRaidedSpace [ `_bytes_to_GiB(&lt;&lt;FIELD&gt;&gt;)` ] | rename protectionInformationCapabilities.protectionType as ptnew | eval ptnew=substr(ptnew,1, 5) | rename ptnew AS protectionInformationCapabilities.protectionType | `nesa_full_disk_pool_field_renames`</query>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link>
            <![CDATA[
/app/netapp_app_eseries_perf/config_vgroups?form.arrayId=$form.arrayId$&form.volumeGroup=$row.Disk Pool$&form.controllerLabel=*]]>
          </link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="volumes_table">
        <title>Volumes</title>
        <search base="baseSearch">
          <query>`expand_json_array(volume)` | lookup nesa_volumes volumeName AS label, arrayId AS host OUTPUT volumeGroupRef | lookup nesa_volume_groups volumeGroupRef, arrayId AS host OUTPUT volumeGroup | eval raidLevel=upper(raidLevel) | `_bytes_to_GiB(capacity)` | eval Preferred=if(tostring(currentManager)==tostring(preferredManager), "TRUE", "FALSE") | lookup nesa_controllers arrayId AS host, controllerRef AS currentManager OUTPUT controllerLabel | rename controllerLabel AS currentManager | lookup nesa_controllers arrayId AS host, controllerRef AS preferredManager OUTPUT controllerLabel | rename controllerLabel AS preferredManager | `nesa_full_volume_table_field_list` | `nesa_full_volume_table_field_renames`</query>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link>
            <![CDATA[
/app/netapp_app_eseries_perf/config_volumes?form.arrayId=$form.arrayId$&form.controllerLabel=*&form.volumeGroup=$row.Volume Groups/Pools$&form.volume=$row.Volume$]]>
          </link>
        </drilldown>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
      <span id="tbltitleUnassignedDrives" class="tbl-title-UnassignedDrives" title="Not a member of pool or VG Location" style="font-size:16px;">Unassigned Drives</span>
      </html>
      <table id="tblConfArrayUnassignedDrives">
        <search base="baseSearch">
          <query>`expand_json_array(drive)` | search available="true" | lookup nesa_drives arrayId AS host, diskId AS id OUTPUT driveLabel | eval driveMediaType=upper(driveMediaType) | eval averageEraseCountPercent=if(driveMediaType="SSD", 'ssdWearLife.averageEraseCountPercent', null()) | eval spareBlocksRemainingPercent=if(driveMediaType="SSD", 'ssdWearLife.spareBlocksRemainingPercent', null()) | foreach usableCapacity, rawCapacity [ `_bytes_to_GiB(&lt;&lt;FIELD&gt;&gt;)` ] | eval driveMediaType=upper(driveMediaType) | foreach currentSpeed, maxSpeed [ eval &lt;&lt;FIELD&gt;&gt;=replace(&lt;&lt;FIELD&gt;&gt;, "speed", "") ] | `nesa_full_drive_table_field_list` | fields - available | `nesa_full_drive_table_field_renames` | eval Interface=upper(Interface)</query>
        </search>
        <option name="wrap">true</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table id="drives_table">
        <title>Drives</title>
        <search base="baseSearch">
          <query><![CDATA[`expand_json_array(drive)` | lookup nesa_drives arrayId AS host, diskId AS id OUTPUT driveLabel | eval driveMediaType=upper(driveMediaType) | eval averageEraseCountPercent=if(driveMediaType="SSD", 'ssdWearLife.averageEraseCountPercent', null()) | eval spareBlocksRemainingPercent=if(driveMediaType="SSD", 'ssdWearLife.spareBlocksRemainingPercent', null()) | foreach usableCapacity, rawCapacity [ `_bytes_to_GiB(<<FIELD>>)` ] | eval driveMediaType=upper(driveMediaType) | foreach currentSpeed, maxSpeed [ eval <<FIELD>>=replace(<<FIELD>>, "speed", "") ] | `nesa_full_drive_table_field_list` | `nesa_full_drive_table_field_renames` | eval Interface=upper(Interface)]]></query>
        </search>
      </table>
    </panel>
  </row>
</form>
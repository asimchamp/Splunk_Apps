<form version="1.1" script="autodiscover.js">
  <label>Configuration - Hierarchical Volumes view</label>
  <fieldset submitButton="false">
    <input type="dropdown" token="arrayId" searchWhenChanged="true">
      <label>Array</label>
      <search>
        <query>
          | inputlookup nesa_volume_groups | stats count by arrayId, arrayName
        </query>
      </search>
      <fieldForLabel>arrayName</fieldForLabel>
      <fieldForValue>arrayId</fieldForValue>
    </input>
    <input type="dropdown" token="controller" searchWhenChanged="true">
      <label>Controller</label>
      <choice value="*">ALL</choice>
      <default>*</default>
      <search>
        <query>
          | inputlookup nesa_controllers | search arrayId="$arrayId$" | dedup controllerLabel
        </query>
      </search>
      <fieldForLabel>controllerLabel</fieldForLabel>
      <fieldForValue>controllerLabel</fieldForValue>
    </input>
  </fieldset>
  <row>
      <html><span>
          This dashboard shows the parent-child relationships for array, controller, and volumes. Hover the mouse over objects to see names. The volumes are the smallest circles and are represented on their owning controller, within their parent volume group or pool. Click on an object to zoom in; click outside the object to zoom out.
      </span></html>
  </row>
  <row>
	<html>
      	<div id="bubbleSearch"
        	class="splunk-manager"
            data-require="splunkjs/mvc/searchmanager"
            data-options='{
        	    "search": {"type": "token_safe", "value": "`get_nesa_index` sourcetype=eseries:volume-stats | search host=$$arrayId$$ | search controllerLabel=\"$$controller$$\" | stats count by host, controllerLabel,volumeGroup, volumeName | JOIN type=LEFT host [inputlookup array_controller_label.csv | rename arrayId as host | table host, arrayName] | stats count by host, arrayName, controllerLabel,volumeGroup, volumeName"},
            	"earliest_time": "-2d",
            	"status_buckets": 0,
            	"cancelOnUnload": true,
            	"auto_cancel": 90,
            	"preview": true
        	}'>
        </div>
        <div id="bubbleChart"
            class="splunk-view"
      		data-require="app/netapp_app_eseries_perf/bubblechart"
            data-options='{
            	"managerid": "bubbleSearch",
				"param": {"type": "token_safe", "value": "$$arrayId$$ $$controller$$"},
				"host": "arrayName",
				"controller": "controllerLabel",
				"volumegroup": "volumeGroup",
                "volumename": "volumeName",
                "height": 1000
            }'>
        </div>
	</html>
  </row>
</form>
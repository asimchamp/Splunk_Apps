<dashboard>
  <label>Deployment Server clientName String</label>
  <description/>
  <row>
    <html>
      <p>This dashboard is designed for environments where the clientName string is used as the primary whitelist method for content distribution within your serverclass.conf file on your Deployment Server. If that is not how your environment is setup feel free to ignore this dashboard.</p>
      <p>There is a bit of crossover between forwarder health and aspects of the Splunk deployment server. The forwarder phonehome logs will contain the forwarder's GUID unless the clientName string has been set in the deploymentclient.conf file. The presence or lack of a GUID becomes something worthwhile to look for. Similar to duplicate GUIDs, if there is duplication clientNames it is likely the forwarder will be sending data but potentially indicates a duplicated virtual server. It could also impact your ability to send individualized content packages.</p>
    </html>
  </row>
  <row>
    <chart>
      <title>Use of clientName Strings</title>
      <searchString>index=_internal source=/opt/splunk/var/log/splunk/splunkd_access.log POST phonehome | rex field=file "connection_.+?_(?&lt;mgmt_port&gt;[^_]+)_(?&lt;fqdn&gt;[^_]+)_(?&lt;hostname&gt;[^_]+)_(?&lt;clientName&gt;.*)" | dedup clientip fqdn hostname | table clientip fqdn hostname mgmt_port clientName | eval guid = if(match(clientName,"^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}"),"GUID","clientName String Set") | stats count by guid</searchString>
      <earliestTime>-15m@m</earliestTime>
      <latestTime>now</latestTime>
      <option name="charting.axisTitleX.visibility">visible</option>
      <option name="charting.axisTitleY.visibility">visible</option>
      <option name="charting.axisX.scale">linear</option>
      <option name="charting.axisY.scale">linear</option>
      <option name="charting.chart">pie</option>
      <option name="charting.chart.nullValueMode">gaps</option>
      <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
      <option name="charting.chart.stackMode">default</option>
      <option name="charting.chart.style">shiny</option>
      <option name="charting.drilldown">all</option>
      <option name="charting.layout.splitSeries">0</option>
      <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
      <option name="charting.legend.placement">right</option>
    </chart>
    <table>
      <title>Reuse of clientName String</title>
      <searchString>index=_internal source=/opt/splunk/var/log/splunk/splunkd_access.log POST phonehome | rex field=file "connection_.+?_(?&lt;mgmt_port&gt;[^_]+)_(?&lt;fqdn&gt;[^_]+)_(?&lt;hostname&gt;[^_]+)_(?&lt;clientName&gt;.*)" | dedup clientip fqdn hostname | stats count by clientName | where count &gt; 1 | sort -count</searchString>
      <earliestTime>-15m@m</earliestTime>
      <latestTime>now</latestTime>
      <option name="wrap">true</option>
      <option name="rowNumbers">false</option>
      <option name="dataOverlayMode">none</option>
      <option name="drilldown">row</option>
      <option name="count">10</option>
    </table>
  </row>
  <row>
    <table>
      <title>Agents without clientName Set</title>
      <searchString>index=_internal source=/opt/splunk/var/log/splunk/splunkd_access.log POST phonehome | rex field=file "connection_.+?_(?&lt;mgmt_port&gt;[^_]+)_(?&lt;fqdn&gt;[^_]+)_(?&lt;hostname&gt;[^_]+)_(?&lt;clientName&gt;.*)" | dedup clientip fqdn hostname | eval guid = if(match(clientName,"^\w{8}-\w{4}-\w{4}-\w{4}-\w{12}"),"GUID","clientName String Set") | where guid="GUID" | table clientip fqdn hostname mgmt_port clientName | rename clientName as GUID | sort clientip</searchString>
      <earliestTime>-15m@m</earliestTime>
      <latestTime>now</latestTime>
    </table>
    <table>
      <title>Reuse of clientName String - Detailed View</title>
      <searchString>index=_internal source=/opt/splunk/var/log/splunk/splunkd_access.log POST phonehome | rex field=file "connection_.+?_(?&lt;mgmt_port&gt;[^_]+)_(?&lt;fqdn&gt;[^_]+)_(?&lt;hostname&gt;[^_]+)_(?&lt;clientName&gt;.*)" | dedup clientip fqdn hostname | stats count values(hostname) as Servers by clientName | where count &gt; 1 | sort -count</searchString>
      <earliestTime>-15m@m</earliestTime>
      <latestTime>now</latestTime>
    </table>
  </row>
</dashboard>

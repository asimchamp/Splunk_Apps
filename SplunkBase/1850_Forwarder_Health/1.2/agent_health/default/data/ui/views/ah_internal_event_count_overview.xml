<dashboard>
  <label>Internal Event Count Overview</label>
  <description/>
  <row>
    <html>
      <h3>Overall Forwarder Health Score</h3>
      <p>This is a self-scaling though simplistic scoring system based on the number of logs over the average internal logs. If a host is generating 5x the average logs 5 is subtracted from 10. To tweak the default internal log filters you can update the agent_internal_logs_blacklist macro.</p>
      <h3>Distribution Dashboards</h3>
      <p>Since these dashboard by default already filter out connections between the forwarders and indexer(s) it can be interesting to compare the health score distribution against the logarithmic distribution dashboards. An ideal state is all forwarders having a score of 10 and very low internal logs being generated.</p>
      <h3>Top Hosts</h3>
      <p>This panel is sorted to show you which systems are sending the most logs and the number of times over the average count of internal logs. By clicking on a row here you will be directed to the Internal Logs - Host View dashboards.</p>
    </html>
  </row>
  <row>
    <single>
      <title>Overall Forwarder Health Score</title>
      <searchString>index=_internal NOT `splunk_indexers` NOT `splunk_search_heads` `agent_internal_logs_blacklist` | stats count as events by host | eventstats avg(events) as avg_events | eval avg_count = floor(events/avg_events) | eval agent_score = 10 - avg_count | eval agent_score = if(agent_score&lt;0, 0, agent_score) | stats avg(agent_score) as avg_agent_score | eval avg_agent_score = round(avg_agent_score,1)</searchString>
      <earliestTime>-24h@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="linkView">search</option>
      <option name="underLabel">Out of 10</option>
    </single>
    <single>
      <title>Average Events</title>
      <searchString>index=_internal NOT `splunk_indexers` NOT `splunk_search_heads` `agent_internal_logs_blacklist` | stats count by host | stats avg(count) as avg_events | table avg_events | eval avg_events = round(avg_events)</searchString>
      <earliestTime>-24h@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="linkView">search</option>
      <option name="underLabel">events per agent</option>
    </single>
  </row>
  <row>
    <table>
      <title>Forwarder Health Score Distribution</title>
      <searchString>index=_internal NOT `splunk_indexers` NOT `splunk_search_heads` `agent_internal_logs_blacklist` | stats count as events by host | eventstats avg(events) as avg_events | eval avg_count = floor(events/avg_events) | eval agent_score = 10 - avg_count | eval agent_score = if(agent_score&lt;0, 0, agent_score) | stats count as hosts by agent_score | sort -agent_score</searchString>
      <earliestTime>-24h@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="wrap">true</option>
      <option name="rowNumbers">false</option>
      <option name="dataOverlayMode">none</option>
      <option name="drilldown">none</option>
      <option name="count">10</option>
    </table>
    <table>
      <title>Logarithmic Distribution of Event Count</title>
      <searchString>index=_internal NOT `splunk_indexers` NOT `splunk_search_heads` `agent_internal_logs_blacklist` | stats count as events by host | bin span=log5 events | stats dc(host) as hosts by events | sort -events</searchString>
      <earliestTime>-24h@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="wrap">true</option>
      <option name="rowNumbers">false</option>
      <option name="dataOverlayMode">none</option>
      <option name="drilldown">none</option>
      <option name="count">10</option>
    </table>
  </row>
  <row>
    <table>
      <title>Top Hosts By Event Count</title>
      <searchString>index=_internal NOT `splunk_indexers` NOT `splunk_search_heads` `agent_internal_logs_blacklist` | stats count as events by host | eventstats avg(events) as avg_events | eval "times over average count" = floor(events/avg_events) | fields - avg_events | sort -"times over average count"</searchString>
      <earliestTime>-24h@h</earliestTime>
      <latestTime>now</latestTime>
      <option name="wrap">true</option>
      <option name="rowNumbers">false</option>
      <option name="dataOverlayMode">none</option>
      <option name="drilldown">row</option>
      <option name="count">10</option>
      <drilldown>
        <link>
          <![CDATA[
          /app/agent_health/ah_host_view?form.host=$row.host$
          ]]>
        </link>
      </drilldown>
    </table>
  </row>
</dashboard>

<dashboard>
	<label>Configuration</label>
	
	<row>
		<html>
			<p>To configure the Splunk Modular Input for MSMQ, you will need to write an input definition, 
			which can be done via the Splunk Manager or by editing the inputs.conf file.  This page consists
			of three parts:</p>
			
			<ol>
				<li>Understanding the Configuration Parameters</li>
				<li>Configuring an MSMQ via the Splunk Manager</li>
				<li>Configuring an MSMQ via inputs.conf</li>
			</ol>
			
			<p>In addition, we provide some additional feature explanations at the bottom of the page.</p>
			
			<h2>Understanding the Configuration Parameters</h2>
			
			<p>In order to configure an MSMQ input, you will need to know the following elements:</p>
			
			<dl>
				<dt>Queue Path</dt>
				<dd>This is the path of the message queue to be accessed.  For more information,refer to 
				the <a href="http://msdn.microsoft.com/library/windows/desktop/ms706083.aspx" target="_blank">MSDN
				documentation</a> on Microsoft Message Queues.</dd>
				<dt>Consumption Mode</dt>
				<dd>When the consumption mode is set to True, messages within the queue will be removed from the 
				queue as they are read.  When the consumption mode is set to False, messages within the queue will 
				not be removed from the queue (the process will use Peek to read the messages).</dd>
				<dt>Polling Interval</dt>
				<dd>To release the processor for other tasks, the process of reading waits for the polling interval 
				between checks of the queue.  You can specify small amounts (including sub-second amounts) of time 
				between polls.  You should specify longer polling intervals if you are not consuming the messages in 
				the queue.  The recommendation is to use 300,000 milli-second (5 minutes) polls when not consuming 
				messages, and 15,000 milli-second (15 seconds) polls when consuming messages.  This value is measured 
				in milliseconds.</dd>
				<dt>Message Handler</dt>
				<dd>The message handler is a C#.NET class that is included in an assembly that formats a message as 
				text. Only a property handler (called <tt>MessagePropertyHandler</tt>) is provided with the Splunk 
				Modular Input for MSMQ, so if you want to consume the message body, then you must 
				<a href="Creating_a_Custom_Message_Handler">write a custom handler</a>.</dd>
			</dl>
			
			<p>Please note that the MSMQ is accessed using the same user privileges as the Splunk process.  If your 
			MSMQ requires domain privileges, then Splunk must be running as a domain user.  Please ensure that the 
			user has the requisite 
			<a href="http://technet.microsoft.com/en-us/library/cc785657(v=WS.10).aspx" target="_blank">Peek or 
			Receive permissions</a> for the target queue.</p>
			
			<h2>Configuring an MSMQ Input via the Splunk Manager</h2>
			
			<p>To configure an MSMQ Input via the Splunk Manager, follow these instructions:</p>
			
			<ol>
				<li>Log onto the Splunk web interface as an administrative user.</li>
				<li>Click on Manager (in the top-right corner)</li>
				<li>Click on Data Inputs (on the right hand side)</li>
				<li>Click on MSMQ Monitoring</li>
				<li>Click on Add New</li>
				<li>Fill in the details from the Configuration Parameters above</li>
				<li>Click on Save</li>
			</ol>
			
			<p>Note that the MSMQ Input provides additional features, including Handler Arguments and Filtering
			options, that are described below.</p>
			
			<h2>Configuring an MSMQ Input via inputs.conf</h2>
			
			<p>Below is an example inputs.conf stanza for a queue called ".\SplunkTest" on server ADMIN1 that 
			will be consumed on a 1 second poll interval.</p>
			
<p><pre>[msmq://SplunkTest]
path = .\SplunkTest
host = ADMIN1
consume_message = 1
handler = MessagePropertyHandler
polling_interval = 1000</pre></p>
			
			<h2>Filtering Options</h2>
			
			<p>In addition to reading the entire queue, the MSMQ data input can filter the inbound messages.  Note 
			that if consume_message is True, the message will not be consumed if it does not match the filter.  You 
			can configure four different filters separately:</p>
			
			<dl>
			<dt>Priority</dt>
			<dd>The Priority is from the list [ Lowest, VeryLow, Low, Normal, AboveNormal, High, VeryHigh, Highest ].  
			If you wish to receive the messages of a particular priority, then list the name of the priority in the 
			filter_priority parameter within inputs.conf.  If you wish to receive multiple priorities, then list all 
			the priorities you wish to receive separated by commas.  In the Splunk Manager, the Filter Priority field 
			can be configured within the Additional Settings section of the data input definition.  If no Filter 
			Priority is set, then messages of all priorities are received.</dd>
			<dt>Type</dt>
			<dd>The Message Type is from the list [ Acknowledgement, Normal, Report ].  If you wish to receive the 
			message of a particular type, then list the name of the message type in the filter_messagetype parameter 
			within inputs.conf (or the Filter Message Type field in the Additional Settings section of the data input 
			definition within Splunk Manager).  If you wish to receive multiple message types, then separate the 
			message types with commas.  If no message type filter is set, then all messages types are received.</dd>
			<dt>Label</dt>
			<dd>The Label is a free-form string parameter within the message.  Filter on the Label by specifying a 
			regular expression within the filter_label parameter (or the Filter Label) field in the Additional 
			Settings section of the data input definition within Splunk Manager).  If you wish to receive multiple 
			labels, then adjust the label regular expression.  If no label filter is set, then all labels are 
			received.</dd>
			<dt>App Specific</dt>
			<dd>The App Specific field is an integer passed within the message.  Filter on the App Specific field by 
			specifying an integer within the filter_appspecific parameter  within inputs.conf (or the Filter App 
			Specific field in the Additional Settings section of the data input definition within Splunk Manager).  
			If no app specific filter is specified, then all messages are received.</dd>
			</dl>
			
			<p>If you specify multiple filters, then all filters must pass for the message to be received.  Thus 
			Priority=High and Type=Normal would indicate that messages with a Normal message type and a High priority 
			would be received.</p>
			
			<h2>Specifying Optional Handler Arguments</h2>
			
			<p>Sometimes, the message handler will require a configuration string to be specified to properly receive 
			the messages.  In this case, the Handler Arguments field (or handler_args parameter within inputs.conf) 
			can be used to specify the configuration string.  Refer to the message handler in question for details 
			on what is required.  The provided handler(MessagePropertyHandler) does not require any special 
			configuration.</p>
			
		</html>
	</row>
	
</dashboard>